(function(){var b={init:function(c,d){return this.each(function(){var p=$(this);var o=p.clone();var i=$.extend({id:p.attr("id"),swf:$.coral.scriptPath+"external/swfupload.swf",uploader:"swfupload.php",auto:true,buttonClass:"",buttonCursor:"hand",buttonImage:null,buttonText:"SELECT FILES",checkExisting:false,debug:false,fileObjName:"Filedata",fileSizeLimit:0,fileTypeDesc:"All Files",fileTypeExts:"*.*",height:30,itemTemplate:false,method:"post",multi:true,formData:{},preventCaching:true,progressData:"percentage",queueID:false,queueSizeLimit:999,removeCompleted:true,removeTimeout:3,requeueErrors:false,successTimeout:30,uploadLimit:0,width:120,overrideEvents:[]},c);var f={assume_success_timeout:i.successTimeout,button_placeholder_id:i.id,button_width:i.width,button_height:i.height,button_text:null,button_text_style:null,button_text_top_padding:0,button_text_left_padding:0,button_action:(i.multi?SWFUpload.BUTTON_ACTION.SELECT_FILES:SWFUpload.BUTTON_ACTION.SELECT_FILE),button_disabled:false,button_cursor:(i.buttonCursor=="arrow"?SWFUpload.CURSOR.ARROW:SWFUpload.CURSOR.HAND),button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,debug:i.debug,requeue_on_error:i.requeueErrors,file_post_name:i.fileObjName,file_size_limit:i.fileSizeLimit,file_types:i.fileTypeExts,file_types_description:i.fileTypeDesc,file_queue_limit:i.queueSizeLimit,file_upload_limit:i.uploadLimit,flash_url:i.swf,prevent_swf_caching:i.preventCaching,post_params:i.formData,upload_url:i.uploader,use_query_string:(i.method=="get"),file_dialog_complete_handler:a.onDialogClose,file_dialog_start_handler:a.onDialogOpen,file_queued_handler:a.onSelect,file_queue_error_handler:a.onSelectError,swfupload_loaded_handler:i.onSWFReady,upload_complete_handler:a.onUploadComplete,upload_error_handler:a.onUploadError,upload_progress_handler:a.onUploadProgress,upload_start_handler:a.onUploadStart,upload_success_handler:a.onUploadSuccess};if(d){f=$.extend(f,d)}f=$.extend(f,i);var q=swfobject.getFlashPlayerVersion();var g=(q.major>=9);
if(g){window["uploadify_"+i.id]=new SWFUpload(f);var h=window["uploadify_"+i.id];p.data("uploadify",h);var n=$("<div />",{id:i.id,"class":"uploadify",css:{height:i.height+"px",width:i.width+"px"}});$("#"+h.movieName).wrap(n);n=$("#"+i.id);n.data("uploadify",h);var e=$("<div />",{id:i.id+"-button","class":"uploadify-button "+i.buttonClass});if(i.buttonImage){e.css({"background-image":"url('"+i.buttonImage+"')","text-indent":"-9999px"})}e.html('<span class="uploadify-button-text">'+i.buttonText+"</span>").css({height:i.height+"px","line-height":i.height+"px",width:i.width+"px"});n.append(e);$("#"+h.movieName).css({position:"absolute","z-index":1});if(!i.queueID){var l=$("<div />",{id:i.id+"-queue","class":"uploadify-queue"});n.after(l);h.settings.queueID=i.id+"-queue";h.settings.defaultQueue=true}h.queueData={files:{},filesSelected:0,filesQueued:0,filesReplaced:0,filesCancelled:0,filesErrored:0,uploadsSuccessful:0,uploadsErrored:0,averageSpeed:0,queueLength:0,queueSize:0,uploadSize:0,queueBytesUploaded:0,uploadQueue:[],errorMsg:"Some files were not added to the queue:"};h.original=o;h.wrapper=n;h.button=e;h.queue=l;if(i.onInit){i.onInit.call(p,h)}}else{if(i.onFallback){i.onFallback.call(p)}var k=i.onNoflash.call(p);var m=$("<div class='coral-uploader-button' style='height: 40px;'></div>").appendTo(k);var j=$("<input type='button'/>").appendTo(m);j.button({id:i.id+"-button",label:i.buttonText,onClick:function(){alert("没有安装flash或flash版本过低")}})}})},cancel:function(c,e){var d=arguments;this.each(function(){var k=$(this),h=k.data("uploadify"),i=h.settings,g=-1;if(d[0]){if(d[0]=="*"){var f=h.queueData.queueLength;$("#"+i.queueID).find(".uploadify-queue-item").each(function(){g++;if(d[1]===true){h.cancelUpload($(this).attr("id"),false)}else{h.cancelUpload($(this).attr("id"))}$(this).find(".data").removeClass("data").html(" - Cancelled");$(this).find(".uploadify-progress-bar").remove();$(this).delay(1000+100*g).fadeOut(500,function(){$(this).remove()});delete h.queueData.files[c]
});h.queueData.queueSize=0;h.queueData.queueLength=0;if(i.onClearQueue){i.onClearQueue.call(k,f)}}else{for(var l=0;l<d.length;l++){h.cancelUpload(d[l]);$("#"+d[l]).find(".data").removeClass("data").html(" - Cancelled");$("#"+d[l]).find(".uploadify-progress-bar").remove();$("#"+d[l]).delay(1000+100*l).fadeOut(500,function(){$(this).remove()});delete h.queueData.files[c]}}}else{var j=$("#"+i.queueID).find(".uploadify-queue-item").get(0);$item=$(j);h.cancelUpload($item.attr("id"));$item.find(".data").removeClass("data").html(" - Cancelled");$item.find(".uploadify-progress-bar").remove();$item.delay(1000).fadeOut(500,function(){$(this).remove()});delete h.queueData.files[c]}})},destroy:function(){this.each(function(){var e=$(this),c=e.data("uploadify"),d=c.settings;c.destroy();if(d.defaultQueue){$("#"+d.queueID).remove()}$("#"+d.id).replaceWith(c.original);if(d.onDestroy){d.onDestroy.call(this)}delete c})},disable:function(c){this.each(function(){var f=$(this),d=f.data("uploadify"),e=d.settings;if(c){d.button.addClass("disabled");if(e.onDisable){e.onDisable.call(this)}}else{d.button.removeClass("disabled");if(e.onEnable){e.onEnable.call(this)}}d.setButtonDisabled(c)})},settings:function(d,f,g){var c=arguments;var e=f;this.each(function(){var j=$(this),h=j.data("uploadify"),i=h.settings;if(typeof(c[0])=="object"){for(var k in f){setData(k,f[k])}}if(c.length===1){e=i[d]}else{switch(d){case"uploader":h.setUploadURL(f);break;case"formData":if(!g){f=$.extend(i.formData,f)}h.setPostParams(i.formData);break;case"method":if(f=="get"){h.setUseQueryString(true)}else{h.setUseQueryString(false)}break;case"fileObjName":h.setFilePostName(f);break;case"fileTypeExts":h.setFileTypes(f,i.fileTypeDesc);break;case"fileTypeDesc":h.setFileTypes(i.fileTypeExts,f);break;case"fileSizeLimit":h.setFileSizeLimit(f);break;case"uploadLimit":h.setFileUploadLimit(f);break;case"queueSizeLimit":h.setFileQueueLimit(f);break;case"buttonImage":h.button.css("background-image",settingValue);break;case"buttonCursor":if(f=="arrow"){h.setButtonCursor(SWFUpload.CURSOR.ARROW)
}else{h.setButtonCursor(SWFUpload.CURSOR.HAND)}break;case"buttonText":$("#"+i.id+"-button").find(".uploadify-button-text").html(f);break;case"width":h.setButtonDimensions(f,i.height);break;case"height":h.setButtonDimensions(i.width,f);break;case"multi":if(f){h.setButtonAction(SWFUpload.BUTTON_ACTION.SELECT_FILES)}else{h.setButtonAction(SWFUpload.BUTTON_ACTION.SELECT_FILE)}break}i[d]=f}});if(c.length===1){return e}},stop:function(){this.each(function(){var d=$(this),c=d.data("uploadify");c.queueData.averageSpeed=0;c.queueData.uploadSize=0;c.queueData.bytesUploaded=0;c.queueData.uploadQueue=[];c.stopUpload()})},upload:function(){var c=arguments;this.each(function(){var e=$(this),d=e.data("uploadify");d.queueData.averageSpeed=0;d.queueData.uploadSize=0;d.queueData.bytesUploaded=0;d.queueData.uploadQueue=[];if(c[0]){if(c[0]=="*"){d.queueData.uploadSize=d.queueData.queueSize;d.queueData.uploadQueue.push("*");d.startUpload()}else{for(var f=0;f<c.length;f++){d.queueData.uploadSize+=d.queueData.files[c[f]].size;d.queueData.uploadQueue.push(c[f])}d.startUpload(d.queueData.uploadQueue.shift())}}else{d.startUpload()}})}};var a={onDialogOpen:function(){var c=this.settings;this.queueData.errorMsg="Some files were not added to the queue:";this.queueData.filesReplaced=0;this.queueData.filesCancelled=0;if(c.onDialogOpen){c.onDialogOpen.call(this)}},onDialogClose:function(c,e,f){var d=this.settings;this.queueData.filesErrored=c-e;this.queueData.filesSelected=c;this.queueData.filesQueued=e-this.queueData.filesCancelled;this.queueData.queueLength=f;if($.inArray("onDialogClose",d.overrideEvents)<0){if(this.queueData.filesErrored>0){alert(this.queueData.errorMsg)}}if(d.onDialogClose){d.onDialogClose.call(this,this.queueData)}if(d.auto){$("#"+d.id).uploadify("upload","*")}},onSelect:function(g){var h=this.settings;var e={};for(var f in this.queueData.files){e=this.queueData.files[f];if(e.uploaded!=true&&e.name==g.name){var c=confirm('The file named "'+g.name+'" is already in the queue.\nDo you want to replace the existing item in the queue?');
if(!c){this.cancelUpload(g.id);this.queueData.filesCancelled++;return false}else{$("#"+e.id).remove();delete this.queueData.files[f];this.cancelUpload(e.id);this.queueData.filesReplaced++}}}var i=Math.round(g.size/1024);var m="KB";if(i>1000){i=Math.round(i/1000);m="MB"}var k=i.toString().split(".");i=k[0];if(k.length>1){i+="."+k[1].substr(0,2)}i+=m;var j=g.name;if(j.length>25){j=j.substr(0,25)+"..."}itemData={fileID:g.id,instanceID:h.id,fileName:j,fileSize:i};if(h.itemTemplate==false){h.itemTemplate='<div id="${fileID}" class="uploadify-queue-item">					<div class="cancel">						<a href="javascript:$(\'#${instanceID}\').uploadify(\'cancel\', \'${fileID}\')">X</a>					</div>					<span class="fileName">${fileName} (${fileSize})</span><span class="data"></span>					<div class="uploadify-progress">						<div class="uploadify-progress-bar"><!--Progress Bar--></div>					</div>				</div>'}if($.inArray("onSelect",h.overrideEvents)<0){itemHTML=h.itemTemplate;for(var l in itemData){itemHTML=itemHTML.replace(new RegExp("\\$\\{"+l+"\\}","g"),itemData[l])}$("#"+h.queueID).append(itemHTML)}this.queueData.queueSize+=g.size;this.queueData.files[g.id]=g;if(h.onSelect){h.onSelect.apply(this,arguments)}},onSelectError:function(c,f,e){var d=this.settings;if($.inArray("onSelectError",d.overrideEvents)<0){switch(f){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:if(d.queueSizeLimit>e){this.queueData.errorMsg+="\nThe number of files selected exceeds the remaining upload limit ("+e+")."}else{this.queueData.errorMsg+="\nThe number of files selected exceeds the queue size limit ("+d.queueSizeLimit+")."}break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.queueData.errorMsg+='\nThe file "'+c.name+'" exceeds the size limit ('+d.fileSizeLimit+").";break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:this.queueData.errorMsg+='\nThe file "'+c.name+'" is empty.';break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:this.queueData.errorMsg+='\nThe file "'+c.name+'" is not an accepted file type ('+d.fileTypeDesc+").";
break}}if(f!=SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED){delete this.queueData.files[c.id]}if(d.onSelectError){d.onSelectError.apply(this,arguments)}},onQueueComplete:function(){if(this.settings.onQueueComplete){this.settings.onQueueComplete.call(this,this.settings.queueData)}},onUploadComplete:function(e){var f=this.settings,c=this;var d=this.getStats();this.queueData.queueLength=d.files_queued;if(this.queueData.uploadQueue[0]=="*"){if(this.queueData.queueLength>0){this.startUpload()}else{this.queueData.uploadQueue=[];if(f.onQueueComplete){f.onQueueComplete.call(this,this.queueData)}}}else{if(this.queueData.uploadQueue.length>0){this.startUpload(this.queueData.uploadQueue.shift())}else{this.queueData.uploadQueue=[];if(f.onQueueComplete){f.onQueueComplete.call(this,this.queueData)}}}if($.inArray("onUploadComplete",f.overrideEvents)<0){if(f.removeCompleted){switch(e.filestatus){case SWFUpload.FILE_STATUS.COMPLETE:setTimeout(function(){if($("#"+e.id)){c.queueData.queueSize-=e.size;c.queueData.queueLength-=1;delete c.queueData.files[e.id];$("#"+e.id).fadeOut(500,function(){$(this).remove()})}},f.removeTimeout*1000);break;case SWFUpload.FILE_STATUS.ERROR:if(!f.requeueErrors){setTimeout(function(){if($("#"+e.id)){c.queueData.queueSize-=e.size;c.queueData.queueLength-=1;delete c.queueData.files[e.id];$("#"+e.id).fadeOut(500,function(){$(this).remove()})}},f.removeTimeout*1000)}break}}else{e.uploaded=true}}if(f.onUploadComplete){f.onUploadComplete.call(this,e)}},onUploadError:function(d,h,g){var e=this.settings;var f="Error";switch(h){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:f="HTTP Error ("+g+")";break;case SWFUpload.UPLOAD_ERROR.MISSING_UPLOAD_URL:f="Missing Upload URL";break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:f="IO Error";break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:f="Security Error";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:alert("The upload limit has been reached ("+g+").");f="Exceeds Upload Limit";break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:f="Failed";
break;case SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND:break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:f="Validation Error";break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:f="Cancelled";this.queueData.queueSize-=d.size;this.queueData.queueLength-=1;if(d.status==SWFUpload.FILE_STATUS.IN_PROGRESS||$.inArray(d.id,this.queueData.uploadQueue)>=0){this.queueData.uploadSize-=d.size}if(e.onCancel){e.onCancel.call(this,d)}delete this.queueData.files[d.id];break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:f="Stopped";break}if($.inArray("onUploadError",e.overrideEvents)<0){if(h!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED&&h!=SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED){$("#"+d.id).addClass("uploadify-error")}$("#"+d.id).find(".uploadify-progress-bar").css("width","1px");if(h!=SWFUpload.UPLOAD_ERROR.SPECIFIED_FILE_ID_NOT_FOUND&&d.status!=SWFUpload.FILE_STATUS.COMPLETE){$("#"+d.id).find(".data").html(" - "+f)}}var c=this.getStats();this.queueData.uploadsErrored=c.upload_errors;if(e.onUploadError){e.onUploadError.call(this,d,h,g,f)}},onUploadProgress:function(f,l,i){var g=this.settings;var d=new Date();var m=d.getTime();var j=m-this.timer;if(j>500){this.timer=m}var h=l-this.bytesLoaded;this.bytesLoaded=l;var c=this.queueData.queueBytesUploaded+l;var o=Math.round(l/i*100);var n="KB/s";var k=0;var e=(h/1024)/(j/1000);e=Math.floor(e*10)/10;if(this.queueData.averageSpeed>0){this.queueData.averageSpeed=Math.floor((this.queueData.averageSpeed+e)/2)}else{this.queueData.averageSpeed=Math.floor(e)}if(e>1000){k=(e*0.001);this.queueData.averageSpeed=Math.floor(k);n="MB/s"}if($.inArray("onUploadProgress",g.overrideEvents)<0){if(g.progressData=="percentage"){$("#"+f.id).find(".data").html(" - "+o+"%")}else{if(g.progressData=="speed"&&j>500){$("#"+f.id).find(".data").html(" - "+this.queueData.averageSpeed+n)}}$("#"+f.id).find(".uploadify-progress-bar").css("width",o+"%")}if(g.onUploadProgress){g.onUploadProgress.call(this,f,l,i,c,this.queueData.uploadSize)}},onUploadStart:function(c){var d=this.settings;
var e=new Date();this.timer=e.getTime();this.bytesLoaded=0;if(this.queueData.uploadQueue.length==0){this.queueData.uploadSize=c.size}if(d.checkExisting){$.ajax({type:"POST",async:false,url:d.checkExisting,data:{filename:c.name},success:function(g){if(g==1){var f=confirm('A file with the name "'+c.name+'" already exists on the server.\nWould you like to replace the existing file?');if(!f){this.cancelUpload(c.id);$("#"+c.id).remove();if(this.queueData.uploadQueue.length>0&&this.queueData.queueLength>0){if(this.queueData.uploadQueue[0]=="*"){this.startUpload()}else{this.startUpload(this.queueData.uploadQueue.shift())}}}}}})}if(d.onUploadStart){d.onUploadStart.call(this,c)}},onUploadSuccess:function(e,g,c){var f=this.settings;var d=this.getStats();this.queueData.uploadsSuccessful=d.successful_uploads;this.queueData.queueBytesUploaded+=e.size;if($.inArray("onUploadSuccess",f.overrideEvents)<0){$("#"+e.id).find(".data").html(" - 上传完成")}if(f.onUploadSuccess){f.onUploadSuccess.call(this,e,g,c)}}};$.fn.uploadify=function(c){if(b[c]){return b[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof c==="object"||!c){return b.init.apply(this,arguments)}else{$.error("The method "+c+" does not exist in $.uploadify")}}}})();