$.component("coral.tabs",{version:"4.0.1",delay:300,options:{active:0,collapsible:false,event:"click",loadonce:true,destroyAllonActive:false,heightStyle:"content",hide:null,show:null,loadtext:"加载中，请耐心等候...",method:"GET",newbtn:false,name:null,onTabNew:null,onActivate:null,onLoad:null,beforeActivate:null,beforeLoad:null,beforeTabClose:null,onTabClose:null},_create:function(){var b=this,a=this.options;if(a.method!=null&&a.method!=""){a.method=(a.method+"").toUpperCase()}else{a.method="GET"}this.running=false;this.element.addClass("coral-tabs ctrl-init ctrl-init-tabs coral-component coral-component-content coral-corner-all").toggleClass("coral-tabs-collapsible",a.collapsible);this._processTabs();if(typeof a.newbtn=="boolean"&&a.newbtn){this.addnewbtn()}a.active=this._initialActive();if($.isArray(a.disabled)){a.disabled=$.unique(a.disabled.concat($.map(this.tabs.filter(".coral-state-disabled"),function(c){return b.tabs.index(c)}))).sort()}if(this.options.active!==false&&this.anchors.length){this.active=this._findActive(a.active)}else{this.active=$()}this._refresh();if(this.active.length){this.load(a.active)}if(this.element.hasClass("coral-tabs-bottom")){$(".coral-tabs-bottom .coral-tabs-nav, .coral-tabs-bottom .coral-tabs-nav > *").removeClass("coral-corner-all coral-corner-top").addClass("coral-corner-bottom")}else{if(this.element.hasClass("coral-tabs-right")){this.element.addClass("coral-tabs-right coral-helper-clearfix").removeClass("coral-corner-top").addClass("coral-corner-left")}else{if(this.element.hasClass("coral-tabs-left")){this.element.removeClass("coral-corner-top").addClass("coral-tabs-left coral-helper-clearfix coral-corner-left")}}}},_isLocal:(function(){var a=/#.*$/;return function(c){var e,d;c=c.cloneNode(false);return c.hash.length>1&&c.href.indexOf("#")!=-1;e=c.href.replace(a,"");d=location.href.replace(a,"");try{e=decodeURIComponent(e)}catch(b){}try{d=decodeURIComponent(d)}catch(b){}return c.hash.length>1&&e===d}})(),_initialActive:function(){var b=this.options.active,a=this.options.collapsible,c=location.hash.substring(1);
if(b===null){if(c){this.tabs.each(function(d,e){if($(e).attr("aria-controls")===c){b=d;return false}})}if(b===null){b=this.tabs.index(this.tabs.filter(".coral-state-active"))}if(b===null||b===-1){b=this.tabs.length?0:false}}if(b!==false){b=this.tabs.index(this.tabs.eq(b));if(b===-1){b=a?false:0}}if(!a&&b===false&&this.anchors.length){b=0}return b},_getCreateEventData:function(){return{tab:this.active,panel:!this.active.length?$():this._getPanelForTab(this.active)}},_tabKeydown:function(c){var b=$(this.document[0].activeElement).closest("li"),a=this.tabs.index(b),d=true;if(this._handlePageNav(c)){return}switch(c.keyCode){case $.coral.keyCode.RIGHT:case $.coral.keyCode.DOWN:a++;break;case $.coral.keyCode.UP:case $.coral.keyCode.LEFT:d=false;a--;break;case $.coral.keyCode.END:a=this.anchors.length-1;break;case $.coral.keyCode.HOME:a=0;break;case $.coral.keyCode.SPACE:c.preventDefault();clearTimeout(this.activating);this._activate(a);return;case $.coral.keyCode.ENTER:c.preventDefault();clearTimeout(this.activating);this._activate(a===this.options.active?false:a);return;default:return}c.preventDefault();clearTimeout(this.activating);a=this._focusNextTab(a,d);if(!c.ctrlKey){b.attr("aria-selected","false");this.tabs.eq(a).attr("aria-selected","true");this.activating=this._delay(function(){this.option("active",a)},this.delay)}},_panelKeydown:function(a){if(this._handlePageNav(a)){return}if(a.ctrlKey&&a.keyCode===$.coral.keyCode.UP){a.preventDefault();this.active.focus()}},_handlePageNav:function(a){if(a.altKey&&a.keyCode===$.coral.keyCode.PAGE_UP){this._activate(this._focusNextTab(this.options.active-1,false));return true}if(a.altKey&&a.keyCode===$.coral.keyCode.PAGE_DOWN){this._activate(this._focusNextTab(this.options.active+1,true));return true}},_findNextTab:function(b,c){var a=this.tabs.length-1;function d(){if(b>a){b=0}if(b<0){b=a}return b}while($.inArray(d(),this.options.disabled)!==-1){b=c?b+1:b-1}return b},_focusNextTab:function(a,b){a=this._findNextTab(a,b);this.tabs.eq(a).focus();
return a},_setOption:function(a,b){if(a==="active"){if(typeof b==="string"){this._activate(this._getIndex(b))}else{this._activate(b)}return}if(a==="disabled"){this._setupDisabled(b);return}this._super(a,b);if(a==="collapsible"){this.element.toggleClass("coral-tabs-collapsible",b);if(!b&&this.options.active===false){this._activate(0)}}if(a==="event"){this._setupEvents(b)}if(a==="heightStyle"){this._setupHeightStyle(b)}},_tabId:function(a){return a.attr("aria-controls")||"coral-tabs-"+getNextTabId()},_sanitizeSelector:function(a){return a?a.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var b=this.options,a=this.tablist.children(":has(a[href])");b.disabled=$.map(a.filter(".coral-state-disabled"),function(c){return a.index(c)});this._processTabs();if(b.active===false||!this.anchors.length){b.active=false;this.active=$()}else{if(this.active.length&&!$.contains(this.tablist[0],this.active[0])){if(this.tabs.length===b.disabled.length){b.active=false;this.active=$()}else{this._activate(this._findNextTab(Math.max(0,b.active-1),false))}}else{b.active=this.tabs.index(this.active)}}this._refresh()},_refresh:function(){var a=this;this._setupDisabled(this.options.disabled);this._setupEvents(this.options.event);this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1});this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"});if(!this.active.length){this.tabs.eq(0).attr("tabIndex",0)}else{this.active.addClass("coral-tabs-active coral-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0});this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})}this._setupHeightStyle(this.options.heightStyle)},add:function(g){g=g||{};var f=this.options.disabled,d=null,c=g.tabId,k=null,j=g.label,i=g.ariaControls,m=false,a=g.href,b=g.closeable==undefined?false:g.closeable,l=b===true?"<span class='coral-closable cui-icon-cross2'></span>":"",h=g.content;if(f===true){return
}if(typeof this.options.newbtn=="boolean"&&this.options.newbtn){this.tablist.find("> li:last").remove()}if(i){d=i}else{if(typeof a==="undefined"){d=$({}).uniqueId()[0].id}else{d=a;if(d.indexOf("#")==0){d=d.substr(1)}else{m=true}}}c=c?"id="+c:"";var e="<li "+c+"><a href='#{href}'>"+j+"</a>{closespan}</li>";e=e.replace(/\{closespan\}/g,l);if(!m){k=$(e.replace(/#\{href\}/g,"#"+d))}else{k=$(e.replace(/#\{href\}/g,d));this.component().find(">.coral-tabs-nav").append(k);this.component().tabs("refresh");return}if(i){k.attr("aria-controls",i)}this.component().find(">.coral-tabs-nav").append(k);if(this.element.hasClass("coral-tabs-bottom")){this.component().find(">.coral-tabs-nav").before("<div id='"+d+"'>"+h+"</div>")}else{this.component().append("<div id='"+d+"'>"+h+"</div>")}this.component().tabs("refresh");if(typeof this.options.newbtn=="boolean"&&this.options.newbtn){this.addnewbtn()}},remove:function(a){if(this.options.disabled){return}if(a instanceof Array){for(var b in a){this._remove(a[b])}this._refresh()}else{this._remove(a)}},_remove:function(b){var c;if(typeof b=="undefined"){c=this.options.active}else{if(typeof b=="string"){c=this.getIndexById(b)}else{c=b}}var a=this._getList().find("> li:has(a[href])").eq(c).attr("aria-controls");this.component().find("li[aria-controls='"+a+"']").remove();this.component().find("div#"+a).remove()},addnewbtn:function(){var b=this;var a=$("<li class='coral-tabs-newbtn coral-corner-top'><a class='coral-tabs-anchor'><span class='cui-icon-plus-circle2'></span></a></li>");a.unbind("click").bind("click",function(c){if(true===b.options.disabled){return}b._trigger("onTabNew",null,[])});this.tablist.append(a);b._hoverable(a)},_processTabs:function(){var a=this;this.tablist=this._getList().addClass("coral-tabs-nav coral-helper-reset coral-helper-clearfix coral-component-header coral-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(b){if($(this).is(".coral-state-disabled")){b.preventDefault()}}).delegate(".coral-tabs-anchor","focus"+this.eventNamespace,function(){if($(this).closest("li").is(".coral-state-disabled")){this.blur()
}});this.tabs=this.tablist.find("> li:has(a[href])").addClass("coral-state-default coral-corner-top").attr({role:"tab",tabIndex:-1});this.tabs=this.tabs.filter(function(){if($(this).data("authority")==false){$(this).remove();var b=$(this).find(">a").attr("href");if(b.slice(0,1)=="#"){$("body").find(b).remove()}return false}else{return true}});this.anchors=this.tabs.map(function(){return $("a",this)[0]}).addClass("coral-tabs-anchor").attr({role:"presentation",tabIndex:-1});this.panels=$();this.anchors.each(function(g,e){var b,c,f,d=$(e).uniqueId().attr("id"),h=$(e).closest("li"),j=h.attr("aria-controls");h.find(".coral-closable").addClass("cui-icon-cross2");if(a._isLocal(e)){b=e.hash;f=b.substring(1);c=a.element.find(a._sanitizeSelector(b))}else{f=h.attr("aria-controls")||$({}).uniqueId()[0].id;b="#"+f;c=a.element.find(b);if(!c.length){c=a._createPanel(f);if(a.element.hasClass("coral-tabs-bottom")){c.insertBefore(a.panels[g-1]||a.tablist)}else{c.insertAfter(a.panels[g-1]||a.tablist)}}c.attr("aria-live","polite")}if(c.length){a.panels=a.panels.add(c)}if(j){h.data("coral-tabs-aria-controls",j)}h.attr({"aria-controls":f,"aria-labelledby":d});c.attr("aria-labelledby",d)});this.panels.addClass("coral-tabs-panel coral-component-content coral-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.tablist||this.element.find(">ol,>ul").eq(0)},_createPanel:function(a){return $("<div>").attr("id",a).addClass("coral-tabs-panel coral-component-content coral-corner-bottom").data("coral-tabs-destroy",true)},_setupDisabled:function(c){if($.isArray(c)){if(!c.length){c=false}else{if(c.length===this.anchors.length){c=true}}}for(var b=0,a;(a=this.tabs[b]);b++){if(c===true||$.inArray(b,c)!==-1){$(a).addClass("coral-state-disabled").attr("aria-disabled","true")}else{$(a).removeClass("coral-state-disabled").removeAttr("aria-disabled")}}this.options.disabled=c},_setupEvents:function(c){var b=this;var a={};if(c){$.each(c.split(" "),function(e,d){a[d]="_eventHandler"})}this._off(this.anchors.add(this.tabs).add(this.panels).add(this.tabs.children("span.cui-icon-cross2")));
this._on(true,this.anchors,{click:function(d){d.preventDefault()}});this._on(this.anchors,a);this._on(this.tabs.children("span.coral-closable"),{click:"_tabClose"});this._on(this.panels,{keydown:"_panelKeydown"});this._on(this.tabs,{keydown:"_tabKeydown"});this._focusable(this.tabs);this._hoverable(this.tabs)},_tabClose:function(f){var c=this;if(c.options.disabled===true){return}var d=$(f.target),h=d.closest("li"),a=h.attr("aria-controls"),g=c._getPanelForTab(h),b={currentTab:h,currentPanel:g,panelId:a};if(c._trigger("beforeTabClose",f,b)===false){return}h.remove();c.element.find("#"+a).remove();c._trigger("onTabClose",f,b);c.refresh()},_setupHeightStyle:function(c){var f,e,h=false,d=this.element.parent();if(c==="fill"){$.coral.fitParent(this.component(),true);f=d.height();e=d.width();d.addClass("coral-noscroll");f-=this.element.outerHeight()-this.element.height();this.element.siblings(":visible").not("script").each(function(){var j=$(this),i=j.css("position");if(i==="absolute"||i==="fixed"){return}f-=j.outerHeight()});this.element.children().not(this.panels).each(function(){if($(this).parent().hasClass("coral-tabs-right")||$(this).parent().hasClass("coral-tabs-left")){var i=$(this).css("position");h=true;if(i==="absolute"||i==="fixed"){return}e-=$(this).outerWidth(true);return}f-=$(this).outerHeight(true)});var b;var a=this.panels.filter(":visible");b=a.outerHeight()-a.innerHeight();this.panels.each(function(){$(this).height(Math.max(0,f-b-$(this).innerHeight()+$(this).height()))});if(h){var g=this.element.children("ul");g.height(Math.max(0,f-g.innerHeight()+g.height()))}}else{if(c==="auto"){f=0;this.panels.each(function(){f=Math.max(f,$(this).height("").height());$(this).width("")}).height(f)}}this.panels.each(function(){if($(this).is(":visible")){$.coral.refreshAllComponent($(this))}})},_eventHandler:function(a){var j=this.options,e=this.active,f=$(a.currentTarget),d=f.closest("li"),h=d[0]===e[0],b=h&&j.collapsible,c=b?$():this._getPanelForTab(d),g=!e.length?$():this._getPanelForTab(e),i={oldTab:e,oldPanel:g,newTab:b?$():d,newPanel:c};
a.preventDefault();if(d.hasClass("coral-state-disabled")||d.hasClass("coral-tabs-loading")||this.running||(h&&!j.collapsible)||(this._trigger("beforeActivate",a,i)===false)){return}j.active=b?false:this.tabs.index(d);this.active=h?$():d;if(this.xhr){this.xhr.abort()}if(!g.length&&!c.length){$.error("jQuery UI Tabs: Mismatching fragment identifier.")}if(c.length){this.load(this.tabs.index(d),a)}this._toggle(a,i)},_toggle:function(g,f){var e=this,a=f.newPanel,d=f.oldPanel;this.running=true;function c(){e.running=false;e._trigger("onActivate",g,f);$.coral.refreshAllComponent(a)}function b(){f.newTab.closest("li").addClass("coral-tabs-active coral-state-active");if(a.length&&e.options.show){e._show(a,e.options.show,c)}else{a.show();c()}}if(d.length&&this.options.hide){this._hide(d,this.options.hide,function(){f.oldTab.closest("li").removeClass("coral-tabs-active coral-state-active");b()})}else{f.oldTab.closest("li").removeClass("coral-tabs-active coral-state-active");d.hide();b()}d.attr("aria-hidden","true");f.oldTab.attr({"aria-selected":"false","aria-expanded":"false"});if(a.length&&d.length){f.oldTab.attr("tabIndex",-1)}else{if(a.length){this.tabs.filter(function(){return $(this).attr("tabIndex")===0}).attr("tabIndex",-1)}}a.attr("aria-hidden","false");f.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(b){if(b==-1){return}var a,c=this._findActive(b);if(c[0]===this.active[0]){return}if(!c.length){c=this.active}a=c.find(".coral-tabs-anchor")[0];this._eventHandler({target:a,currentTarget:a,preventDefault:$.noop})},_findActive:function(a){return a===false?$():this.tabs.eq(a)},_getIndex:function(a){if(typeof a==="string"){a=this.anchors.index(this.anchors.filter("[href$='"+a+"']"))}return a},getIdByIndex:function(b){var a=this.tablist.children("li").filter(function(){return $(this).hasClass("coral-state-default")});return a.eq(b).attr("aria-controls")},getIndexById:function(b){var a=this.tablist.children("li").filter(function(){return $(this).hasClass("coral-state-default")
});return a.index(a.filter("[aria-controls$='"+b+"']"))},getIndexByTabId:function(b){var a=this.tablist.children("li").filter(function(){return $(this).hasClass("coral-state-default")});return a.index(a.filter("#"+b))},getAllTabId:function(){return this.getPanelIds()},getPanelIds:function(){var a=[];this.tabs.filter("[aria-controls]").each(function(){var b=$(this).attr("aria-controls");if(""!=b){a.push(b)}});return a},getTabIds:function(){var b=[];var a=this.tablist.children("li").each(function(){var c=$(this).attr("id");if(""!=c){b.push(c)}});return b},getTabEl:function(){var a=this.tablist.children("li.coral-state-default");return a},getPanelEl:function(){return{}},getLength:function(){return this.tabs.find("[aria-controls]").length},_destroy:function(){if(this.xhr){this.xhr.abort()}this.element.removeClass("coral-tabs coral-component coral-component-content coral-corner-all coral-tabs-collapsible");this.tablist.removeClass("coral-tabs-nav coral-helper-reset coral-helper-clearfix coral-component-header coral-corner-all").removeAttr("role");this.anchors.removeClass("coral-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId();this.tablist.unbind(this.eventNamespace);this.tabs.add(this.panels).each(function(){if($.data(this,"coral-tabs-destroy")){$(this).remove()}else{$(this).removeClass("coral-state-default coral-state-active coral-state-disabled coral-corner-top coral-corner-bottom coral-component-content coral-state-active coral-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}});this.tabs.each(function(){var a=$(this),b=a.data("coral-tabs-aria-controls");if(b){a.attr("aria-controls",b).removeData("coral-tabs-aria-controls")}else{a.removeAttr("aria-controls")}});this.panels.show();if(this.options.heightStyle!=="content"){this.panels.css("height","")}},enable:function(a){var b=this.options.disabled;
if(b===false){return}if(a===undefined){b=false}else{a=this._getIndex(a);if($.isArray(b)){b=$.map(b,function(c){return c!==a?c:null})}else{b=$.map(this.tabs,function(c,d){return d!==a?d:null})}}this._setupDisabled(b)},disable:function(a){var b=this.options.disabled;if(b===true){return}if(a===undefined){b=true}else{a=this._getIndex(a);if($.inArray(a,b)!==-1){return}if($.isArray(b)){b=$.merge([a],b).sort()}else{b=[a]}}this._setupDisabled(b)},_destroyOtherTabs:function(a){var b=this._getList().find("> li:has(a[href])").eq(a).attr("aria-controls");this.component().children("div:not(#"+b+")").children().remove()},load:function(c,g){c=this._getIndex(c);var f=this,d=this.tabs.eq(c),b=d.find(".coral-tabs-anchor"),a=this._getPanelForTab(d),e={tab:d,panel:a};if(this.options.destroyAllonActive){f._destroyOtherTabs(c)}if(f._isLocal(b[0])||$.data(b[0],"cache")){return}else{if(this.options.loadonce){$.data(b[0],"cache",true)}}this.xhr=$.ajax(this._ajaxSettings(b,g,e));if(this.xhr&&this.xhr.statusText!=="canceled"){d.addClass("coral-tabs-loading");a.attr("aria-busy","true");a.loading({position:"inside",text:"加载中，请耐心等候..."});this.xhr.success(function(h){setTimeout(function(){a.html(h);if($.coral.openTag===true){$.parser.parse(a)}f._trigger("onLoad",g,e)},1)}).complete(function(i,h){setTimeout(function(){if(h==="abort"){f.panels.stop(false,true)}d.removeClass("coral-tabs-loading");a.removeAttr("aria-busy");if(i===f.xhr){delete f.xhr}},1)})}},_ajaxSettings:function(a,d,c){var b=this;return{url:a.attr("href"),beforeSend:function(f,e){return b._trigger("beforeLoad",d,$.extend({jqXHR:f,ajaxSettings:e},c))},type:b.options.method}},_getPanelForTab:function(a){var b=$(a).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+b))},getPanelForTab:function(a){return this._getPanelForTab(a)}});