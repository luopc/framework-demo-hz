/*!
 * 组件库4.0.1：按钮
 *
 * 依赖JS文件:
 *	   jquery.coral.core.js
 *	   jquery.coral.component.js
 */
(function(){var d,c="coral-button coral-component coral-state-default coral-corner-all",f="coral-button-text-icons coral-button-text-icon-primary coral-button-text-icon-secondary",b="coral-state-focus",e=function(){var g=$(this);setTimeout(function(){g.find(":coral-button").button("refresh")},1)},a=function(h){var g=h.name,i=h.form,j=$([]);if(g){g=g.replace(/'/g,"\\'");if(i){j=$(i).find("[name='"+g+"'][type=radio]")}else{j=$("[name='"+g+"'][type=radio]",h.ownerDocument).filter(function(){return !this.form})}}return j};$.component("coral.button",{version:"4.0.1",defaultElement:"<button>",options:{id:null,name:null,cls:null,title:false,disabled:null,text:true,label:null,icons:{primary:null,secondary:null},type:"button",width:null,countdown:false,countdownTime:3000,showCountdown:true,onCreate:null,onClick:null,onDblClick:null,onMouseEnter:null,onMouseLeave:null},_create:function(){this.options.icons=this._icons();this.element.addClass("ctrl-init ctrl-init-button");this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,e);if(typeof this.options.disabled!=="boolean"){this.options.disabled=!!this.element.prop("disabled")}else{this.element.prop("disabled",this.options.disabled)}this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title")||this.options.title;var i=this,g=this.options,j=this.type==="checkbox"||this.type==="radio",h=!j?"coral-state-active":"";if(g.id){this.element.attr("id",g.id)}if(g.name){this.element.attr("name",g.name)}if(g.label===null){g.label=(this.type==="input"?this.buttonElement.val():this.buttonElement.html())}this._hoverable(this.buttonElement);this.buttonElement.addClass(c).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){if(g.disabled){return}if(this===d){$(this).addClass("coral-state-active")}i._trigger("onMouseEnter",null,{id:this.id,label:i.options.label})}).bind("mouseleave"+this.eventNamespace,function(){if(g.disabled){return
}$(this).removeClass(h);i._trigger("onMouseLeave",null,{id:this.id,label:i.options.label})}).bind("click"+this.eventNamespace,function(l){if(g.disabled){l.preventDefault();l.stopImmediatePropagation()}else{if(g.once){i.element.button("disable")}if(g.countdown){var n=g.countdownTime/1000;var k=i.element.button("option","label");function m(){if(n<=0){i.element.button("enable");i.element.button("option","label",k)}else{i.element.button("option","label",k+"("+n+")");n--;setTimeout(function(){m()},1000)}}if($(document).find(i.element).length){i.element.button("disable");if(g.showCountdown){m()}else{i._delay(function(){i.element.button("enable");i.element.button("option","label",k)},g.countdownTime)}}}i._trigger("onClick",null,{id:this.id,label:i.options.label})}}).bind("dblclick"+this.eventNamespace,function(k){if(g.disabled){k.preventDefault();k.stopImmediatePropagation()}else{i._trigger("onDblClick",null,{id:this.id,label:i.options.label})}});this._on({focus:function(){this.buttonElement.addClass("coral-state-focus")},blur:function(){this.buttonElement.removeClass("coral-state-focus")}});if(j){this.element.bind("change"+this.eventNamespace,function(){i.refresh()})}if(this.type==="checkbox"){this.buttonElement.bind("click"+this.eventNamespace,function(){if(g.disabled){return false}})}else{if(this.type==="radio"){this.buttonElement.bind("click"+this.eventNamespace,function(){if(g.disabled){return false}$(this).addClass("coral-state-active");i.buttonElement.attr("aria-pressed","true");var k=i.element[0];a(k).not(k).map(function(){return $(this).button("component")[0]}).removeClass("coral-state-active").attr("aria-pressed","false")})}else{this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(g.disabled){return false}$(this).addClass("coral-state-active");d=this;i.document.one("mouseup",function(){d=null})}).bind("mouseup"+this.eventNamespace,function(){if(g.disabled){return false}$(this).removeClass("coral-state-active")}).bind("keydown"+this.eventNamespace,function(k){var l=$.coral.keyCode;
if(g.disabled){return false}if(k.keyCode===l.SPACE||k.keyCode===l.ENTER){$(this).addClass("coral-state-active")}i._trigger("onKeyDown")}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){$(this).removeClass("coral-state-active")});if(this.buttonElement.is("a")){this.buttonElement.keyup(function(k){if(k.keyCode===$.coral.keyCode.SPACE){$(this).click()}})}}}if(g.width){this.buttonElement.outerWidth(g.width)}this._setOption("disabled",g.disabled);this._resetButton()},_icons:function(){var j=this.options.icons,i=null,l=null,k=null,g=null;if(j&&typeof j==="string"){i=j.split(",");if(i.length>0){l=$.trim(i[0]);g=h("right",l);if(null===g){k=h("left",l,true)}}if(i.length>1){l=$.trim(i[1]);k=((k===null)?h("left",l):k);if(null===g){g=h("right",l,true)}}}else{return j}function h(n,o,p){var m=o.split(" ");if($.inArray(n,m)>-1){m=$.grep(m,function(q,r){return q!==n});return m.join(" ")}if(p){return o}return null}return{primary:k,secondary:g}},_determineButtonType:function(){var g,i,h;if(this.element.is("[type=checkbox]")){this.type="checkbox"}else{if(this.element.is("[type=radio]")){this.type="radio"}else{if(this.element.is("input")){this.type="input"}else{this.type="button"}}}if(this.type==="checkbox"||this.type==="radio"){g=this.element.parents().last();i="label[for='"+this.element.attr("id")+"']";this.buttonElement=g.find(i);if(!this.buttonElement.length){g=g.length?g.siblings():this.element.siblings();this.buttonElement=g.filter(i);if(!this.buttonElement.length){this.buttonElement=g.find(i)}}this.element.addClass("coral-helper-hidden-accessible");h=this.element.is(":checked");if(h){this.buttonElement.addClass("coral-state-active")}this.buttonElement.prop("aria-pressed",h)}else{this.buttonElement=this.element}},component:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("coral-helper-hidden-accessible");this.buttonElement.removeClass(c+" ui-state-active "+f).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".coral-button-text").html());
if(!this.hasTitle){this.buttonElement.removeAttr("title")}},_setOption:function(g,h){this._super(g,h);if(g==="disabled"){this.component().toggleClass("coral-state-disabled",!!h);this.element.prop("disabled",!!h);if(h){if(this.type==="checkbox"||this.type==="radio"){this.buttonElement.removeClass("coral-state-focus")}else{this.buttonElement.removeClass("coral-state-focus coral-state-active")}}return}this._resetButton()},update:function(g){if(typeof g==="string"){this.element.find(".coral-button-text").html(g)}},refresh:function(){var g=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("coral-button-disabled");if(g!==this.options.disabled){this._setOption("disabled",g)}if(this.type==="radio"){a(this.element[0]).each(function(){if($(this).is(":checked")){$(this).button("component").addClass("coral-state-active").attr("aria-pressed","true")}else{$(this).button("component").removeClass("coral-state-active").attr("aria-pressed","false")}})}else{if(this.type==="checkbox"){if(this.element.is(":checked")){this.buttonElement.addClass("coral-state-active").attr("aria-pressed","true")}else{this.buttonElement.removeClass("coral-state-active").attr("aria-pressed","false")}}}},_resetButton:function(){if(this.type==="input"){if(this.options.label){this.element.val(this.options.label)}return}var k=this.buttonElement.removeClass(f),i=$("<span></span>",this.document[0]).addClass("coral-button-text").html(this.options.label).appendTo(k.empty()).text(),h=this.options.icons,g=h.primary&&h.secondary,j=[];if(h.primary||h.secondary){if(this.options.text){j.push("coral-button-text-icon"+(g?"s":(h.primary?"-primary":"-secondary")))}if(h.primary){k.prepend("<span class='coral-button-icon-primary icon "+h.primary+"'></span>")}if(h.secondary){k.append("<span class='coral-button-icon-secondary icon "+h.secondary+"'></span>")}if(!this.options.text){j.push(g?"coral-button-icons-only":"coral-button-icon-only");if(!this.hasTitle){k.attr("title",$.trim(i))}}}else{j.push("coral-button-text-only")
}if(this.hasTitle){k.attr("title",$.trim(i))}k.addClass(j.join(" "))}});$.component("coral.buttonset",{version:"4.0.1",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(coral-button)"},_create:function(){this.element.addClass("coral-buttonset")},_init:function(){this.refresh()},_setOption:function(g,h){if(g==="disabled"){this.buttons.button("option",g,h)}this._super(g,h)},refresh:function(){var h=this.element.css("direction")==="rtl",g=this.element.find(this.options.items),i=g.filter(":coral-button");g.not(":coral-button").button();i.button("refresh");this.buttons=g.map(function(){return $(this).button("component")[0]}).removeClass("coral-corner-all coral-corner-left coral-corner-right").filter(":first").addClass(h?"coral-corner-right":"coral-corner-left").end().filter(":last").addClass(h?"coral-corner-left":"coral-corner-right").end().end()},_destroy:function(){this.element.removeClass("coral-buttonset");this.buttons.map(function(){return $(this).button("component")[0]}).removeClass("coral-corner-left coral-corner-right").end().button("destroy")}})})();