var tooltip=$.component("coral.tooltip",{version:"4.0.1",options:{content:function(){var a=$(this).attr("title")||"";return $("<a>").text(a).html()},hide:true,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:true,tooltipClass:null,track:false,onClose:null,onOpen:null},_addDescribedBy:function(b,c){var a=(b.attr("aria-describedby")||"").split(/\s+/);a.push(c);b.data("coral-tooltip-id",c).attr("aria-describedby",$.trim(a.join(" ")))},_removeDescribedBy:function(c){var d=c.data("coral-tooltip-id"),b=(c.attr("aria-describedby")||"").split(/\s+/),a=$.inArray(d,b);if(a!==-1){b.splice(a,1)}c.removeData("coral-tooltip-id");b=$.trim(b.join(" "));if(b){c.attr("aria-describedby",b)}else{c.removeAttr("aria-describedby")}},_create:function(){this._on({mouseover:"open",focusin:"open"});this.tooltips={};this.parents={};if(this.options.disabled){this._disable()}this.liveRegion=$("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("coral-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(a,c){var b=this;if(a==="disabled"){this[c?"_disable":"_enable"]();this.options[a]=c;return}this._super(a,c);if(a==="content"){$.each(this.tooltips,function(e,d){b._updateContent(d)})}},_disable:function(){var a=this;$.each(this.tooltips,function(d,b){var c=$.Event("blur");c.target=c.currentTarget=b[0];a.close(c,true)});this.element.find(this.options.items).addBack().each(function(){var b=$(this);if(b.is("[title]")){b.data("coral-tooltip-title",b.attr("title")).removeAttr("title")}})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var a=$(this);if(a.data("coral-tooltip-title")){a.attr("title",a.data("coral-tooltip-title"))}})},open:function(b){var a=this,c=$(b?b.target:this.element).closest(this.options.items);if(!c.length||c.data("coral-tooltip-id")){return}if(c.attr("title")){c.data("coral-tooltip-title",c.attr("title"))}c.data("coral-tooltip-open",true);
if(b&&b.type==="mouseover"){c.parents().each(function(){var e=$(this),d;if(e.data("coral-tooltip-open")){d=$.Event("blur");d.target=d.currentTarget=this;a.close(d,true)}if(e.attr("title")){e.uniqueId();a.parents[this.id]={element:this,title:e.attr("title")};e.attr("title","")}})}this._updateContent(c,b)},_updateContent:function(f,e){var d,a=this.options.content,c=this,b=e?e.type:null;if(typeof a==="string"){return this._open(e,f,a)}d=a.call(f[0],function(g){if(!f.data("coral-tooltip-open")){return}c._delay(function(){if(e){e.type=b}this._open(e,f,g)})});if(d){this._open(e,f,d)}},_open:function(a,d,e){var i,h,g,b,f=$.extend({},this.options.position);if(!e){return}i=this._find(d);if(i.length){i.find(".coral-tooltip-content").html(e);return}if(d.is("[title]")){if(a&&a.type==="mouseover"){d.attr("title","")}else{d.removeAttr("title")}}i=this._tooltip(d);this._addDescribedBy(d,i.attr("id"));i.find(".coral-tooltip-content").html(e);this.liveRegion.children().hide();if(e.clone){b=e.clone();b.removeAttr("id").find("[id]").removeAttr("id")}else{b=e}$("<div>").html(b).appendTo(this.liveRegion);function c(j){f.of=j;if(i.is(":hidden")){return}i.position(f)}if(this.options.track&&a&&/^mouse/.test(a.type)){this._on(this.document,{mousemove:c});c(a)}else{i.position($.extend({of:d},this.options.position))}this.hiding=false;this.closing=false;i.hide();this._show(i,this.options.show);if(this.options.show&&this.options.show.delay){g=this.delayedShow=setInterval(function(){if(i.is(":visible")){c(f.of);clearInterval(g)}},$.fx.interval)}this._trigger("onOpen",a,{tooltip:i});h={keyup:function(j){if(j.keyCode===$.coral.keyCode.ESCAPE){var k=$.Event(j);k.currentTarget=d[0];this.close(k,true)}}};if(d[0]!==this.element[0]){h.remove=function(){this._removeTooltip(i)}}if(!a||a.type==="mouseover"){h.mouseleave="close"}if(!a||a.type==="focusin"){h.focusout="close"}this._on(true,d,h)},close:function(b){var a=this,d=$(b?b.currentTarget:this.element),c=this._find(d);if(this.closing){return}clearInterval(this.delayedShow);
if(d.data("coral-tooltip-title")&&!d.attr("title")){d.attr("title",d.data("coral-tooltip-title"))}this._removeDescribedBy(d);this.hiding=true;c.stop(true);this._hide(c,this.options.hide,function(){a._removeTooltip($(this));this.hiding=false;this.closing=false});d.removeData("coral-tooltip-open");this._off(d,"mouseleave focusout keyup");if(d[0]!==this.element[0]){this._off(d,"remove")}this._off(this.document,"mousemove");if(b&&b.type==="mouseleave"){$.each(this.parents,function(f,e){$(e.element).attr("title",e.title);delete a.parents[f]})}this.closing=true;this._trigger("onClose",b,{tooltip:c});if(!this.hiding){this.closing=false}},_tooltip:function(a){var b=$("<div>").attr("role","tooltip").addClass("coral-tooltip coral-component coral-corner-all coral-component-content "+(this.options.tooltipClass||"")),c=b.uniqueId().attr("id");$("<div>").addClass("coral-tooltip-content").appendTo(b);b.appendTo(this.document[0].body);this.tooltips[c]=a;return b},_find:function(a){var b=a.data("coral-tooltip-id");return b?$("#"+b):$()},_removeTooltip:function(a){a.remove();delete this.tooltips[a.attr("id")]},_destroy:function(){var a=this;$.each(this.tooltips,function(d,b){var c=$.Event("blur");c.target=c.currentTarget=b[0];a.close(c,true);$("#"+d).remove();if(b.data("coral-tooltip-title")){if(!b.attr("title")){b.attr("title",b.data("coral-tooltip-title"))}b.removeData("coral-tooltip-title")}});this.liveRegion.remove()}});