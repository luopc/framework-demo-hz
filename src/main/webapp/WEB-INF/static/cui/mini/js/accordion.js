$.component("coral.accordion",{version:"4.0.1",options:{active:0,a:[],animate:{params:{},duration:300,easing:"swing"},collapsible:false,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"cui-icon-arrow-down3",header:"cui-icon-arrow-up3"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var a=this.options;a.icons=$.coral.toFunction(a.icons);this.options.a.push("ddd");this.prevShow=this.prevHide=$();this.element.addClass("coral-accordion ctrl-init ctrl-init-accordion coral-component coral-helper-reset").attr("role","tablist");if(!a.collapsible&&(a.active===false||a.active==null)){a.active=0}this._processPanels();if(a.active<0){a.active+=this.headers.length}this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:!this.active.length?$():this.active.next()}},_createIcons:function(){var b=this,a=this.options.icons;if(a){$("<span>").addClass("coral-accordion-header-icon icon "+a.header).prependTo(this.headers);this.active.children(".coral-accordion-header-icon").removeClass(a.header).addClass(a.activeHeader);this.headers.each(function(){var c=$.parser.parseOptions(this);if(c.collapsible==false){$(this).children(".coral-accordion-header-icon").remove()}else{$(this).addClass("coral-accordion-icons")}})}},_destroyIcons:function(){this.headers.removeClass("coral-accordion-icons").children(".coral-accordion-header-icon").remove()},_destroy:function(){var a;this.element.removeClass("coral-accordion coral-component coral-helper-reset").removeAttr("role");this.headers.removeClass("coral-accordion-header coral-accordion-header-active coral-state-default coral-corner-all coral-state-active coral-state-disabled coral-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId();
this._destroyIcons();a=this.headers.next().removeClass("coral-helper-reset coral-widget-content coral-corner-bottom coral-accordion-content coral-accordion-content-active coral-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId();if(this.options.heightStyle!=="content"){a.css("height","")}},_setOption:function(a,b){if(a==="active"){this._activate(b);return}if(a==="event"){if(this.options.event){this._off(this.headers,this.options.event)}this._setupEvents(b)}this._super(a,b);if(a==="collapsible"&&!b&&this.options.active===false){this._activate(0)}if(a==="icons"){this._destroyIcons();if(b){this._createIcons()}}if(a==="disabled"){this.element.toggleClass("coral-state-disabled",!!b).attr("aria-disabled",b);this.headers.add(this.headers.next()).toggleClass("coral-state-disabled",!!b)}},_keydown:function(d){if(d.altKey||d.ctrlKey){return}var e=$.coral.keyCode,c=this.headers.length,a=this.headers.index(d.target),b=false;switch(d.keyCode){case e.RIGHT:case e.DOWN:b=this.headers[(a+1)%c];break;case e.LEFT:case e.UP:b=this.headers[(a-1+c)%c];break;case e.SPACE:case e.ENTER:this._eventHandler(d);break;case e.HOME:b=this.headers[0];break;case e.END:b=this.headers[c-1];break}if(b){$(d.target).attr("tabIndex",-1);$(b).attr("tabIndex",0);b.focus();d.preventDefault()}},_panelKeyDown:function(a){if(a.keyCode===$.coral.keyCode.UP&&a.ctrlKey){$(a.currentTarget).prev().focus()}},refresh:function(){var a=this.options;this._processPanels();if((a.active===false&&a.collapsible===true)||!this.headers.length){a.active=false;this.active=$()}else{if(a.active===false){this._activate(0)}else{if(this.active.length&&!$.contains(this.element[0],this.active[0])){if(this.headers.length===this.headers.find(".coral-state-disabled").length){a.active=false;this.active=$()}else{this._activate(Math.max(0,a.active-1))}}else{a.active=this.headers.index(this.active)}}}this._destroyIcons();this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("coral-accordion-header coral-state-default coral-corner-all");
this.headers.next().addClass("coral-accordion-content coral-helper-reset coral-component-content coral-corner-bottom").filter(":not(.coral-accordion-content-active)").hide()},_refresh:function(){var d,b=this.options,a=b.heightStyle,c=this.element.parent();this.active=this._findActive(b.active).addClass("coral-accordion-header-active coral-state-active coral-corner-top").removeClass("coral-corner-all");this.active.next().addClass("coral-accordion-content-active").show();this.headers.attr("role","tab").each(function(){var h=$(this),g=h.uniqueId().attr("id"),e=h.next(),f=e.uniqueId().attr("id");h.attr("aria-controls",f);e.attr("aria-labelledby",g)}).next().attr("role","tabpanel");this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide();if(!this.active.length){this.headers.eq(0).attr("tabIndex",0)}else{this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"})}this._createIcons();this._setupEvents(b.event);if(a==="fill"){$.coral.fitParent(this.component(),true);d=c.height();this.element.siblings(":visible").each(function(){var f=$(this),e=f.css("position");if(e==="absolute"||e==="fixed"){return}d-=f.outerHeight(true)});this.headers.each(function(){d-=$(this).outerHeight(true)});this.headers.next().each(function(){$(this).height(Math.max(0,d-$(this).innerHeight()+$(this).height()))}).addClass("coral-scroll")}else{if(a==="auto"){d=0;this.headers.next().each(function(){d=Math.max(d,$(this).css("height","").height())}).height(d)}}this.headers.each(function(){var e=$.parser.parseOptions(this);if(e.collapsible==false){$(this).next().addClass("hidden")}})},_activate:function(a){var b=this._findActive(a)[0];if(b===this.active[0]){return}b=b||this.active[0];this._eventHandler({target:b,currentTarget:b,preventDefault:$.noop})},_findActive:function(a){return typeof a==="number"?this.headers.eq(a):$()},_setupEvents:function(b){var a={keydown:"_keydown"};
if(b){$.each(b.split(" "),function(d,c){a[c]="_eventHandler"})}this._off(this.headers.add(this.headers.next()));this._on(this.headers,a);this._on(this.headers.next(),{keydown:"_panelKeyDown"});this._hoverable(this.headers);this._focusable(this.headers)},_eventHandler:function(a){var i=this.options,d=this.active,e=$(a.currentTarget),g=e[0]===d[0],b=g&&i.collapsible,c=b?$():e.next(),f=d.next(),h={oldHeader:d,oldPanel:f,newHeader:b?$():e,newPanel:c,headerOptions:$.parser.parseOptions((b?$():e))};a.preventDefault();if((g&&!i.collapsible)||(this._trigger("beforeActivate",a,h)===false)){return}i.active=b?false:this.headers.index(e);this.active=g?$():e;this._toggle(h);d.removeClass("coral-accordion-header-active coral-state-active");if(i.icons){d.children(".coral-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header)}if(!g){e.removeClass("coral-corner-all").addClass("coral-accordion-header-active coral-state-active coral-corner-top");if(i.icons){e.children(".coral-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader)}e.next().addClass("coral-accordion-content-active")}},_toggle:function(c){var a=c.newPanel,b=this.prevShow.length?this.prevShow:c.oldPanel;this.prevShow.add(this.prevHide).stop(true,true);this.prevShow=a;this.prevHide=b;if(this.options.animate){this._animate(a,b,c)}else{b.hide();a.show();this._toggleComplete(c)}b.attr({"aria-hidden":"true"});b.prev().attr("aria-selected","false");if(a.length&&b.length){b.prev().attr({tabIndex:-1,"aria-expanded":"false"})}else{if(a.length){this.headers.filter(function(){return $(this).attr("tabIndex")===0}).attr("tabIndex",-1)}}a.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(a,i,e){var h,g,d,f=this,j=0,k=a.length&&(!i.length||(a.index()<i.index())),c=this.options.animate||{},l=k&&c.down||c,b=function(){f._toggleComplete(e)};if(typeof l==="number"){d=l}if(typeof l==="string"){g=l}g=g||l.easing||c.easing;
d=d||l.duration||c.duration;if(!i.length){return a.animate(this.showProps,d,g,b)}if(!a.length){return i.animate(this.hideProps,d,g,b)}h=a.show().outerHeight();i.animate(this.hideProps,{duration:d,easing:g,step:function(m,n){n.now=Math.round(m)}});a.hide().animate(this.showProps,{duration:d,easing:g,complete:b,step:function(m,n){n.now=Math.round(m);if(n.prop!=="height"){j+=n.now}else{if(f.options.heightStyle!=="content"){j=0}}}})},_toggleComplete:function(b){var a=b.oldPanel;a.removeClass("coral-accordion-content-active").prev().removeClass("coral-corner-top").addClass("coral-corner-all");if(a.length){a.parent()[0].className=a.parent()[0].className}this._trigger("onActivate",null,b)}});