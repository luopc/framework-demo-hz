/*!
 * jQuery coral Sortable 4.0.1
 *
 * Depends:
 *	jquery.coral.core.js
 *	jquery.coral.component.js
 *	jquery.coral.mouse.js
 */
(function(){function a(d,c,e){return(d>=c)&&(d<(c+e))}function b(c){return(/left|right/).test(c.css("float"))||(/inline|table-cell/).test(c.css("display"))}$.component("coral.sortable",$.coral.mouse,{version:"4.0.1",componentEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var c=this.options;this.containerCache={};this.element.addClass("coral-sortable");this.refresh();this.floating=this.items.length?c.axis==="x"||b(this.items[0].item):false;this.offset=this.element.offset();this._mouseInit();this._setHandleClassName();this.ready=true},_setOption:function(c,d){this._super(c,d);if(c==="handle"){this._setHandleClassName()}},_setHandleClassName:function(){this.element.find(".coral-sortable-handle").removeClass("coral-sortable-handle");$.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("coral-sortable-handle")})},_destroy:function(){this.element.removeClass("coral-sortable coral-sortable-disabled").find(".coral-sortable-handle").removeClass("coral-sortable-handle");this._mouseDestroy();for(var c=this.items.length-1;c>=0;c--){this.items[c].item.removeData(this.componentName+"-item")}return this},_mouseCapture:function(e,f){var c=null,g=false,d=this;if(this.reverting){return false}if(this.options.disabled||this.options.type==="static"){return false}this._refreshItems(e);
$(e.target).parents().each(function(){if($.data(this,d.componentName+"-item")===d){c=$(this);return false}});if($.data(e.target,d.componentName+"-item")===d){c=$(e.target)}if(!c){return false}if(this.options.handle&&!f){$(this.options.handle,c).find("*").addBack().each(function(){if(this===e.target){g=true}});if(!g){return false}}this.currentItem=c;this._removeCurrentsFromItems();return true},_mouseStart:function(f,g,d){var e,c,h=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(f);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:f.pageX-this.offset.left,top:f.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(f);this.originalPageX=f.pageX;this.originalPageY=f.pageY;(h.cursorAt&&this._adjustOffsetFromHelper(h.cursorAt));this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!==this.currentItem[0]){this.currentItem.hide()}this._createPlaceholder();if(h.containment){this._setContainment()}if(h.cursor&&h.cursor!=="auto"){c=this.document.find("body");this.storedCursor=c.css("cursor");c.css("cursor",h.cursor);this.storedStylesheet=$("<style>*{ cursor: "+h.cursor+" !important; }</style>").appendTo(c)}if(h.opacity){if(this.helper.css("opacity")){this._storedOpacity=this.helper.css("opacity")}this.helper.css("opacity",h.opacity)}if(h.zIndex){if(this.helper.css("zIndex")){this._storedZIndex=this.helper.css("zIndex")}this.helper.css("zIndex",h.zIndex)}if(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"){this.overflowOffset=this.scrollParent.offset()}this._trigger("start",f,this._uiHash());if(!this._preserveHelperProportions){this._cacheHelperProportions()
}if(!d){for(e=this.containers.length-1;e>=0;e--){this.containers[e]._trigger("activate",f,this._uiHash(this))}}if($.coral.ddmanager){$.coral.ddmanager.current=this}if($.coral.ddmanager&&!h.dropBehaviour){$.coral.ddmanager.prepareOffsets(this,f)}this.dragging=true;this.helper.addClass("coral-sortable-helper");this._mouseDrag(f);return true},_mouseDrag:function(g){var e,f,d,j,h=this.options,c=false;this.position=this._generatePosition(g);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs}if(this.options.scroll){if(this.scrollParent[0]!==document&&this.scrollParent[0].tagName!=="HTML"){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-g.pageY<h.scrollSensitivity){this.scrollParent[0].scrollTop=c=this.scrollParent[0].scrollTop+h.scrollSpeed}else{if(g.pageY-this.overflowOffset.top<h.scrollSensitivity){this.scrollParent[0].scrollTop=c=this.scrollParent[0].scrollTop-h.scrollSpeed}}if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-g.pageX<h.scrollSensitivity){this.scrollParent[0].scrollLeft=c=this.scrollParent[0].scrollLeft+h.scrollSpeed}else{if(g.pageX-this.overflowOffset.left<h.scrollSensitivity){this.scrollParent[0].scrollLeft=c=this.scrollParent[0].scrollLeft-h.scrollSpeed}}}else{if(g.pageY-$(document).scrollTop()<h.scrollSensitivity){c=$(document).scrollTop($(document).scrollTop()-h.scrollSpeed)}else{if($(window).height()-(g.pageY-$(document).scrollTop())<h.scrollSensitivity){c=$(document).scrollTop($(document).scrollTop()+h.scrollSpeed)}}if(g.pageX-$(document).scrollLeft()<h.scrollSensitivity){c=$(document).scrollLeft($(document).scrollLeft()-h.scrollSpeed)}else{if($(window).width()-(g.pageX-$(document).scrollLeft())<h.scrollSensitivity){c=$(document).scrollLeft($(document).scrollLeft()+h.scrollSpeed)}}}if(c!==false&&$.coral.ddmanager&&!h.dropBehaviour){$.coral.ddmanager.prepareOffsets(this,g)}}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!=="y"){this.helper[0].style.left=this.position.left+"px"
}if(!this.options.axis||this.options.axis!=="x"){this.helper[0].style.top=this.position.top+"px"}for(e=this.items.length-1;e>=0;e--){f=this.items[e];d=f.item[0];j=this._intersectsWithPointer(f);if(!j){continue}if(f.instance!==this.currentContainer){continue}if(d!==this.currentItem[0]&&this.placeholder[j===1?"next":"prev"]()[0]!==d&&!$.contains(this.placeholder[0],d)&&(this.options.type==="semi-dynamic"?!$.contains(this.element[0],d):true)){this.direction=j===1?"down":"up";if(this.options.tolerance==="pointer"||this._intersectsWithSides(f)){this._rearrange(g,f)}else{break}this._trigger("change",g,this._uiHash());break}}this._contactContainers(g);if($.coral.ddmanager){$.coral.ddmanager.drag(this,g)}this._trigger("sort",g,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(e,g){if(!e){return}if($.coral.ddmanager&&!this.options.dropBehaviour){$.coral.ddmanager.drop(this,e)}if(this.options.revert){var d=this,h=this.placeholder.offset(),c=this.options.axis,f={};if(!c||c==="x"){f.left=h.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)}if(!c||c==="y"){f.top=h.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)}this.reverting=true;$(this.helper).animate(f,parseInt(this.options.revert,10)||500,function(){d._clear(e)})}else{this._clear(e,g)}return false},cancel:function(){if(this.dragging){this._mouseUp({target:null});if(this.options.helper==="original"){this.currentItem.css(this._storedCSS).removeClass("coral-sortable-helper")}else{this.currentItem.show()}for(var c=this.containers.length-1;c>=0;c--){this.containers[c]._trigger("deactivate",null,this._uiHash(this));if(this.containers[c].containerCache.over){this.containers[c]._trigger("out",null,this._uiHash(this));this.containers[c].containerCache.over=0}}}if(this.placeholder){if(this.placeholder[0].parentNode){this.placeholder[0].parentNode.removeChild(this.placeholder[0])
}if(this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode){this.helper.remove()}$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem)}else{$(this.domPosition.parent).prepend(this.currentItem)}}return this},serialize:function(e){var c=this._getItemsAsjQuery(e&&e.connected),d=[];e=e||{};$(c).each(function(){var f=($(e.item||this).attr(e.attribute||"id")||"").match(e.expression||(/(.+)[\-=_](.+)/));if(f){d.push((e.key||f[1]+"[]")+"="+(e.key&&e.expression?f[1]:f[2]))}});if(!d.length&&e.key){d.push(e.key+"=")}return d.join("&")},toArray:function(e){var c=this._getItemsAsjQuery(e&&e.connected),d=[];e=e||{};c.each(function(){d.push($(e.item||this).attr(e.attribute||"id")||"")});return d},_intersectsWith:function(o){var e=this.positionAbs.left,d=e+this.helperProportions.width,m=this.positionAbs.top,k=m+this.helperProportions.height,f=o.left,c=f+o.width,p=o.top,j=p+o.height,q=this.offset.click.top,i=this.offset.click.left,h=(this.options.axis==="x")||((m+q)>p&&(m+q)<j),n=(this.options.axis==="y")||((e+i)>f&&(e+i)<c),g=h&&n;if(this.options.tolerance==="pointer"||this.options.forcePointerForContainers||(this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>o[this.floating?"width":"height"])){return g}else{return(f<e+(this.helperProportions.width/2)&&d-(this.helperProportions.width/2)<c&&p<m+(this.helperProportions.height/2)&&k-(this.helperProportions.height/2)<j)}},_intersectsWithPointer:function(e){var f=(this.options.axis==="x")||a(this.positionAbs.top+this.offset.click.top,e.top,e.height),d=(this.options.axis==="y")||a(this.positionAbs.left+this.offset.click.left,e.left,e.width),h=f&&d,c=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();if(!h){return false}return this.floating?(((g&&g==="right")||c==="down")?2:1):(c&&(c==="down"?2:1))},_intersectsWithSides:function(f){var d=a(this.positionAbs.top+this.offset.click.top,f.top+(f.height/2),f.height),e=a(this.positionAbs.left+this.offset.click.left,f.left+(f.width/2),f.width),c=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();
if(this.floating&&g){return((g==="right"&&e)||(g==="left"&&!e))}else{return c&&((c==="down"&&d)||(c==="up"&&!d))}},_getDragVerticalDirection:function(){var c=this.positionAbs.top-this.lastPositionAbs.top;return c!==0&&(c>0?"down":"up")},_getDragHorizontalDirection:function(){var c=this.positionAbs.left-this.lastPositionAbs.left;return c!==0&&(c>0?"right":"left")},refresh:function(c){this._refreshItems(c);this._setHandleClassName();this.refreshPositions();return this},_connectWith:function(){var c=this.options;return c.connectWith.constructor===String?[c.connectWith]:c.connectWith},_getItemsAsjQuery:function(h){var f,e,l,k,c=[],d=[],g=this._connectWith();if(g&&h){for(f=g.length-1;f>=0;f--){l=$(g[f]);for(e=l.length-1;e>=0;e--){k=$.data(l[e],this.componentFullName);if(k&&k!==this&&!k.options.disabled){d.push([$.isFunction(k.options.items)?k.options.items.call(k.element):$(k.options.items,k.element).not(".coral-sortable-helper").not(".coral-sortable-placeholder"),k])}}}}d.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".coral-sortable-helper").not(".coral-sortable-placeholder"),this]);for(f=d.length-1;f>=0;f--){d[f][0].each(function(){c.push(this)})}return $(c)},_removeCurrentsFromItems:function(){var c=this.currentItem.find(":data("+this.componentName+"-item)");this.items=$.grep(this.items,function(e){for(var d=0;d<c.length;d++){if(c[d]===e.item[0]){return false}}return true})},_refreshItems:function(c){this.items=[];this.containers=[this];var g,e,n,h,m,d,p,o,k=this.items,f=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],c,{item:this.currentItem}):$(this.options.items,this.element),this]],l=this._connectWith();if(l&&this.ready){for(g=l.length-1;g>=0;g--){n=$(l[g]);for(e=n.length-1;e>=0;e--){h=$.data(n[e],this.componentFullName);if(h&&h!==this&&!h.options.disabled){f.push([$.isFunction(h.options.items)?h.options.items.call(h.element[0],c,{item:this.currentItem}):$(h.options.items,h.element),h]);
this.containers.push(h)}}}}for(g=f.length-1;g>=0;g--){m=f[g][1];d=f[g][0];for(e=0,o=d.length;e<o;e++){p=$(d[e]);p.data(this.componentName+"-item",m);k.push({item:p,instance:m,width:0,height:0,left:0,top:0})}}},refreshPositions:function(c){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset()}var e,f,d,g;for(e=this.items.length-1;e>=0;e--){f=this.items[e];if(f.instance!==this.currentContainer&&this.currentContainer&&f.item[0]!==this.currentItem[0]){continue}d=this.options.toleranceElement?$(this.options.toleranceElement,f.item):f.item;if(!c){f.width=d.outerWidth();f.height=d.outerHeight()}g=d.offset();f.left=g.left;f.top=g.top}if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this)}else{for(e=this.containers.length-1;e>=0;e--){g=this.containers[e].element.offset();this.containers[e].containerCache.left=g.left;this.containers[e].containerCache.top=g.top;this.containers[e].containerCache.width=this.containers[e].element.outerWidth();this.containers[e].containerCache.height=this.containers[e].element.outerHeight()}}return this},_createPlaceholder:function(d){d=d||this;var c,e=d.options;if(!e.placeholder||e.placeholder.constructor===String){c=e.placeholder;e.placeholder={element:function(){var g=d.currentItem[0].nodeName.toLowerCase(),f=$("<"+g+">",d.document[0]).addClass(c||d.currentItem[0].className+" coral-sortable-placeholder").removeClass("coral-sortable-helper");if(g==="tr"){d.currentItem.children().each(function(){$("<td>&#160;</td>",d.document[0]).attr("colspan",$(this).attr("colspan")||1).appendTo(f)})}else{if(g==="img"){f.attr("src",d.currentItem.attr("src"))}}if(!c){f.css("visibility","hidden")}return f},update:function(f,g){if(c&&!e.forcePlaceholderSize){return}if(!g.height()){g.height(d.currentItem.innerHeight()-parseInt(d.currentItem.css("paddingTop")||0,10)-parseInt(d.currentItem.css("paddingBottom")||0,10))}if(!g.width()){g.width(d.currentItem.innerWidth()-parseInt(d.currentItem.css("paddingLeft")||0,10)-parseInt(d.currentItem.css("paddingRight")||0,10))
}}}}d.placeholder=$(e.placeholder.element.call(d.element,d.currentItem));d.currentItem.after(d.placeholder);e.placeholder.update(d,d.placeholder)},_contactContainers:function(c){var h,f,n,k,l,p,q,g,m,e,d=null,o=null;for(h=this.containers.length-1;h>=0;h--){if($.contains(this.currentItem[0],this.containers[h].element[0])){continue}if(this._intersectsWith(this.containers[h].containerCache)){if(d&&$.contains(this.containers[h].element[0],d.element[0])){continue}d=this.containers[h];o=h}else{if(this.containers[h].containerCache.over){this.containers[h]._trigger("out",c,this._uiHash(this));this.containers[h].containerCache.over=0}}}if(!d){return}if(this.containers.length===1){if(!this.containers[o].containerCache.over){this.containers[o]._trigger("over",c,this._uiHash(this));this.containers[o].containerCache.over=1}}else{n=10000;k=null;m=d.floating||b(this.currentItem);l=m?"left":"top";p=m?"width":"height";e=m?"clientX":"clientY";for(f=this.items.length-1;f>=0;f--){if(!$.contains(this.containers[o].element[0],this.items[f].item[0])){continue}if(this.items[f].item[0]===this.currentItem[0]){continue}q=this.items[f].item.offset()[l];g=false;if(c[e]-q>this.items[f][p]/2){g=true}if(Math.abs(c[e]-q)<n){n=Math.abs(c[e]-q);k=this.items[f];this.direction=g?"up":"down"}}if(!k&&!this.options.dropOnEmpty){return}if(this.currentContainer===this.containers[o]){return}k?this._rearrange(c,k,null,true):this._rearrange(c,null,this.containers[o].element,true);this._trigger("change",c,this._uiHash());this.containers[o]._trigger("change",c,this._uiHash(this));this.currentContainer=this.containers[o];this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[o]._trigger("over",c,this._uiHash(this));this.containers[o].containerCache.over=1}},_createHelper:function(d){var e=this.options,c=$.isFunction(e.helper)?$(e.helper.apply(this.element[0],[d,this.currentItem])):(e.helper==="clone"?this.currentItem.clone():this.currentItem);if(!c.parents("body").length){$(e.appendTo!=="parent"?e.appendTo:this.currentItem[0].parentNode)[0].appendChild(c[0])
}if(c[0]===this.currentItem[0]){this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}}if(!c[0].style.width||e.forceHelperSize){c.width(this.currentItem.width())}if(!c[0].style.height||e.forceHelperSize){c.height(this.currentItem.height())}return c},_adjustOffsetFromHelper:function(c){if(typeof c==="string"){c=c.split(" ")}if($.isArray(c)){c={left:+c[0],top:+c[1]||0}}if("left" in c){this.offset.click.left=c.left+this.margins.left}if("right" in c){this.offset.click.left=this.helperProportions.width-c.right+this.margins.left}if("top" in c){this.offset.click.top=c.top+this.margins.top}if("bottom" in c){this.offset.click.top=this.helperProportions.height-c.bottom+this.margins.top}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var c=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){c.left+=this.scrollParent.scrollLeft();c.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]===document.body||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&$.coral.ie)){c={top:0,left:0}}return{top:c.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:c.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var c=this.currentItem.position();return{top:c.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:c.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css("marginLeft"),10)||0),top:(parseInt(this.currentItem.css("marginTop"),10)||0)}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}
},_setContainment:function(){var d,f,c,e=this.options;if(e.containment==="parent"){e.containment=this.helper[0].parentNode}if(e.containment==="document"||e.containment==="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$(e.containment==="document"?document:window).width()-this.helperProportions.width-this.margins.left,($(e.containment==="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!(/^(document|window|parent)$/).test(e.containment)){d=$(e.containment)[0];f=$(e.containment).offset();c=($(d).css("overflow")!=="hidden");this.containment=[f.left+(parseInt($(d).css("borderLeftWidth"),10)||0)+(parseInt($(d).css("paddingLeft"),10)||0)-this.margins.left,f.top+(parseInt($(d).css("borderTopWidth"),10)||0)+(parseInt($(d).css("paddingTop"),10)||0)-this.margins.top,f.left+(c?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt($(d).css("borderLeftWidth"),10)||0)-(parseInt($(d).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,f.top+(c?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt($(d).css("borderTopWidth"),10)||0)-(parseInt($(d).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(f,h){if(!h){h=this.position}var e=f==="absolute"?1:-1,c=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,g=(/(html|body)/i).test(c[0].tagName);return{top:(h.top+this.offset.relative.top*e+this.offset.parent.top*e-((this.cssPosition==="fixed"?-this.scrollParent.scrollTop():(g?0:c.scrollTop()))*e)),left:(h.left+this.offset.relative.left*e+this.offset.parent.left*e-((this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():g?0:c.scrollLeft())*e))}},_generatePosition:function(f){var h,g,i=this.options,e=f.pageX,d=f.pageY,c=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,j=(/(html|body)/i).test(c[0].tagName);
if(this.cssPosition==="relative"&&!(this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0])){this.offset.relative=this._getRelativeOffset()}if(this.originalPosition){if(this.containment){if(f.pageX-this.offset.click.left<this.containment[0]){e=this.containment[0]+this.offset.click.left}if(f.pageY-this.offset.click.top<this.containment[1]){d=this.containment[1]+this.offset.click.top}if(f.pageX-this.offset.click.left>this.containment[2]){e=this.containment[2]+this.offset.click.left}if(f.pageY-this.offset.click.top>this.containment[3]){d=this.containment[3]+this.offset.click.top}}if(i.grid){h=this.originalPageY+Math.round((d-this.originalPageY)/i.grid[1])*i.grid[1];d=this.containment?((h-this.offset.click.top>=this.containment[1]&&h-this.offset.click.top<=this.containment[3])?h:((h-this.offset.click.top>=this.containment[1])?h-i.grid[1]:h+i.grid[1])):h;g=this.originalPageX+Math.round((e-this.originalPageX)/i.grid[0])*i.grid[0];e=this.containment?((g-this.offset.click.left>=this.containment[0]&&g-this.offset.click.left<=this.containment[2])?g:((g-this.offset.click.left>=this.containment[0])?g-i.grid[0]:g+i.grid[0])):g}}return{top:(d-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+((this.cssPosition==="fixed"?-this.scrollParent.scrollTop():(j?0:c.scrollTop())))),left:(e-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+((this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():j?0:c.scrollLeft())))}},_rearrange:function(g,f,d,e){d?d[0].appendChild(this.placeholder[0]):f.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction==="down"?f.item[0]:f.item[0].nextSibling));this.counter=this.counter?++this.counter:1;var c=this.counter;this._delay(function(){if(c===this.counter){this.refreshPositions(!e)}})},_clear:function(d,e){this.reverting=false;var c,f=[];if(!this._noFinalSort&&this.currentItem.parent().length){this.placeholder.before(this.currentItem)}this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(c in this._storedCSS){if(this._storedCSS[c]==="auto"||this._storedCSS[c]==="static"){this._storedCSS[c]=""
}}this.currentItem.css(this._storedCSS).removeClass("coral-sortable-helper")}else{this.currentItem.show()}if(this.fromOutside&&!e){f.push(function(g){this._trigger("receive",g,this._uiHash(this.fromOutside))})}if((this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".coral-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!e){f.push(function(g){this._trigger("update",g,this._uiHash())})}if(this!==this.currentContainer){if(!e){f.push(function(g){this._trigger("remove",g,this._uiHash())});f.push((function(g){return function(h){g._trigger("receive",h,this._uiHash(this))}}).call(this,this.currentContainer));f.push((function(g){return function(h){g._trigger("update",h,this._uiHash(this))}}).call(this,this.currentContainer))}}for(c=this.containers.length-1;c>=0;c--){if(!e){f.push((function(g){return function(h){g._trigger("deactivate",h,this._uiHash(this))}}).call(this,this.containers[c]))}if(this.containers[c].containerCache.over){f.push((function(g){return function(h){g._trigger("out",h,this._uiHash(this))}}).call(this,this.containers[c]));this.containers[c].containerCache.over=0}}if(this.storedCursor){this.document.find("body").css("cursor",this.storedCursor);this.storedStylesheet.remove()}if(this._storedOpacity){this.helper.css("opacity",this._storedOpacity)}if(this._storedZIndex){this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex)}this.dragging=false;if(this.cancelHelperRemoval){if(!e){this._trigger("beforeStop",d,this._uiHash());for(c=0;c<f.length;c++){f[c].call(this,d)}this._trigger("stop",d,this._uiHash())}this.fromOutside=false;return false}if(!e){this._trigger("beforeStop",d,this._uiHash())}this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!==this.currentItem[0]){this.helper.remove()}this.helper=null;if(!e){for(c=0;c<f.length;c++){f[c].call(this,d)}this._trigger("stop",d,this._uiHash())}this.fromOutside=false;return true},_trigger:function(){if($.Component.prototype._trigger.apply(this,arguments)===false){this.cancel()
}},_uiHash:function(c){var d=c||this;return{helper:d.helper,placeholder:d.placeholder||$([]),position:d.position,originalPosition:d.originalPosition,offset:d.positionAbs,item:d.currentItem,sender:c?c.element:null}}})})();