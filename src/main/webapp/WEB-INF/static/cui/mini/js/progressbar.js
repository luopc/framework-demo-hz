/*!
 * 组件库4.0.1：进度条
 *
 * 依赖JS文件:
 *   jquery.coral.code.js
 *   jquery.coral.component.js
 */
$.component("coral.progressbar",{version:"4.0.1",options:{id:null,name:null,max:100,value:0,text:"{value}%",onChange:null,onComplete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue();this.element.addClass("coral-progressbar coral-component coral-corner-all");this.valueDiv=$('<div class="coral-progressbar-value coral-corner-left"></div>').appendTo(this.element);this.textDiv=$('<div class="coral-progressbar-text"></div>').appendTo(this.valueDiv);this.valueWidth=this.element.width()-(this.valueDiv.outerWidth(true)-this.valueDiv.outerWidth());this._refreshValue()},_destroy:function(){this.element.removeClass("coral-progressbar coral-component coral-component-content coral-corner-all");this.valueDiv.remove()},value:function(a){if(a===undefined){return this.options.value}this.options.value=this._constrainedValue(a);this._refreshValue()},_constrainedValue:function(a){if(a===undefined){a=this.options.value}this.indeterminate=a===false;if(typeof a!=="number"){a=0}return(this.indeterminate?false:Math.min(this.options.max,Math.max(this.min,a)))},_setOptions:function(a){var b=a.value;delete a.value;this._super(a);this.options.value=this._constrainedValue(b);this._refreshValue()},_setOption:function(a,b){if(a==="max"){b=Math.max(this.min,b)}if(a==="disabled"){this.element.toggleClass("coral-state-disabled",!!b).attr("aria-disabled",b)}this._super(a,b)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var b=this.options.value,a=this._percentage().toFixed(0),e=this.options.text.replace(/{value}/,a),d=0,c=0;this.valueDiv.toggle(this.indeterminate||b>this.min).toggleClass("coral-corner-right",b===this.options.max).width(this.valueWidth*a/100);if(100==a){this.valueDiv.width("auto")}this.textDiv.html(e);d=(this.element.position().left+(this.element.outerWidth()-this.textDiv.outerWidth())/2);
c=(this.element.position().top+(this.element.outerHeight()-this.textDiv.outerHeight())/2);this.textDiv.position({of:this.element,my:d+" "+c,at:d+" "+c});this.element.toggleClass("coral-progressbar-indeterminate",this.indeterminate);if(this.indeterminate){if(!this.overlayDiv){this.overlayDiv=$("<div class='coral-progressbar-overlay'></div>").appendTo(this.valueDiv)}}else{if(this.overlayDiv){this.overlayDiv.remove();this.overlayDiv=null}}if(this.oldValue!==b){this.oldValue=b;this._trigger("onChange",null,{value:b,oldValue:this.oldValue})}if(b===this.options.max){this._trigger("onComplete")}}});