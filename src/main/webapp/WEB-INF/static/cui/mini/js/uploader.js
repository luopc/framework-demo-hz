$.component("coral.uploader",{version:$.coral.version,castProperties:["dataCustom","formData","overrideEvents","buttons","itemTemplate"],options:{id:"",swf:$.coral.scriptPath+"external/swfupload.swf",uploader:"",auto:true,buttonClass:"",buttonCursor:"hand",buttonImage:null,buttonText:"SELECT FILES",checkExisting:false,debug:false,fileObjName:"Filedata",fileSizeLimit:0,fileTypeDesc:"All Files",fileTypeExts:"*.*",heigh:30,itemTemplate:false,method:"post",multi:true,formData:{},preventCaching:true,progressData:"percentage",queueID:false,queueSizeLimit:999,removeCompleted:true,removeTimeout:3,requeueError:false,successTimeout:30,uploadLimit:0,width:120,cls:"",displayStyle:"original",emptyText:"请选择...",delay:1000,buttons:null,overrideEvents:[],onCancel:null,onClearQueue:null,onDestroy:null,onDialogClose:null,onDialogOpen:null,onDisable:null,onEnable:null,onFallback:null,onNoflash:null,onInit:null,onQueueComplete:null,onSelectError:null,onSelect:null,onNoFlash:null,onSWFReady:null,onUploadComplete:null,onUploadError:null,onUploadSuccess:null,onUploadProgress:null,onUploadStart:null},_create:function(){var b=this;b._initElement();var a=b._flashCheck();if(a==false){b._trigger("onNoFlash",null,[])}},_initElement:function(){var c=this,b=c.options,a={};if(typeof c.element.attr("id")!="undefined"){b.id=c.element.attr("id")}else{if(b.id){c.element.attr("id",b.id)}}if(typeof c.element.attr("name")!="undefined"){b.name=c.element.attr("name")}else{if(b.name){c.element.attr("name",b.name)}}delete b.id;a=c.getEventsObj();b=$.extend({},b,a);this._initUploder(b);b.id=c.element.attr("id")},_flashCheck:function(){var d=!-[1,];var a=true;if(d){try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");a=true}catch(f){a=false}}else{try{if(navigator.plugins&&navigator.plugins.length>0){var b=navigator.plugins["Shockwave Flash"];if(b==undefined){a=false}}else{a=true}}catch(f){a=false}}return a},component:function(){return this.uiUploader},destroy:function(){this.uploader.uploadify("destroy")
},disable:function(a){this.uploader.uploadify("disable",a)},settings:function(a,b,c){this.uploader.uploadify("settings",a,b,c)},stop:function(){this.uploader.uploadify("stop")},upload:function(a){if("original"==this.options.displayStyle||!this._isQueueDialog()){this.uploader.uploadify("upload",a);return}if(this.select.length==0){return}var b=this,c=this.element.attr("id");$("#"+c+"_queue").dialog("open")},getvalue:function(){if(this.select.length==0){alert("none file")}return this.select.join(",")},cancel:function(){this.uploader.uploadify("cancel")},clear:function(a){if("custom"==this.options.displayStyle){this.select=[];this.uiUploader.find(".coral-file").html("请选择...");this.uiUploader.find("object").attr("title","请选择...")}this.uploader.uploadify("cancel");this.clearQueue()},clearQueue:function(){this.uploader.clearQueue()},uploadify:function(){return this.uploader},queueData:function(){return this.uploader.data("uploadify").queueData},_getButtons:function(){if(typeof this.options.buttons==="object"){return this.options.buttons}if(typeof this.options.buttons!=="string"){return[]}var h=this,g=this.options,f=this.options.buttons,b=[];var d=$.trim(f).split(",");for(var c in d){var a={},e=d[c].split(" ");a.label=e[0];a.click=e[1];b.push(a)}return b},_triggerClick:function(a,c,d){var b=this;var e=$.coral.toFunction(a);c=$.Event(c);return e.apply(b.element[0],[c].concat(d))},_createButtons:function(){var d=this,c=this.options,b=this._getButtons();var a=$('<span class="coral-uploader-btn-icons coral-corner-right"></span>');d.uiBorder.append(a);$.each(b,function(h,j){var g=j.label,k=j.id,i=j.click,f={},e=$('<span class="coral-uploader-btn-ico icon coral-uploader-btn-textico"></span>');if(g){e.html(g);f.label=g}if(k){e.attr("data-id",k);f.id=k}e.bind("click"+d.eventNamespace,function(l){if(d.options.disabled){return}d._triggerClick(i,l,f)});a.append(e)})},_initUploder:function(a){var c=this,d=c.element.attr("id");c.uiUploader=$('<span class="coral-uploader"></span>');c.uiBorder=$('<span class="coral-uploader-border coral-corner-all"></span>');
c.uploader=$('<div id="'+d+'_uploader"></div>');c.element.after(c.uiUploader);c.uiUploader.append(c.uiBorder);c.uiBorder.append(c.element);c.element.hide();if(a.displayStyle=="original"){c.element.before(c.uploader);this.uploader.uploadify(a);return}this.uiUploader.addClass("coral-uploader-custom coral-textbox");this.uiBorder.addClass("coral-textbox-border");if(a.buttons){this._createButtons()}c.select=[];$(this.element).wrap('<span class="coral-file-default"></span>').before("<span class='coral-file'>"+a.emptyText+"</span>").before(c.uploader);var b=$.extend(a,{height:28,width:800});if(!b.queueID){$(this.element).before("<div id='"+d+"_queue'></div>");$("#"+d+"_queue").dialog({autoOpen:false,title:"上传",modal:false,resizable:false,onOpen:function(){c.uploader.uploadify("upload","*")}});a.queueID=d+"_queue";this.hasDialog=true}c.uploader.uploadify(b)},_isQueueDialog:function(){return this.hasDialog},_reloadUploader:function(){var b=this,a=this.options;delete a.id;b.uploader.uploadify(a);a.id=b.element.attr("id")},getEventsObj:function(){var b=this,a=this.options,c=this.element.attr("id");return{onCancel:function(d){b._trigger("onCancel",null,[{file:d}])},onClearQueue:function(d){b._trigger("onClearQueue",null,[{queueItemCount:d}])},onDestroy:function(){b._trigger("onDestroy",null,[])},onDialogClose:function(d){if("custom"==a.displayStyle&&a.auto&&b._isQueueDialog()){$("#"+c+"_queue").dialog("open")}b._trigger("onDialogClose",null,[{queueData:d}])},onDialogOpen:function(){if("custom"==a.displayStyle){}b._trigger("onDialogOpen",null,[])},onDisable:function(){b._trigger("onDisable",null,[])},onEnable:function(){b._trigger("onEnable",null,[])},onFallback:function(){b._trigger("onFallback ",null,[])},onNoflash:function(){return b.uiBorder},onInit:function(d){b._trigger("onInit",null,[{swfuploadify:d}])},onQueueComplete:function(d){var e=b.element.attr("id");if("custom"==a.displayStyle&&b._isQueueDialog()){setTimeout(function(){$("#"+e+"_queue").dialog("close");b.select=[]},a.delay)
}b._trigger("onQueueComplete",null,[{queueData:d}])},onSelectError:function(d,f,e){b._trigger("onSelectError",null,[{arguments:arguments}])},onSelect:function(d){if("custom"==a.displayStyle){b.select.push(d.name);b.uiUploader.find(".coral-file").html(b.select.join(","));b.uiUploader.find("object").attr("title",b.select.join(","))}b._trigger("onSelect",null,[{file:d}])},onSWFReady:function(){b._trigger("onSWFReady",null,[])},onUploadComplete:function(d){b._trigger("onUploadComplete",null,[{file:d}])},onUploadError:function(d,g,f,e){b._trigger("onUploadError",null,[{file:d,errorCode:g,errorMsg:f,errorString:e}])},onUploadSuccess:function(e,f,d){b._trigger("onUploadSuccess",null,[{file:e,data:f,response:d}])},onUploadProgress:function(e,h,d,g,f){b._trigger("onUploadProgress",null,[{file:e,fileBytesLoaded:h,fileTotalBytes:d,queueBytesLoaded:g,uploadSize:f}])},onUploadStart:function(d){b._trigger("onUploadStart",null,[{file:d}])}}},_setOption:function(a,c){var b=this;if(a==="id"||a==="name"){return}this._super(a,c);if(a==="emptyText"){this.uiUploader.find(".coral-file").html(c);return}b.settings(a,c)},_destroy:function(){var a=this;a.uiUploader.replaceWith(a.element)}});