(function(){var a="easyinput",c="easytext",b=a+c.charAt(0).toUpperCase()+c.slice(1);$.component(a+"."+c,{options:{currentValue:"",values:[],maxWidth:200,minWidth:80,maxChars:200,storage:"array",ajaxConfig:{url:"/",id:"",UPDATETemplate:"",UPDATEData:{},GETCallback:null}},_name:c,_input:null,_id:null,_valuesIndex:null,_classUnChanged:null,_classEmpty:null,_classOnEdit:null,_classChanged:null,_classEasyText:c.toLowerCase(),_setListeners:function(){this._input.bind({focus:this._focusBehaviour,input:this._autoGrownBehaviour,blur:this._blurBehaviour,storageChange:this._storageChange})},_getClassName:function(d){return this._name.toLowerCase()+"-"+d},_setClassNames:function(){this._classOnHover=this._getClassName("onHover");this._classUnChanged=this._getClassName("unChanged");this._classOnEdit=this._getClassName("onEdit");this._classChanged=this._getClassName("changed");this._classEmpty=this._getClassName("empty")},_setVars:function(){var d=this.element;this._input=d;d.uniqueId();this._valuesIndex=0;this._id=this._name+"-"+d.attr("id");d.attr("maxLength",this.options.maxChars)},_setRuler:function(){var e="#"+this._name+"-ruler",f=$(e),d=this._input;if(!f.length){String.prototype.visualLength=function(){var g=$(e);g.html(this.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"));return g.width()};f=$('<span id="'+e.substr(1)+'"></span>');f.css({fontSize:d.css("fontSize"),fontFamily:d.css("font-family"),fontWeight:d.css("fontWeight"),position:"absolute",visibility:"hidden",whiteSpace:"nowrap"});$("body").after(f)}},_initializeAjax:function(){var d=this.options.ajaxConfig;if(!$.isFunction(d.GETCallback)){return}if(d.url.charAt(d.url.length-1)!=="/"){d.url+="/"}if(!d.id){d.id=this._id}$.ajax({url:d.url+d.id,succes:d.GETCallback})},_setState:function(){var d=this._input,i=d.val(),e=i.visualLength(),g=this.options.minWidth,h=this.options.maxWidth,f;if(e<g){f=g}else{if(h<e){f=h}else{f=e}}d.width(f);if(d.val().length===0){d.removeClass(this._classChanged);
d.addClass(this._classEmpty)}else{d.addClass(this._classChanged)}},_focusBehaviour:function(){var e=$(this).data(b),d=e._input;d.removeClass(e._classChanged+" "+e._classUnChanged+" "+e._classEmpty).addClass(e._classOnEdit)},_autoGrownBehaviour:function(){var h=$(this).data(b),d=h._input,i=d.val(),f=h.options.minWidth,g=h.options.maxWidth,e=i.visualLength();if(e<f){e=f}else{if(e>g){e=g}}d.width(e)},_blurBehaviour:function(){var f=$(this).data(b),d=f._input,g=d.val(),e=f.options.ajaxConfig,h;d.removeClass(f._classOnEdit);if(g.length===0){d.addClass(f._classEmpty)}else{d.addClass(f._classChanged);f.option("values",g);f._valuesIndex=f.option("values").length-1;if(f.options.storage==="ajax"){e.UPDATEData.value=d.val();$.ajax({url:e.url+e.id,data:f._tmpl(e.UPDATETemplate,e.UPDATEData),type:"UPDATE"})}}f._setState()},_tmpl:function(f,e){var d=typeof(f)!=="string"?(function(){throw {name:"Invalid Parameter",message:"You must insert a string into the function"}}()):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+f.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return e?d(e):d},_setOption:function(e,f){var d=this.options;switch(e){case"values":d.values.push(f);if(d.storage==="localStorage"){localStorage.setItem(this._id,JSON.stringify(d.values))}return;case"currentValue":this.option("values",f);this._input.val(f);break}this._super("_setOption",e,f)},_create:function(){var e,d,f=this.options.storage;this._setClassNames();this._setVars();this._setListeners();d=this._input;d.addClass(this._classEasyText);if(f==="localStorage"){if(localStorage[this._id]){e=JSON.parse(localStorage[this._id]);this.options.values=e;d.val(e[e.length-1]);this._valuesIndex=e.length-1}}else{if(f==="ajax"){this._initializeAjax()}}this._setRuler();this._setState()},_destroy:function(){this._input.attr("class","")
},deleteStorage:function(){var e=this.options.ajaxConfig,d=this.options.storage;if(d==="localStorage"){localStorage.removeItem(this._id)}else{if(d==="ajax"){$.ajax({url:e.url+e.id,type:"DELETE"})}}this.options.values=[];this._input.val("");this._setState()},getNextBackValue:function(f){var d=this.option("values"),e=this._valuesIndex;if(f===undefined){f=true}if(typeof(f)!=="boolean"){throw new Error("Invalid parameter")}e+=f?1:(-1);if(d[e]===undefined){return -1}this._valuesIndex=e;this._input.val(d[e]);this._setState();return d[e]}})})();