$.extend($.grid,{showModal:function(a){a.w.show()},closeModal:function(a){a.w.hide().attr("aria-hidden","true");if(a.o){a.o.remove()}},hideModal:function(a,d){d=$.extend({jqm:true,gb:""},d||{});if(d.onClose){var b=d.onClose(a);if(typeof b=="boolean"&&!b){return}}if($.fn.jqm&&d.jqm===true){$(a).attr("aria-hidden","true").jqmHide()}else{if(d.gb!==""){try{$(".jqgrid-overlay:first",d.gb).hide()}catch(c){}}$(a).hide().attr("aria-hidden","true")}},findPos:function(b){var c=0,a=0;if(b.offsetParent){do{c+=b.offsetLeft;a+=b.offsetTop}while(b=b.offsetParent)}return[c,a]},createModal:function(h,o,l,a,u,b,g){var j=document.createElement("div"),q,k=this;g=$.extend({},g||{});q=$(l.gbox).attr("dir")=="rtl"?true:false;j.className="coral-component coral-component-content coral-corner-all coral-jqdialog";j.id=h.themodal;var t=document.createElement("div");t.className="coral-jqdialog-titlebar coral-component-header coral-corner-all coral-helper-clearfix";t.id=h.modalhead;$(t).append("<span class='coral-jqdialog-title'>"+l.caption+"</span>");var m=$("<a href='javascript:void(0)' class='coral-jqdialog-titlebar-close coral-corner-all'></a>").hover(function(){m.addClass("coral-state-hover")},function(){m.removeClass("coral-state-hover")}).append("<span class='coral-icon coral-icon-closethick'></span>");$(t).append(m);if(q){j.dir="rtl";$(".coral-jqdialog-title",t).css("float","right");$(".coral-jqdialog-titlebar-close",t).css("left",0.3+"em")}else{j.dir="ltr";$(".coral-jqdialog-title",t).css("float","left");$(".coral-jqdialog-titlebar-close",t).css("right",0.3+"em")}var v=document.createElement("div");$(v).addClass("coral-jqdialog-content coral-component-content").attr("id",h.modalcontent);$(v).append(o);j.appendChild(v);$(j).prepend(t);if(b===true){$("body").append(j)}else{if(typeof b=="string"){$(b).append(j)}else{$(j).insertBefore(a)}}$(j).css(g);if(typeof l.jqModal==="undefined"){l.jqModal=true}var n={};if($.fn.jqm&&l.jqModal===true){if(l.left===0&&l.top===0&&l.overlay){var c=[];c=this.findPos(u);
l.left=c[0]+4;l.top=c[1]+4}n.top=l.top+"px";n.left=l.left}else{if(l.left!==0||l.top!==0){n.left=l.left;n.top=l.top+"px"}}$("a.coral-jqdialog-titlebar-close",t).click(function(){var e=$("#"+$.grid.jqID(h.themodal)).data("onClose")||l.onClose;var p=$("#"+$.grid.jqID(h.themodal)).data("gbox")||l.gbox;k.hideModal("#"+$.grid.jqID(h.themodal),{gb:p,jqm:l.jqModal,onClose:e});return false});if(l.width===0||!l.width){l.width=300}if(l.height===0||!l.height){l.height=200}if(!l.zIndex){var d=$(a).parents("*[role=dialog]").filter(":first").css("z-index");if(d){l.zIndex=parseInt(d,10)+2}else{l.zIndex=950}}var f=0;if(q&&n.left&&!b){f=$(l.gbox).width()-(!isNaN(l.width)?parseInt(l.width,10):0)-8;n.left=parseInt(n.left,10)+parseInt(f,10)}if(n.left){n.left+="px"}$(j).css($.extend({width:isNaN(l.width)?"auto":l.width+"px",height:isNaN(l.height)?"auto":l.height+"px",zIndex:l.zIndex,overflow:"hidden"},n)).attr({tabIndex:"-1",role:"dialog","aria-labelledby":h.modalhead,"aria-hidden":"true"});if(typeof l.drag=="undefined"){l.drag=true}if(typeof l.resize=="undefined"){l.resize=true}if(l.drag){$(t).css("cursor","move");if($.fn.jqDrag){$(j).jqDrag(t)}else{try{$(j).draggable({handle:$("#"+$.grid.jqID(t.id))})}catch(s){}}}if(l.resize){if($.fn.jqResize){$(j).append("<div class='jqResize coral-resizable-handle coral-resizable-se coral-icon coral-icon-gripsmall-diagonal-se coral-icon-grip-diagonal-se'></div>");$("#"+$.grid.jqID(h.themodal)).jqResize(".jqResize",h.scrollelm?"#"+$.grid.jqID(h.scrollelm):false)}else{try{$(j).resizable({handles:"se, sw",alsoResize:h.scrollelm?"#"+$.grid.jqID(h.scrollelm):false})}catch(i){}}}if(l.closeOnEscape===true){$(j).keydown(function(r){if(r.which==27){var p=$("#"+$.grid.jqID(h.themodal)).data("onClose")||l.onClose;k.hideModal(this,{gb:l.gbox,jqm:l.jqModal,onClose:p})}})}},viewModal:function(a,c){c=$.extend({toTop:true,overlay:10,modal:false,overlayClass:"coral-component-overlay",onShow:this.showModal,onHide:this.closeModal,gbox:"",jqm:true,jqM:true},c||{});if($.fn.jqm&&c.jqm===true){if(c.jqM){$(a).attr("aria-hidden","false").jqm(c).jqmShow()
}else{$(a).attr("aria-hidden","false").jqmShow()}}else{if(c.gbox!==""){$(".jqgrid-overlay:first",c.gbox).show();$(a).data("gbox",c.gbox)}$(a).show().attr("aria-hidden","false");try{$(":input:visible",a)[0].focus()}catch(b){}}},info_dialog:function(p,j,b,o){var l={width:290,height:"auto",dataheight:"auto",drag:true,resize:false,caption:"<b>"+p+"</b>",left:250,top:170,zIndex:1000,jqModal:true,modal:false,closeOnEscape:true,align:"center",buttonalign:"center",buttons:[]};$.extend(l,o||{});var d=l.jqModal,q=this;if($.fn.jqm&&!d){d=false}var g="";if(l.buttons.length>0){for(var f=0;f<l.buttons.length;f++){if(typeof l.buttons[f].id=="undefined"){l.buttons[f].id="info_button_"+f}g+="<a href='javascript:void(0)' id='"+l.buttons[f].id+"' class='fm-button coral-state-default coral-corner-all'>"+l.buttons[f].text+"</a>"}}var k=isNaN(l.dataheight)?l.dataheight:l.dataheight+"px",n="text-align:"+l.align+";";var a="<div id='info_id'>";a+="<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+k+";"+n+"'>"+j+"</div>";a+=b?"<div class='coral-component-content coral-helper-clearfix' style='text-align:"+l.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'><a href='javascript:void(0)' id='closedialog' class='fm-button coral-state-default coral-corner-all'>"+b+"</a>"+g+"</div>":g!==""?"<div class='coral-component-content coral-helper-clearfix' style='text-align:"+l.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'>"+g+"</div>":"";a+="</div>";try{if($("#info_dialog").attr("aria-hidden")=="false"){this.hideModal("#info_dialog",{jqm:d})}$("#info_dialog").remove()}catch(h){}this.createModal({themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content",scrollelm:"infocnt"},a,l,"","",true);if(g){$.each(l.buttons,function(e){$("#"+$.grid.jqID(this.id),"#info_id").bind("click",function(){l.buttons[e].onClick.call($("#info_dialog"));
return false})})}$("#closedialog","#info_id").click(function(){q.hideModal("#info_dialog",{jqm:d});return false});$(".fm-button","#info_dialog").hover(function(){$(this).addClass("coral-state-hover")},function(){$(this).removeClass("coral-state-hover")});if($.isFunction(l.beforeOpen)){l.beforeOpen()}this.viewModal("#info_dialog",{onHide:function(e){e.w.hide().remove();if(e.o){e.o.remove()}},modal:l.modal,jqm:d});if($.isFunction(l.afterOpen)){l.afterOpen()}try{$("#info_dialog").focus()}catch(c){}},createEl:function(d,f,u,j,s){var t="",o=this;function k(i,e){if($.isFunction(e.dataInit)){e.dataInit.call(o,i)}if(e.dataEvents){$.each(e.dataEvents,function(){if(this.data!==undefined){$(i).bind(this.type,this.data,this.fn)}else{$(i).bind(this.type,this.fn)}})}return e}function q(y,i,e){if(!i.hasOwnProperty("id")){$(y).attr("id",$.grid.randId())}}switch(d){case"textarea":t=document.createElement("textarea");if(j){if(!f.cols){$(t).css({width:"98%"})}}else{if(!f.cols){f.cols=20}}if(!f.rows){f.rows=2}if(u=="&nbsp;"||u=="&#160;"||(u.length==1&&u.charCodeAt(0)==160)){u=""}t.value=u;q(t,f);$(t).attr({role:"textbox",multiline:"true"});break;case"select":t=document.createElement("select");t.setAttribute("role","select");var c,g=[];if(f.multiple===true){c=true;t.multiple="multiple";$(t).attr("aria-multiselectable","true")}else{c=false}if(typeof(f.dataUrl)!="undefined"){$.ajax($.extend({url:f.dataUrl,type:"GET",dataType:"html",context:{elem:t,options:f,vl:u},success:function(D){var y,i=[],C=this.elem,B=this.vl,z=$.extend({},this.options),A=z.multiple===true;if($.isFunction(z.buildSelect)){var e=z.buildSelect.call(o,D);y=$(e).html()}else{y=$(D).html()}if(y){$(C).append(y);q(C,z);if(typeof z.size==="undefined"){z.size=A?3:1}if(A){i=B.split(",");i=$.map(i,function(E){return $.trim(E)})}else{i[0]=$.trim(B)}setTimeout(function(){$("option",C).each(function(E){if(E===0&&C.multiple){this.selected=false}$(this).attr("role","option");if($.inArray($.trim($(this).text()),i)>-1||$.inArray($.trim($(this).val()),i)>-1){this.selected="selected"
}})},0)}}},s||{}))}else{if(f.value){var n;if(typeof f.size==="undefined"){f.size=c?3:1}if(c){g=u.split(",");g=$.map(g,function(e){return $.trim(e)})}if(typeof f.value==="function"){f.value=f.value()}var p,m,h,l=f.separator===undefined?":":f.separator,v=f.delimiter===undefined?";":f.delimiter;if(typeof f.value==="string"){p=f.value.split(v);for(n=0;n<p.length;n++){m=p[n].split(l);if(m.length>2){m[1]=$.map(m,function(i,e){if(e>0){return i}}).join(l)}h=document.createElement("option");h.setAttribute("role","option");h.value=m[0];h.innerHTML=m[1];t.appendChild(h);if(!c&&($.trim(m[0])==$.trim(u)||$.trim(m[1])==$.trim(u))){h.selected="selected"}if(c&&($.inArray($.trim(m[1]),g)>-1||$.inArray($.trim(m[0]),g)>-1)){h.selected="selected"}}}else{if(typeof f.value==="object"){var b=f.value;for(var x in b){if(b.hasOwnProperty(x)){h=document.createElement("option");h.setAttribute("role","option");h.value=x;h.innerHTML=b[x];t.appendChild(h);if(!c&&($.trim(x)==$.trim(u)||$.trim(b[x])==$.trim(u))){h.selected="selected"}if(c&&($.inArray($.trim(b[x]),g)>-1||$.inArray($.trim(x),g)>-1)){h.selected="selected"}}}}}q(t,f,["value"])}}break;case"datepicker":case"autocomplete":case"autocompletetree":case"text":case"password":case"button":var w;if(d=="button"){w="button"}else{w="textbox"}t=document.createElement("input");if(d=="datepicker"){t.type="text"}else{if(d=="autocomplete"){t.type="text"}else{t.type=d}}t.value=u;q(t,f);if(d!="button"){if(j){if(!f.size){$(t).css({width:"98%"})}}else{if(!f.size){f.size=20}}}$(t).attr("role",w);break;case"image":case"file":t=document.createElement("input");t.type=d;q(t,f);break;case"custom":t=document.createElement("span");try{if($.isFunction(f.custom_element)){var a=f.custom_element.call(o,u,f);if(a){a=$(a).addClass("customelement").attr({id:f.id,name:f.name});$(t).empty().append(a)}else{throw"e2"}}else{throw"e1"}}catch(r){if(r=="e1"){this.info_dialog($.grid.errors.errcap,"function 'custom_element' "+$.grid.edit.msg.nodefined,$.grid.edit.bClose)}if(r=="e2"){this.info_dialog($.grid.errors.errcap,"function 'custom_element' "+$.grid.edit.msg.novalue,$.grid.edit.bClose)
}else{this.info_dialog($.grid.errors.errcap,typeof(r)==="string"?r:r.message,$.grid.edit.bClose)}}break;case"checkbox":t=document.createElement("input");t.type=d;t.value=u;q(t,f);break;case"combobox":case"combotree":case"combogrid":t=document.createElement("input");t.type="text";t.value=u;q(t,f);break;default:break}return t},checkDate:function(n,c){var l=function(i){return(((i%4===0)&&(i%100!==0||(i%400===0)))?29:28)},k=function(q){for(var j=1;j<=q;j++){this[j]=31;if(j==4||j==6||j==9||j==11){this[j]=30}if(j==2){this[j]=29}}return this};var e={},p;n=n.toLowerCase();if(n.indexOf("/")!=-1){p="/"}else{if(n.indexOf("-")!=-1){p="-"}else{if(n.indexOf(".")!=-1){p="."}else{p="/"}}}n=n.split(p);c=c.split(p);if(c.length!=3){return false}var g=-1,o,f=-1,d=-1;for(var h=0;h<n.length;h++){var b=isNaN(c[h])?0:parseInt(c[h],10);e[n[h]]=b;o=n[h];if(o.indexOf("y")!=-1){g=h}if(o.indexOf("m")!=-1){d=h}if(o.indexOf("d")!=-1){f=h}}if(n[g]=="y"||n[g]=="yyyy"){o=4}else{if(n[g]=="yy"){o=2}else{o=-1}}var a=k(12),m;if(g===-1){return false}else{m=e[n[g]].toString();if(o==2&&m.length==1){o=1}if(m.length!=o||(e[n[g]]===0&&c[g]!="00")){return false}}if(d===-1){return false}else{m=e[n[d]].toString();if(m.length<1||e[n[d]]<1||e[n[d]]>12){return false}}if(f===-1){return false}else{m=e[n[f]].toString();if(m.length<1||e[n[f]]<1||e[n[f]]>31||(e[n[d]]==2&&e[n[f]]>l(e[n[g]]))||e[n[f]]>a[e[n[d]]]){return false}}return true},isEmpty:function(a){if(a.match(/^\s+$/)||a===""){return true}else{return false}},checkTime:function(c){var b=/^(\d{1,2}):(\d{2})([ap]m)?$/,a;if(!this.isEmpty(c)){a=c.match(b);if(a){if(a[3]){if(a[1]<1||a[1]>12){return false}}else{if(a[1]>23){return false}}if(a[2]>59){return false}}else{return false}}return true},checkValues:function(c,o,k,p,h){var f,j,q,b,l;if(typeof(p)==="undefined"){if(typeof(o)=="string"){for(j=0,l=k.options.colModel.length;j<l;j++){if(k.options.colModel[j].name==o){f=k.options.colModel[j].editrules;o=j;try{q=k.options.colModel[j].formoptions.label}catch(n){}break}}}else{if(o>=0){f=k.options.colModel[o].editrules
}}}else{f=p;q=h===undefined?"_":h}if(f){if(!q){q=k.options.colNames[o]}if(f.required===true){if(this.isEmpty(c)){return[false,q+": "+$.grid.edit.msg.required,""]}}var d=f.required===false?false:true;if(f.number===true){if(!(d===false&&this.isEmpty(c))){if(isNaN(c)){return[false,q+": "+$.grid.edit.msg.number,""]}}}if(typeof f.minValue!="undefined"&&!isNaN(f.minValue)){if(parseFloat(c)<parseFloat(f.minValue)){return[false,q+": "+$.grid.edit.msg.minValue+" "+f.minValue,""]}}if(typeof f.maxValue!="undefined"&&!isNaN(f.maxValue)){if(parseFloat(c)>parseFloat(f.maxValue)){return[false,q+": "+$.grid.edit.msg.maxValue+" "+f.maxValue,""]}}var a;if(f.email===true){if(!(d===false&&this.isEmpty(c))){a=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;if(!a.test(c)){return[false,q+": "+$.grid.edit.msg.email,""]}}}if(f.integer===true){if(!(d===false&&this.isEmpty(c))){if(isNaN(c)){return[false,q+": "+$.grid.edit.msg.integer,""]}if((c%1!==0)||(c.indexOf(".")!=-1)){return[false,q+": "+$.grid.edit.msg.integer,""]}}}if(f.date===true){if(!(d===false&&this.isEmpty(c))){if(k.options.colModel[o].formatoptions&&k.options.colModel[o].formatoptions.newformat){b=k.options.colModel[o].formatoptions.newformat
}else{b=k.options.colModel[o].datefmt||"Y-m-d"}if(!this.checkDate(b,c)){return[false,q+": "+$.grid.edit.msg.date+" - "+b,""]}}}if(f.time===true){if(!(d===false&&this.isEmpty(c))){if(!this.checkTime(c)){return[false,q+": "+$.grid.edit.msg.date+" - hh:mm (am/pm)",""]}}}if(f.url===true){if(!(d===false&&this.isEmpty(c))){a=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;if(!a.test(c)){return[false,q+": "+$.grid.edit.msg.url,""]}}}if(f.custom===true){if(!(d===false&&this.isEmpty(c))){if($.isFunction(f.custom_func)){var m=f.custom_func.call(k,c,q);if($.isArray(m)){return m}else{return[false,$.grid.edit.msg.customarray,""]}}else{return[false,$.grid.edit.msg.customfcheck,""]}}}}return[true,"",""]}});