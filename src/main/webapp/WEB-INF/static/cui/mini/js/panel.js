(function(){var b=false,a=true;$(window).unbind(".coral-panel").bind("resize.coral-panel",function(){$.coral.beforeDoOverflow();if(!a){return}if(b!==false){clearTimeout(b)}b=setTimeout(function(){a=false;$.coral.refreshAllComponent("body");b=false;a=true},200)});$.component("coral.panel",{version:"4.0.2",options:{id:null,title:null,iconCls:null,width:"auto",height:"auto",left:null,top:null,cls:null,headerCls:null,bodyCls:null,style:{},href:null,cache:true,fit:false,border:true,doSize:true,showHeader:true,showTitle:true,content:null,collapsible:false,showNavButton:false,minimizable:false,maximizable:false,closable:false,collapsed:false,minimized:false,maximized:false,closed:false,tools:null,url:null,loadtext:"加载中，请耐心等候...",loadingMessage:"Loading...",extractor:function(e){var d=/<body[^>]*>((.|[\n\r])*)<\/body>/im;var c=d.exec(e);if(c){return c[1]}else{return e}},beforeOpen:$.noop,beforeClose:$.noop,beforeDestroy:$.noop,beforeCollapse:$.noop,beforeExpand:$.noop,onLoad:$.noop,onOpen:$.noop,onClose:$.noop,onDestroy:$.noop,onResize:$.noop,onMove:$.noop,onMaximize:$.noop,onRestore:$.noop,onMinimize:$.noop,onCollapse:$.noop,onExpand:$.noop},_create:function(){this.originalTitle=this.element.attr("title");this.element.removeAttr("title").addClass("ctrl-init ctrl-init-panel");this._createWrapper();this.isLoaded=false;this.element.appendTo(this.uiPanel);this._addHeader();this._setBorder();if(this.options.doSize==true){this.uiPanel.css("display","block");this.resizePanel()}if(this.options.closed==true||this.options.minimized==true){this.close()}else{this.open()}},_createWrapper:function(){var c=this;this.element.addClass("coral-panel-body");this.uiPanel=$('<div class="coral-panel"></div>').insertBefore(this.element)},_fit:function(c){return $.coral.panel.fit(this.uiPanel,c)},resizePanel:function(f){var e=this.options,d=this.uiPanel,g=d.children("div.coral-panel-header"),c=d.children("div.coral-panel-body");if(f){$.extend(e,{width:f.width,height:f.height,left:f.left,top:f.top})
}e.fit?$.extend(e,this._fit()):this._fit(false);d.css({left:e.left,top:e.top});if(!isNaN(e.width)){d.outerWidth(e.width)}else{d.width("auto")}g.add(c).outerWidth(d.width());if(!isNaN(e.height)){d.outerHeight(e.height);c.outerHeight(d.height()-g.outerHeight())}else{c.height("auto");d.css("height","")}this._doResize();if(this.toolbarEl){this.toolbarEl.toolbar("refresh")}this._trigger("onResize",null,{width:e.width,height:e.height})},_setBorder:function(){var e=this.options,d=this.uiPanel,f=this.header(),c=this.body();if(!$.isEmptyObject(e.style)){d.css(e.style)}if(e.border){f.removeClass("coral-panel-header-noborder");c.removeClass("coral-panel-body-noborder")}else{f.addClass("coral-panel-header-noborder");c.addClass("coral-panel-body-noborder")}f.addClass(e.headerCls);c.addClass(e.bodyCls)},_addHeader:function(){var c=this.options,d=this.uiPanel,i=this;if(c.tools&&typeof c.tools=="string"){d.find(">div.coral-panel-header>div.coral-panel-tool .coral-panel-tool-a").appendTo(c.tools)}d.children("div.coral-panel-header").remove();if(c.title&&c.showHeader){var h=$('<div class="coral-panel-header"></div>').prependTo(d);this.toolbarEl=$("<div></div>");this.toolbarEl.appendTo(h);var k=[];var m={type:"html",content:c.title},l={type:"button",icons:"cui-icon-arrow-up3 coral-panel-tool-collapse",label:"collapse",text:false,onClick:function(){if(c.collapsed===true){i.expand(true)}else{i.collapse(true)}}},j={type:"button",icons:"cui-icon-minus3 coral-panel-tool-min",label:"minimize",text:false,onClick:function(){i.minimize()}},g={type:"button",icons:"cui-icon-enlarge7 coral-panel-tool-max",label:"maximize",text:false,onClick:function(){if(c.maximized===true){i.restore()}else{i.maximize()}}},e={type:"button",icons:"cui-icon-cross2 coral-panel-tool-close",label:"close",text:false,onClick:function(){i.close()}};var f={data:k};if(c.toolbarOptions){$.each(c.toolbarOptions.data,function(n,o){if(o==="title"){c.toolbarOptions.data[n]=m}if(o==="collapse"){c.toolbarOptions.data[n]=l}if(o==="minimize"){c.toolbarOptions.data[n]=j
}if(o==="maximize"){c.toolbarOptions.data[n]=g}if(o==="close"){c.toolbarOptions.data[n]=e}});$.extend(true,f,c.toolbarOptions)}else{if(c.showTitle){k.push(m)}k.push("->");if(c.collapsible){k.push(l)}if(c.minimizable){k.push(j)}if(c.maximizable){k.push(g)}if(c.closable){k.push(e)}}this.toolbarEl.toolbar(f);d.children("div.coral-panel-body").removeClass("coral-panel-body-noheader")}else{d.children("div.coral-panel-body").addClass("coral-panel-body-noheader")}},toolbar:function(){return this.toolbarEl},_loadData:function(){var d=this.options,c=this;if(d.url){if(!c.isLoaded||!d.cache){c.isLoaded=false;c.element.html("");$(this.element).loading({position:"inside",text:this.options.loadtext});if(this.xhr){this.xhr.abort()}this.xhr=$.ajax(this._ajaxSettings());this.xhr.success(function(e){c.setContent(d.extractor.call(c.element,e));c._trigger("onLoad",null,arguments);c.isLoaded=true}).complete(function(f,e){if(f===c.xhr){c.xhr=null}})}}else{if(d.content){if(!c.isLoaded){c.setContent(d.content);c.isLoaded=true}}}},_ajaxSettings:function(){var d=this.options,c=this;return{url:d.url,cache:false,dataType:"html"}},_doResize:function(){$.coral.refreshAllComponent(this.element)},_destroy:function(c){if(c!=true){if(this._trigger("beforeDestroy")==false){return}}if(this.originalTitle){this.element.attr("title",this.originalTitle)}this.element.removeClass("coral-panel-body").detach();this.element.insertAfter(this.component());this.component().remove();this._trigger("onDestroy")},component:function(){return this.uiPanel},panel:function(){return this.uiPanel},getOptions:function(){return this.options},header:function(){return this.uiPanel.find(">div.coral-panel-header")},body:function(){return this.uiPanel.find(">div.coral-panel-body")},setTitle:function(c){this.options.title=c;this.header().find("div.coral-panel-title").html(c)},setContent:function(c){this.element.children().remove();this.element.html(c);if($.parser){$.parser.parse(this.element)}},open:function(c){var e=this.options,d=null;
if(c!=true){if(this._trigger("beforeOpen",null)===false){return}}this.uiPanel.show();e.closed=false;e.minimized=false;d=this.uiPanel.children(".coral-panel-header").find("a.coral-panel-tool-restore");if(d.length){e.maximized=true}this._trigger("onOpen");if(e.maximized===true){e.maximized=false;this.maximize()}if(e.collapsed===true){e.collapsed=false;this.collapse()}if(!e.collapsed){this._loadData();this._doResize()}},close:function(e){var d=this.options;var c=this.uiPanel;if(e!=true){if(this._trigger("beforeClose",null)==false){return}}this._fit(false);c.hide();d.closed=true;this._trigger("onClose")},refresh:function(c){this.isLoaded=false;if(c){this.options.url=c}this._loadData()},reload:function(c){this.refresh(c)},resize:function(c){this.resizePanel(c)},move:function(c){var d=this.options;if(c){if(c.left!=null){d.left=c.left}if(c.top!=null){d.top=c.top}}this.uiPanel.css({left:d.left,top:d.top});this._trigger("onMove",null,{left:d.left,top:d.top})},maximize:function(){var c=this.options;if(c.maximized===true){return}this.uiPanel.children("div.coral-panel-header").find("a.coral-panel-tool-max").addClass("coral-panel-tool-restore").addClass("cui-icon-shrink7").removeClass("cui-icon-enlarge7");if(!this.original){this.original={width:c.width,height:c.height,left:c.left,top:c.top,fit:c.fit}}c.left=0;c.top=0;c.fit=true;this.resizePanel();c.minimized=false;c.maximized=true;this._trigger("onMaximize")},minimize:function(){this._fit(false);this.uiPanel.hide();this.options.minimized=true;this.options.maximized=false;this._trigger("onMinimize")},restore:function(){if(this.options.maximized===false){return}this.uiPanel.show();this.uiPanel.children("div.coral-panel-header").find("a.coral-panel-tool-max").removeClass("coral-panel-tool-restore").addClass("cui-icon-enlarge7").removeClass("cui-icon-shrink7");$.extend(this.options,this.original);this.resizePanel();this.options.minimized=false;this.options.maximized=false;this.original=null;this._trigger("onRestore")},collapse:function(d){var f=this.options,c=this.body(),e=this;
if(f.collapsed===true){return}c.stop(true,true);if(e._trigger("beforeCollapse")===false){return}this.header().find("a.coral-panel-tool-collapse").addClass("coral-panel-tool-expand");if(d===true){c.slideUp("normal",function(){f.collapsed=true;e._trigger("onCollapse")})}else{c.hide();f.collapsed=true;e._trigger("onCollapse")}},expand:function(d){var f=this.options,c=this.body(),e=this;if(f.collapsed===false){return}c.stop(true,true);if(e._trigger("beforeExpand")===false){return}this.header().find("a.coral-panel-tool-collapse").removeClass("coral-panel-tool-expand");if(d===true){c.slideDown("normal",function(){f.collapsed=false;e._trigger("onExpand");e._loadData();e._doResize()})}else{c.show();f.collapsed=false;e._trigger("onExpand");e._loadData();e._doResize()}}});$.coral.panel.fit=function(e,c){c=(c==undefined?true:c);var d=e.parent()[0];d=$(d);if(c){if(!d.hasClass("coral-panel-noscroll")){d.addClass("coral-panel-noscroll");if(d.attr("tagName")=="BODY"){$("html").addClass("coral-panel-fit")}}}else{if(d.hasClass("coral-panel-noscroll")){d.removeClass("coral-panel-noscroll");if(d.attr("tagName")=="BODY"){$("html").removeClass("coral-panel-fit")}}}return{width:d.width(),height:d.height()}}})();