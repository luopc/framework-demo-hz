$.component("coral.autocompletetree",$.coral.autocomplete,{requestIndex:0,pending:0,options:{allowPushParent:false,rootNode:false,multiLineLabel:false,radioType:"level",showRootNode:true,multiple:false,triggers:null,excluded:false},_create:function(){this.options.render="tree";this._super()},_filter:function(c,b,a){$(this.menu.element).tree("reload",c);$(this.menu.element).tree("filterNodesByParam",{name:b.term});a(c)},_initData:function(){var b=this;this.menu={};var a=$("<ul>")[0];$(a).uniqueId().addClass("coral-autocomplete-panel coral-front").appendTo(this._appendTo()).tree({showLine:false,showIcon:true,radioType:this.options.radioType,showRootNode:this.options.showRootNode,rootNode:this.options.rootNode,componentCls:"coral-autocomplete-tree",beforeClick:function(d,c){if(!b.options.allowPushParent&&c.isParent){return false}},onClick:function(c,d,f){var k=f,e=b.previous;if(b.element[0]!==b.document[0].activeElement){b.element.focus();b.previous=e;b._delay(function(){b.previous=e;b.selectedItem=k})}if(false!==b._trigger("beforeNodeClick",c,{item:k,value:b.getValue()})){b.selectedItem=k;b.selectedItems.push(k);var g=b.getValue(),j=b.getText(),h=g==""?[]:g.split(b.options.separator),i=j==""?[]:j.split(b.options.separator);if(b.options.multiple){if(!b.options.allowRepeat&&$.inArray(f.id,h)>-1){return}h.push(f.id);i.push(f.name)}else{h=[f.id];i=[f.name]}b.setText(i.join(b.options.separator));b.setValue(h.join(b.options.separator),true)}b._trigger("onNodeClick",c,{item:k,value:b.getValue()});b.term=b._text();b.close(c)}}).hide();this.menu.element=$(a);if(isNaN(this.options.panelHeight)){$(".coral-autocomplete-panel").css({"max-height":this.options.maxPanelHeight+"px"})}}});