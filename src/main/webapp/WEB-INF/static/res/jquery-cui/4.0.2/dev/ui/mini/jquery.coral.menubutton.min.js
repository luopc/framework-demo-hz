/*!
 * 组件库4.0：下拉按钮
 * 
 * 依赖JS文件：
 *    jquery.coral.core.js
 *    jquery.coral.component.js
 */
(function(a,b){a(document).unbind(".coral-menubutton").bind("mousedown.coral-menubutton mousewheel.coral-menubutton",function(c){if(a(c.target).closest("span.coral-menubutton,.coral-menubutton-buttons").length){return}a(".coral-menubutton-buttons").hide()});a.component("coral.menubutton",a.coral.button,{version:"4.0.2",castProperties:["menuOptions"],options:{id:null,name:null,label:null,cls:null,icons:{primary:null,secondary:"cui-icon-arrow-down3"},width:null,text:true,disabled:false,renderType:"menu",menuOptions:{autoDisplay:false,popup:true},data:null,url:null,method:"get",position:{my:"left top",at:"left bottom"},onCreate:null,onClick:null,onDblClick:null,onLoad:null},showPanel:function(){var g=this,f=this.options;var c=a.extend(f.position,{of:this.element});var d=this.uiButtons.siblings(".coral-front:visible").map(function(){return +a(this).css("z-index")}).get(),e=Math.max.apply(null,d);if(e>=+this.uiButtons.css("z-index")){this.uiButtons.css("z-index",e+1)}this.uiButtons.css({position:"absolute",left:"",top:""}).position(c).show()},hidePanel:function(){this.uiButtons.hide()},_create:function(){this._initElements();this._super()},_getToolbar:function(d){var f=this,e=this.options,c=a();if(this.element.hasClass("ctrl-toolbar-element")){c=d?this.element.parents(".coral-toolbar:eq(0)"):this.element.parents(".ctrl-init-toolbar:eq(0)")}return c},_hideMenus:function(){a(".coral-tieredmenu").hide()},hideAllMenus:function(){a(".coral-tieredmenu").hide()},showMenu:function(){this.uiMenu.tieredmenu("show")},_initElements:function(){var d=this,c=this.options;this.element.addClass("ctrl-init ctrl-init-menubutton coral-menubutton-element");this.uiBorder=a('<span class="coral-menubutton-border"></span>');this.uiBox=a('<span class="coral-menubutton"></span>');this.uiBox.append(this.uiBorder);this.uiBox.insertAfter(this.element);this.uiBorder.append(this.element);if(typeof this.element.attr("id")!="undefined"){this.options.id=this.element.attr("id")
}else{if(this.options.id){this.element.attr("id",this.options.id)}else{this.options.id=this.element.uniqueId().attr("id")}}if(typeof this.element.attr("name")!="undefined"){this.options.name=this.element.attr("name")}else{if(this.options.name){this.element.attr("name",this.options.name)}}this.options.onClick=function(h,g){if(c.renderType=="button"){if(!d.uiButtons.is(":visible")){d.showPanel()}else{d.hidePanel()}}if(!d._getToolbar().length||!d._getToolbar().toolbar("option","autoDisplay")){return}var f=d._getToolbar(true);if(f.length){f.toggleClass("coral-toolbar-click-active")}},this.options.onMouseEnter=function(h,g){if(!d._getToolbar().length||!d._getToolbar().toolbar("option","autoDisplay")){return}if(c.renderType=="button"){return}var f=d._getToolbar(true);if(f.hasClass("coral-toolbar-click-active")){if(a(".coral-tieredmenu:visible").length){d._hideMenus()}d.uiMenu.tieredmenu("show")}};this._on(this.element,{buttononclick:function(g,f){d._trigger("onClick",g,f)}});if(c.renderType=="button"){this.uiButtons=a("<div class='coral-menubutton-buttons coral-front'></div>").appendTo(a(document.body));this._loadData()}else{this.uiMenu=a('<ul class="coral-menubutton-menu"></ul>').appendTo(a(document.body));this._renderMenu()}},_renderMenu:function(){var g=this,f=this.options,e=this.options.menuOptions,h=this.options.data,c=this.options.url;var d={};if(null!=h){d.data=h}if(null!=c){d.url=c}e=a.extend({},d,f.menuOptions,{id:this.element.attr("id")+"_tieredmenu",trigger:this.element,of:this.element});this.uiMenu.tieredmenu(e);if(g._getToolbar().length&&g._getToolbar().toolbar("option","autoDisplay")){this.uiMenu.tieredmenu("component").bind("mouseleave",function(){g._hideMenus()})}this._on(this.uiMenu,{tieredmenuonclick:function(j,i){g._trigger("onClick",j,i)}})},_loadData:function(){var d=this,c=this.options;if(c.url){a.ajax({type:c.method,url:c.url,data:{},dataType:"json",success:function(e){d._initData(e)},error:function(){a.alert("Json Format Error!")}})}else{if(c.data){this._initData(c.data)
}}},_initData:function(d){var c=this;if(typeof d==="object"){this._addItems(null,d)}c._trigger("onLoad",null,{})},_addItems:function(f,j){if(typeof j!=="object"){return}var h=this,e=[],d=j.length;for(var g=0;g<d;g++){var c=j[g];if(!a.isEmptyObject(c)){e.push(h._createButton(c))}}this._appendItems(f,e);this._initItems(e)},_createButton:function(c){return{button:a("<button type='button'></button>").addClass("coral-menubutton-button-item"),options:c}},_appendItems:function(d,c){for(var e in c){c[e].button.appendTo(this.uiButtons)}},_initItems:function(c){var h=this;for(var f in c){var e=c[f].button,g=c[f].options;e.button(g);var d={};d.buttononclick=function(j,i){h._trigger("onClick",j,i)};h._on(e,d)}},add:function(c){},prepend:function(f){if(!f instanceof jQuery){return}var g=this,c=f.length;if(!(f instanceof Array)){f=[f]}for(var e=c-1;e>-1;e--){var d=f[e];d.css({margin:"",left:"",right:""}).removeClass("coral-menubutton-button-item").addClass("coral-menubutton-button-item").prependTo(g.uiButtons)}},append:function(f){if(!f instanceof jQuery){return}var g=this,c=f.length;if(!(f instanceof Array)){f=[f]}for(var e=c-1;e>-1;e--){var d=f[e];d.css({margin:"",left:"",right:""}).removeClass("coral-menubutton-button-item").addClass("coral-menubutton-button-item").prependTo(g.uiButtons)}},pop:function(){var e=this,d=this.options;if("button"!=d.renderType){return a()}var c=this.uiButtons.find(".coral-menubutton-button-item:eq(0)");if(c.length){return c.removeClass("coral-menubutton-button-item")}else{return a()}},component:function(){return this.uiBox},border:function(){return this.uiBorder},buttons:function(){return this.uiButtons},buttonElements:function(){return this.uiButtons.children()},menu:function(){return this.uiMenu},_bindEvents:function(){},_setOption:function(c,e){var d=this;if(c==="id"||c==="name"){return}if(c==="disabled"){this.element.toggleClass("coral-state-disabled",e)}this._super(c,e)},_destroy:function(){var c=this.options;this.uiBox.replaceWith(this.element);
if(c.renderType=="buttons"){this.uiButtons.remove()}else{this.uiMenu.parent().remove()}this.element.children().remove();this.element.removeClass("ctrl-init ctrl-init-menubutton coral-menubutton-element")}})})(jQuery);