/*!
 * 组件库4.0：复选框组
 * 
 * 依赖JS文件：
 *    jquery.coral.core.js
 *    jquery.coral.component.js
 *    jquery.validatehelper.js
 */
(function(a){a.component("coral.radiolist",a.coral.formelement,{version:"4.0.1",castProperties:["data","triggers"],options:{id:null,name:null,valueField:"value",textField:"text",required:false,labelField:null,starBefore:false,showStar:true,column:null,disabled:false,readonly:false,isCheck:false,allowCancel:false,value:"",valueIndex:null,data:[],url:null,termSplit:";",itemSplit:":",repeatLayout:"table",itemWidth:"auto",errMsg:null,errMsgPosition:"leftBottom",onLoad:null,onValidError:null,onKeyDown:null,onValidSuccess:null,triggers:null,excluded:false,onChange:a.noop},_create:function(){var e=this,c=null,b=null,f=null,d=this.options;this._prepareInit();this._initComponent();this._setDefaultValue();this._initData();this._bindEvent();if(this.options.url){this._trigger("onLoad",null,[{data:this.getData()}])}},_prepareInit:function(){this.isInit=false},_initComponent:function(){this.element.addClass("coral-form-element-radiolist coral-validation-radiolist ctrl-init ctrl-form-element ctrl-init-radiolist");typeof this.element.attr("id")=="undefined"&&!!this.options.id&&that.element.attr("id",this.options.id);this.options.id=this.element.uniqueId().attr("id");var b=this.element.attr("name");typeof b!="undefined"?(this.options.name=b):(this.element.attr("name",this.options.name));this.uiBoxlist=a('<span class="coral-radiolist"></span>');this.uiInput=a('<input type="hidden">');if(this.options.name){this.uiInput.attr("name",this.options.name);this.element.removeAttr("name").attr("orgname",this.options.name)}this.uiInput.appendTo(this.uiBoxlist);if(this.options.labelField){this.uiLabel=a('<label class="coral-label">'+this.options.labelField+"</label>");this.uiBoxlist.prepend(this.uiLabel);this.uiBoxlist.addClass("coral-hasLabel")}this.uiBoxlist.insertAfter(this.element);this.element.hide()},_setDefaultValue:function(){},_initData:function(){var c=this,b=this.options;
if(b.url){if(this.xhr){this.xhr.abort()}this.xhr=a.ajax(this._ajaxSettings());this.xhr.success(function(d){c._loadData(d)}).complete(function(e,d){if(e===c.xhr){c.xhr=null}}).error(function(){a.alert("Json Format Error!")})}else{if(b.data){this._loadData(b.data)}}},_ajaxSettings:function(){var c=this.options,b=this;return{type:"get",url:c.url,data:{},async:false,dataType:"json"}},_loadData:function(h){var c=null,j,g,d=0,e=null,b=null,f=null;if(typeof h==="string"){c=h.split(this.options.termSplit);h=[];for(;d<c.length;d++){b=c[d];f=b.split(this.options.itemSplit);e={};e[this.options.valueField]=f[0];e[this.options.textField]=f[1];h.push(e)}}this.data=h;for(d;d<h.length;d++){j=h[d];if(j.checked){g=j[this.options.valueField]}}if(this.options.value){g=this.options.value}if(!this.isInit){this.isInit=true;this.originalValue=g}this._renderRadioItem();this.setValue(g)},_renderRadioItem:function(){if(this.options.repeatLayout=="table"){if(this.options.column==null){this.options.column=3}this._renderTableItem();this.uiTable.appendTo(this.uiBoxlist)}else{if(this.options.repeatLayout=="flow"){if(this.options.column==null){this.options.column=this.data.length}this._renderFlowItem();this.uiBorder.appendTo(this.uiBoxlist)}}},reset:function(){this.setValue(this.originalValue)},getData:function(){return this.data},_renderFlowItem:function(){var e=this,d=this.options,c=this.options.column,f=this.data;e.uiBorder=a('<span class="coral-radiolist-border"></span>');for(var b in f){if(b>(c-1)&&b%(c)===0){a("<br/>").appendTo(e.uiBorder)}e._renderItem(f[b]).css("width",d.itemWidth).appendTo(e.uiBorder)}},_renderTableItem:function(){this.uiTable=a("<table></table>");var e=0,d=0,h=this.data,c=h.length||0,f=this.options.column,g=0,k=null,b=null;if(!h||h.length<1){return}g=Math.ceil(c/f);for(;e<g;e++){k=a("<tr></tr>");for(d=0;d<f;d++){b=a("<td></td>");if((e*f+d)<c){this._renderItem(h[(e*f+d)]).appendTo(b)}b.appendTo(k)}k.appendTo(this.uiTable)}},_renderItem:function(c){var d=c.hidden===true?"hidden":"";
var f=a("<span class='coral-radio "+d+"'></span>"),e=a("<label class='coral-radio-label'></label>"),b=a("<span class='coral-radio-icon'></span>"),g=c[this.options.valueField],h=c[this.options.textField];f.attr("value",g);e.append(b).append(h);e.appendTo(f);b.addClass("cui-icon-radio-unchecked");return f},_bindEvent:function(){var b=this;if(this.options.disabled){this._setDisabled(this.options.disabled)}this._on({"mouseenter .coral-radio":function(d){if(b.options.readonly){return false}var c=a(d.target).closest(".coral-radio");if(a(c).hasClass("coral-state-disabled")){return}a(c).addClass("coral-radio-hover")},"mouseleave .coral-radio":function(d){if(b.options.readonly){return false}var c=a(d.target).closest(".coral-radio");if(a(c).hasClass("coral-state-disabled")){return}a(c).removeClass("coral-radio-hover")},"keydown .coral-radio":function(c){b._trigger("onKeyDown",c,{})},"click .coral-radio":function(i){var f=a(i.target).closest(".coral-radio");if(b.options.readonly){return false}var g=f,c=g.find(".coral-radio-icon"),h=g.attr("value"),d=b.getValue();if(h==d){if(!this.options.allowCancel){return false}c.removeClass("cui-icon-radio-checked coral-radiolist-item-hightlight").addClass("cui-icon-radio-unchecked");b.uiInput.val("")}else{b.setValue(h);b._trigger("onChange",null,{value:h,checked:c.hasClass("coral-radiolist-item-hightlight")})}i.stopPropagation()}})},_setDisabled:function(b){b=!!b;this.uiBoxlist.find(".coral-radio").each(function(){a(this).toggleClass("coral-state-disabled",b)});this.options.disabled=b},_setReadonly:function(b){b=!!b;this.uiBoxlist.find(".coral-radio").each(function(){a(this).toggleClass("coral-readonly",b)});this.options.readonly=b},_setOption:function(b,c){if(b==="id"||b==="name"){return}if(b==="disabled"){this._setDisabled(c)}if(b==="readonly"){this._setReadonly(c)}this._super(b,c)},_destroy:function(){this.component().remove();if(this.options.name){this.element.removeAttr("orgname").attr("name",this.options.name)}this.element.removeClass("coral-form-element-radiolist");
this.element.removeClass("coral-validation-radiolist");this.element.show()},focus:function(){},component:function(){return this.uiBoxlist},disable:function(){this._setDisabled(true)},readonly:function(){this._setReadonly(true)},enable:function(){this._setDisabled(false)},disableItem:function(b){this.uiBoxlist.find('.coral-radio[value="'+b+'"]').toggleClass("coral-state-disabled",true)},enableItem:function(b){this.options.disabled=false;this.uiBoxlist.find('.coral-radio[value="'+b+'"]').toggleClass("coral-state-disabled",false)},show:function(){this.component().show()},hide:function(){this.component().hide()},getValue:function(){return this.uiInput.val()},setValue:function(c){this.uiBoxlist.find(".coral-radiolist-item-hightlight").each(function(){a(this).removeClass("cui-icon-radio-checked coral-radiolist-item-hightlight").addClass("cui-icon-radio-unchecked")});var b=this.uiBoxlist.find('.coral-radio[value="'+c+'"]').find(".coral-radio-icon").removeClass("cui-icon-radio-unchecked").addClass("cui-icon-radio-checked coral-radiolist-item-hightlight");this.uiBoxlist.find(".coral-radio").removeClass("coral-state-highlight");this.uiBoxlist.find('.coral-radio[value="'+c+'"]').addClass("coral-state-highlight");this.uiInput.val(c)},getText:function(e){var c=0,d=this.data,f=null,b=[];if(!e){e=this.getValue()}for(;c<d.length;c++){f=d[c][this.options.valueField];if(f==e){return(d[c][this.options.textField])}}return""}})})(jQuery);