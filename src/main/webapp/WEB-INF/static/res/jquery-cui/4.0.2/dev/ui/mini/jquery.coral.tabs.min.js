/*!
 * jQuery CORAL Tabs 4.0.1
 *
 *
 * Depends:
 *	jquery.coral.core.js
 *	jquery.coral.component.js
 */
(function(a,b){a.component("coral.tabs",{version:"4.0.1",delay:300,options:{active:0,collapsible:false,event:"click",loadonce:true,destroyAllonActive:false,heightStyle:"content",hide:null,show:null,method:"GET",newbtn:false,name:null,onTabNew:null,onActivate:null,onLoad:null,beforeActivate:null,beforeLoad:null,beforeTabClose:null,onTabClose:null},_create:function(){var d=this,c=this.options;if(c.method!=null&&c.method!=""){c.method=(c.method+"").toUpperCase()}else{c.method="GET"}this.running=false;this.element.addClass("coral-tabs ctrl-init ctrl-init-tabs coral-component coral-component-content coral-corner-all").toggleClass("coral-tabs-collapsible",c.collapsible);this._processTabs();if(typeof c.newbtn=="boolean"&&c.newbtn){this.addnewbtn()}c.active=this._initialActive();if(a.isArray(c.disabled)){c.disabled=a.unique(c.disabled.concat(a.map(this.tabs.filter(".coral-state-disabled"),function(e){return d.tabs.index(e)}))).sort()}if(this.options.active!==false&&this.anchors.length){this.active=this._findActive(c.active)}else{this.active=a()}this._refresh();if(this.active.length){this.load(c.active)}if(this.element.hasClass("coral-tabs-bottom")){a(".coral-tabs-bottom .coral-tabs-nav, .coral-tabs-bottom .coral-tabs-nav > *").removeClass("coral-corner-all coral-corner-top").addClass("coral-corner-bottom")}else{if(this.element.hasClass("coral-tabs-right")){this.element.addClass("coral-tabs-right coral-helper-clearfix").removeClass("coral-corner-top").addClass("coral-corner-left")}else{if(this.element.hasClass("coral-tabs-left")){this.element.removeClass("coral-corner-top").addClass("coral-tabs-left coral-helper-clearfix coral-corner-left")}}}},_isLocal:(function(){var c=/#.*$/;return function(e){var g,f;e=e.cloneNode(false);return e.hash.length>1&&e.href.indexOf("#")!=-1;g=e.href.replace(c,"");f=location.href.replace(c,"");try{g=decodeURIComponent(g)}catch(d){}try{f=decodeURIComponent(f)
}catch(d){}return e.hash.length>1&&g===f}})(),_initialActive:function(){var d=this.options.active,c=this.options.collapsible,e=location.hash.substring(1);if(d===null){if(e){this.tabs.each(function(f,g){if(a(g).attr("aria-controls")===e){d=f;return false}})}if(d===null){d=this.tabs.index(this.tabs.filter(".coral-state-active"))}if(d===null||d===-1){d=this.tabs.length?0:false}}if(d!==false){d=this.tabs.index(this.tabs.eq(d));if(d===-1){d=c?false:0}}if(!c&&d===false&&this.anchors.length){d=0}return d},_getCreateEventData:function(){return{tab:this.active,panel:!this.active.length?a():this._getPanelForTab(this.active)}},_tabKeydown:function(e){var d=a(this.document[0].activeElement).closest("li"),c=this.tabs.index(d),f=true;if(this._handlePageNav(e)){return}switch(e.keyCode){case a.coral.keyCode.RIGHT:case a.coral.keyCode.DOWN:c++;break;case a.coral.keyCode.UP:case a.coral.keyCode.LEFT:f=false;c--;break;case a.coral.keyCode.END:c=this.anchors.length-1;break;case a.coral.keyCode.HOME:c=0;break;case a.coral.keyCode.SPACE:e.preventDefault();clearTimeout(this.activating);this._activate(c);return;case a.coral.keyCode.ENTER:e.preventDefault();clearTimeout(this.activating);this._activate(c===this.options.active?false:c);return;default:return}e.preventDefault();clearTimeout(this.activating);c=this._focusNextTab(c,f);if(!e.ctrlKey){d.attr("aria-selected","false");this.tabs.eq(c).attr("aria-selected","true");this.activating=this._delay(function(){this.option("active",c)},this.delay)}},_panelKeydown:function(c){if(this._handlePageNav(c)){return}if(c.ctrlKey&&c.keyCode===a.coral.keyCode.UP){c.preventDefault();this.active.focus()}},_handlePageNav:function(c){if(c.altKey&&c.keyCode===a.coral.keyCode.PAGE_UP){this._activate(this._focusNextTab(this.options.active-1,false));return true}if(c.altKey&&c.keyCode===a.coral.keyCode.PAGE_DOWN){this._activate(this._focusNextTab(this.options.active+1,true));return true}},_findNextTab:function(d,e){var c=this.tabs.length-1;function f(){if(d>c){d=0
}if(d<0){d=c}return d}while(a.inArray(f(),this.options.disabled)!==-1){d=e?d+1:d-1}return d},_focusNextTab:function(c,d){c=this._findNextTab(c,d);this.tabs.eq(c).focus();return c},_setOption:function(c,d){if(c==="active"){if(typeof d==="string"){this._activate(this._getIndex(d))}else{this._activate(d)}return}if(c==="disabled"){this._setupDisabled(d);return}this._super(c,d);if(c==="collapsible"){this.element.toggleClass("coral-tabs-collapsible",d);if(!d&&this.options.active===false){this._activate(0)}}if(c==="event"){this._setupEvents(d)}if(c==="heightStyle"){this._setupHeightStyle(d)}},_tabId:function(c){return c.attr("aria-controls")||"coral-tabs-"+getNextTabId()},_sanitizeSelector:function(c){return c?c.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var d=this.options,c=this.tablist.children(":has(a[href])");d.disabled=a.map(c.filter(".coral-state-disabled"),function(e){return c.index(e)});this._processTabs();if(d.active===false||!this.anchors.length){d.active=false;this.active=a()}else{if(this.active.length&&!a.contains(this.tablist[0],this.active[0])){if(this.tabs.length===d.disabled.length){d.active=false;this.active=a()}else{this._activate(this._findNextTab(Math.max(0,d.active-1),false))}}else{d.active=this.tabs.index(this.active)}}this._refresh()},_refresh:function(){var c=this;this._setupDisabled(this.options.disabled);this._setupEvents(this.options.event);this._setupHeightStyle(this.options.heightStyle);this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1});this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"});if(!this.active.length){this.tabs.eq(0).attr("tabIndex",0)}else{this.active.addClass("coral-tabs-active coral-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0});this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})}},add:function(i){i=i||{};var h=this.options.disabled,f=null,e=i.tabId,m=null,l=i.label,k=i.ariaControls,o=false,c=i.href,d=i.closeable==b?false:i.closeable,n=d===true?"<span class='coral-closable cui-icon-cross2'></span>":"",j=i.content;
if(h===true){return}if(typeof this.options.newbtn=="boolean"&&this.options.newbtn){this.tablist.find("> li:last").remove()}if(k){f=k}else{if(typeof c==="undefined"){f=a({}).uniqueId()[0].id}else{f=c;if(f.indexOf("#")==0){f=f.substr(1)}else{o=true}}}e=e?"id="+e:"";var g="<li "+e+"><a href='#{href}'>"+l+"</a>{closespan}</li>";g=g.replace(/\{closespan\}/g,n);if(!o){m=a(g.replace(/#\{href\}/g,"#"+f))}else{m=a(g.replace(/#\{href\}/g,f));this.component().find(">.coral-tabs-nav").append(m);this.component().tabs("refresh");return}if(k){m.attr("aria-controls",k)}this.component().find(">.coral-tabs-nav").append(m);if(this.element.hasClass("coral-tabs-bottom")){this.component().find(">.coral-tabs-nav").before("<div id='"+f+"'>"+j+"</div>")}else{this.component().append("<div id='"+f+"'>"+j+"</div>")}this.component().tabs("refresh");if(typeof this.options.newbtn=="boolean"&&this.options.newbtn){this.addnewbtn()}},remove:function(c){if(this.options.disabled){return}if(c instanceof Array){for(var d in c){this._remove(c[d])}this._refresh()}else{this._remove(c)}},_remove:function(d){var e;if(typeof d=="undefined"){e=this.options.active}else{if(typeof d=="string"){e=this.getIndexById(d)}else{e=d}}var c=this._getList().find("> li:has(a[href])").eq(e).attr("aria-controls");this.component().find("li[aria-controls='"+c+"']").remove();this.component().find("div#"+c).remove()},addnewbtn:function(){var d=this;var c=a("<li class='coral-tabs-newbtn coral-corner-top'><a class='coral-tabs-anchor'><span class='cui-icon-plus-circle2'></span></a></li>");c.unbind("click").bind("click",function(e){if(true===d.options.disabled){return}d._trigger("onTabNew",null,[])});this.tablist.append(c);d._hoverable(c)},_processTabs:function(){var c=this;this.tablist=this._getList().addClass("coral-tabs-nav coral-helper-reset coral-helper-clearfix coral-component-header coral-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(d){if(a(this).is(".coral-state-disabled")){d.preventDefault()
}}).delegate(".coral-tabs-anchor","focus"+this.eventNamespace,function(){if(a(this).closest("li").is(".coral-state-disabled")){this.blur()}});this.tabs=this.tablist.find("> li:has(a[href])").addClass("coral-state-default coral-corner-top").attr({role:"tab",tabIndex:-1});this.anchors=this.tabs.map(function(){return a("a",this)[0]}).addClass("coral-tabs-anchor").attr({role:"presentation",tabIndex:-1});this.panels=a();this.anchors.each(function(j,g){var d,e,h,f=a(g).uniqueId().attr("id"),k=a(g).closest("li"),l=k.attr("aria-controls");k.find(".coral-closable").addClass("cui-icon-cross2");if(c._isLocal(g)){d=g.hash;h=d.substring(1);e=c.element.find(c._sanitizeSelector(d))}else{h=k.attr("aria-controls")||a({}).uniqueId()[0].id;d="#"+h;e=c.element.find(d);if(!e.length){e=c._createPanel(h);if(c.element.hasClass("coral-tabs-bottom")){e.insertBefore(c.panels[j-1]||c.tablist)}else{e.insertAfter(c.panels[j-1]||c.tablist)}}e.attr("aria-live","polite")}if(e.length){c.panels=c.panels.add(e)}if(l){k.data("coral-tabs-aria-controls",l)}k.attr({"aria-controls":h,"aria-labelledby":f});e.attr("aria-labelledby",f)});this.panels.addClass("coral-tabs-panel coral-component-content coral-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.tablist||this.element.find(">ol,>ul").eq(0)},_createPanel:function(c){return a("<div>").attr("id",c).addClass("coral-tabs-panel coral-component-content coral-corner-bottom").data("coral-tabs-destroy",true)},_setupDisabled:function(e){if(a.isArray(e)){if(!e.length){e=false}else{if(e.length===this.anchors.length){e=true}}}for(var d=0,c;(c=this.tabs[d]);d++){if(e===true||a.inArray(d,e)!==-1){a(c).addClass("coral-state-disabled").attr("aria-disabled","true")}else{a(c).removeClass("coral-state-disabled").removeAttr("aria-disabled")}}this.options.disabled=e},_setupEvents:function(e){var d=this;var c={};if(e){a.each(e.split(" "),function(g,f){c[f]="_eventHandler"})}this._off(this.anchors.add(this.tabs).add(this.panels).add(this.tabs.children("span.cui-icon-cross2")));
this._on(true,this.anchors,{click:function(f){f.preventDefault()}});this._on(this.anchors,c);this._on(this.tabs.children("span.coral-closable"),{click:"_tabClose"});this._on(this.panels,{keydown:"_panelKeydown"});this._on(this.tabs,{keydown:"_tabKeydown"});this._focusable(this.tabs);this._hoverable(this.tabs)},_tabClose:function(h){var f=this;if(f.options.disabled===true){return}var g=a(h.target),j=g.closest("li"),c=j.attr("aria-controls"),i=f._getPanelForTab(j),d={currentTab:j,currentPanel:i,panelId:c};if(f._trigger("beforeTabClose",h,d)===false){return}j.remove();f.element.find("#"+c).remove();f._trigger("onTabClose",h,d);f.refresh()},_setupHeightStyle:function(c){var f,e,h=false,d=this.element.parent();if(c==="fill"){a.coral.fitParent(this.component(),true);f=d.height();e=d.width();f-=this.element.outerHeight()-this.element.height();this.element.siblings(":visible").not("script").each(function(){var j=a(this),i=j.css("position");if(i==="absolute"||i==="fixed"){return}f-=j.outerHeight()});this.element.children().not(this.panels).each(function(){if(a(this).parent().hasClass("coral-tabs-right")||a(this).parent().hasClass("coral-tabs-left")){var i=a(this).css("position");h=true;if(i==="absolute"||i==="fixed"){return}e-=a(this).outerWidth(true);return}f-=a(this).outerHeight(true)});this.panels.each(function(){var i=a(this).outerHeight()-a(this).innerHeight();a(this).height(Math.max(0,f-i-a(this).innerHeight()+a(this).height()))}).addClass("coral-scroll");if(h){var g=this.element.children("ul");g.height(Math.max(0,f-g.innerHeight()+g.height()))}}else{if(c==="auto"){f=0;this.panels.each(function(){f=Math.max(f,a(this).height("").height());a(this).width("")}).height(f)}}this.panels.each(function(){if(a(this).is(":visible")){a.coral.refreshAllComponent(a(this))}})},_eventHandler:function(c){var l=this.options,g=this.active,h=a(c.currentTarget),f=h.closest("li"),j=f[0]===g[0],d=j&&l.collapsible,e=d?a():this._getPanelForTab(f),i=!g.length?a():this._getPanelForTab(g),k={oldTab:g,oldPanel:i,newTab:d?a():f,newPanel:e};
c.preventDefault();if(f.hasClass("coral-state-disabled")||f.hasClass("coral-tabs-loading")||this.running||(j&&!l.collapsible)||(this._trigger("beforeActivate",c,k)===false)){return}l.active=d?false:this.tabs.index(f);this.active=j?a():f;if(this.xhr){this.xhr.abort()}if(!i.length&&!e.length){a.error("jQuery UI Tabs: Mismatching fragment identifier.")}if(e.length){this.load(this.tabs.index(f),c)}this._toggle(c,k)},_toggle:function(i,h){var g=this,c=h.newPanel,f=h.oldPanel;this.running=true;function e(){g.running=false;g._trigger("onActivate",i,h);a.coral.refreshAllComponent(c)}function d(){h.newTab.closest("li").addClass("coral-tabs-active coral-state-active");if(c.length&&g.options.show){g._show(c,g.options.show,e)}else{c.show();e()}}if(f.length&&this.options.hide){this._hide(f,this.options.hide,function(){h.oldTab.closest("li").removeClass("coral-tabs-active coral-state-active");d()})}else{h.oldTab.closest("li").removeClass("coral-tabs-active coral-state-active");f.hide();d()}f.attr("aria-hidden","true");h.oldTab.attr({"aria-selected":"false","aria-expanded":"false"});if(c.length&&f.length){h.oldTab.attr("tabIndex",-1)}else{if(c.length){this.tabs.filter(function(){return a(this).attr("tabIndex")===0}).attr("tabIndex",-1)}}c.attr("aria-hidden","false");h.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(d){if(d==-1){return}var c,e=this._findActive(d);if(e[0]===this.active[0]){return}if(!e.length){e=this.active}c=e.find(".coral-tabs-anchor")[0];this._eventHandler({target:c,currentTarget:c,preventDefault:a.noop})},_findActive:function(c){return c===false?a():this.tabs.eq(c)},_getIndex:function(c){if(typeof c==="string"){c=this.anchors.index(this.anchors.filter("[href$='"+c+"']"))}return c},getIdByIndex:function(d){var c=this.tablist.children("li").filter(function(){return a(this).hasClass("coral-state-default")});return c.eq(d).attr("aria-controls")},getIndexById:function(d){var c=this.tablist.children("li").filter(function(){return a(this).hasClass("coral-state-default")
});return c.index(c.filter("[aria-controls$='"+d+"']"))},getIndexByTabId:function(d){var c=this.tablist.children("li").filter(function(){return a(this).hasClass("coral-state-default")});return c.index(c.filter("#"+d))},getAllTabId:function(){return this.getPanelIds()},getPanelIds:function(){var c=[];this.tabs.filter("[aria-controls]").each(function(){var d=a(this).attr("aria-controls");if(""!=d){c.push(d)}});return c},getTabIds:function(){var d=[];var c=this.tablist.children("li").each(function(){var e=a(this).attr("id");if(""!=e){d.push(e)}});return d},getTabEl:function(){var c=this.tablist.children("li.coral-state-default");return c},getPanelEl:function(){return{}},getLength:function(){return this.tabs.find("[aria-controls]").length},_destroy:function(){if(this.xhr){this.xhr.abort()}this.element.removeClass("coral-tabs coral-component coral-component-content coral-corner-all coral-tabs-collapsible");this.tablist.removeClass("coral-tabs-nav coral-helper-reset coral-helper-clearfix coral-component-header coral-corner-all").removeAttr("role");this.anchors.removeClass("coral-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId();this.tablist.unbind(this.eventNamespace);this.tabs.add(this.panels).each(function(){if(a.data(this,"coral-tabs-destroy")){a(this).remove()}else{a(this).removeClass("coral-state-default coral-state-active coral-state-disabled coral-corner-top coral-corner-bottom coral-component-content coral-state-active coral-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}});this.tabs.each(function(){var c=a(this),d=c.data("coral-tabs-aria-controls");if(d){c.attr("aria-controls",d).removeData("coral-tabs-aria-controls")}else{c.removeAttr("aria-controls")}});this.panels.show();if(this.options.heightStyle!=="content"){this.panels.css("height","")}},enable:function(c){var d=this.options.disabled;
if(d===false){return}if(c===b){d=false}else{c=this._getIndex(c);if(a.isArray(d)){d=a.map(d,function(e){return e!==c?e:null})}else{d=a.map(this.tabs,function(e,f){return f!==c?f:null})}}this._setupDisabled(d)},disable:function(c){var d=this.options.disabled;if(d===true){return}if(c===b){d=true}else{c=this._getIndex(c);if(a.inArray(c,d)!==-1){return}if(a.isArray(d)){d=a.merge([c],d).sort()}else{d=[c]}}this._setupDisabled(d)},_destroyOtherTabs:function(c){var d=this._getList().find("> li:has(a[href])").eq(c).attr("aria-controls");this.component().children("div:not(#"+d+")").children().remove()},load:function(e,i){e=this._getIndex(e);var h=this,f=this.tabs.eq(e),d=f.find(".coral-tabs-anchor"),c=this._getPanelForTab(f),g={tab:f,panel:c};if(this.options.destroyAllonActive){h._destroyOtherTabs(e)}if(h._isLocal(d[0])||a.data(d[0],"cache")){return}else{if(this.options.loadonce){a.data(d[0],"cache",true)}}this.xhr=a.ajax(this._ajaxSettings(d,i,g));if(this.xhr&&this.xhr.statusText!=="canceled"){f.addClass("coral-tabs-loading");c.attr("aria-busy","true");this.xhr.success(function(j){setTimeout(function(){c.html(j);if(a.coral.openTag===true){a.parser.parse(c)}h._trigger("onLoad",i,g)},1)}).complete(function(k,j){setTimeout(function(){if(j==="abort"){h.panels.stop(false,true)}f.removeClass("coral-tabs-loading");c.removeAttr("aria-busy");if(k===h.xhr){delete h.xhr}},1)})}},_ajaxSettings:function(c,f,e){var d=this;return{url:c.attr("href"),beforeSend:function(h,g){return d._trigger("beforeLoad",f,a.extend({jqXHR:h,ajaxSettings:g},e))},type:d.options.method}},_getPanelForTab:function(c){var d=a(c).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+d))},getPanelForTab:function(c){return this._getPanelForTab(c)}})})(jQuery);