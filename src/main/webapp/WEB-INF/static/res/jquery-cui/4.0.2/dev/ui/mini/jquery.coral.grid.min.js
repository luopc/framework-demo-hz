(function($){$.grid=$.grid||{};$.component("coral.grid",{version:"4.0.1",castProperties:["rowEditButtons","data","initData","rowList","pagerTemplate","celloptions"],options:{},grid:{},diff:2,getScrollBarWidth:function(){var inner=document.createElement("p");inner.style.width="100%";inner.style.height="200px";var outer=document.createElement("div");outer.style.position="absolute";outer.style.top="0px";outer.style.left="0px";outer.style.visibility="hidden";outer.style.width="200px";outer.style.height="150px";outer.style.overflow="hidden";outer.appendChild(inner);document.body.appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow="scroll";var w2=inner.offsetWidth;if(w1==w2){w2=outer.clientWidth}document.body.removeChild(outer);return(w1-w2)+this.diff},_destroy:function(){var destroyPag="",elementId=$(this.element).attr("id");if(this.pagers){destroyPag=$(this.pagers).empty().addClass(elementId)}$(this.element).empty();this.element.removeClass("ctrl-init ctrl-init-grid");this.element.removeClass("coral-grid");this.element.removeClass(this.options.cls);this.component().replaceWith(this.element).append(destroyPag)},_create:function(){var options=this.options,that=this,activeClass="coral-state-active",focusClass="coral-state-focus",id=this.element.uniqueId().attr("id");options.id=id;var p={_index:{},altRows:false,altclass:" coral-priority-secondary ",ajaxGridOptions:{},asyncType:"post",autoSave:false,autoValid:true,autoWidth:true,allowSaveOnError:true,cls:"",caption:"",colModel:[],colNames:[],cellLayout:1,cellEdit:false,cellsubmit:"clientArray",clicksToEdit:2,data:[],datatype:"json",direction:"ltr",deselectAfterSort:true,emptyrecords:"无数据",ExpandColumn:null,height:150,idPrefix:"",initData:false,customPicgrid:$.noop(),gridview:false,grouping:false,groupingView:{groupField:[],groupOrder:[],groupText:[],groupColumnShow:[],groupSummary:[],showSummaryOnHide:false,sortitems:[],sortnames:[],summary:[],summaryval:[],plusicon:"cui-icon-plus3",minusicon:"cui-icon-minus3",displayField:[],groupSummaryPos:[],formatDisplayField:[],_locgr:false},groupHeaders:[],groupHeader:false,fitStyle:"auto",forceFit:false,hoverrows:true,lastsort:0,loadonce:true,loadui:"enable",loadtext:"加载中，请耐心等候 ...",minWidth:false,multiselect:false,multiselectWidth:30,multikey:"",model:"grid",page:1,pager:"",pagerStyle:"flex",pginput:true,records:0,rninput:true,rowEditButtons:[],pgbuttons:true,picTemplate:"picTemplate",postData:{},prmNames:{page:"P_pageNumber",rows:"P_pagesize",sort:"P_orders",order:"sord",search:"_search",nd:"nd",id:"id",oper:"oper",editoper:"edit",addoper:"add",deloper:"del",subgridid:"id",npage:null,totalrows:"totalrows"},rowNum:20,rowNumMax:200,rownumbers:false,rownumWidth:35,rowList:[10,20,30],savedRow:[],scrollOffset:this.getScrollBarWidth(),selarrrow:[],singleselect:false,sortorder:"asc",treeGrid:false,treeGridModel:"adjacency",treeReader:{},treeANode:-1,tree_root_level:0,onSortableColumns:false,sortableColumnsOptions:{},onSortableRows:false,beforeSortableRows:false,afterSortableRows:false,editableRows:false,containSortOrder:false,sortSeparator:" ",shrinkToFit:true,toppager:false,toolbar:[false,""],url:"",useProp:true,viewsortcols:[false,"vertical",true],viewrecords:true,minIndex:null,maxIndex:null,preIndex:null,beforePopulate:null};
options=$.extend(true,{},p,$.grid.defaults,this.options);if(options.model=="pic"){options.model="card"}this.options=options;this.options.isValid=true;options.postData=$.coral.toFunction(options.postData);options.localReader=$.extend(true,{root:"data",page:"pageNumber",total:"totalPages",records:"total",repeatitems:false,cell:"cell",id:"id",userData:"userData",subgrid:{root:"data",repeatitems:true,cell:"cell"}},options.localReader);options.jsonReader=$.extend(true,{root:"data",page:"pageNumber",total:"totalPages",records:"total",repeatitems:false,cell:"cell",id:"id",userData:"userData"},options.jsonReader);if(this.options.data.length){this.normalizeData();this.refreshIndex()}this.id=id;var grid={groupHeader:[],headers:[],cols:[],footers:[],dragStart:function(i,x,y){var grid=this;this.resizing={idx:i,startX:x.clientX,sOL:y[0]};grid.columnsView.style.cursor="col-resize";this.curGbox=$("#rs_m"+$.grid.coralID(that.options.id),"#"+$.grid.coralID(that.options.id));this.curGbox.css({display:"block",left:y[0],top:y[1],height:y[2]});that._trigger("onResizeStart",x,[{index:i}]);document.onselectstart=function(){return false}},dragMove:function(x){if(this.resizing){var diff=x.clientX-this.resizing.startX,h=this.headers[this.resizing.idx],newWidth=that.options.direction==="ltr"?h.width+diff:h.width-diff,hn,nWn;$("#test").html(diff);if(newWidth>33){this.curGbox.css({left:this.resizing.sOL+diff});if(that.options.forceFit===true){hn=this.headers[this.resizing.idx+options.nv];nWn=that.options.direction==="ltr"?hn.width-diff:hn.width+diff;if(nWn>33){h.newWidth=newWidth;hn.newWidth=nWn}}else{this.newWidth=that.options.direction==="ltr"?that.options.tblwidth+diff:that.options.tblwidth-diff;h.newWidth=newWidth}}}},dragEnd:function(){this.columnsView.style.cursor="default";if(this.resizing){var idx=this.resizing.idx,nw=this.headers[idx].newWidth||this.headers[idx].width;nw=parseInt(nw,10);this.resizing=false;$("#rs_m"+$.grid.coralID(that.options.id)).css("display","none");that.options.colModel[idx].width=nw;
this.headers[idx].width=nw;this.headers[idx].el.style.width=nw+"px";this.cols[idx].style.width=nw+"px";if($("table:first",this.rowsView).hasClass("coral-grid-btable-frozen")){$("tr.jqgfirstrow>td:eq("+idx+")",$("table:first",this.rowsView))[0].style.width=nw+"px"}var groupHeader=$("tr.jqg-first-row-header>th:eq("+idx+")",$("table:first",this.columnsView));if(groupHeader.length>0){groupHeader[0].style.width=nw+"px"}if(this.footers.length>0){this.footers[idx].style.width=nw+"px"}if(that.options.forceFit===true){nw=this.headers[idx+options.nv].newWidth||this.headers[idx+options.nv].width;this.headers[idx+options.nv].width=nw;this.headers[idx+options.nv].el.style.width=nw+"px";this.cols[idx+options.nv].style.width=nw+"px";if(this.footers.length>0){this.footers[idx+options.nv].style.width=nw+"px"}that.options.colModel[idx+options.nv].width=nw;groupHeader=$("tr.jqg-first-row-header>th:eq("+(idx+options.nv)+")",$("table:first",this.columnsView));if(groupHeader.length>0){groupHeader[0].style.width=nw+"px"}}else{that.options.tblwidth=this.newWidth||that.options.tblwidth;$("table",this.rowsView).css("width",that.options.tblwidth+"px");$("table:first",this.columnsView).css("width",that.options.tblwidth+"px");this.columnsView.scrollLeft=this.rowsView.scrollLeft;if(that.options.footerrow){$("table:first",this.sDiv).css("width",p.tblwidth+"px");this.sDiv.scrollLeft=this.rowsView.scrollLeft}}that._trigger("onResizeStop",null,[{newWidth:nw,index:idx,headers:this.headers}])}this.curGbox=null;document.onselectstart=function(){return true}},selectionPreserver:function(that){var opts=that.options,sr=opts.selrow,sra=opts.selarrrow?$.makeArray(opts.selarrrow):null,left=that.grid.rowsView.scrollLeft,restoreSelection=function(){var i;opts.selrow=null;opts.selarrrow=[];if(opts.multiselect&&sra&&sra.length>0){for(i=0;i<sra.length;i++){if(sra[i]!=sr){$(that.element).grid("setSelection",sra[i],false,null)}}}if(sr){$(that.element).grid("setSelection",sr,false,null)}that.grid.rowsView.scrollLeft=left;
$(that.element).unbind(".selectionPreserver",restoreSelection)};$(that.element).bind("gridComplete.selectionPreserver",restoreSelection)}};this.grid=grid;var gridColumns=this.element.find(">div").filter(function(){if($(this).hasClass(that.options.id)){return false}return true}),gridRows=$("<div class='coral-grid-rows'></div>");if(gridColumns.length==0){this.element.prepend("<div></div>");gridColumns=this.element.find(">div").filter(function(){if($(this).hasClass(that.id)){return false}return true})}that.gridRows=gridRows;that.gridColumns=gridColumns;that._analyzeColumns(gridColumns);gridColumns.addClass("coral-grid-columns").after(gridRows);grid.rowsView=document.createElement("div");$(grid.rowsView).addClass("coral-grid-rows-view").appendTo(gridRows);$("<span class='coral-grid-noRecordsTips' id='noRecordsTips_"+$.grid.coralID(that.options.id)+"'>"+that.options.emptyrecords+"</span>").appendTo($(grid.rowsView));grid.columnsView=document.createElement("div");$(grid.columnsView).addClass("coral-state-default coral-grid-columns-view").appendTo(gridColumns).append("<div class='coral-grid-topRightCell'></div>");that.pic=$("<ul class='coral-pic'></ul>");gridColumns.addClass("coral-grid-columns").after(that.pic);if(that.options.grouping===true){that.options.scroll=false;that.options.rownumbers=false;that.options.treeGrid=false;that.options.gridview=true}if(this.options.treeGrid===true){try{$(that.element).grid("setTreeGrid")}catch(_){}if(that.options.datatype!="local"){that.options.localReader={id:"_id_"}}}if(this.options.subGrid){try{$(that.element).grid("setSubGrid")}catch(s){}}if(this.options.multiselect){this.options.singleselect=false}this.options.keyName=false;for(var i=0;i<this.options.colModel.length;i++){this.options.colModel[i]=$.extend(true,{},this.options.cmTemplate,this.options.colModel[i].template||{},this.options.colModel[i]);if(this.options.keyName===false&&this.options.colModel[i].key===true){this.options.keyName=this.options.colModel[i].name}}if(this.options.multiselect){this.options.colNames.unshift("<input role='checkbox' id='cb_"+this.options.id+"' class='cbox' type='checkbox'/>");
this.options.colModel.unshift({name:"cb",width:that.options.multiselectWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:"center",fixed:true})}else{if(this.options.singleselect){this.options.colNames.unshift("");this.options.colModel.unshift({name:"cb",width:that.options.multiselectWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:"center",fixed:true})}}if(this.options.rownumbers){this.options.colNames.unshift("");this.options.colModel.unshift({name:"rn",width:that.options.rownumWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:"center",fixed:true})}that._transToGrid();that._transToPicgrid();that._transPagers();that._cvH=$(grid.columnsView).height();if("fill"!==options.fitStyle){}that._setGridHeight(that.options.height);if(options.model=="grid"){that.pic.hide()}else{if(options.model=="card"){that.gridRows.hide();that.gridColumns.hide()}}that.setFrozenColumns();this.component().addClass(options.componentCls);this._populate();that._setUpEvent();$(window).unload(function(){that=null});this._on(this.document,{mousedown:function(event){if(this.options.autoSave&&this._closeOnDocumentClick(event)){this.restoreAll(event)}}})},_closeOnDocumentClick:function(event){return !$(event.target).closest(".coral-grid").length},_transPagers:function(){var that=this;this.pagers=$("."+this.id);this.pagers.each(function(ind){$(this).addClass("coral-grid-pager").removeClass(that.id).attr("id","pager_"+ind+++"_"+that.id)});if(this.pagers){this.pagers.each(function(i){that._setPager(that.pagers[i].id,"")});that.options.pager="."+that.id}},toolbar:function(){return $(".pager-toolbar",this.element)},_transToPicgrid:function(){var that=this;that.pic.css({height:230,overflow:"auto"})},_transToGrid:function(){var that=this,options=this.options;if($.inArray(that.options.multikey,that._sortkeys)==-1){that.options.multikey=false}that.options.sortorder=that.options.sortorder.toLowerCase();this.element.addClass("coral-grid");this.element.addClass(that.options.cls);
that._transGridView()},_transGridView:function(){var that=this,options=this.options,grid=this.grid,ni=options.rownumbers===true?1:0,gi=options.multiselect===true?1:(options.singleselect===true?1:0),si=options.subGrid===true?1:0;var dir=options.direction,i;var thead="<thead><tr class='coral-grid-labels' role='rowheader'>",tdc,idn,w,res,sort,td,ptr,tbody,imgs,iac="",idc="";if(options.shrinkToFit===true&&options.forceFit===true){for(i=options.colModel.length-1;i>=0;i--){if(!options.colModel[i].hidden){options.colModel[i].resizable=false;break}}}$.each(this.options.colModel,function(){if(typeof this.hidden==="undefined"){this.hidden=false}});imgs="<span class='s-ico' style='display:none'><span sort='asc' class='coral-grid-ico-sort coral-icon-asc"+iac+" coral-state-disabled cui-icon-arrow-up5 coral-sort-"+dir+"'></span>";imgs+="<span sort='desc' class='coral-grid-ico-sort coral-icon-desc"+idc+" coral-state-disabled cui-icon-arrow-down5 coral-sort-"+dir+"'></span></span>";for(i=0;i<options.colNames.length;i++){var tooltip=that.options.headertitles?(' title="'+$.grid.stripHtml(that.options.colNames[i])+'"'):"";var coralColumnSortableDisabledClass=options.colModel[i].columnSortable?"coral-columnSortable-disabled":"";thead+="<th id='"+options.id+"_"+options.colModel[i].name+"' role='columnheader' class='coral-state-default "+coralColumnSortableDisabledClass+" coral-th-column coral-th-"+dir+"'"+tooltip+">";idn=options.colModel[i].index||options.colModel[i].name;if(i<ni+si+gi){thead+="<div id='jqgh_"+options.id+"_"+options.colModel[i].name+"' "+tdc+">"+options.colNames[i]}else{thead+="<div id='jqgh_"+options.id+"_"+options.colModel[i].name+"'  title='"+options.colNames[i]+"'"+tdc+">"+options.colNames[i]}if(!options.colModel[i].width){options.colModel[i].width=150}else{options.colModel[i].width=parseInt(options.colModel[i].width,10)}if(typeof(options.colModel[i].title)!=="boolean"){options.colModel[i].title=true}if(idn==options.sortname){options.lastsort=i}thead+=imgs+"</div></th>"
}thead+="</tr></thead>";imgs=null;var hTable=$("<table class='coral-grid-htable' role='grid' aria-labelledby='gbox_"+this.id+"' cellspacing='0' cellpadding='0' border='0'></table>").append(thead);that.gridColumns.find(".coral-grid-columns-view").append(hTable);$("thead tr:first th",grid.columnsView).hover(function(){$(this).addClass("coral-state-hover")},function(){$(this).removeClass("coral-state-hover")});that._setMultiselect();var ww;if(typeof(options.width)!=="undefined"){if(typeof(options.width)=="string"&&options.width=="auto"){var pw=$(that.element).innerWidth();that.options.width=pw>0?pw:"nw";ww=pw}else{ww=options.width}}that._trigger("beforePopulate",null,[]);this._setColWidth();$(that.element).append("<div class='coral-grid-resize-mark' id='rs_m"+that.options.id+"'>&#160;</div>");thead=$("thead:first",that.element).get(0);var thr=$("tr:first",thead),firstr="<tr class='jqgfirstrow' role='row' style='height:auto'>";$("th",thr).each(function(j){w=options.colModel[j].width;if(typeof options.colModel[j].resizable==="undefined"){options.colModel[j].resizable=true}if(options.colModel[j].resizable){res=document.createElement("span");$(res).html("&#160;").addClass("coral-grid-resize coral-grid-resize-"+dir);$(res).css("cursor","col-resize");$(this).addClass(options.resizeclass)}else{res=""}$(this).css("width",w+"px").prepend(res);var hdcol="";if(options.colModel[j].hidden){$(this).css("display","none");hdcol="display:none;"}firstr+="<td role='gridcell' style='height:0px;width:"+w+"px;"+hdcol+"'></td>";grid.headers.push({width:w,el:this});sort=options.colModel[j].sortable;if(typeof sort!=="boolean"){options.colModel[j].sortable=true;sort=true}var nm=options.colModel[j].name;if(!(nm=="cb"||nm=="subgrid"||nm=="rn")){if(options.viewsortcols[2]){$(">div",this).addClass("coral-grid-sortable")}}if(sort){if(options.viewsortcols[0]){$("div span.s-ico",this).show();if(j==options.lastsort){$("div span.coral-icon-"+options.sortorder,this).removeClass("coral-state-disabled")}}else{if(j==options.lastsort){$("div span.s-ico",this).show();
$("div span.coral-icon-"+options.sortorder,this).removeClass("coral-state-disabled")}}}}).mousedown(function(e){if($(e.target).closest("th>span.coral-grid-resize").length!=1){return}var ci=that._getColumnHeaderIndex(this);if(options.forceFit===true){options.nv=that._nextVisible(ci)}grid.dragStart(ci,e,that._getOffset(ci));return false}).click(function(e){if(options.disableClick){options.disableClick=false;return false}var s="th>div.coral-grid-sortable",r,d;if(!options.viewsortcols[2]){s="th>div>span>span.coral-grid-ico-sort"}var t=$(e.target).closest(s);if(t.length!=1){return}var ci=that._getColumnHeaderIndex(this);if(!options.viewsortcols[2]){r=true;d=t.attr("sort")}that._sortData($("div",this)[0].id,ci,r,d,this);return false});if(that.options.onSortableColumns&&$.fn.sortable){try{$(that.element).grid("sortableColumns",thr)}catch(e){}}firstr+="</tr>";var bTable=$("<table id='"+that.options.id+"_table' class='coral-grid-btable' role='grid' cellspacing='0' cellpadding='0' border='0'></table>").append(firstr);that.gridRows.find(".coral-grid-rows-view").append(bTable);this.rows=that.gridRows.find(".coral-grid-btable")[0].rows;this.element.prepend("<div class='coral-grid-view'></div>");if(that.options.caption.length>0){grid.caption=document.createElement("div");grid.caption.className="coral-grid-caption";$(grid.caption).html(that.options.caption);this.element.prepend(grid.caption)}$(grid.columnsView).add(grid.rowsView).parent().appendTo(this.element.find(".coral-grid-view"));if(options.shrinkToFit===true&&options.forceFit===true){$("table:first",grid.rowsView).css("width",that.grid.width+"px");$("table:first",grid.columnsView).css("width",that.grid.width+"px")}else{if(options.shrinkToFit===false){$("table:first",grid.rowsView).css("width",that.options.tblwidth+"px");$("table:first",grid.columnsView).css("width",that.options.tblwidth+"px")}}that._setOption("width",ww);this.grid.cols=this.rows[0].cells;if(options.groupHeader){this.setGroupHeaders({useColSpanStyle:true,groupHeaders:options.groupHeaders})
}thead=null;hTable=null;bTable=null},_sortkeys:["shiftKey","altKey","ctrlKey"],_getColumnHeaderIndex:function(th){var that=this;var i,headers=that.grid.headers,ci=$.grid.getCellIndex(th);if(this.grid.rightfhDiv){ci=headers.length-ci-1}for(i=0;i<headers.length;i++){if(th===headers[i].el){ci=i;break}}return ci},_analyzeColumns:function(columns){var that=this,i=0,options=this.options;columns.children().each(function(i){var opts=$.parser.parseOptions(this,null,["data"]);if(typeof(opts.name)!="undefined"){options.colModel.push(opts);options.colNames.push(opts.label||$(this).html())}else{if(typeof(opts.header)!="undefined"){var len=0;var inOption;$(this).children().each(function(i){var opts=$.parser.parseOptions(this,null,["data"]);options.colModel.push(opts);options.colNames.push(opts.label||$(this).html());len++;i==0&&(inOption=opts)});options.groupHeaders.push({startColumnName:inOption.name,numberOfColumns:len,titleText:opts.header})}}});for(i=0;i<this.options.colModel.length;i++){var model=this.options.colModel[i];if(model.formatter=="combobox"||model.formatter=="combotree"||model.formatter=="combogrid"){if(model.revertCode!=false){model.revertCode=true}}model.postMode=model.postMode||"value";if(model.edittype=="combobox"||model.edittype=="combotree"||model.edittype=="autocomplete"||model.edittype=="combogrid"){(model.edittype=="combotree")&&(model.dataStructure="tree");model.formatter=model.formatter||"convertCode"}}if(this.options.colNames.length===0){for(i=0;i<this.options.colModel.length;i++){this.options.colNames[i]=this.options.colModel[i].label||this.options.colModel[i].name}}if(this.options.colNames.length!==this.options.colModel.length){alert("errors! colNames not equals to colModel!");return}columns.children().not(".coral-grid-columns-view").remove()},_updateMultiSelectIndexsOption:function(options){var min_index=options.minIndex,max_index=options.maxIndex,pre_index=options.preIndex,cur_index=options.curIndex;if(null==min_index){min_index=max_index=pre_index=(null==pre_index?cur_index:pre_index)
}if(cur_index<=min_index){min_index=cur_index}else{if(cur_index>min_index&&cur_index<max_index){if(pre_index==max_index&&pre_index!=min_index){max_index=cur_index}else{if(pre_index==min_index&&pre_index!=max_index){min_index=cur_index}else{min_index=Math.min(cur_index,pre_index);max_index=Math.max(cur_index,pre_index)}}}else{if(cur_index>max_index){max_index=cur_index}}}return{minIndex:min_index,maxIndex:max_index,preIndex:pre_index}},_addShiftKeySelect:function(e,ui){var that=this,opts=that.options;if(!ui.rowId){return}var $this=$(that.element),rows=$this.find(".coral-grid-btable")[0].rows,curIndex=rows.namedItem(ui.rowId).rowIndex;if(e.shiftKey){var indexsOption=that._updateMultiSelectIndexsOption({maxIndex:opts.maxIndex,minIndex:opts.minIndex,preIndex:opts.preIndex,curIndex:curIndex});opts.minIndex=indexsOption.minIndex;opts.maxIndex=indexsOption.maxIndex;opts.preIndex=indexsOption.preIndex;$this.grid("resetSelection");for(var i=opts.minIndex;i<=opts.maxIndex;i++){if(i!=curIndex||opts.multikey){$this.grid("setSelection",rows[i].id,false)}}if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){window.getSelection().removeAllRanges()}}}else{opts.minIndex=opts.maxIndex=null}opts.preIndex=curIndex},_setUpEvent:function(){var that=this,grid=this.grid,options=this.options;var ri,ci,tdHtml,td,ptr;if(that.options.cellEdit===false&&that.options.hoverrows===true){$(that.element).bind("mouseover",function(e){var isPicgrid=!!(that.options.model=="card");if(isPicgrid){ptr=$(e.target,that.pic).closest("li.gridPanel").find(".rowgrid");if($(ptr).attr("class")!=="coral-subgrid"){$(ptr).addClass("coral-state-hover")}}else{ptr=$(e.target,that.rows).closest("tr.jqgrow");if($(ptr).attr("class")!=="coral-subgrid"){$(ptr).addClass("coral-state-hover")}}}).bind("mouseout",function(e){var isPicgrid=!!(that.options.model=="card");if(isPicgrid){ptr=$(e.target,that.pic).closest("li.gridPanel ").find(".rowgrid")}else{ptr=$(e.target,that.rows).closest("tr.jqgrow")
}$(ptr).removeClass("coral-state-hover")})}$(grid.rowsView).scroll(function(e){if(options.scroll){var scrollTop=$(grid.rowsView)[0].scrollTop;if(grid.scrollTop===undefined){grid.scrollTop=0}if(scrollTop!=grid.scrollTop){grid.scrollTop=scrollTop;if(grid.timer){clearTimeout(grid.timer)}grid.timer=setTimeout(grid.populateVisible,options.scrollTimeout)}}$(grid.columnsView)[0].scrollLeft=$(grid.rowsView)[0].scrollLeft;$(".coral-grid-btable-frozen").css("left",-$(grid.rowsView)[0].scrollLeft+"px");var b=$(".row-editable",that.element),editRow=$(that.element).grid("getInd",that.editRowIndex,true);if(b.length>0){that.editButtonsPos(that.editRowIndex,b)}if(options.footerrow){grid.sDiv.scrollLeft=$(grid.rowsView)[0].scrollLeft}if(e){e.stopPropagation()}});$(".coral-grid-btable",that.element).add(that.pic).click(function(e){var isPicgrid=!!(that.options.model=="card");var rowId;td=e.target;if(isPicgrid){ptr=$(td,that.pic).closest("li.gridPanel")}else{ptr=$(td,that.rows).closest("tr.jqgrow")}if($(ptr).length===0||ptr[0].className.indexOf("coral-state-disabled")>-1||$(td,that.element).closest("table.coral-grid-btable").length<0){return this}var scb=$(td).hasClass("cbox"),cSel=that._trigger("beforeSelectRow",e,[{rowId:ptr[0].id}]);cSel=(cSel===false||cSel==="stop")?false:true;if(td.tagName=="A"||((td.tagName=="INPUT"||td.tagName=="TEXTAREA"||td.tagName=="OPTION"||td.tagName=="SELECT")&&!scb)){return}if(cSel===true){rowId=ptr[0].id;tdHtml=$(td).closest("td,th").html();if(!isPicgrid){ci=$.grid.getCellIndex(td);that._addShiftKeySelect(e,{rowId:ptr[0].id});that._trigger("onSelectCell",e,[{rowId:rowId,rowIndex:ptr[0].rowIndex,cellIndex:ci,cellHtml:tdHtml}])}if(that.options.editableRows&&that.options.clicksToEdit==1&&options.editrow!=rowId){that.restoreRow(options.editrow);if(that.rowEditButtons){that.rowEditButtons.remove()}}if(that.options.editableRows&&that.options.clicksToEdit==1&&!scb){options.editrow=ptr[0].id;that.editRow(ptr[0].id,true)}if(that.options.cellEdit===true&&that.options.clicksToEdit==1){var editable=that.options.colModel[ci].editable;
var mul=that.options.multiselect||that.options.singleselect;if((mul&&scb)||(mul&&!editable&&!that.options.multikey)){$(that.element).grid("setSelection",rowId,true,e)}else{if(!isPicgrid){try{$(that.element).grid("editCell",ptr[0].rowIndex,ci,true)}catch(_){}}}}else{if(!that.options.multikey){if(that.options.multiselect&&that.options.multiboxonly){if(scb){$(that.element).grid("setSelection",rowId,true,e)}else{var frz=that.options.frozenColumns?that.options.id+"_frozen":"";$(that.options.selarrrow).each(function(i,n){var ind=that.rows.namedItem(n);$(ind).removeClass("coral-state-highlight");$("#jqg_"+$.grid.coralID(that.options.id)+"_"+$.grid.coralID(n))[that.options.useProp?"prop":"attr"]("checked",false);if(frz){$("#"+$.grid.coralID(n),"#"+$.grid.coralID(frz)).removeClass("coral-state-highlight");$("#jqg_"+$.grid.coralID(that.options.id)+"_"+$.grid.coralID(n),"#"+$.grid.coralID(frz))[that.options.useProp?"prop":"attr"]("checked",false)}});that.options.selarrrow=[];$(that.element).grid("setSelection",rowId,true,e)}}else{if(scb||typeof(that.editRowIndex)!="undefiend"&&that.editRowIndex!=rowId){$(that.element).grid("setSelection",rowId,true,e)}}}else{if(e[that.options.multikey]){$(that.element).grid("setSelection",rowId,true,e)}else{if((that.options.multiselect||that.options.singleselect)&&scb){$(that.element).grid("setSelection",rowId,true,e);if(!scb){that._cancelCheckAll()}}}}}}});$(that.element).dblclick(function(e){td=e.target;ptr=$(td,that.rows).closest("tr.jqgrow");if($(ptr).length===0){return}if(that.options.editableRows&&options.editrow!=ptr[0].id){that.restoreRow(options.editrow);if(that.rowEditButtons){that.rowEditButtons.remove()}}var ri=ptr[0].rowIndex;var ci=$.grid.getCellIndex(td);if(that.options.editableRows&&that.options.clicksToEdit==2){options.editrow=ptr[0].id;that.editRow(ptr[0].id,true)}if(that.options.cellEdit===true&&that.options.clicksToEdit==2){ri=ptr[0].rowIndex;try{$(that.element).grid("editCell",ri,ci,true)}catch(_){}}that._trigger("onDblClickRow",null,[{rowId:ptr[0].id,rowIndex:ri,cellIndex:ci}])
}).bind("contextmenu",function(e){td=e.target;ptr=$(td,that.rows).closest("tr.jqgrow");if($(ptr).length===0){return}if(!that.options.multiselect){$(that.element).grid("setSelection",ptr[0].id,true,e)}ri=ptr[0].rowIndex;ci=$.grid.getCellIndex(td);that._trigger("onRightClickRow",null,[{rowId:ptr[0].id,rowIndex:ri,cellIndex:ci}])});$(grid.columnsView).mousemove(function(e){if(grid.resizing){grid.dragMove(e);return false}});$(".coral-grid-labels",grid.columnsView).bind("selectstart",function(){return false});$(document).mouseup(function(){if(grid.resizing){grid.dragEnd();return false}return true});this._off($(".coral-paginator-page"));this._on({"click.coral-paginator-page":function(e){var cp=that._intNum($(e.target).html(),1);that.options.page=cp;if(!that._clearVals(this.id)){return false}that._populate();return false}})},restoreAll:function(){if(this.options.editableRows){this.restoreRow(this.options.editrow);if(this.rowEditButtons){this.rowEditButtons.remove()}}if(this.options.savedRow.length>0){if(!$(this.element).grid("saveCell",this.options.savedRow[0].id,this.options.savedRow[0].ic)){return}}},_setMultiselect:function(){var that=this;if(this.options.multiselect){var emp=[],chk;$("#cb_"+$.grid.coralID(that.options.id),this.grid.columnsView).bind("click",function(e){that.options.selarrrow=[];var froz=that.options.frozenColumns===true?that.options.id+"_frozen":"";if(this.checked){$(that.rows).each(function(i){if(i>0){if(!$(this).hasClass("coral-subgrid")&&!$(this).hasClass("jqgroup")&&!$(this).hasClass("coral-state-disabled")){$("#jqg_"+$.grid.coralID(that.options.id)+"_"+$.grid.coralID(this.id))[that.options.useProp?"prop":"attr"]("checked",true);$(this).addClass("coral-state-highlight").attr("aria-selected","true");that.options.selarrrow.push(this.id);that.options.selrow=this.id;if(froz){$("#jqg_"+$.grid.coralID(that.options.id)+"_"+$.grid.coralID(that.rows[i].id),that.grid.fbDiv)[that.options.useProp?"prop":"attr"]("checked",true);$("#"+$.grid.coralID(that.rows[i].id),that.grid.fbDiv).addClass("coral-state-highlight");
if(that.grid.fhDiv){$("#jqg_"+$.grid.coralID(that.options.id)+"_"+$.grid.coralID(that.rows[i].id),that.grid.fbDiv)[that.options.useProp?"prop":"attr"]("checked",true);$("#"+$.grid.coralID(that.rows[i].id),that.grid.fbDiv).addClass("coral-state-highlight")}else{if(that.grid.rightfhDiv){$("#jqg_"+$.grid.coralID(that.options.id)+"_"+$.grid.coralID(that.rows[i].id),that.grid.rightfbDiv)[that.options.useProp?"prop":"attr"]("checked",true);$("#"+$.grid.coralID(that.rows[i].id),that.grid.rightfbDiv).addClass("coral-state-highlight")}}}}}});chk=true;emp=[]}else{$(that.rows).each(function(i){if(i>0){if(!$(this).hasClass("coral-subgrid")&&!$(this).hasClass("coral-state-disabled")){$("#jqg_"+$.grid.coralID(that.options.id)+"_"+$.grid.coralID(this.id))[that.options.useProp?"prop":"attr"]("checked",false);$(this).removeClass("coral-state-highlight").attr("aria-selected","false");emp.push(this.id);if(froz){if(that.grid.fhDiv){$("#jqg_"+$.grid.coralID(that.options.id)+"_"+$.grid.coralID(that.rows[i].id),that.grid.fbDiv)[that.options.useProp?"prop":"attr"]("checked",false);$("#"+$.grid.coralID(that.rows[i].id),that.grid.fbDiv).removeClass("coral-state-highlight")}else{if(that.grid.rightfhDiv){$("#jqg_"+$.grid.coralID(that.options.id)+"_"+$.grid.coralID(that.rows[i].id),that.grid.rightfbDiv)[that.options.useProp?"prop":"attr"]("checked",false);$("#"+$.grid.coralID(that.rows[i].id),that.grid.rightfbDiv).removeClass("coral-state-highlight")}}}}}});that.options.selrow=null;chk=false}that._trigger("onSelectAll",null,[{aRowIds:chk?that.options.selarrrow:emp,status:chk}])})}},_refresh:function(key,value){},reload:function(opts){var that=this,grid=this.grid;if(that.options.treeGrid===true){that.options.datatype=that.options.treedatatype}if(opts&&opts.current){that.grid.selectionPreserver(that)}if(that.options.datatype=="local"){$(that.element).grid("resetSelection");if(that.options.data.length){that.normalizeData();that.refreshIndex()}}else{if(!that.options.treeGrid){that.options.selrow=null;
if(that.options.multiselect){that.options.selarrrow=[];that._setHeadCheckBox(false)}that.options.savedRow=[]}}if(that.options.scroll){emptyRows(that.grid.rowsView,true,false)}if(opts&&opts.page){var page=opts.page;if(page>that.options.lastpage){page=that.options.lastpage}if(page<1){page=1}that.options.page=page;if(that.grid.prevRowHeight){that.grid.rowsView.scrollTop=(page-1)*that.grid.prevRowHeight*that.options.rowNum}else{that.grid.rowsView.scrollTop=0}}if(that.grid.prevRowHeight&&that.options.scroll){delete that.options.lastpage;that._populateVisible()}else{if(that.options.localonce==true){that.options.search=true}else{that.options.search=false}that._populate();that.options.localonce=false}return false},resetFrozen:function(){if(!this._hasHorizontalScrollBar()){$(this.grid.rightfbDiv).hide();$(this.grid.rightfhDiv).hide()}else{$(this.grid.rightfbDiv).show();$(this.grid.rightfhDiv).show()}},refresh:function(opts){var maxHeight,that=this,options=this.options,fitStyle=options.fitStyle,parent=this.element.parent();maxHeight=parent.height();that.resetFrozen();this.element.siblings(":visible").each(function(){var elem=$(this),position=elem.css("position");if(position==="absolute"||position==="fixed"){return}maxHeight-=elem.outerHeight(true)});if(!$("#"+that.element[0].id).length){return}if(fitStyle==="fill"){$.coral.fitParent(this.component(),true);$(that.element).grid("option","height",maxHeight);$(that.element).grid("option","width",that.element.innerWidth()>0?that.element.innerWidth():0)}else{if(fitStyle==="width"){$(that.element).grid("option","width",that.element.innerWidth()>0?that.element.innerWidth():0);$(that.element).grid("option","height",that.options.height)}else{if(fitStyle==="height"){$.coral.fitParent(this.component(),true);$(that.element).grid("option","height",maxHeight)}else{if(fitStyle==="auto"){$(that.element).grid("option","height",that.options.height)}}}}that.refreshPager();that._noRecordsTipsPositon();if(that.options.frozenColumns===true){that.resizeFrozen()
}if(this.element.find(".loading-overlay").length){switch(this.options.loadui){case"disable":break;case"enable":case"block":$(this.element).loading("refresh");break}}$.coral.refreshAllComponent(this.element)},refreshPager:function(){var that=this;if(this.pagers){this.pagers.each(function(i){var pagerleftwidth=$(".paginator-left",that.element).outerWidth()+5;var pagerwidth=$("#"+that.pagers[i].id).width();$(".toolbarpanel",that.element).css({left:pagerleftwidth+"px",position:"absolute",top:0,width:(pagerwidth-pagerleftwidth)+"px"})});that.options.pager="."+that.id;if($(".ctrl-init-toolbar",that.element).length){$(".ctrl-init-toolbar",that.element).toolbar("refresh")}}},setSelectionAll:function(){if(!$("#cb_"+this.options.id).prop("checked")){$("#cb_"+this.options.id).trigger("click")}},setSelection:function(selection,onsr,e){var that=this,stat,isPicgrid=(this.options.model==="card"),pt,ner,ia,tpsr,fid;if(selection===undefined){return}onsr=onsr===false?false:true;if(isPicgrid){pt=this.element.find(".coral-pic #"+selection)[0]}else{pt=this.rows.namedItem(selection+"")}if(!pt||!pt.className||pt.className.indexOf("coral-state-disabled")>-1){return}function scrGrid(iR){var ch=$(that.grid.rowsView)[0].clientHeight,st=$(that.grid.rowsView)[0].scrollTop,rpos=that.rows[iR].offsetTop,rh=that.rows[iR].clientHeight;if(rpos+rh>=ch+st){$(that.grid.rowsView)[0].scrollTop=rpos-(ch+st)+rh+st}else{if(rpos<ch+st){if(rpos<st){$(that.grid.rowsView)[0].scrollTop=rpos}}}}if(this.options.scrollrows===true){ner=this.rows.namedItem(selection).rowIndex;if(ner>=0){scrGrid(ner)}}if(this.options.frozenColumns===true){fid=this.options.id+"_frozen"}if(!this.options.multiselect){if(pt.className!=="coral-subgrid"){if(this.options.selrow!=pt.id){if(isPicgrid){this.element.find("#"+this.options.selrow+">ul").removeClass("coral-state-highlight").attr({"aria-selected":"false",tabindex:"-1"});$(pt).find(".rowgrid").addClass("coral-state-highlight").attr({"aria-selected":"true",tabindex:"0"});if(fid){$("#"+$.grid.coralID(this.options.selrow),"#"+$.grid.coralID(fid)).find(".rowgrid").removeClass("coral-state-highlight");
$("#"+$.grid.coralID(selection),"#"+$.grid.coralID(fid)).find(".rowgrid").addClass("coral-state-highlight")}}else{$(this.rows.namedItem(this.options.selrow)).removeClass("coral-state-highlight").attr({"aria-selected":"false",tabindex:"-1"});$(pt).addClass("coral-state-highlight").attr({"aria-selected":"true",tabindex:"0"});if(fid){$("#"+$.grid.coralID(this.options.selrow),"#"+$.grid.coralID(fid)).removeClass("coral-state-highlight");$("#"+$.grid.coralID(selection),"#"+$.grid.coralID(fid)).addClass("coral-state-highlight")}}stat=true;$("#jqg_"+$.grid.coralID(this.options.id)+"_"+$.grid.coralID(pt.id),$(pt))[this.options.useProp?"prop":"attr"]("checked",stat);if(fid){$("#jqg_"+$.grid.coralID(this.options.id)+"_"+$.grid.coralID(selection),"#"+$.grid.coralID(fid))[this.options.useProp?"prop":"attr"]("checked",stat)}}else{stat=false}this.options.selrow=pt.id;if(onsr){this._trigger("onSelectRow",e,[{rowId:pt.id,status:stat}])}}}else{this._setHeadCheckBox(false);this.options.selrow=pt.id;ia=$.inArray(this.options.selrow,this.options.selarrrow);if(ia===-1){if(isPicgrid){if(pt.className!=="coral-subgrid"){$(pt).find(".rowgrid").addClass("coral-state-highlight").attr("aria-selected","true")}}else{if(pt.className!=="coral-subgrid"){$(pt).addClass("coral-state-highlight").attr("aria-selected","true")}}stat=true;this.options.selarrrow.push(this.options.selrow)}else{if(isPicgrid){if(pt.className!=="coral-subgrid"){$(pt).find(".rowgrid").removeClass("coral-state-highlight").attr("aria-selected","false")}}else{if(pt.className!=="coral-subgrid"){$(pt).removeClass("coral-state-highlight").attr("aria-selected","false")}}stat=false;this.options.selarrrow.splice(ia,1);tpsr=this.options.selarrrow[0];this.options.selrow=(tpsr===undefined)?null:tpsr}if(this.rows.length-1===this.options.selarrrow.length){this._setHeadCheckBox(true)}$("#jqg_"+$.grid.coralID(this.options.id)+"_"+$.grid.coralID(pt.id),$(pt))[this.options.useProp?"prop":"attr"]("checked",stat);if(fid){if(isPicgrid){if(ia===-1){$("#"+$.grid.coralID(selection),"#"+$.grid.coralID(fid)).find(".rowgrid").addClass("coral-state-highlight")
}else{$("#"+$.grid.coralID(selection),"#"+$.grid.coralID(fid)).find(".rowgrid").removeClass("coral-state-highlight")}}else{if(ia===-1){$("#"+$.grid.coralID(selection),"#"+$.grid.coralID(fid)).addClass("coral-state-highlight")}else{$("#"+$.grid.coralID(selection),"#"+$.grid.coralID(fid)).removeClass("coral-state-highlight")}}$("#jqg_"+$.grid.coralID(this.options.id)+"_"+$.grid.coralID(selection),"#"+$.grid.coralID(fid))[this.options.useProp?"prop":"attr"]("checked",stat)}if(onsr){this._trigger("onSelectRow",e,[{rowId:pt.id,status:stat}])}}},_setHeadCheckBox:function(checked){var that=this;$("#cb_"+$.grid.coralID(that.options.id),that.grid.columnsView)[that.options.useProp?"prop":"attr"]("checked",checked);var fid=that.options.frozenColumns?that.options.id+"_frozen":"";if(fid){$("#cb_"+$.grid.coralID(that.options.id),that.grid.fcolumnsView)[that.options.useProp?"prop":"attr"]("checked",checked)}},setFrozenRows:function(rowNum){var that=this,grid=that.grid;that.destroyFrozenRows();that.rowsView2=$(grid.rowsView);if(!that.rowsView2.children("table.coral-grid-btable-frozen").length){$(that.rowsView2).prepend('<table class="coral-grid-btable-frozen" cellspacing="0" cellpadding="0"></table>');that.rowsView2.children("table.coral-grid-btable-frozen").css({position:"absolute",left:0,top:$(grid.columnsView).height()+"px"})}var vh=that.element.find(".coral-grid-rows-view").height();doWithFirstRow(false);doWithFrozen(false);var fh=that.rowsView2.find("table.coral-grid-btable-frozen").outerHeight();that.rowsView2.css({"margin-top":fh+"px",height:(vh-fh)+"px"});that.rowsView2.find(".coral-grid-btable-frozen").css({left:-$(grid.rowsView)[0].scrollLeft+"px",width:that.rowsView2.find(".coral-grid-btable").width()+"px","table-layout":"fixed"});function doWithFirstRow(isFirst){var tr=that.rowsView2.find(".coral-grid-btable")[0].rows[0];(isFirst?that.rowsView1:that.rowsView2).children("table.coral-grid-btable-frozen").append($(tr).clone())}function doWithFrozen(isFirst){var trs=that.rowsView2.find(".coral-grid-btable tr").filter(function(i){if(i==0){return false
}if(i<=rowNum){return true}});var tr=that.rowsView2.find(".coral-grid-btable")[0].rows[1];(isFirst?that.rowsView1:that.rowsView2).children("table.coral-grid-btable-frozen").append(trs)}},destroyFrozenRows:function(){var that=this,grid=that.grid;that.rowsView2=$(grid.rowsView);if(!that.rowsView2.children("table.coral-grid-btable-frozen").length){$(that.rowsView2).prepend('<table class="coral-grid-btable-frozen" cellspacing="0" cellpadding="0"></table>');that.rowsView2.children("table.coral-grid-btable-frozen").css({position:"absolute",left:0,top:0})}var vh=that.element.find(".coral-grid-rows-view").height();var fh=that.rowsView2.find("table.coral-grid-btable-frozen").outerHeight();doWidthFrozen(false);doWidthFirstRow(false);that.rowsView2.css({"margin-top":0,height:(vh+fh)+"px"});function doWidthFrozen(isFirst){var rows=that.rowsView2.find("table.coral-grid-btable-frozen tr").filter(function(i){if(i==0){return false}return true});var row1=(isFirst?that.rowsView1:that.rowsView2).children("table.coral-grid-btable-frozen")[0].rows[1];$(that.rowsView2.find(".coral-grid-btable tbody:first tr:first")[0]).after(rows)}function doWidthFirstRow(isFirst){(isFirst?that.rowsView1:that.rowsView2).children("table.coral-grid-btable-frozen").remove()}},showHideCol:function(colname,show){var that=this,fndh=false,brd=$.support.boxSizing?0:this._intNum(this.options.cellLayout,0),cw;if(!that.grid){return}if(typeof colname==="string"){colname=[colname]}show=show!="none"?"":"none";var sw=show===""?true:false,gh=that.options.groupHeader&&(typeof that.options.groupHeader==="object"||$.isFunction(that.options.groupHeader));if(gh){$(that.element).grid("destroyGroupHeader",false)}$(this.options.colModel).each(function(i){if($.inArray(this.name,colname)!==-1&&this.hidden===sw){if(that.options.frozenColumns===true&&this.frozen===true){}$("tr",that.grid.columnsView).each(function(){$(this.cells[i]).css("display",show)});$(that.rows).each(function(){if(!$(this).hasClass("jqgroup")){$(this.cells[i]).css("display",show)
}});if(that.options.footerrow){$("tr.footrow td:eq("+i+")",that.grid.sDiv).css("display",show)}cw=this.widthOrg?this.widthOrg:parseInt(this.width,10);if(show==="none"){that.options.tblwidth-=cw+brd}else{that.options.tblwidth+=cw+brd}this.hidden=!sw;fndh=true;that._trigger("onShowHideCol",null,[{show:sw,name:this.name,index:i}])}});if(fndh===true){if(that.options.shrinkToFit===true&&!isNaN(that.options.height)){that.options.tblwidth+=parseInt(that.options.scrollOffset,10)}that._setGridWidth(that.options.shrinkToFit===true?that.options.tblwidth:that.options.width)}if(gh){$(that.element).grid("setGroupHeaders",that.options.groupHeader)}},hideCol:function(colname){return $(this.element).grid("showHideCol",colname,"none")},showCol:function(colname){return $(this.element).grid("showHideCol",colname,"")},remapColumns:function(permutation,updateCells,keepHeader){function resortArray(a){var ac;if(a.length){ac=$.makeArray(a)}else{ac=$.extend({},a)}$.each(permutation,function(i){a[i]=ac[this]})}var that=this;function resortRows(parent,clobj){$(">tr"+(clobj||""),parent).each(function(){var row=this;var elems=$.makeArray(row.cells);$.each(permutation,function(){var e=elems[this];if(e){row.appendChild(e)}})})}resortArray(that.options.colModel);resortArray(that.options.colNames);resortArray(that.grid.headers);resortRows($("thead:first",that.grid.columnsView),keepHeader&&":not(.coral-grid-labels)");if(updateCells){resortRows($("#"+$.grid.coralID(that.options.id)+" tbody:first"),".jqgfirstrow, tr.jqgrow, tr.jqfoot")}if(that.options.footerrow){resortRows($("tbody:first",that.grid.sDiv))}if(that.options.remapColumns){if(!that.options.remapColumns.length){that.options.remapColumns=$.makeArray(permutation)}else{resortArray(that.options.remapColumns)}}that.options.lastsort=$.inArray(that.options.lastsort,permutation);if(that.options.treeGrid){that.options.expColInd=$.inArray(that.options.expColInd,permutation)}$(that).triggerHandler("gridRemapColumns",[permutation,updateCells,keepHeader])
},sortableColumns:function(tblrow){var that=this,tid=$.grid.coralID(that.options.id);function start(){that.options.disableClick=true}var sortable_opts={tolerance:"pointer",axis:"x",cancel:".coral-columnSortable-disabled",scrollSensitivity:"1",helper:function(event,currentItem){return currentItem.clone()},items:">th:not(:has(#jqgh_"+tid+"_cb,#jqgh_"+tid+"_rn,#jqgh_"+tid+"_subgrid),:hidden, .coral-columnSortable-disabled)",placeholder:{element:function(item){var rowspan=typeof(item.attr("rowspan"))=="undefined"?"1":"2",colspan=typeof(item.attr("colspan"))=="undefined"?"1":"2";var el=$(document.createElement(item[0].nodeName)).addClass(item[0].className+" coral-sortable-placeholder coral-state-highlight").removeClass("coral-sortable-helper").attr("rowspan",rowspan).attr("colspan",colspan)[0];return el},update:function(self,options){options.height(self.currentItem.innerHeight()-parseInt(self.currentItem.css("paddingTop")||0,10)-parseInt(self.currentItem.css("paddingBottom")||0,10));options.width(self.currentItem.innerWidth()-parseInt(self.currentItem.css("paddingLeft")||0,10)-parseInt(self.currentItem.css("paddingRight")||0,10))}},update:function(event,ui){var p=$(ui.item).parent(),th=$(">th",p),colModel=that.options.colModel,cmMap={},tid=that.options.id+"_";ui.itemId=[];$.each(colModel,function(i){cmMap[this.name]=i});var permutation=[];var permutationId=[];th.each(function(){var id=$(">div",this).get(0).id.replace(/^jqgh_/,"").replace(tid,"");if(id in cmMap){permutation.push(cmMap[id]);permutationId.push(id)}});$.each(ui.item,function(i){ui.itemId.push(ui.item[i].id.replace(/^jqgh_/,"").replace(tid,""))});ui.prevItemId=$(ui.item[0]).prev("th").attr("id").replace(/^jqgh_/,"").replace(tid,"");ui.nextItemId=$(ui.item[0]).next("th").attr("id").replace(/^jqgh_/,"").replace(tid,"");ui.targetId=ui.position.left>ui.originalPosition.left?ui.prevItemId:ui.nextItemId;$(that.element).grid("remapColumns",permutation,true,true);ui.permutation=permutation;ui.permutationOfId=permutationId;
that._trigger("onSortableColumns",event,[ui]);setTimeout(function(){that.options.disableClick=false},50)}};$.extend(sortable_opts,that.options.sortableColumnsOptions);if(sortable_opts.beforesortablecolumns){var s=sortable_opts.beforesortablecolumns;sortable_opts.start=function(e,ui){start();s.call(this,e,ui)}}else{sortable_opts.start=start}if(that.options.sortableColumnsOptions.exclude){sortable_opts.items+=":not("+that.options.sortableColumnsOptions.exclude+")"}tblrow.sortable(sortable_opts).data("sortable").floating=true},setCaption:function(newcap){this.options.caption=newcap;$("span.coral-grid-title, span.coral-grid-title-rtl",this.grid.caption).html(newcap);$(this.grid.cDiv).show()},setLabel:function(colname,nData,prop,attrp){var that=this,pos=-1;if(!that.grid){return}if(typeof(colname)!="undefined"){$(that.options.colModel).each(function(i){if(this.name==colname){pos=i;return false}})}else{return}if(pos>=0){var thecol=$("tr.coral-grid-labels th:eq("+pos+")",that.grid.columnsViews);if(nData){var ico=$(".s-ico",thecol);$("[id^=jqgh_]",thecol).empty().html(nData).append(ico);that.options.colNames[pos]=nData}if(prop){if(typeof prop==="string"){$(thecol).addClass(prop)}else{$(thecol).css(prop)}}if(typeof attrp==="object"){$(thecol).attr(attrp)}}},setCell:function(rowid,colname,nData,cssp,attrp,forceupd){var that=this,pos=-1,v,title;if(!that.grid){return}if(isNaN(colname)){$(that.options.colModel).each(function(i){if(this.name==colname){pos=i;return false}})}else{pos=parseInt(colname,10)}if(pos>=0){var ind=that.rows.namedItem(rowid);var rwd=$(that.element).grid("getRowData",rowid);if(ind){var tcell=$("td:eq("+pos+")",ind);if(nData!==""||forceupd===true){v=that._formatter(rowid,nData,pos,rwd,"edit");title=that.options.colModel[pos].title?{title:$.grid.stripHtml(v)}:{};if(that.options.treeGrid&&$(".tree-wrap",$(tcell)).length>0){$("span",$(tcell)).html(v).attr(title)}else{$(tcell).html(v).attr(title)}$.fn.afterFmatter.call(that);if(that.options.datatype=="local"){var cm=that.options.colModel[pos],index;
var _fn=$.coral.toFunction(cm.formatter);if($.isFunction(_fn)){nData=_fn.apply(this.element[0])}else{nData=cm.formatter&&typeof(cm.formatter)==="string"&&cm.formatter=="date"?$.unformat.date.call(that,nData,cm):nData}index=that.options._index[rowid];if(typeof index!="undefined"){that.options.data[index][cm.name]=nData}}}if(typeof cssp==="string"){$(tcell).addClass(cssp)}else{if(cssp){$(tcell).css(cssp)}}if(typeof attrp==="object"){$(tcell).attr(attrp)}}}},getCell:function(rowid,col){var ret=false;var $t=this,pos=-1;if(!$t.grid){return}if(isNaN(col)){$($t.options.colModel).each(function(i){if(this.name===col){pos=i;return false}})}else{pos=parseInt(col,10)}if(pos>=0){var ind=$t.rows.namedItem(rowid);if(ind){try{ret=$.unformat.call($t,$("td:eq("+pos+")",ind),{rowId:ind.id,colModel:$t.options.colModel[pos]},pos)}catch(e){ret=$.grid.htmlDecode($("td:eq("+pos+")",ind).html())}}}return ret},getCol:function(col,obj,mathopr){var ret=[],val,sum=0,min,max,v;obj=typeof(obj)!="boolean"?false:obj;if(typeof mathopr=="undefined"){mathopr=false}var $t=this,pos=-1;if(!$t.grid){return}if(isNaN(col)){$($t.options.colModel).each(function(i){if(this.name===col){pos=i;return false}})}else{pos=parseInt(col,10)}if(pos>=0){var ln=$t.rows.length,i=0;if(ln&&ln>0){while(i<ln){if($($t.rows[i]).hasClass("jqgrow")){try{val=$.unformat.call($t,$($t.rows[i].cells[pos]),{rowId:$t.rows[i].id,colModel:$t.options.colModel[pos]},pos)}catch(e){val=$.grid.htmlDecode($t.rows[i].cells[pos].innerHTML)}if(mathopr){v=parseFloat(val);sum+=v;if(i===0){min=v;max=v}else{min=Math.min(min,v);max=Math.max(max,v)}}else{if(obj){ret.push({id:$t.rows[i].id,value:val})}else{ret.push(val)}}}i++}if(mathopr){switch(mathopr.toLowerCase()){case"sum":ret=sum;break;case"avg":ret=sum/ln;break;case"count":ret=ln;break;case"min":ret=min;break;case"max":ret=max;break}}}}return ret},getCellComponent:function(rowid,colname,nData,cssp,attrp,forceupd){var that=this,pos=-1,v,title;if(!that.grid){return}return $("#"+rowid).find("[aria-describedby$="+colname+"]").find(".ctrl-init")
},_formatter:function(rowId,_cellVal,colpos,rwdat,_act){var cm=this.options.colModel[colpos],v;if(typeof cm.formatter!=="undefined"){var opts={rowId:rowId,colModel:cm,gid:this.options.id,pos:colpos,model:this.options.model};var _fn=$.coral.toFunction(cm.formatter);if($.isFunction(_fn)){v=_fn.apply(this.element[0],[_cellVal,opts,rwdat,_act])}else{if($.fmatter){v=$.fn.fmatter.call(this,cm.formatter,_cellVal,opts,rwdat,_act)}else{v=this._cellVal(_cellVal)}}}else{v=this._cellVal(_cellVal)}return v},_getOffset:function(iCol){var that=this;var i,ret={},brd1=$.support.boxSizing?0:that.options.cellLayout;ret[0]=ret[1]=ret[2]=0;for(i=0;i<=iCol;i++){if(that.options.colModel[i].hidden===false||typeof(that.options.colModel[i].hidden)=="undefined"){ret[0]+=that.options.colModel[i].width+brd1}}ret[0]=ret[0]-that.grid.rowsView.scrollLeft;ret[2]+=$(that.grid.rowsView).height()+$(that.grid.columnsView).height();return ret},_sortData:function(index,idxcol,reload,sor,obj){var that=this;if(!this.options.colModel[idxcol].sortable){return}that.options.b_sortdata=true;var so;if(this.options.savedRow.length>0){return}if(!reload){if(this.options.lastsort==idxcol){if(this.options.sortorder=="asc"){this.options.sortorder="desc"}else{if(this.options.sortorder=="desc"){this.options.sortorder="asc"}}}else{this.options.sortorder=this.options.colModel[idxcol].firstsortorder||"asc"}this.options.page=1}if(sor){if(this.options.lastsort==idxcol&&this.options.sortorder==sor&&!reload){return}else{that.options.sortorder=sor}}var previousSelectedTh=this.grid.headers[this.options.lastsort].el,newSelectedTh=this.options.frozenColumns?obj:this.grid.headers[idxcol].el;$("span.coral-grid-ico-sort",previousSelectedTh).addClass("coral-state-disabled");$(previousSelectedTh).attr("aria-selected","false");if(this.options.frozenColumns){if(this.grid.fhDiv){this.grid.fhDiv.find("span.coral-grid-ico-sort").addClass("coral-state-disabled");this.grid.fhDiv.find("th").attr("aria-selected","false")}else{if(this.grid.rightfhDiv){this.grid.rightfhDiv.find("span.coral-grid-ico-sort").addClass("coral-state-disabled");
this.grid.rightfhDiv.find("th").attr("aria-selected","false")}}}$("span.coral-icon-"+this.options.sortorder,newSelectedTh).removeClass("coral-state-disabled");$(newSelectedTh).attr("aria-selected","true");if(!this.options.viewsortcols[0]){if(this.options.lastsort!=idxcol){if(this.options.frozenColumns){if(this.grid.fhDiv){this.grid.fhDiv.find("span.s-ico").hide()}else{if(this.grid.rightfhDiv){this.grid.rightfhDiv.find("span.s-ico").hide()}}}$("span.s-ico",previousSelectedTh).hide();$("span.s-ico",newSelectedTh).show()}else{if(this.options.sortname===""){$("span.s-ico",newSelectedTh).show()}}}index=index.substring(5+this.options.id.length+1);this.options.sortname=this.options.colModel[idxcol].index||index;so=this.options.sortorder;if(that._trigger("onSortCol",null,[{id:index,colIndex:idxcol,sortorder:so}])==="stop"){this.options.lastsort=idxcol;return}if(this.options.datatype=="local"){if(this.options.deselectAfterSort){$(this.element).grid("resetSelection")}}else{this.options.selrow=null;if(this.options.multiselect){that._setHeadCheckBox(false)}this.options.selarrrow=[];this.options.savedRow=[]}if(this.options.scroll){var sscroll=this.grid.rowsView.scrollLeft;emptyRows(this.grid.rowsView,true,false);this.grid.columnsView.scrollLeft=sscroll}if(this.options.subGrid&&this.options.datatype=="local"){$("td.sgexpanded","#"+$.grid.coralID(this.options.id)).each(function(){$(this).trigger("click")})}this._populate();this.options.lastsort=idxcol;if(this.options.sortname!=index&&idxcol){this.options.lastsort=idxcol}that.options.b_sortdata=false},_intNum:function(val,defval){val=parseInt(val,10);if(isNaN(val)){return defval?defval:0}else{return val}},_beginReq:function(){var tipsDom=$("#noRecordsTips_"+$.grid.coralID(this.options.id));if(tipsDom.is(":visible")){tipsDom.hide()}this.refresh();this.grid.columnsView.loading=true;if(this.options.hiddengrid){return}switch(this.options.loadui){case"disable":break;case"enable":$(this.element).loading({position:"overlay",text:this.options.loadtext});
break;case"block":$("#lui_"+$.grid.coralID(this.options.id)).show();$(this.element).loading({position:"overlay",text:this.options.loadtext});break}},_endReq:function(){var that=this;this._delay(function(){that.refreshPager()},300);this.grid.columnsView.loading=false;switch(this.options.loadui){case"disable":break;case"enable":$(this.element).loading("hide");break;case"block":$("#lui_"+$.grid.coralID(this.options.id)).hide();$(this.element).loading("hide");break}this.element.find(".coral-grid-htable,.coral-grid-btable").css({"table-layout":"fixed"});if($(that.grid.rowsView).find(".jqgrow").length==0){that._noRecordsTipsPositon();$("#noRecordsTips_"+$.grid.coralID(that.options.id)).css("display","inline-block")}else{$("#noRecordsTips_"+$.grid.coralID(that.options.id)).css("display","none")}},_noRecordsTipsPositon:function(){var that=this;var gridWidth=this.element.width(),gridHeight=this.gridRows.height(),tipsWidth=$("#noRecordsTips_"+$.grid.coralID(that.options.id)).width(),tipsHeight=$("#noRecordsTips_"+$.grid.coralID(that.options.id)).height();$("#noRecordsTips_"+$.grid.coralID(that.options.id)).css({"margin-top":(gridHeight-tipsHeight)/2+"px","margin-left":gridWidth/2+"px"})},_setColWidth:function(){var that=this;var grid=this.grid;var initwidth=0,brd=$.support.boxSizing?0:this._intNum(this.options.cellLayout,0),vc=0,lvc,scw=this._intNum(this.options.scrollOffset,0),cw,hs=false,aw,gw=0,cl=0,cr;$.each(this.options.colModel,function(){if(that.options.grouping&&that.options.autowidth){var ind=$.inArray(this.name,that.options.groupingView.groupField);if(ind>=0&&that.options.groupingView.groupColumnShow.length>ind){this.hidden=!that.options.groupingView.groupColumnShow[ind]}}this.widthOrg=cw=that._intNum(this.width,0);if((this.hidden===false||typeof(this.hidden)=="undefined")){initwidth+=cw+brd;if(this.fixed){gw+=cw+brd}else{vc++}cl++}});if(isNaN(that.options.width)){that.options.width=grid.width=initwidth}else{grid.width=that.options.width}that.options.tblwidth=initwidth;
if(that.options.shrinkToFit===false&&that.options.forceFit===true){that.options.forceFit=false}if(that.options.shrinkToFit===true&&vc>0){aw=grid.width-brd*vc-gw;if(!isNaN(this.options.height)){aw-=scw;hs=true}initwidth=0;$.each(that.options.colModel,function(i){if((this.hidden===false||typeof(this.hidden)=="undefined")&&!this.fixed){cw=Math.round(aw*this.width/(that.options.tblwidth-brd*vc-gw));this.width=cw;initwidth+=cw;lvc=i}});cr=0;if(hs){if(grid.width-gw-(initwidth+brd*vc)!==scw){cr=grid.width-gw-(initwidth+brd*vc)-scw}}else{if(!hs&&Math.abs(grid.width-gw-(initwidth+brd*vc))!==1){cr=grid.width-gw-(initwidth+brd*vc)-1}}that.options.colModel[lvc].width+=cr;that.options.tblwidth=initwidth+cr+brd*vc+gw;if(that.options.tblwidth>that.options.width){that.options.colModel[lvc].width-=(that.options.tblwidth-parseInt(that.options.width,10));that.options.tblwidth=that.options.width}that.options.tblwidth}},_nextVisible:function(iCol){var ret=iCol,j=iCol,i;for(i=iCol+1;i<this.options.colModel.length;i++){if(this.options.colModel[i].hidden!==true){j=i;break}}return j-ret},_formatCol:function(pos,rowInd,tv,rawObject,rowId,rdata){var that=this;if(that.options.model=="card"){return""}var grid=that.grid;var cm=that.options.colModel[pos],ral=cm.align,result='style="',clas=cm.cls,nm=cm.name,celp,acp=[],dataOrg="";if(ral){result+="text-align:"+ral+";"}if(cm.hidden===true){result+="display:none;"}var _fn=$.coral.toFunction(cm.cellattr);if(rowInd===0){result+="width: "+grid.headers[pos].width+"px;"}else{if($.isFunction(_fn)){celp=_fn.apply(that.element[0],[{rowId:rowId,value:tv,rawObject:rawObject,colModel:cm,rowData:rdata}]);if(celp&&typeof(celp)==="string"){celp=celp.replace(/style/i,"style").replace(/title/i,"title");if(celp.indexOf("title")>-1){cm.title=false}if(celp.indexOf("class")>-1){clas=undefined}acp=celp.split("style");if(acp.length===2){acp[1]=$.trim(acp[1].replace("=",""));if(acp[1].indexOf("'")===0||acp[1].indexOf('"')===0){acp[1]=acp[1].substring(1)}result+=acp[1].replace(/'/gi,'"')
}else{result+='"'}}}}if(rawObject){var rawObjectV=rawObject[nm]||"";rawObjectV=$.grid.htmlEncode(rawObjectV);dataOrg+="data-org='"+rawObjectV+"'"}if(!acp.length){acp[0]="";result+='"'}result+=(clas!==undefined?(' class="'+clas+'"'):"")+((cm.title&&tv)?(' title="'+$.grid.stripHtml(tv)+'"'):"");result+=' aria-describedby="'+that.options.id+"_"+nm+'"';return result+acp[0]+dataOrg},findTextByValue:function(cval,opts){var code=opts.colModel.editoptions.data;if(!code){return cval}for(var i=0;i<code.length;i++){if(code[i].text==cval){return code[i].value}else{}}return cval},_cellVal:function(val){return val===undefined||val===null||val===""?"&#160;":(this.options.autoencode?$.grid.htmlEncode(val):val+"")},_addCell:function(rowId,cell,pos,irow,srvr,rdata){if(this.options.model=="card"){var v,prp;v=this._formatter(rowId,cell,pos,srvr,"add");prp=this._formatCol(pos,irow,v,srvr,rowId,rdata);return'<div role="gridcell" '+prp+">"+v+"</div>"}var v,prp;v=this._formatter(rowId,cell,pos,srvr,"add");prp=this._formatCol(pos,irow,v,srvr,rowId,rdata);return'<td role="gridcell" '+prp+">"+v+"</td>"},_orderedCols:function(offset){var that=this;var order=that.options.remapColumns;if(!order||!order.length){order=$.map(that.options.colModel,function(v,i){return i})}if(offset){order=$.map(order,function(v){return v<offset?null:v-offset})}return order},emptyRows:function(parent,scroll,locdata){var that=this,isPicgrid=!!(that.options.model=="card");if(isPicgrid){$("#"+$.grid.coralID(that.options.id)+" .coral-pic").children().remove()}else{if(that.options.deepempty){$("#"+$.grid.coralID(that.options.id)+" tbody:first tr:gt(0)").remove()}else{var trf=$("#"+$.grid.coralID(that.options.id)+" tbody:first tr:first")[0];$("#"+$.grid.coralID(that.options.id)+" tbody:first").empty().append(trf)}if(scroll&&that.options.scroll){$(">div:first",parent).css({height:"auto"}).children("div:first").css({height:0,display:"none"});parent.scrollTop=0}if(locdata===true){if(that.options.treeGrid===true){that.options.data=[];
that.options._index={}}}}},normalizeData:function(){var p=this.options,data=p.data,dataLength=data.length,i,j,cur,idn,idr,ccur,v,rd,localReader=p.localReader,colModel=p.colModel,cellName=localReader.cell,iOffset=(p.multiselect===true?1:0)+(p.subGrid===true?1:0)+(p.rownumbers===true?1:0),br=p.scroll?$.jgrid.randId():1,arrayReader,objectReader,rowReader;if(p.datatype!=="local"||localReader.repeatitems!==true){return}arrayReader=this._orderedCols(iOffset);objectReader=this._reader("local");idn=p.keyName===false?($.isFunction(localReader.id)?localReader.id.call(ts,data):localReader.id):p.keyName;for(i=0;i<dataLength;i++){cur=data[i];idr=$.grid.getAccessor(cur,idn);if(idr===undefined){if(typeof idn==="number"&&colModel[idn+iOffset]!=null){idr=$.grid.getAccessor(cur,colModel[idn+iOffset].name)}if(idr===undefined){idr=br+i;if(cellName){ccur=$.grid.getAccessor(cur,cellName)||cur;idr=ccur!=null&&ccur[idn]!==undefined?ccur[idn]:idr;ccur=null}}}rd={};rd[localReader.id]=idr;if(cellName){cur=$.grid.getAccessor(cur,cellName)||cur}rowReader=$.isArray(cur)?arrayReader:objectReader;for(j=0;j<rowReader.length;j++){v=$.grid.getAccessor(cur,rowReader[j]);rd[colModel[j+iOffset].name]=v}$.extend(true,data[i],rd)}},refreshIndex:function(){var that=this;var datalen=that.options.data.length,idname,i,val;if(that.options.keyName===false||that.options.loadonce===true){idname=that.options.localReader.id}else{idname=that.options.keyName}for(i=0;i<datalen;i++){val=$.grid.getAccessor(that.options.data[i],idname);that.options._index[val]=i}},constructPanel:function(id,hide,altClass,rd,cur){var tabindex="-1",restAttr="",attrName,style=hide?"display:none;":"",classes="gridPanel coral-row-"+this.options.direction+altClass;return'<li role="row" id="'+id+'" tabindex="'+tabindex+'" class="'+classes+'"'+(style===""?"":' style="'+style+'"')+restAttr+">"},constructTr:function(id,hide,altClass,rd,cur,selected){var tabindex="-1",restAttr="",attrName,style=hide?"display:none;":"",rowAttrObj,classes="coral-component-content jqgrow coral-row-"+this.options.direction+altClass+(selected?" coral-state-highlight":"");
if(this.options.treeGrid){var parent_id=this.options.treeReader.parent_id_field;if(cur[parent_id]!==null&&String(cur[parent_id]).toLowerCase()!="null"){classes+=" treeGridRow "}}var rowattrFun=$.coral.toFunction(this.options.rowattr);rowAttrObj=$.isFunction(rowattrFun)?rowattrFun.apply(this.element[0],[{rowId:id,rowData:rd,currentObj:cur}]):{};if(!$.isEmptyObject(rowAttrObj)){if(rowAttrObj.hasOwnProperty("id")){id=rowAttrObj.id;delete rowAttrObj.id}if(rowAttrObj.hasOwnProperty("tabindex")){tabindex=rowAttrObj.tabindex;delete rowAttrObj.tabindex}if(rowAttrObj.hasOwnProperty("style")){style+=rowAttrObj.style;delete rowAttrObj.style}if(rowAttrObj.hasOwnProperty("class")){classes+=" "+rowAttrObj["class"];delete rowAttrObj["class"]}try{delete rowAttrObj.role}catch(ra){}for(attrName in rowAttrObj){if(rowAttrObj.hasOwnProperty(attrName)){restAttr+=" "+attrName+"="+rowAttrObj[attrName]}}}return'<tr role="row" id="'+id+'" tabindex="'+tabindex+'" class="'+classes+'"'+(style===""?"":' style="'+style+'"')+restAttr+">"},_clearVals:function(onPaging){var that=this,ret;ret=that._trigger("onPaging",null,[{pgButton:onPaging}]);if(!ret){return false}that.options.selrow=null;that.options.editrow=null;if(that.options.multiselect){that.options.selarrrow=[];that._setHeadCheckBox(false)}that.options.savedRow=[];return true},_getPagination:function(){},_setPager:function(pgid,tp){var that=this,pagerTemplate1="<span class='paginator-left'>{viewrecords}</span><span class='paginator-center'>{prev}{links}{next}{pginput}{navbar}{description}</span><span class='paginator-right'><em>每页</em>{rninput}<em>条</em></span>",pagerTemplate2="<div class='paginator-left'>{viewrecords}{rowlist}{first}{prev}{pginput}{next}{last}{navbar}{description}</div><div class='toolbarpanel'>{toolbar}</div>";tp+="_"+pgid;var pagerTemplate=false;if($.isFunction(that.options.pagerTemplate)){pagerTemplate=that.options.pagerTemplate.call(that)}var dir=this.options.direction;var po=["first"+tp,"prev"+tp,"next"+tp,"last"+tp];if(dir=="rtl"){po.reverse()
}var pginp="",str="",rninput="",rowlist="",viewrecords="",totalPage="",pagers="",pagination="",links="<span class='coral-paginator-pages'></span>",pginput="<em>第</em><input type='text' class='coral-pg-input'/><em>页</em>",reload="<button class='reload-button' id='_reloadGrid' type='button' data-options='customData:{gridId:\""+that.options.id+'"},label:"刷新",text: false,icons: "cui-icon-loop3",onClick: function( e, ui ){$( "#'+that.options.id+'" ).grid( "reload" );}\'>reload</button>',first="<span id='"+po[0]+"' class='coral-paginator-first coral-state-default coral-corner-all' tabindex='0'><span class='cui-icon-first2' title='第一页'></span></span>",last="<span id='"+po[3]+"' class='coral-paginator-last coral-state-default coral-corner-all' tabindex='0'><span class='cui-icon-last2' title='最后一页'></span></span>",next="<span id='"+po[2]+"' class='coral-paginator-next coral-corner-all' tabindex='0'><span class='cui-icon-arrow-right3' title='下一页'></span></span>",prev="<span id='"+po[1]+"' class='coral-paginator-prev coral-corner-all' tabindex='0'><span class='cui-icon-arrow-left3' title='前一页'></span></span>",sep="<span>|</span>",navbar="<span class='pager-navbar'></span>",toolbar="<span class='pager-toolbar'></span>",description="<span class='pager-description'></span>",paginator,lft,cent,rgt,twd,tdw,i;paginator="pg_"+pgid;lft=pgid+"_left";cent=pgid+"_center";rgt=pgid+"_right";rninput+="<input type='text' class='coral-rn-input' val=''/>";if(!that.options.rninput){}else{if(that.options.rowList.length>0){}}rowlist+="<span class='coral-paginator-combobox'><select class='coral-pg-selbox' role='listbox'>";for(i=0;i<that.options.rowList.length;i++){rowlist+='<option role="option" value="'+that.options.rowList[i]+'"'+((that.options.rowNum==that.options.rowList[i])?' selected="selected"':"")+">"+that.options.rowList[i]+"</option>"}rowlist+="</select></span>";if(that.options.viewrecords){viewrecords+="<span class='coral-paging-info'></span>";totalPage+="<span class='coral-paging-totalpage'></span>"
}if(that.options.pginput===true){pginp="<td dir='"+dir+"'>"+$.grid.format(that.options.pgtext||"","<input class='coral-pg-input' type='text' size='2' maxlength='7' value='0' role='textbox'/>","<span id='sp_1_"+$.grid.coralID(pgid)+"'></span>")+"</td>"}if(that.options.pagerStyle=="flex"){if(pagerTemplate){pagerTemplate1=pagerTemplate}pagination="<span id='"+po[1]+"' class='coral-paginator-prev coral-corner-all' tabindex='0'><span class='cui-icon-arrow-left3'>p</span></span><span class='coral-paginator-pages'></span><span id='"+po[2]+"' class='coral-paginator-next coral-corner-all' tabindex='0'><span class='cui-icon-arrow-right3'>p</span></span><em>第</em><input type='text' class='coral-pg-input'/><em>页</em>";pagers=pagerTemplate1.replace(/\{viewrecords\}/g,viewrecords).replace(/\{navbar\}/g,navbar).replace(/\{reload\}/g,reload).replace(/\{-\}/g,sep).replace(/\{first\}/g,first).replace(/\{last\}/g,last).replace(/\{next\}/g,next).replace(/\{totalPage\}/g,totalPage).replace(/\{prev\}/g,prev).replace(/\{links\}/g,links).replace(/\{pginput\}/g,pginput).replace(/\{toolbar\}/g,toolbar).replace(/\{description\}/g,description).replace(/\{rowlist\}/g,rowlist).replace(/\{rninput\}/g,rninput);$("#"+$.grid.coralID(pgid)).addClass("coral-pager-flex");$("#"+$.grid.coralID(pgid)).append("<div id='"+paginator+"' class='coral-paginator' role='group'>"+pagers+"</div>");that._bindpager(pgid,tp)}else{if(that.options.pagerStyle=="tradition"){if(pagerTemplate){pagerTemplate2=pagerTemplate}pagination="<span id='"+po[0]+"' class='coral-paginator-first coral-state-default coral-corner-all' tabindex='0'><span class='cui-icon-first2'></span></span><span id='"+po[1]+"' class='coral-paginator-prev coral-corner-all' tabindex='0'><span class='cui-icon-arrow-left3'></span></span><em>第</em><input type='text' class='coral-pg-input'/><em>页</em><span id='"+po[2]+"' class='coral-paginator-next coral-corner-all' tabindex='0'><span class='cui-icon-arrow-right3'></span></span><span id='"+po[3]+"' class='coral-paginator-last coral-state-default coral-corner-all' tabindex='0'><span class='cui-icon-last2'></span></span>";
pagers=pagerTemplate2.replace(/\{viewrecords\}/g,viewrecords).replace(/\{navbar\}/g,navbar).replace(/\{reload\}/g,reload).replace(/\{-\}/g,sep).replace(/\{first\}/g,first).replace(/\{last\}/g,last).replace(/\{next\}/g,next).replace(/\{prev\}/g,prev).replace(/\{links\}/g,links).replace(/\{totalPage\}/g,totalPage).replace(/\{pginput\}/g,pginput).replace(/\{toolbar\}/g,toolbar).replace(/\{description\}/g,description).replace(/\{rowlist\}/g,rowlist).replace(/\{rninput\}/g,rninput);$("#"+$.grid.coralID(pgid)).addClass("coral-pager-tradition");$("#"+$.grid.coralID(pgid)).append("<div id='"+paginator+"' class='coral-paginator' role='group'>"+pagers+"</div>");that._bindpagerTradition(pgid,tp)}else{}}var pagerOpts=$.parser.parseOptions($("#"+$.grid.coralID(pgid))[0],null);that.options.toolbarOptions=pagerOpts.toolbarOptions;that.options.description=pagerOpts.description;var navbarOptions=that.options.navbarOptions||{};pagerOpts.toolbarOptions=pagerOpts.toolbarOptions||{};$(".reload-button",that.element).button();if($(".pager-toolbar",that.element).length){$(".pager-toolbar",that.element).toolbar(pagerOpts.toolbarOptions)}if(that.options.description){$(".pager-description",that.element).html(that.options.description)}},_bindpagerTradition:function(pgid,tp){var that=this;$("input.coral-pg-input",$("#"+$.grid.coralID(pgid))).textbox({componentCls:"pg",onKeyPress:function(e,ui){var key=e.charCode?e.charCode:e.keyCode?e.keyCode:0;if(key==13){that.options.page=(ui.text>0)?ui.text:that.options.page;if(!that._clearVals("user")){return false}that._populate();return false}return this}});$("input.coral-rn-input",$("#"+$.grid.coralID(pgid))).textbox({componentCls:"rn",onKeyPress:function(e,ui){var key=e.charCode?e.charCode:e.keyCode?e.keyCode:0;if(key==13){that.options.rowNum=(ui.text>0)?(ui.text<that.options.rowNumMax?ui.text:that.options.rowNumMax):that.options.rowNum;if(!that._clearVals("records")){return false}that._populate();return false}return this}});$(".coral-pg-selbox",$("#"+$.grid.coralID(pgid))).combobox({componentCls:"rn",panelHeight:"auto",onChange:function(event,ui){that.options.page=Math.round(that.options.rowNum*(that.options.page-1)/ui.value-0.5)+1;
that.options.rowNum=ui.value;if(!that._clearVals("records")){return false}that._populate();return false}});$("#first"+$.grid.coralID(tp)+", #prev"+$.grid.coralID(tp)+", #next"+$.grid.coralID(tp)+", #last"+$.grid.coralID(tp)).click(function(){var cp=that._intNum(that.options.page,1),last=that._intNum(that.options.lastpage,1),selclick=false,fp=true,pp=true,np=true,lp=true;if(last===0||last===1){fp=false;pp=false;np=false;lp=false}else{if(last>1&&cp>=1){if(cp===1){fp=false;pp=false}else{if(cp===last){np=false;lp=false}}}else{if(last>1&&cp===0){np=false;lp=false;cp=last-1}}}if(this.id==="first"+tp&&fp){that.options.page=1;selclick=true}if(this.id==="prev"+tp&&pp){that.options.page=(cp-1);selclick=true}if(this.id==="next"+tp&&np){that.options.page=(cp+1);selclick=true}if(this.id==="last"+tp&&lp){that.options.page=last;selclick=true}if(selclick){if(!that._clearVals(this.id)){return false}that._populate()}return false})},_bindpager:function(pgid,tp){var that=this;$("input.coral-pg-input",$("#"+$.grid.coralID(pgid))).textbox({componentCls:"pg",onKeyPress:function(e,ui){var key=e.charCode?e.charCode:e.keyCode?e.keyCode:0;if(key==13){var last=that._intNum(that.options.lastpage,1);var cp=that._intNum(ui.text,1);if(cp>last){return}that.options.page=(ui.text>0)?ui.text:that.options.page;if(!that._clearVals("user")){return false}that._populate();return false}return this}});$("input.coral-rn-input",$("#"+$.grid.coralID(pgid))).textbox({componentCls:"rn",onKeyPress:function(e,ui){var key=e.charCode?e.charCode:e.keyCode?e.keyCode:0;if(key==13){that.options.rowNum=(ui.text>0)?(ui.text<that.options.rowNumMax?ui.text:that.options.rowNumMax):that.options.rowNum;if(!that._clearVals("records")){return false}that._populate();return false}return this}});$(".coral-pg-selbox",$("#"+$.grid.coralID(pgid))).combobox({componentCls:"rn",panelHeight:"auto",onChange:function(event,ui){that.options.page=Math.round(that.options.rowNum*(that.options.page-1)/ui.newValue-0.5)+1;that.options.rowNum=ui.newValue;
if(!that._clearVals("records")){return false}that._populate();return false}});$(".coral-textbox-btn-ico-search",$("#"+$.grid.coralID(pgid))).click(function(e){that.options.page=($(this).prev().val()>0)?$(this).prev().val():that.options.page;if(!that._clearVals("user")){return false}that._populate();return false});this._off($(".coral-paginator-page"));this._on({"click.coral-paginator-page":function(e){var _this=e.target;if($(_this).hasClass("coral-state-disabled")){_this.style.cursor="default"}else{$(_this).addClass("coral-state-hover");_this.style.cursor="pointer"}}});this._on({"mouseenter.coral-paginator-page":function(e){var _this=e.target;if($(_this).hasClass("coral-state-disabled")){_this.style.cursor="default"}else{$(_this).addClass("coral-state-hover");_this.style.cursor="pointer"}},"mouseleave.coral-paginator-page":function(e){var _this=e.target;if(!$(_this).hasClass("coral-state-disabled")){$(_this).removeClass("coral-state-hover");_this.style.cursor="default"}}});$("#first"+$.grid.coralID(tp)+", #prev"+$.grid.coralID(tp)+", #next"+$.grid.coralID(tp)+", #last"+$.grid.coralID(tp)).click(function(){var cp=that._intNum(that.options.page,1),last=that._intNum(that.options.lastpage,1),selclick=false,fp=true,pp=true,np=true,lp=true;if(last===0||last===1){fp=false;pp=false;np=false;lp=false}else{if(last>1&&cp>=1){if(cp===1){fp=false;pp=false}else{if(cp===last){np=false;lp=false}}}else{if(last>1&&cp===0){np=false;lp=false;cp=last-1}}}if(this.id==="first"+tp&&fp){that.options.page=1;selclick=true}if(this.id==="prev"+tp&&pp){that.options.page=(cp-1);selclick=true}if(this.id==="next"+tp&&np){that.options.page=(cp+1);selclick=true}if(this.id==="last"+tp&&lp){that.options.page=last;selclick=true}if(selclick){if(!that._clearVals(this.id)){return false}that._populate()}return false})},_updatepager:function(rn,dnd){var that=this;var cp,last,base,from,to,tot,fmt,pgboxes="",sppg,topa,totalp,tspg=that.options.pager?"_"+$.grid.coralID(that.options.pager.substr(1)):"",tspg_t=that.options.toppager?"_"+that.options.toppager.substr(1):"";
base=parseInt(that.options.page,10)-1;if(base<0){base=0}base=base*parseInt(that.options.rowNum,10);to=base+that.options.reccount;if(that.options.scroll){var rows=$("tbody:first > tr:gt(0)",that.grid.rowsView);base=to-rows.length;that.options.reccount=rows.length;var rh=rows.outerHeight()||that.grid.prevRowHeight;if(rh){var top=base*rh;var height=parseInt(that.options.records,10)*rh;$(">div:first",that.grid.rowsView).css({height:height}).children("div:first").css({height:top,display:top?"":"none"})}that.grid.rowsView.scrollLeft=that.grid.columnsView.scrollLeft}if(that.options.treeGrid){var rows=$("tbody:first > tr:not(.treeGridRow,.jqgfirstrow)",that.grid.rowsView);that.options.reccount=rows.length;to=base+that.options.reccount}pgboxes=$(that.element).find(".coral-grid-pager");if(pgboxes.length>0){fmt=$.grid.formatter.integer||{};cp=that._intNum(that.options.page);last=that._intNum(that.options.lastpage);$(".selbox",pgboxes)[this.options.useProp?"prop":"attr"]("disabled",false);if($(".coral-pg-input",pgboxes).length>0){$(".coral-pg-input",pgboxes).val(that.options.page);sppg=that.options.toppager?"#sp_1"+tspg+",#sp_1"+tspg_t:"#sp_1"+tspg;$(sppg).html($.fmatter?$.fmatter.util.NumberFormat(that.options.lastpage,fmt):that.options.lastpage)}if(that.options.rninput===true){$(".coral-rn-input",pgboxes).val(that.options.rowNum)}if(that.options.viewrecords){if(that.options.reccount===0){$(".coral-paging-info",pgboxes).html("");$(".coral-paging-totalpage",pgboxes).html("")}else{from=base+1;tot=that.options.records;topa=that.options.reccount;if(tot%topa==0){totalp=parseInt(tot/topa)}else{totalp=parseInt(tot/topa)+1}if($.fmatter){from=$.fmatter.util.NumberFormat(from,fmt);to=$.fmatter.util.NumberFormat(to,fmt);tot=$.fmatter.util.NumberFormat(tot,fmt);topa=$.fmatter.util.NumberFormat(topa,fmt);totalp=$.fmatter.util.NumberFormat(totalp,fmt)}$(".coral-paging-info",pgboxes).html($.grid.format(that.options.recordtext,from,to,tot));$(".coral-paging-totalpage",pgboxes).html($.grid.format(that.options.pagetext))
}}if(that.options.pgbuttons===true){var pre=[],next=[];that.pagers.each(function(){pre.push("#first_"+this.id);pre.push("#prev_"+this.id);next.push("#next_"+this.id);next.push("#last_"+this.id)});if(cp<=0){cp=last=0}if(cp==1||cp===0){$(pre.join(",")).addClass("coral-state-disabled").removeClass("coral-state-hover");if(that.options.toppager){$("#first_t"+tspg_t+", #prev_t"+tspg_t).addClass("coral-state-disabled").removeClass("coral-state-hover")}}else{$(pre.join(",")).removeClass("coral-state-disabled");if(that.options.toppager){$("#first_t"+tspg_t+", #prev_t"+tspg_t).removeClass("coral-state-disabled")}}if(cp==last||cp===0){$(next.join(",")).addClass("coral-state-disabled").removeClass("coral-state-hover");if(that.options.toppager){$("#next_t"+tspg_t+", #last_t"+tspg_t).addClass("coral-state-disabled").removeClass("coral-state-hover")}}else{$(next.join(",")).removeClass("coral-state-disabled");if(that.options.toppager){$("#next_t"+tspg_t+", #last_t"+tspg_t).removeClass("coral-state-disabled")}}if(0==last){$(next.join(",")).addClass("coral-state-disabled").removeClass("coral-state-hover")}}that._paginators()}if(rn===true&&that.options.rownumbers===true){$("td.grid-rownum",that.rows).each(function(i){$(this).html(base+1+i)})}if(dnd&&that.options.jqgdnd){$(that.element).grid("gridDnD","updateDnD")}that._trigger("onComplete",null,[]);that._trigger("afterComplete",null,[])},_paginators:function(){var that=this;var cp=that._intNum(that.options.page,1),last=that._intNum(that.options.lastpage,1),selclick=false;var le=3,begin=cp>2?cp+2-le:1,end,pages="";end=le+begin>last?last+1:le+begin;if(begin>3&&end<=last+2){begin=end-le}if(cp>2&&last>le){if(begin>=2){pages+="<span class='coral-paginator-page coral-state-default coral-corner-all'  tabindex='0'>1</span>"}if(begin>=3){pages+="<span class='coral-paginator-page coral-state-default coral-corner-all'  tabindex='0'>2</span>"}if(begin!=3&&begin!=1&&begin!=2){pages+="<span class='coral-page-pointer'>...</span>"}}for(var i=begin;i<end;
i++){if(cp==i){pages+="<span class='coral-paginator-page coral-state-default coral-state-active coral-corner-all'  tabindex='0'>"+i+"</span>"}else{pages+="<span class='coral-paginator-page coral-state-default coral-corner-all'  tabindex='0'>"+i+"</span>"}}if(end==last){pages+="<span class='coral-paginator-page coral-state-default coral-corner-all'>"+last+"</span>"}else{if(end<=last){pages+="<span class='coral-page-pointer'>...</span><span class='coral-paginator-page coral-state-default coral-corner-all'>"+last+"</span>"}}$(".coral-paginator-pages",that.element).html(pages)},_populate:function(npage){var that=this,isPicgrid=!!(that.options.model=="card");var grid=that.grid;if(true){var pvis=that.options.scroll&&npage===false,prm={},dt,dstr,pN=that.options.prmNames;if(that.options.page<=0){that.options.page=1}if(pN.search!==null){prm[pN.search]=that.options.search}if(pN.nd!==null){prm[pN.nd]=new Date().getTime()}if(pN.rows!==null){prm[pN.rows]=that.options.rowNum}if(pN.page!==null){prm[pN.page]=that.options.page}if(pN.sort!==null){prm[pN.sort]=that.options.sortname}if(pN.order!==null){prm[pN.order]=that.options.sortorder}if(that.options.rowTotal!==null&&pN.totalrows!==null){prm[pN.totalrows]=that.options.rowTotal}var lc=function(req){that._trigger("onLoad",null,[req]);if(that.options.afterSortableRows&&$.fn.sortable){try{$(that.element).grid("sortableRows")}catch(e){}}};var adjust=0;npage=npage||1;if(npage>1){if(pN.npage!==null){prm[pN.npage]=npage;adjust=npage-1;npage=1}else{lc=function(req){that.options.page++;grid.columnsView.loading=false;that._trigger("onLoad",null,[req]);that._populate(npage-1)}}}else{if(pN.npage!==null){delete that.options.postData[pN.npage]}}if(that.options.grouping){this.groupingSetup();var grp=that.options.groupingView,gi,gs="";for(gi=0;gi<grp.groupField.length;gi++){var index=grp.groupField[gi];$.each(that.options.colModel,function(cmIndex,cmValue){if(cmValue.name===index&&cmValue.index){index=cmValue.index}});gs+=index+" "+grp.groupOrder[gi]+", "
}prm[pN.sort]=gs+prm[pN.sort]}if(that.options.containSortOrder&&prm[pN.sort]&&prm[pN.order]){prm[pN.sort]=prm[pN.sort]+that.options.sortSeparator+prm[pN.order]}$.extend(that.options.postData,prm);var rcnt=!that.options.scroll?1:that.rows.length-1;var bfr=that._trigger("beforeRequest",null,[]);if(bfr===false||bfr==="stop"){return}if($.isFunction(that.options.datatype)){that.options.datatype.call(that,that.options.postData,"load_"+that.options.id);return}dt=that.options.datatype.toLowerCase();if(!(that.options.b_sortdata&&that.options.b_sortdata===true)&&that.options.orgdatatype){dt=that.options.orgdatatype;that.options.datatype=dt}if(that.options.localonce){dt="local"}if(this.options.initData){dt="initinlocal"}var success=function(content,st,xhr){if(that.options.loadonce){that.options.orgdatatype=dt}if(!that._trigger("beforeProcessing",null,[{content:content,state:st,xhr:xhr}])){that._endReq();return}else{that._addJSONData(content,grid.rowsView,rcnt,npage>1,adjust)}if(!isPicgrid){that._hasScrollOffset()}if(lc){lc.call(that,content)}that._trigger("afterLoad",null,[{content:content}]);if(pvis){grid.populateVisible()}if(that.options.loadonce||that.options.treeGrid){that.options.datatype="local";that.options.orgpage=that.options.page}if(npage===1){that._endReq()}var dReader,drows;if(that.options.orgdatatype=="local"){dReader=that.options.localReader}else{dReader=that.options.jsonReader}drows=$.grid.getAccessor(content,dReader.root);if(drows.length==0&&parseInt(that.options.page)!=1&&parseInt(that.options.lastpage)<parseInt(that.options.page)){$(that.element).grid("reload",{page:that.options.lastpage})}content=null;that.refresh()};switch(dt){case"initinlocal":dt="json";success(that.options.initData,null,null);this.options.initData=false;break;case"json":case"jsonp":if(this.xhr){this.xhr.abort()}this.xhr=$.ajax(this._ajaxSettings());this.xhr.success(function(content,st,xhr){success(content,st,xhr)}).error(function(xhr,st,err){that._trigger("onLoadError",null,[{xhr:xhr,st:st,err:err}]);
if(npage===1){that._endReq()}xhr=null;that.refresh()}).complete(function(jqXHR,status){if(jqXHR===that.xhr){that.xhr=null}});break;case"local":case"clientside":that._beginReq();that.options.datatype="local";var req=that._addLocalData();this._addJSONData(req,grid.rowsView,rcnt,npage>1,adjust);if(!that.options.b_sortdata){that.refresh();if(lc){lc.call(that,req)}that._trigger("AfterLoad",null,[req]);if(pvis){grid.populateVisible()}}that._endReq();if(that.options.frozenColumns){that._setFrozenHeight()}break}}},_setFrozenHeight:function(){var that=this,rowId="",headHeight=0,frozenHeight=0,normalHeight=0;if(this.grid.fhDiv){headHeight=this.grid.fhDiv.height();this.grid.fbDiv.css("top",headHeight);$("tr",that.grid.fbDiv).slice(1).each(function(){rowId=$(this).attr("id");frozenHeight=parseFloat($("td:first",this).height());normalHeight=parseFloat($("#"+rowId,that.gridRows).find("td:first").height());if(frozenHeight<normalHeight){$("td",this).each(function(){$(this).height(normalHeight)})}else{if(frozenHeight>normalHeight){$("td",$("#"+rowId,that.gridRows)).each(function(){$(this).height(frozenHeight)})}}})}if(this.grid.rightfhDiv){headHeight=this.grid.rightfhDiv.height();this.grid.rightfbDiv.css("top",headHeight);$("tr",that.grid.rightfbDiv).slice(1).each(function(){rowId=$(this).attr("id");frozenHeight=parseFloat($("td:first",this).height());normalHeight=parseFloat($("#"+rowId,that.gridRows).find("td:first").height());if(frozenHeight<normalHeight){$("td",this).each(function(){$(this).height(normalHeight)})}else{if(frozenHeight>normalHeight){$("td",$("#"+rowId,that.gridRows)).each(function(){$(this).height(frozenHeight)})}}})}},_ajaxSettings:function(){var that=this,opts=this.options;return $.extend({url:opts.url,type:opts.asyncType,beforeSend:function(xhr,settings){var gotoreq=true;gotoreq=that._trigger("beforeSend",null,{xhr:xhr,settings:settings});if(gotoreq===undefined){gotoreq=true}if(gotoreq===false){return false}else{that._beginReq()}},data:$.isFunction(opts.serializeGridData)?opts.serializeGridData.call(this,opts.postData):opts.postData,dataType:opts.datatype},$.grid.ajaxOptions,opts.ajaxGridOptions)
},_reader:function(datatype){var that=this;var field,f=[],j=0,i;for(i=0;i<this.options.colModel.length;i++){field=this.options.colModel[i];if(field.name!=="cb"&&field.name!=="subgrid"&&field.name!=="rn"){f[j]=datatype=="local"?field.name:((datatype=="xml"||datatype==="xmlstring")?field.xmlmap||field.name:field.jsonmap||field.name);if(that.options.keyName!==false&&field.key===true){that.options.keyName=f[j]}j++}}return f},_addMulti:function(rowid,pos,irow,checked){var that=this,isPicgrid=!!(that.options.model=="card"),v='<input role="checkbox" type="checkbox" id="jqg_'+that.options.id+"_"+rowid+'" class="cbox" name="jqg_'+that.options.id+"_"+rowid+'"'+(checked?'checked="checked"':"")+"/>",prp=that._formatCol(pos,irow,"",null,rowid,true);if(isPicgrid){return v}return'<td role="gridcell" '+prp+">"+v+"</td>"},_addSingle:function(rowid,pos,irow){var that=this,isPicgrid=!!(that.options.model=="card"),v='<input role="radio" type="radio" id="jqg_'+that.options.id+"_"+rowid+'" class="cbox" name="jqg_'+that.options.id+'"/>',prp=that._formatCol(pos,irow,"",null,rowid,true);if(isPicgrid){return v}return'<td role="gridcell" '+prp+">"+v+"</td>"},_addRowNum:function(pos,irow,pG,rN){var v=(parseInt(pG,10)-1)*parseInt(rN,10)+1+irow,prp=this._formatCol(pos,irow,v,null,irow,true);return'<td role="gridcell" class="coral-state-default grid-rownum" '+prp+">"+v+"</td>"},_customPanel:function(rd,ni,muti){var that=this,itemJson={},coreData="",itemData="",toolbarsData="",buttonsData="";var fun=$.coral.toFunction(that.options.picTemplate);if($.isFunction(fun)){itemJson=fun.apply("picTemplate",[{rowData:rd,ni:ni,muti:muti,getData:true}])}if(typeof(itemJson)=="undefined"){return""}var src=itemJson.src;if(!src){src="src"}coreData=itemJson.coreData||"<img src='"+rd.src+"'/>";itemData=itemJson.itemData||"";toolbarsData=itemJson.toolbarsData||"";buttonsData=itemJson.buttonsData||"";var ui=[];ui.push("<ul class='rowgrid coral-component-content coral-corner-all'>");ui.push("<li class='gridModel1 gridModel'>");
if(coreData.length>0){ui.push(coreData)}ui.push("<div class='valigh-fix'></div>");if(toolbarsData.length>0){ui.push("<div class='gridtoolbars'><div class='bgopacity'>&#160;</div>"+toolbarsData+"</div>")}ui.push("</li>");if(itemData.length>0){ui.push("<li class='gridModel2 gridModel'>");ui.push("<div class='griditem'>"+itemData+"</div>");ui.push("</li>")}if(muti.length>0||buttonsData.length>0){ui.push("<li class='gridModel3 gridModel'>");if(itemData.length>0||buttonsData.length>0){ui.push("<ul class='griditem'>");if(muti.length>0){ui.push("<li class='gridCheckbox'>"+muti+"</li>")}if(buttonsData.length>0){ui.push("<li class='gridbuttons'>"+buttonsData+"</li>")}ui.push("</ul>")}ui.push("</li>")}ui.push("</ul>");return ui.join("")},_addJSONData:function(data,t,rcnt,more,adjust){var that=this,isPicgrid=!!(that.options.model=="card");var startReq=new Date();if(data){if(that.options.treeANode===-1&&!that.options.scroll){that.emptyRows(t,false,true);rcnt=1}else{rcnt=rcnt>1?rcnt:1}}else{return}var dReader,locid="_id_",frd,locdata=(that.options.datatype!="local"&&that.options.loadonce)||that.options.datatype=="jsonstring";if(locdata){that.options.data=[];that.options._index={};that.options.localReader.id=locid}that.options.reccount=0;if(that.options.datatype=="local"){dReader=that.options.localReader;frd="local"}else{dReader=that.options.jsonReader;frd="json"}var self=this,ir=0,v,i,j,f=[],F,cur,gi=that.options.multiselect?1:0,si=that.options.subGrid?1:0,ni=that.options.rownumbers===true?1:0,len,drows,idn,rd={},fpos,idr,rowData=[],orgRowData=[],buttonsData=[],cn=(that.options.altRows===true)?" "+that.options.altclass:"",cn1,lp;if(gi==0){gi=that.options.singleselect?1:0}that.options.page=$.grid.getAccessor(data,dReader.page)||0;lp=$.grid.getAccessor(data,dReader.total);that.options.lastpage=lp===undefined?1:lp;that.options.records=$.grid.getAccessor(data,dReader.records)||0;that.options.total=$.grid.getAccessor(data,dReader.total)||0;that.options.userData=$.grid.getAccessor(data,dReader.userData)||{};
if(!dReader.repeatitems){F=f=that._reader(frd)}if(that.options.keyName===false){idn=$.isFunction(dReader.id)?dReader.id.call(that,data):dReader.id}else{idn=that.options.keyName}if(f.length>0&&!isNaN(idn)){if(that.options.remapColumns&&that.options.remapColumns.length){idn=$.inArray(idn,that.options.remapColumns)}idn=f[idn]}drows=$.grid.getAccessor(data,dReader.root);if(!drows){drows=[]}len=drows.length;i=0;if(len>0&&that.options.page<=0){that.options.page=1}var rn=parseInt(that.options.rowNum,10),br=that.options.scroll?$.grid.randId():1,altr,selected=false,selr;if(adjust){rn*=adjust+1}if(that.options.datatype==="local"&&!that.options.deselectAfterSort){selected=true}var afterInsRow=$.isFunction(that.options.afterInsertRow),grpdata=[],hiderow=false,groupingPrepare;if(that.options.grouping){hiderow=that.options.groupingView.groupCollapse===true;groupingPrepare=this.groupingPrepare}while(i<len){cur=drows[i];idr=$.grid.getAccessor(cur,idn);if(idr===undefined){idr=br+i;if(f.length===0){if(dReader.cell){var ccur=$.grid.getAccessor(cur,dReader.cell);idr=ccur!==undefined?ccur[idn]||idr:idr;ccur=null}}}idr=that.options.idPrefix+idr;altr=rcnt===1?0:rcnt;cn1=(altr+i)%2==1?cn:"";if(selected){if(that.options.multiselect){selr=($.inArray(idr,that.options.selarrrow)!==-1)}else{selr=(idr===that.options.selrow)}}var iStartTrTag=rowData.length;var iStartPicTag=orgRowData.length;rowData.push("");if(ni){rowData.push(that._addRowNum(0,i,that.options.page,that.options.rowNum))}if(gi){if(that.options.singleselect){rowData.push(that._addSingle(idr,ni,i,selr));buttonsData.push(that._addSingle(idr,ni,i,selr))}else{rowData.push(that._addMulti(idr,ni,i,selr));buttonsData.push(that._addMulti(idr,ni,i,selr))}}if(si){rowData.push($(that.element).grid("addSubGridCell",gi+ni,i+rcnt))}if(dReader.repeatitems){if(dReader.cell){cur=$.grid.getAccessor(cur,dReader.cell)}if(!F){F=this._orderedCols(gi+si+ni)}}for(j=0;j<F.length;j++){v=$.grid.getAccessor(cur,F[j]);rd[that.options.colModel[j+gi+si+ni].name]=v;
rowData.push(this._addCell(idr,v,j+gi+si+ni,i+rcnt,cur,rd))}if(that.options.model=="card"){orgRowData[iStartTrTag]=that.constructPanel(idr,hiderow,cn1,rd,cur);orgRowData.push(that._customPanel(rd,ni,buttonsData));orgRowData.push("</li>")}else{rowData[iStartTrTag]=that.constructTr(idr,hiderow,cn1,rd,cur,selr);rowData.push("</tr>")}if(that.options.grouping){grpdata.push(rowData);if(!that.options.groupingView._locgr){groupingPrepare.call(self,rd,i)}rowData=[]}if(locdata||that.options.treeGrid===true){rd[locid]=idr;that.options.data.push(rd);that.options._index[idr]=that.options.data.length-1}if(that.options.gridview===false){if(isPicgrid){$("#"+$.grid.coralID(that.options.id)+" .coral-pic").append(orgRowData.join(""))}else{$("#"+$.grid.coralID(that.options.id)+" .coral-grid-btable tbody:first").append(rowData.join(""))}$(that).triggerHandler("gridAfterInsertRow",[idr,rd,cur]);if(afterInsRow){that.options.afterInsertRow.call(that,idr,rd,cur)}rowData=[];orgRowData=[];buttonsData=[]}$.fn.afterFmatter.call(that);rd={};ir++;i++;if(ir==rn){break}}if(that.options.gridview===true){fpos=that.options.treeANode>-1?that.options.treeANode:0;if(that.options.grouping){if(!locdata){this.groupingRender(grpdata,that.options.colModel.length,that.options.page,rn);grpdata=null}}else{if(that.options.treeGrid===true&&fpos>0){$(that.rows[fpos]).after(rowData.join(""))}else{$("#"+$.grid.coralID(that.options.id)+" tbody:first").append(rowData.join(""))}}}if(that.options.subGrid===true){try{$(that.element).grid("addSubGrid",gi+ni)}catch(_){}}that.options.totaltime=new Date()-startReq;if(ir>0){if(that.options.records===0){that.options.records=len}}rowData=null;if(that.options.treeGrid===true){try{$(that.element).grid("setTreeNode",fpos+1,ir+fpos+1)}catch(e){}}if(!that.options.treeGrid&&!that.options.scroll&&!isPicgrid){that.grid.rowsView.scrollTop=0}that.options.reccount=ir;that.options.treeANode=-1;if(that.options.userDataOnFooter){$(that).grid("footerData","set",that.options.userData,true)}if(locdata&&!that.options.orgdatatype){that.options.records=len;
that.options.lastpage=Math.ceil(len/rn)}if(!more){that._updatepager(false,true)}if(locdata){while(ir<len&&drows[ir]){cur=drows[ir];idr=$.grid.getAccessor(cur,idn);if(idr===undefined){idr=br+ir;if(f.length===0){if(dReader.cell){var ccur2=$.grid.getAccessor(cur,dReader.cell);idr=ccur2[idn]||idr;ccur2=null}}}if(cur){idr=that.options.idPrefix+idr;if(dReader.repeatitems){if(dReader.cell){cur=$.grid.getAccessor(cur,dReader.cell)}if(!F){F=that._orderedCols(gi+si+ni)}}for(j=0;j<F.length;j++){v=$.grid.getAccessor(cur,F[j]);rd[that.options.colModel[j+gi+si+ni].name]=v}rd[locid]=idr;if(that.options.grouping){groupingPrepare.call(self,rd,ir)}that.options.data.push(rd);that.options._index[idr]=that.options.data.length-1;rd={}}ir++}if(that.options.grouping){that.options.groupingView._locgr=true;this.groupingRender(grpdata,that.options.colModel.length,that.options.page,rn);grpdata=null}}},_addLocalData:function(){var that=this;var st,fndsort=false,cmtypes={},grtypes=[],grindexes=[],srcformat,sorttype,newformat;if(!$.isArray(that.options.data)){return}var grpview=that.options.grouping?that.options.groupingView:false,lengrp,gin;$.each(that.options.colModel,function(){sorttype=this.sorttype||"text";if(sorttype=="date"||sorttype=="datetime"){if(this.formatter&&typeof(this.formatter)==="string"&&this.formatter=="date"){if(this.formatoptions&&this.formatoptions.srcformat){srcformat=this.formatoptions.srcformat}else{srcformat=$.grid.formatter.date.srcformat}if(this.formatoptions&&this.formatoptions.newformat){newformat=this.formatoptions.newformat}else{newformat=$.grid.formatter.date.newformat}}else{srcformat=newformat=this.datefmt||"Y-m-d"}cmtypes[this.name]={stype:sorttype,srcfmt:srcformat,newfmt:newformat}}else{cmtypes[this.name]={stype:sorttype,srcfmt:"",newfmt:""}}if(that.options.grouping){for(gin=0,lengrp=grpview.groupField.length;gin<lengrp;gin++){if(this.name===grpview.groupField[gin]){var grindex=this.name;if(this.index){grindex=this.index}grtypes[gin]=cmtypes[grindex];grindexes[gin]=grindex
}}}if(!fndsort&&(this.index==that.options.sortname||this.name==that.options.sortname)){st=this.name;fndsort=true}});if(that.options.treeGrid){$(that.element).grid("sortTree",st,that.options.sortorder,cmtypes[st].stype,cmtypes[st].srcfmt);return}var compareFnMap={eq:function(queryObj){return queryObj.equals},ne:function(queryObj){return queryObj.notEquals},lt:function(queryObj){return queryObj.less},le:function(queryObj){return queryObj.lessOrEquals},gt:function(queryObj){return queryObj.greater},ge:function(queryObj){return queryObj.greaterOrEquals},cn:function(queryObj){return queryObj.contains},nc:function(queryObj,op){return op==="OR"?queryObj.orNot().contains:queryObj.andNot().contains},bw:function(queryObj){return queryObj.startsWith},bn:function(queryObj,op){return op==="OR"?queryObj.orNot().startsWith:queryObj.andNot().startsWith},en:function(queryObj,op){return op==="OR"?queryObj.orNot().endsWith:queryObj.andNot().endsWith},ew:function(queryObj){return queryObj.endsWith},ni:function(queryObj,op){return op==="OR"?queryObj.orNot().equals:queryObj.andNot().equals},"in":function(queryObj){return queryObj.equals},nu:function(queryObj){return queryObj.isNull},nn:function(queryObj,op){return op==="OR"?queryObj.orNot().isNull:queryObj.andNot().isNull}},query=$.grid.from(that.options.data);if(that.options.ignoreCase){query=query.ignoreCase()}function tojLinq(group){var s=0,index,gor,ror,opr,rule;if(group.groups!==undefined){gor=group.groups.length&&group.groupOp.toString().toUpperCase()==="OR";if(gor){query.orBegin()}for(index=0;index<group.groups.length;index++){if(s>0&&gor){query.or()}try{tojLinq(group.groups[index])}catch(e){alert(e)}s++}if(gor){query.orEnd()}}if(group.rules!==undefined){if(s>0){var result=query.select();query=$.grid.from(result);if(that.options.ignoreCase){query=query.ignoreCase()}}try{ror=group.rules.length&&group.groupOp.toString().toUpperCase()==="OR";if(ror){query.orBegin()}for(index=0;index<group.rules.length;index++){rule=group.rules[index];
opr=group.groupOp.toString().toUpperCase();if(compareFnMap[rule.op]&&rule.field){if(s>0&&opr&&opr==="OR"){query=query.or()}query=compareFnMap[rule.op](query,opr)(rule.field,rule.data,cmtypes[rule.field])}s++}if(ror){query.orEnd()}}catch(g){alert(g)}}}if(that.options.search===true){var srules=that.options.postData.filters;if(srules){if(typeof srules=="string"){srules=$.grid.parse(srules)}tojLinq(srules)}else{try{query=compareFnMap[that.options.postData.searchOper](query)(that.options.postData.searchField,that.options.postData.searchString,cmtypes[that.options.postData.searchField])}catch(se){}}}if(that.options.grouping){for(gin=0;gin<lengrp;gin++){query.orderBy(grindexes[gin],grpview.groupOrder[gin],grtypes[gin].stype,grtypes[gin].srcfmt)}}if(st&&that.options.sortorder&&fndsort){if(that.options.sortorder.toUpperCase()=="DESC"){query.orderBy(that.options.sortname,"d",cmtypes[st].stype,cmtypes[st].srcfmt)}else{query.orderBy(that.options.sortname,"a",cmtypes[st].stype,cmtypes[st].srcfmt)}}var queryResults=query.select(),ret=that._trigger("afterFilter",null,[{queryResults:query.select(),getData:true}])["result"];if(ret){queryResults=ret}var recordsperpage=parseInt(that.options.rowNum,10),total=queryResults.length,page=parseInt(that.options.page,10),totalpages=Math.ceil(total/recordsperpage),retresult={};if((that.options.search||that.options.resetsearch)&&that.options.grouping&&that.options.groupingView._locgr){that.options.groupingView.groups=[];var j,grPrepare=that.groupingPrepare,key,udc;if(that.options.footerrow&&that.options.userDataOnFooter){for(key in that.options.userData){if(that.options.userData.hasOwnProperty(key)){that.options.userData[key]=0}}udc=true}for(j=0;j<total;j++){if(udc){for(key in that.options.userData){that.options.userData[key]+=parseFloat(queryResults[j][key]||0)}}grPrepare.call($(this),queryResults[j],j,recordsperpage)}}queryResults=queryResults.slice((page-1)*recordsperpage,page*recordsperpage);query=null;cmtypes=null;if(that.options.orgdatatype){retresult[that.options.localReader.total]=that.options.lastpage;
retresult[that.options.localReader.page]=that.options.orgpage;retresult[that.options.localReader.records]=that.options.records}else{retresult[that.options.localReader.total]=totalpages;retresult[that.options.localReader.page]=page;retresult[that.options.localReader.records]=total}retresult[that.options.localReader.root]=queryResults;retresult[that.options.localReader.userData]=that.options.userData;queryResults=null;return retresult},getColProp:function(colname){var ret={},that=this;if(!that.grid){return false}var cM=that.options.colModel;for(var i=0;i<cM.length;i++){if(cM[i].name==colname){ret=cM[i];break}}return ret},setColProp:function(colname,obj){if(this.grid){if(obj){var cM=this.options.colModel;for(var i=0;i<cM.length;i++){if(cM[i].name==colname){$.extend(this.options.colModel[i],obj);break}}}}},destroyGroupHeader:function(nullHeader){if(typeof(nullHeader)=="undefined"){nullHeader=true}var that=this,$tr,i,l,headers,$th,$resizing,grid=that.grid,thead=$("table.coral-grid-htable thead",grid.columnsView),cm=that.options.colModel,hc;if(!grid){return}$(this.element).unbind(".setGroupHeaders");$tr=$("<tr>",{role:"rowheader"}).addClass("coral-grid-labels");headers=grid.headers;for(i=0,l=headers.length;i<l;i++){hc=cm[i].hidden?"none":"";$th=$(headers[i].el).width(headers[i].width).css("display",hc);try{$th.removeAttr("rowSpan")}catch(rs){$th.attr("rowSpan",1)}$tr.append($th);$resizing=$th.children("span.coral-grid-resize");if($resizing.length>0){$resizing[0].style.height=""}$th.children("div")[0].style.top=""}$(thead).children("tr.coral-grid-labels").remove();$(thead).prepend($tr);if(nullHeader===true){$(that.element).grid("option",{groupHeader:null})}},setGroupHeaders:function(o){o=$.extend({useColSpanStyle:false,groupHeaders:[]},o||{});this.options.groupHeader=o;var that=this,i,cmi,skip=0,$tr,$colHeader,th,$th,thStyle,iCol,cghi,numberOfColumns,titleText,cVisibleColumns,colModel=that.options.colModel,cml=colModel.length,ths=that.grid.headers,$htable=$("table.coral-grid-htable",that.grid.columnsView),$trLabels=$htable.children("thead").children("tr.coral-grid-labels:last").addClass("jqg-second-row-header"),$thead=$htable.children("thead"),$theadInTable,$firstHeaderRow=$htable.find(".jqg-first-row-header");
if($firstHeaderRow[0]===undefined){$firstHeaderRow=$("<tr>",{role:"row","aria-hidden":"true"}).addClass("jqg-first-row-header").css("height","auto")}else{$firstHeaderRow.empty()}var $firstRow,inColumnHeader=function(text,columnHeaders){var i=0,length=columnHeaders.length;for(;i<length;i++){if(columnHeaders[i].startColumnName===text){return i}}return -1};that.element.find(".coral-grid-columns-view>table").prepend($thead);$tr=$("<tr>",{role:"rowheader"}).addClass("coral-gird-labels jqg-third-row-header");for(i=0;i<cml;i++){th=ths[i].el;$th=$(th);cmi=colModel[i];thStyle={height:"0px",width:ths[i].width+"px",display:(cmi.hidden?"none":"")};$("<th>",{role:"gridcell"}).css(thStyle).addClass("coral-first-th-"+that.options.direction).appendTo($firstHeaderRow);th.style.width="";iCol=inColumnHeader(cmi.name,o.groupHeaders);if(iCol>=0){cghi=o.groupHeaders[iCol];numberOfColumns=cghi.numberOfColumns;titleText=cghi.titleText;for(cVisibleColumns=0,iCol=0;iCol<numberOfColumns&&(i+iCol<cml);iCol++){if(!colModel[i+iCol].hidden){cVisibleColumns++}}$colHeader=$("<th>").attr({role:"columnheader"}).addClass("coral-state-default coral-th-column-header coral-th-"+that.options.direction).css({"border-top":"0px none"}).html(titleText);if(cVisibleColumns>0){$colHeader.attr("colspan",String(cVisibleColumns))}if(that.options.headertitles){$colHeader.attr("title",$colHeader.text())}if(cVisibleColumns===0){$colHeader.hide()}$th.before($colHeader);$tr.append(th);skip=numberOfColumns-1}else{if(skip===0){if(o.useColSpanStyle){$th.attr("rowspan","2")}else{$("<th>",{role:"columnheader"}).addClass("coral-state-default coral-th-column-header coral-th-"+that.options.direction).css({display:cmi.hidden?"none":"","border-top":"0px none"}).insertBefore($th);$tr.append(th)}}else{$tr.append(th);skip--}}}$theadInTable=$(that.element).find(".coral-grid-htable").children("thead");$theadInTable.prepend($firstHeaderRow);$tr.insertAfter($trLabels);$htable.append($theadInTable);if(o.useColSpanStyle){$htable.find("span.coral-gird-resize").each(function(){var $parent=$(this).parent();
if($parent.is(":visible")){this.style.cssText="height: "+$parent.height()+"px !important; cursor: col-resize;"}});$htable.find("div.coral-gird-sortable").each(function(){var $that=$(this),$parent=$that.parent();if($parent.is(":visible")&&$parent.is(":has(span.coral-gird-resize)")){$that.css("top",($parent.height()-$that.outerHeight())/2+"px")}})}$firstRow=$theadInTable.find("tr.jqg-first-row-header");$(that.element).bind("gridonresizestop.setGroupHeaders",function(e,nw,idx){$firstRow.find("th").eq(idx).width(nw)})},getGridParam:function(pName){var that=this;if(!that||!that.grid){return}if(!pName){return that.p}else{return typeof(that.options[pName])!="undefined"?that.options[pName]:null}},setGridParam:function(newParams){if(this.grid&&typeof(newParams)==="object"){$.extend(true,this.options,newParams)}},_setOption:function(key,value){var that=this,options=this.options;if(this.grid){$.extend(true,options[key],value)}if(key=="height"){that._setGridHeight(value);that._hasScrollOffset()}if(key=="width"){that._setGridWidth(value);that._hasScrollOffset()}if(key=="model"){if(value=="grid"){that.pic.hide();that.gridRows.show();that.gridColumns.show()}else{if(value=="card"){that.gridRows.hide();that.gridColumns.hide();that.pic.show()}}}this._super(key,value)},_hasScrollOffset:function(){var that=this,grid=this.grid;if(grid.rowsView.style.overflow!="hidden"&&grid.rowsView.scroll!="no"&&grid.rowsView.scrollHeight>grid.rowsView.offsetHeight){$(grid.columnsView).css("padding-right",that.options.scrollOffset+"px");return true}else{$(grid.columnsView).css("padding-right","");$(grid.rowsView).css("padding-right","");return false}},_hasHorizontalScrollBar:function(){var that=this,grid=this.grid;var fw=that.rightFrozenWidth;if(grid.rowsView.style.overflow!="hidden"&&grid.rowsView.scroll!="no"&&(grid.rowsView.scrollWidth-grid.rowsView.clientWidth)>0){return true}else{return false}},_setGridWidth:function(nwidth,shrink){if(!this.grid||nwidth==0||!this.rows){return}var that=this,grid=this.grid,cw,initwidth=0,brd=$.support.boxSizing?0:that.options.cellLayout,lvc,vc=0,hs=false,scw=that.options.scrollOffset,aw,gw=0,cl=0,cr;
if(typeof shrink!="boolean"){shrink=that.options.shrinkToFit}if(isNaN(nwidth)){return}else{nwidth=parseInt(nwidth,10);that.grid.width=that.options.width=nwidth}if(shrink===false&&that.options.forceFit===true){that.options.forceFit=false}$.each(that.options.colModel,function(){if((this.hidden===false||typeof(this.hidden)=="undefined")){cw=this.widthOrg?this.widthOrg:parseInt(this.width,10);initwidth+=cw+brd;if(this.fixed){gw+=cw+brd}else{vc++}cl++}});var useMinWidth=false;if(that.options.minWidth&&initwidth>$(that.element).width()){useMinWidth=true}if(shrink===true||useMinWidth){if(vc===0){return}that.options.tblwidth=initwidth;aw=nwidth-brd*vc-gw;if(!isNaN(that.options.height)){if($(that.grid.rowsView)[0].clientHeight<$(that.grid.rowsView)[0].scrollHeight||that.rows.length===1){hs=true;aw-=scw}}initwidth=0;var cle=that.grid.cols.length>0;$.each(that.options.colModel,function(i){if((this.hidden===false||typeof(this.hidden)=="undefined")&&!this.fixed){cw=this.widthOrg?this.widthOrg:parseInt(this.width,10);if(!useMinWidth){cw=Math.round(aw*cw/(that.options.tblwidth-brd*vc-gw))}if(cw<0){return}this.width=cw;initwidth+=cw;that.grid.headers[i].width=cw;that.grid.headers[i].el.style.width=cw+"px";var groupHeader=$("tr.jqg-first-row-header>th:eq("+i+")",$("table:first",that.grid.columnsView));if(groupHeader.length>0){groupHeader[0].style.width=cw+"px"}if(that.options.footerrow){that.grid.footers[i].style.width=cw+"px"}if(cle){that.grid.cols[i].style.width=(cw)+"px"}lvc=i}});if(!lvc){return}cr=0;if(!useMinWidth){if(hs){if(nwidth-gw-(initwidth+brd*vc)!==scw){cr=nwidth-gw-(initwidth+brd*vc)-scw}}else{if(Math.abs(nwidth-gw-(initwidth+brd*vc))!==1){cr=nwidth-gw-(initwidth+brd*vc)}}that.options.colModel[lvc].width+=(cr-1)}else{cr=that.options.colModel[lvc].width}that.options.tblwidth=initwidth+cr+brd*vc+gw;if(that.options.tblwidth>nwidth){var delta=that.options.tblwidth-parseInt(nwidth,10);that.options.tblwidth=nwidth;cw=that.options.colModel[lvc].width=that.options.colModel[lvc].width-delta
}else{cw=that.options.colModel[lvc].width}that.grid.headers[lvc].width=cw;that.grid.headers[lvc].el.style.width=cw+"px";if(cle){that.grid.cols[lvc].style.width=cw+"px"}}$(grid.rowsView).width(nwidth);$(grid.columnsView).width(nwidth);if(that.options.tblwidth){$("table:first",grid.rowsView).css("width",that.options.tblwidth+"px");$("table:first",grid.columnsView).css("width",that.options.tblwidth+"px");that.grid.columnsView.scrollLeft=that.grid.rowsView.scrollLeft;if(that.options.footerrow){$("table:first",that.grid.sDiv).css("width",that.options.tblwidth+"px")}}},_setGridHeight:function(nh){var that=this,grid=that.grid,isPicgrid=!!(that.options.model=="card");if(!that.grid){return}var rowsView=$(that.grid.rowsView);if(that.options.frozenColumns===true){$("#"+$.grid.coralID(that.options.id)+"_frozen").parent().height(rowsView.height()-16)}var tblHeight="auto";if(String(nh).toLowerCase()==="auto"){nh="auto";tblHeight="auto";that.pic.css({height:"auto"});rowsView.css({height:"auto"})}else{tblHeight=nh-that.element.find(".coral-grid-pager").height()-$(grid.caption).height();that.pic.css({height:tblHeight+(isNaN(tblHeight)?"":"px")});tblHeight=nh-$(grid.columnsView).outerHeight(true)-that.element.find(".coral-grid-pager").outerHeight(true)-$(grid.caption).height();rowsView.css({height:tblHeight+(isNaN(tblHeight)?"":"px")})}that.options.height=nh;if(that.options.scroll){that.grid.populateVisible()}},getDataIDs:function(){var ids=[],i=0,len,j=0;len=this.rows.length;if(len&&len>0){while(i<len){if($(this.rows[i]).hasClass("jqgrow")){ids[j]=this.rows[i].id;j++}i++}}return ids},setRowData:function(rowid,data,cssp){var that=this,nm,success=true,title;if(!this.grid){return false}var t=this,vl,ind,cp=typeof cssp,lcdata={};ind=t.rows.namedItem(rowid);if(!ind){return false}if(data){try{$(this.options.colModel).each(function(i){nm=this.name;if(data[nm]!==undefined){lcdata[nm]=this.formatter&&typeof(this.formatter)==="string"&&this.formatter=="date"?$.unformat.date.call(t,data[nm],this):data[nm];
vl=t._formatter(rowid,data[nm],i,data,"edit");title=this.title?{title:$.grid.stripHtml(vl)}:{};if(t.options.treeGrid===true&&nm==t.options.ExpandColumn){$("td:eq("+i+") > span:first",ind).html(vl).attr(title)}else{$("td:eq("+i+")",ind).html(vl).attr(title)}$.fn.afterFmatter.call(that)}});if(t.options.datatype=="local"){var id=$.grid.stripPref(t.options.idPrefix,rowid),pos=t.options._index[id];if(t.options.treeGrid){for(var key in t.options.treeReader){if(lcdata.hasOwnProperty(t.options.treeReader[key])){delete lcdata[t.options.treeReader[key]]}}}if(typeof(pos)!="undefined"){t.options.data[pos]=$.extend(true,t.options.data[pos],lcdata)}lcdata=null}}catch(e){success=false}}if(success){if(cp==="string"){$(ind).addClass(cssp)}else{if(cp==="object"){$(ind).css(cssp)}}t._trigger("aftercomplete")}return success},delRowData:function(rowid){var success=false,rowInd,ia,ri;var that=this;var isPicgrid=!!(that.options.model=="card");if(isPicgrid){rowInd=that.pic.children("#"+rowid)[0];if(!rowInd){return false}else{$(rowInd).remove();that.options.records--;that.options.reccount--;that._updatepager(true,false);success=true;if(that.options.multiselect){ia=$.inArray(rowid,that.options.selarrrow);if(ia!=-1){that.options.selarrrow.splice(ia,1)}}if(rowid==that.options.selrow){that.options.selrow=null}}if(that.options.datatype=="local"){var id=$.grid.stripPref(that.options.idPrefix,rowid),pos=that.options._index[id];if(typeof(pos)!="undefined"){that.options.data.splice(pos,1);that.refreshIndex()}}}else{rowInd=that.rows.namedItem(rowid);if(!rowInd){return false}else{ri=rowInd.rowIndex;$(rowInd).remove();that.options.records--;that.options.reccount--;that._updatepager(true,false);success=true;if(that.options.multiselect){ia=$.inArray(rowid,that.options.selarrrow);if(ia!=-1){that.options.selarrrow.splice(ia,1)}}if(rowid==that.options.selrow){that.options.selrow=null}if(rowid==that.options.editrow){that.options.editrow=null;that.rowEditButtons.remove()}var sRowArr=$.each(that.options.savedRow,function(i,sRow){if(sRow.id==rowid){ia=i;
return true}});if(sRowArr.length){if(ia!=-1){that.options.savedRow.splice(ia,1)}}}if(that.options.datatype=="local"){var id=$.grid.stripPref(that.options.idPrefix,rowid),pos=that.options._index[id];if(typeof(pos)!="undefined"){that.options.data.splice(pos,1);that.refreshIndex()}}if(that.options.altRows===true&&success){var cn=that.options.altclass;$(that.rows).each(function(i){if(i%2==1){$(this).addClass(cn)}else{$(this).removeClass(cn)}})}if(!that.getDataIDs().length){that._cancelCheckAll()}if(this.options.frozenColumns){this._setFrozenHeight()}return success}},_cancelCheckAll:function(){var that=this;if(that.options.multiselect){$("#cb_"+$.grid.coralID(that.options.id),that.grid.columnsView)[that.options.useProp?"prop":"attr"]("checked",false)}},resetSelection:function(rowid){var t=this,ind,sr,fid;if(t.options.frozenColumns===true){fid=t.options.id+"_frozen"}if(typeof(rowid)!=="undefined"){sr=rowid===t.options.selrow?t.options.selrow:rowid;$("#"+$.grid.coralID(t.options.id)+" tbody:first tr#"+$.grid.coralID(sr)).removeClass("coral-state-highlight").attr("aria-selected","false");if(fid){$("#"+$.grid.coralID(sr),"#"+$.grid.coralID(fid)).removeClass("coral-state-highlight")}if(t.options.multiselect){$("#jqg_"+$.grid.coralID(t.options.id)+"_"+$.grid.coralID(sr),"#"+$.grid.coralID(t.options.id))[t.options.useProp?"prop":"attr"]("checked",false);if(fid){$("#jqg_"+$.grid.coralID(t.options.id)+"_"+$.grid.coralID(sr),"#"+$.grid.coralID(fid))[t.options.useProp?"prop":"attr"]("checked",false)}t._setHeadCheckBox(false)}sr=null}else{if(!t.options.multiselect){if(t.options.selrow){$("#"+$.grid.coralID(t.options.id)+" tbody:first tr#"+$.grid.coralID(t.options.selrow)).removeClass("coral-state-highlight").attr("aria-selected","false");if(fid){$("#"+$.grid.coralID(t.options.selrow),"#"+$.grid.coralID(fid)).removeClass("coral-state-highlight")}t.options.selrow=null}}else{$(t.options.selarrrow).each(function(i,n){ind=t.rows.namedItem(n);$(ind).removeClass("coral-state-highlight").attr("aria-selected","false");
$("#jqg_"+$.grid.coralID(t.options.id)+"_"+$.grid.coralID(n))[t.options.useProp?"prop":"attr"]("checked",false);if(fid){$("#"+$.grid.coralID(n),"#"+$.grid.coralID(fid)).removeClass("coral-state-highlight");$("#jqg_"+$.grid.coralID(t.options.id)+"_"+$.grid.coralID(n),"#"+$.grid.coralID(fid))[t.options.useProp?"prop":"attr"]("checked",false)}});t._setHeadCheckBox(false);t.options.selarrrow=[]}}if(t.options.cellEdit===true){if(parseInt(t.options.iCol,10)>=0&&parseInt(t.options.iRow,10)>=0){$("td:eq("+t.options.iCol+")",t.rows[t.options.iRow]).removeClass("edit-cell coral-state-highlight");$(t.rows[t.options.iRow]).removeClass("selected-row coral-state-hover")}}t.options.savedRow=[]},getRowData:function(rowid){var res={},resall,getall=false,len,j=0;var that=this,nm,ind;var isPicgrid=!!(that.options.model=="card");if(isPicgrid){if(typeof(rowid)=="undefined"){getall=true;resall=[];len=that.pic.children("li").length}else{ind=that.pic.children("#"+rowid)[0];if(!ind){return res}len=2}var localKey="_id_";while(j<len){if(getall){ind=that.pic.children("li")[j]}if($(ind).hasClass("gridPanel")){for(var k=0;k<that.options.data.length;k++){if(that.options.data[k][localKey]==ind.id){res=that.options.data[k]}}if(getall){resall.push(res);res={}}}j++}}else{if(typeof(rowid)=="undefined"){getall=true;resall=[];len=that.rows.length}else{ind=that.rows.namedItem(rowid);if(!ind){return res}len=2}while(j<len){if(getall){ind=that.rows[j]}if($(ind).hasClass("jqgrow")){$('td[role="gridcell"]',ind).each(function(i){nm=that.options.colModel[i].name;if(nm!=="cb"&&nm!=="subgrid"&&nm!=="rn"){if(that.options.treeGrid===true&&nm==that.options.ExpandColumn){res[nm]=$.grid.htmlDecode($("span:first",this).html())}else{try{res[nm]=$.unformat.call(that,this,{rowId:ind.id,colModel:that.options.colModel[i]},i,"get")}catch(e){res[nm]=$.grid.htmlDecode($(this).html())}}}});if(getall){resall.push(res);res={}}}j++}}return resall?resall:res},addRowData:function(rowid,rdata,pos,src){if(!pos){pos="last"}var success=false,nm,row,picRow,buttonsData,gi,si,ni,sind,i,v,prp="",aradd,cnm,cn,data,cm,id;
if(rdata){if($.isArray(rdata)){aradd=true;cnm=rowid}else{rdata=[rdata];aradd=false}var t=this,datalen=rdata.length;var isPicgrid=!!(t.options.model=="card");ni=t.options.rownumbers===true?1:0;gi=t.options.multiselect===true?1:(t.options.singleselect===true?1:0);si=t.options.subGrid===true?1:0;if(!aradd){if(typeof(rowid)!="undefined"){rowid=rowid+""}else{rowid=$.grid.randId();if(t.options.keyName!==false){cnm=t.options.keyName;if(typeof rdata[0][cnm]!="undefined"){rowid=rdata[0][cnm]}}}}cn=t.options.altclass;var k=0,cna="",lcdata={},air=$.isFunction(t.options.afterInsertRow)?true:false;while(k<datalen){data=rdata[k];row=[];buttonsData=[];picRow=[];if(aradd){try{rowid=data[cnm]}catch(e){rowid=$.grid.randId()}cna=t.options.altRows===true?(t.rows.length-1)%2===0?cn:"":""}cna+=" new-row ";id=rowid;rowid=t.options.idPrefix+rowid;if(ni){prp=t._formatCol(0,1,"",null,rowid,true);row[row.length]='<td role="gridcell" aria-describedby="'+t.options.id+'_rn" class="coral-state-default grid-rownum" '+prp+">0</td>"}if(gi){if(this.options.singleselect){v='<input role="radio" type="radio" id="jqg_'+t.options.id+"_"+rowid+'" name="jqg_'+t.options.id+'" class="cbox"/>'}else{v='<input role="checkbox" type="checkbox" id="jqg_'+t.options.id+"_"+rowid+'" name="jqg_'+t.options.id+"_"+rowid+'" class="cbox"/>'}prp=t._formatCol(ni,1,"",null,rowid,true);row[row.length]='<td role="gridcell" aria-describedby="'+t.options.id+'_cb" '+prp+">"+v+"</td>";buttonsData.push(v)}if(si){row[row.length]=$(t).grid("addSubGridCell",gi+ni,1)}for(i=gi+si+ni;i<t.options.colModel.length;i++){cm=t.options.colModel[i];nm=cm.name;lcdata[nm]=cm.formatter&&typeof(cm.formatter)==="string"&&cm.formatter=="date"?$.unformat.date.call(t,data[nm],cm):data[nm];v=t._formatter(rowid,$.grid.getAccessor(data,nm),i,data,"edit");prp=t._formatCol(i,1,v,data,rowid,true);row[row.length]='<td role="gridcell" aria-describedby="'+t.options.id+"_"+nm+'" '+prp+">"+v+"</td>"}if(isPicgrid){picRow.unshift(t.constructPanel(rowid,false,cna,lcdata,lcdata));
picRow.push(t._customPanel(lcdata,ni,buttonsData));picRow.push("</li>")}else{row.unshift(t.constructTr(rowid,false,cna,lcdata,lcdata,false));row[row.length]="</tr>"}if(isPicgrid){$("#"+$.grid.coralID(t.options.id)+" .coral-pic").append(picRow.join(""))}else{if(t.rows.length===0){$("table:first",t.grid.rowsView).append(row.join(""))}else{switch(pos){case"last":$(t.rows[t.rows.length-1]).after(row.join(""));sind=t.rows.length-1;break;case"first":$(t.rows[0]).after(row.join(""));sind=1;break;case"after":sind=t.rows.namedItem(src);if(sind){if($(t.rows[sind.rowIndex+1]).hasClass("coral-subgrid")){$(t.rows[sind.rowIndex+1]).after(row)}else{$(sind).after(row.join(""))}}sind++;break;case"before":sind=t.rows.namedItem(src);if(sind){$(sind).before(row.join(""));sind=sind.rowIndex}sind--;break}}}if(t.options.subGrid===true){$(t).grid("addSubGrid",gi+ni,sind)}t.options.records++;t.options.reccount++;$(t).triggerHandler("gridAfterInsertRow",[rowid,data,data]);if(air){t.options.afterInsertRow.call(t,rowid,data,data)}k++;if(t.options.datatype=="local"){lcdata[t.options.localReader.id]=id;t.options._index[id]=t.options.data.length;t.options.data.push(lcdata);lcdata={}}}if(t.options.altRows===true&&!aradd){if(pos=="last"){if((t.rows.length-1)%2==1){$(t.rows[t.rows.length-1]).addClass(cn)}}else{$(t.rows).each(function(i){if(i%2==1){$(this).addClass(cn)}else{$(this).removeClass(cn)}})}}t._updatepager(true,true);success=true;$("#noRecordsTips_"+$.grid.coralID(t.options.id)).hide();$.fn.afterFmatter.call(t)}if(this.options.frozenColumns){this._setFrozenHeight()}return success},clearGridData:function(clearfooter){var that=this;var isPicgrid=!!(that.options.model=="card");if(!that.grid){return}if(typeof clearfooter!="boolean"){clearfooter=false}if(isPicgrid){$("#"+$.grid.coralID(that.options.id)+" .coral-pic").empty()}else{if(that.options.deepempty){$("#"+$.grid.coralID(that.options.id)+" tbody:first tr:gt(0)").remove()}else{var trf=$(" tbody:first tr:first",that.element)[0];$(" tbody:first",that.element).empty().append(trf)
}}if(that.options.footerrow&&clearfooter){$(".coral-grid-ftable td",that.grid.sDiv).html("&#160;")}that.options.selrow=null;that.options.selarrrow=[];that.options.savedRow=[];that.options.records=0;that.options.page=1;that.options.lastpage=0;that.options.reccount=0;that.options.data=[];that.options._index={};that._updatepager(true,false);that._cancelCheckAll()},sortableRows:function(){var opts={},t=0;if(opts.sortableRowsOptions){$.extend(opts,opts.sortableRowsOptions)}var that=this;if(!that.grid){return}if(that.options.treeGrid){return}if($.fn.sortable){opts=$.extend({cursor:"move",axis:"y",items:".jqgrow"},opts||{});opts.change=function(e,ui){ui.prevItemId=$(ui.placeholder[0]).prev("tr").attr("id");ui.nextItemId=$(ui.placeholder[0]).next("tr").attr("id");ui.targetId=ui.position.top>ui.originalPosition.top?ui.prevItemId:ui.nextItemId;$("#"+that.id+" #"+ui.targetId).siblings().removeClass("coral-state-target");$("#"+that.id+" #"+ui.targetId).addClass("coral-state-target");that._trigger("onSortableRows",e,[ui])};opts.start=function(e,ui){$(ui.item).css("border-width","0px");ui.originalPermutation=[];if(ui.item.is("tr")){$("td",ui.item).each(function(i){this.style.width=that.grid.cols[i].style.width})}else{$("td",ui.item.find("tr:first")).each(function(i){this.style.width=that.grid.cols[i].style.width})}if(that.options.subGrid){var subgid=$(ui.item).attr("id");try{$(that).grid("collapseSubGridRow",subgid)}catch(e){}}$("tr.jqgrow",that.element.find(".coral-grid-btable")).each(function(){this.id!==""&&ui.originalPermutation.push(this.id)});that.sortableRowOriginalPermutation=ui.originalPermutation;that._trigger("beforeSortableRows",e,[ui])};opts.update=function(e,ui){$(ui.item).css("border-width","");ui.itemId=[];ui.permutation=[];ui.originalPermutation=that.sortableRowOriginalPermutation||[];if(that.options.rownumbers===true){$("td.grid-rownum",that.rows).each(function(i){$(this).html(i+1+(parseInt(that.options.page,10)-1)*parseInt(that.options.rowNum,10));ui.permutation.push(that.rows[i+1].id)
})}else{$("tr.jqgrow",that.grid.rowsView).each(function(i){ui.permutation.push(this.id)})}$.each(ui.item,function(i){ui.itemId.push(ui.item[i].id)});ui.prevItemId=$(ui.item[0]).prev("tr").attr("id");ui.nextItemId=$(ui.item[0]).next("tr").attr("id");ui.targetId=ui.position.top>ui.originalPosition.top?ui.prevItemId:ui.nextItemId;var dr=$.data(that.element[0],"dns-ref");if(dr){var opts=$.data(dr,"dns");if(opts.dragToSort){ui.item.remove();opts.dragToSort=false;var i=0;if(ui.targetId){for(;i<opts.dataItems.length;i++){$(dr).grid("delRowData",opts.dataItems[i].id)}that.element.grid("addRowData",opts.rowid,opts.dataItems,"after",ui.targetId)}}}that._trigger("afterSortableRows",e,[ui])};$("tbody:first",that.grid.rowsView).sortable(opts)}},destroySortableRows:function(opts){var that=this;if(!that.grid){return}if($.fn.sortable){$("tbody:first",that.grid.rowsView).sortable("destroy")}},gridDnS:function(opts){var that=this,t=0,items=[];if(!that.grid){return}if(that.options.treeGrid){return}if(!$.fn.draggable||!$.fn.droppable){return}var appender="<table id='grid_dns' class='coral-grid-dns'></table>";if($("#grid_dns")[0]===undefined){$("body").append(appender)}if(!opts.connectWith){return}opts.connectWith=opts.connectWith.split(",");opts.connectWith=$.map(opts.connectWith,function(n){return $.trim(n)});var connectToSortableOpts=opts.connectWith.join(" .coral-grid-btable>tbody, ")+" .coral-grid-btable>tbody";opts=$.extend({onstart:null,onstop:null,beforedrop:null,ondrop:null,dragcopy:false,dropbyname:false,droppos:"first",autoid:true,rowid:"id",dataItems:[],autoidprefix:"dns_"},opts||{});$.data(that.element[0],"dns",opts);if(that.options.reccount!="0"&&!that.options.jqgdns){var datadns=$.data(that.element,"dns");$("tr.jqgrow:not(.coral-draggable)",that.element).draggable({revert:"invalid",helper:function(e,ui){var tId=$(e.target).parent("tr")[0].id,i=0,html=$("<div></div>"),sel=that.element.grid("option","selarrrow").concat();$.data(that.element[0],"dns").dataItems=[];if($.inArray(tId,sel)>-1){for(i;
i<sel.length;i++){$.data(that.element[0],"dns").dataItems.push($(that.element).grid("getRowData",sel[i]));html.append($(".coral-grid-btable>tbody #"+sel[i],that.element).clone())}return html}else{$.data(that.element[0],"dns").dataItems.push(that.element.grid("getRowData",tId));html.append($(e.target).parent("tr").clone());return html}},connectToSortable:connectToSortableOpts,cursor:"move",appendTo:"#grid_dns",zIndex:5000,start:function(ev,ui){if(that.options.subGrid){var subgid=$(ui.helper).attr("id");try{$(that.element).grid("collapseSubGridRow",subgid)}catch(e){}}$.data(that.element[0],"dns").dragToSort=true;for(var i=0;i<$.data(that.element[0],"dns").connectWith.length;i++){if($($.data(that.element[0],"dns").connectWith[i]).grid("option","reccount")=="0"){$($.data(that.element[0],"dns").connectWith[i]).grid("addRowData","jqg_empty_row",{})}}ui.helper.addClass("coral-state-highlight");$("td",ui.helper.find("tr:first")).each(function(i){this.style.width=that.grid.headers[i].width+"px"});if(opts.onstart&&$.isFunction(opts.onstart)){opts.onstart.call($($t),ev,ui)}},stop:function(ev,ui){if(ui.helper.dropped&&!opts.dragcopy){var ids=$(ui.helper).attr("id");if(ids===undefined){ids=$(this).attr("id")}$(that.element).grid("delRowData",ids)}for(var i=0;i<$.data(that.element[0],"dns").connectWith.length;i++){$($.data(that.element[0],"dns").connectWith[i]).grid("delRowData","jqg_empty_row")}if(opts.onstop&&$.isFunction(opts.onstop)){opts.onstop.call($($t),ev,ui)}}})}that.options.jqgdns=true;for(var i=0;i<opts.connectWith.length;i++){var cn=opts.connectWith[i];$.data($(cn)[0],"dns-ref",that.element[0])}},gridDnD:function(opts){var that=this;if(!that.grid){return}if(that.options.treeGrid){return}if(!$.fn.draggable||!$.fn.droppable){return}function updateDnD(){var datadnd=$.data(that.element,"dnd");$("tr.jqgrow:not(.coral-draggable)",that.element).draggable($.isFunction(datadnd.drag)?datadnd.drag.call($(that.element),datadnd):datadnd.drag)}var appender="<table id='jqgrid_dnd' class='coral-grid-dnd'></table>";
if($("#jqgrid_dnd")[0]===undefined){$("body").append(appender)}if(typeof opts=="string"&&opts=="updateDnD"&&that.options.jqgdnd===true){updateDnD();return}if(!opts.connectWith){return}opts.connectWith=opts.connectWith.split(",");opts.connectWith=$.map(opts.connectWith,function(n){return $.trim(n)});var connectToSortableOpts=opts.connectWith.join(" .coral-grid-btable>tbody, ")+" .coral-grid-btable>tbody";opts=$.extend({drag:function(opts){return $.extend({start:function(ev,ui){if(that.options.subGrid){var subgid=$(ui.helper).attr("id");try{$(that.element).grid("collapseSubGridRow",subgid)}catch(e){}}for(var i=0;i<$.data(that.element,"dnd").connectWith.length;i++){if($($.data(that.element,"dnd").connectWith[i]).grid("option","reccount")=="0"){$($.data(that.element,"dnd").connectWith[i]).grid("addRowData","jqg_empty_row",{})}}ui.helper.addClass("coral-state-highlight");$("td",ui.helper).each(function(i){this.style.width=that.grid.headers[i].width+"px"});if(opts.onstart&&$.isFunction(opts.onstart)){opts.onstart.call($($t),ev,ui)}},stop:function(ev,ui){if(ui.helper.dropped&&!opts.dragcopy){var ids=$(ui.helper).attr("id");if(ids===undefined){ids=$(this).attr("id")}$(that.element).grid("delRowData",ids)}for(var i=0;i<$.data(that.element,"dnd").connectWith.length;i++){$($.data(that.element,"dnd").connectWith[i]).grid("delRowData","jqg_empty_row")}if(opts.onstop&&$.isFunction(opts.onstop)){opts.onstop.call($($t),ev,ui)}}},opts.drag_opts||{})},drop:function(opts){return $.extend({accept:function(d){if(!$(d).hasClass("jqgrow")){return d}var tid=$(d).closest("table.coral-grid-btable");if(tid.length>0&&$.data(that.element,"dnd")!==undefined){var cn=$.data(that.element,"dnd").connectWith;return $.inArray("#"+$.grid.coralID(this.id),cn)!=-1?true:false}return false},drop:function(ev,ui){if(!$(ui.draggable).hasClass("jqgrow")){return}var accept=$(ui.draggable).attr("id");var getdata=ui.draggable.parents(".coral-grid").grid("getRowData",accept);if(!opts.dropbyname){var j=0,tmpdata={},nm;
var dropmodel=$("#"+$.grid.coralID(this.id)).grid("option","colModel");try{for(var key in getdata){if(getdata.hasOwnProperty(key)){nm=dropmodel[j].name;if(!(nm=="cb"||nm=="rn"||nm=="subgrid")){if(getdata.hasOwnProperty(key)&&dropmodel[j]){tmpdata[nm]=getdata[key]}}else{j++}j++}}getdata=tmpdata}catch(e){}}ui.helper.dropped=true;if(opts.beforedrop&&$.isFunction(opts.beforedrop)){var datatoinsert=opts.beforedrop.call(this,ev,ui,getdata,$("#"+$.grid.coralID(that.options.id)),$(this));if(typeof datatoinsert!="undefined"&&datatoinsert!==null&&typeof datatoinsert=="object"){getdata=datatoinsert}}if(ui.helper.dropped){var grid;if(opts.autoid){if($.isFunction(opts.autoid)){grid=opts.autoid.call(this,getdata)}else{grid=Math.ceil(Math.random()*1000);grid=opts.autoidprefix+grid}}$("#"+$.grid.coralID(this.id)).grid("addRowData",grid,getdata,opts.droppos)}if(opts.ondrop&&$.isFunction(opts.ondrop)){opts.ondrop.call(this,ev,ui,getdata)}}},opts.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{activeClass:"coral-state-active",hoverClass:"coral-state-hover"},drag_opts:{revert:"invalid",helper:"clone",connectToSortable:connectToSortableOpts,cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5000},dragcopy:false,dropbyname:false,droppos:"first",autoid:true,autoidprefix:"dnd_"},opts||{});$.data(that.element,"dnd",opts);if(that.options.reccount!="0"&&!that.options.jqgdnd){updateDnD()}that.options.jqgdnd=true;for(var i=0;i<opts.connectWith.length;i++){var cn=opts.connectWith[i];$(cn).droppable($.isFunction(opts.drop)?opts.drop.call($(that),opts):opts.drop)}},getInd:function(rowid,rc){var ret=false,rw;rw=this.rows.namedItem(rowid);if(rw){ret=rc===true?rw:rw.rowIndex}return ret}});$.extend($.grid,{htmlDecode:function(value){if(value&&(value=="&nbsp;"||value=="&#160;"||(value.length===1&&value.charCodeAt(0)===160))){return""}return !value?value:String(value).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&").replace(/\'/g,"&acute;")},htmlEncode:function(value){return !value?value:String(value).replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&acute;")
},format:function(format){var args=$.makeArray(arguments).slice(1);if(format===undefined){format=""}return format.replace(/\{(\d+)\}/g,function(m,i){return args[i]})},getCellIndex:function(cell){var c=$(cell);if(c.is("tr")){return -1}c=(!c.is("td")&&!c.is("th")?c.closest("td,th"):c)[0];return c.cellIndex},stripHtml:function(v){v=v+"";var regexp=/<("[^"]*"|'[^']*'|[^'">])*>/gi;if(v){v=v.replace(regexp,"");return(v&&v!=="&nbsp;"&&v!=="&#160;")?v.replace(/\"/g,"'"):""}else{return v}},stripPref:function(pref,id){var obj=$.type(pref);if(obj=="string"||obj=="number"){pref=String(pref);id=pref!==""?String(id).replace(String(pref),""):id}return id},stringToDoc:function(xmlString){var xmlDoc;if(typeof xmlString!=="string"){return xmlString}try{var parser=new DOMParser();xmlDoc=parser.parseFromString(xmlString,"text/xml")}catch(e){xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async=false;xmlDoc.loadXML(xmlString)}return(xmlDoc&&xmlDoc.documentElement&&xmlDoc.documentElement.tagName!="parsererror")?xmlDoc:null},parse:function(jsonString){var js=jsonString;if(js.substr(0,9)=="while(1);"){js=js.substr(9)}if(js.substr(0,2)=="/*"){js=js.substr(2,js.length-4)}if(!js){js="{}"}return($.grid.useJSON===true&&typeof(JSON)==="object"&&typeof(JSON.parse)==="function")?JSON.parse(js):eval("("+js+")")},parseDate:function(format,date){var tsp={m:1,d:1,y:1970,h:0,i:0,s:0,u:0},k,hl,dM,regdate=/[\\\/:_;.,\t\T\s-]/;if(date&&date!==null&&date!==undefined){date=$.trim(date);date=date.split(regdate);if($.grid.formatter.date.masks[format]!==undefined){format=$.grid.formatter.date.masks[format]}format=format.split(regdate);var dfmt=$.grid.formatter.date.monthNames;var afmt=$.grid.formatter.date.AmPm;var h12to24=function(ampm,h){if(ampm===0){if(h===12){h=0}}else{if(h!==12){h+=12}}return h};for(k=0,hl=format.length;k<hl;k++){if(format[k]=="M"){dM=$.inArray(date[k],dfmt);if(dM!==-1&&dM<12){date[k]=dM+1;tsp.m=date[k]}}if(format[k]=="F"){dM=$.inArray(date[k],dfmt);if(dM!==-1&&dM>11){date[k]=dM+1-12;tsp.m=date[k]
}}if(format[k]=="a"){dM=$.inArray(date[k],afmt);if(dM!==-1&&dM<2&&date[k]==afmt[dM]){date[k]=dM;tsp.h=h12to24(date[k],tsp.h)}}if(format[k]=="A"){dM=$.inArray(date[k],afmt);if(dM!==-1&&dM>1&&date[k]==afmt[dM]){date[k]=dM-2;tsp.h=h12to24(date[k],tsp.h)}}if(date[k]!==undefined){tsp[format[k].toLowerCase()]=parseInt(date[k],10)}}tsp.m=parseInt(tsp.m,10)-1;var ty=tsp.y;if(ty>=70&&ty<=99){tsp.y=1900+tsp.y}else{if(ty>=0&&ty<=69){tsp.y=2000+tsp.y}}if(tsp.j!==undefined){tsp.d=tsp.j}if(tsp.n!==undefined){tsp.m=parseInt(tsp.n,10)-1}}return new Date(tsp.y,tsp.m,tsp.d,tsp.h,tsp.i,tsp.s,tsp.u)},coralID:function(sid){return String(sid).replace(/[!"#$%&'()*+,.\/:;<=>?@\[\\\]\^`{|}~]/g,"\\$&")},guid:1,uidPref:"coralg",randId:function(prefix){return(prefix?prefix:$.grid.uidPref)+($.grid.guid++)},getAccessor:function(obj,expr){var ret,p,prm=[],i;if(typeof expr==="function"){return expr(obj)}ret=obj[expr];if(ret===undefined){try{if(typeof expr==="string"){prm=expr.split(".")}i=prm.length;if(i){ret=obj;while(ret&&i--){p=prm.shift();ret=ret[p]}}}catch(e){}}return ret},ajaxOptions:{},from:function(source){var QueryObject=function(d,q){if(typeof(d)=="string"){d=$.data(d)}var self=this,_data=d,_usecase=true,_trim=false,_query=q,_stripNum=/[\$,%]/g,_lastCommand=null,_lastField=null,_orDepth=0,_negate=false,_queuedOperator="",_sorting=[],_useProperties=true,_usePinyin=true;if(typeof(d)=="object"&&d.push){if(d.length>0){if(typeof(d[0])!="object"){_useProperties=false}else{_useProperties=true}}}else{throw"data provides is not an array"}this._hasData=function(){return _data===null?false:_data.length===0?false:true};this._getStr=function(s){var phrase=[];if(_trim){phrase.push("jQuery.trim(")}phrase.push("String("+s+")");if(_trim){phrase.push(")")}if(!_usecase){phrase.push(".toLowerCase()")}return phrase.join("")};this._strComp=function(val){if(typeof(val)=="string"){return".toString()"}else{return""}};this._group=function(f,u){return({field:f.toString(),unique:u,items:[]})};this._toStr=function(phrase){if(_trim){phrase=$.trim(phrase)
}phrase=phrase.toString().replace(/\\/g,"\\\\").replace(/\"/g,'\\"');return _usecase?phrase:phrase.toLowerCase()};this._funcLoop=function(func){var results=[];$.each(_data,function(i,v){results.push(func(v))});return results};this._append=function(s){var i;if(_query===null){_query=""}else{_query+=_queuedOperator===""?" && ":_queuedOperator}for(i=0;i<_orDepth;i++){_query+="("}if(_negate){_query+="!"}_query+="("+s+")";_negate=false;_queuedOperator="";_orDepth=0};this._setCommand=function(f,c){_lastCommand=f;_lastField=c};this._resetNegate=function(){_negate=false};this._repeatCommand=function(f,v){if(_lastCommand===null){return self}if(f!==null&&v!==null){return _lastCommand(f,v)}if(_lastField===null){return _lastCommand(f)}if(!_useProperties){return _lastCommand(f)}return _lastCommand(_lastField,f)};this._equals=function(a,b){return(self._compare(a,b,1)===0)};this._compare=function(a,b,d){var toString=Object.prototype.toString;if(d===undefined){d=1}if(a===undefined){a=null}if(b===undefined){b=null}if(a===null&&b===null){return 0}if(a===null&&b!==null){return 1}if(a!==null&&b===null){return -1}if(toString.call(a)==="[object Date]"&&toString.call(b)==="[object Date]"){if(a<b){return -d}if(a>b){return d}return 0}if(!_usecase&&typeof(a)!=="number"&&typeof(b)!=="number"){a=String(a).toLowerCase();b=String(b).toLowerCase()}if(a<b){return -d}if(a>b){return d}return 0};this._performSort=function(){if(_sorting.length===0){return}_data=self._doSort(_data,0)};this._doSort=function(d,q){var by=_sorting[q].by,dir=_sorting[q].dir,type=_sorting[q].type,dfmt=_sorting[q].datefmt;if(q==_sorting.length-1){return self._getOrder(d,by,dir,type,dfmt)}q++;var values=self._getGroup(d,by,dir,type,dfmt);var results=[];for(var i=0;i<values.length;i++){var sorted=self._doSort(values[i].items,q);for(var j=0;j<sorted.length;j++){results.push(sorted[j])}}return results};this._getOrder=function(data,by,dir,type,dfmt){var sortData=[],_sortData=[],newDir=dir=="a"?1:-1,i,ab,j,findSortKey;if(type===undefined){type="text"
}if(type=="float"||type=="number"||type=="currency"||type=="numeric"){findSortKey=function($cell){var key=parseFloat(String($cell).replace(_stripNum,""));return isNaN(key)?0:key}}else{if(type=="int"||type=="integer"){findSortKey=function($cell){return $cell?parseFloat(String($cell).replace(_stripNum,"")):0}}else{if(type=="date"||type=="datetime"){findSortKey=function($cell){return $.grid.parseDate(dfmt,$cell).getTime()}}else{if($.isFunction(type)){findSortKey=type}else{findSortKey=function($cell){if(!$cell){$cell=""}return $.trim(String($cell).toUpperCase())}}}}}$.each(data,function(i,v){ab=by!==""?$.grid.getAccessor(v,by):v;if(ab===undefined){ab=""}ab=findSortKey(ab,v);_sortData.push({vSort:ab,index:i})});_sortData.sort(function(a,b){a=a.vSort;b=b.vSort;return self._compare(a,b,newDir)});j=0;var nrec=data.length;while(j<nrec){i=_sortData[j].index;sortData.push(data[i]);j++}return sortData};this._getGroup=function(data,by,dir,type,dfmt){var results=[],group=null,last=null,val;$.each(self._getOrder(data,by,dir,type,dfmt),function(i,v){val=$.grid.getAccessor(v,by);if(val===undefined){val=""}if(!self._equals(last,val)){last=val;if(group!==null){results.push(group)}group=self._group(by,val)}group.items.push(v)});if(group!==null){results.push(group)}return results};this.ignoreCase=function(){_usecase=false;return self};this.useCase=function(){_usecase=true;return self};this.trim=function(){_trim=true;return self};this.noTrim=function(){_trim=false;return self};this.execute=function(){var match=_query,results=[];if(match===null){return self}$.each(_data,function(){if(eval(match)){results.push(this)}});_data=results;return self};this.data=function(){return _data};this.select=function(f){self._performSort();if(!self._hasData()){return[]}self.execute();if($.isFunction(f)){var results=[];$.each(_data,function(i,v){results.push(f(v))});return results}return _data};this.hasMatch=function(){if(!self._hasData()){return false}self.execute();return _data.length>0};this.andNot=function(f,v,x){_negate=!_negate;
return self.and(f,v,x)};this.orNot=function(f,v,x){_negate=!_negate;return self.or(f,v,x)};this.not=function(f,v,x){return self.andNot(f,v,x)};this.and=function(f,v,x){_queuedOperator=" && ";if(f===undefined){return self}return self._repeatCommand(f,v,x)};this.or=function(f,v,x){_queuedOperator=" || ";if(f===undefined){return self}return self._repeatCommand(f,v,x)};this.orBegin=function(){_orDepth++;return self};this.orEnd=function(){if(_query!==null){_query+=")"}return self};this.isNot=function(f){_negate=!_negate;return self.is(f)};this.is=function(f){self._append("this."+f);self._resetNegate();return self};this._compareValues=function(func,f,v,how,t){var fld;if(_useProperties){fld="jQuery.grid.getAccessor(this,'"+f+"')"}else{fld="this"}if(v===undefined){v=null}var val=v,swst=t.stype===undefined?"text":t.stype;if(v!==null){switch(swst){case"int":case"integer":val=(isNaN(Number(val))||val==="")?"0":val;fld="parseInt("+fld+",10)";val="parseInt("+val+",10)";break;case"float":case"number":case"numeric":val=String(val).replace(_stripNum,"");val=(isNaN(Number(val))||val==="")?"0":val;fld="parseFloat("+fld+")";val="parseFloat("+val+")";break;case"date":case"datetime":val=String($.grid.parseDate(t.newfmt||"Y-m-d",val).getTime());fld='jQuery.grid.parseDate("'+t.srcfmt+'",'+fld+").getTime()";break;default:fld=self._getStr(fld);val=self._getStr('"'+self._toStr(val)+'"')}}self._append(fld+" "+how+" "+val+" || pinyinEngine.toPinyin("+fld+', false, "") '+how+" "+val);self._setCommand(func,f);self._resetNegate();return self};this.equals=function(f,v,t){return self._compareValues(self.equals,f,v,"==",t)};this.notEquals=function(f,v,t){return self._compareValues(self.equals,f,v,"!==",t)};this.isNull=function(f,v,t){return self._compareValues(self.equals,f,null,"===",t)};this.greater=function(f,v,t){return self._compareValues(self.greater,f,v,">",t)};this.less=function(f,v,t){return self._compareValues(self.less,f,v,"<",t)};this.greaterOrEquals=function(f,v,t){return self._compareValues(self.greaterOrEquals,f,v,">=",t)
};this.lessOrEquals=function(f,v,t){return self._compareValues(self.lessOrEquals,f,v,"<=",t)};this.startsWith=function(f,v){var val=(v===undefined||v===null)?f:v,length=_trim?$.trim(val.toString()).length:val.toString().length;if(_useProperties){self._append(self._getStr("jQuery.grid.getAccessor(this,'"+f+"')")+".substr(0,"+length+") == "+self._getStr('"'+self._toStr(v)+'"'))}else{length=_trim?$.trim(v.toString()).length:v.toString().length;self._append(self._getStr("this")+".substr(0,"+length+") == "+self._getStr('"'+self._toStr(f)+'"'))}self._setCommand(self.startsWith,f);self._resetNegate();return self};this.endsWith=function(f,v){var val=(v===undefined||v===null)?f:v,length=_trim?$.trim(val.toString()).length:val.toString().length;if(_useProperties){self._append(self._getStr("jQuery.grid.getAccessor(this,'"+f+"')")+".substr("+self._getStr("jQuery.grid.getAccessor(this,'"+f+"')")+".length-"+length+","+length+') == "'+self._toStr(v)+'"')}else{self._append(self._getStr("this")+".substr("+self._getStr("this")+'.length-"'+self._toStr(f)+'".length,"'+self._toStr(f)+'".length) == "'+self._toStr(f)+'"')}self._setCommand(self.endsWith,f);self._resetNegate();return self};this.contains=function(f,v){if(_useProperties){if(_usePinyin){self._append(self._getStr("jQuery.grid.getAccessor(this,'"+f+"')")+'.indexOf("'+self._toStr(v)+'",0) > -1 || '+self._getStr("pinyinEngine.toPinyin(jQuery.grid.getAccessor(this,'"+f+'\'), false, "")')+'.indexOf("'+self._toStr(v)+'",0) > -1')}else{self._append(self._getStr("jQuery.grid.getAccessor(this,'"+f+"')")+'.indexOf("'+self._toStr(v)+'",0) > -1')}}else{if(_usePinyin){self._append(self._getStr("this")+'.indexOf("'+self._toStr(f)+'",0) > -1 || '+pinyinEngine.toPinyin(self._getStr("this"),false,"")+'.indexOf("'+self._toStr(v)+'",0) > -1')}else{self._append(self._getStr("this")+'.indexOf("'+self._toStr(f)+'",0) > -1')}}self._setCommand(self.contains,f);self._resetNegate();return self};this.groupBy=function(by,dir,type,datefmt){if(!self._hasData()){return null
}return self._getGroup(_data,by,dir,type,datefmt)};this.orderBy=function(by,dir,stype,dfmt){dir=dir===undefined||dir===null?"a":$.trim(dir.toString().toLowerCase());if(stype===null||stype===undefined){stype="text"}if(dfmt===null||dfmt===undefined){dfmt="Y-m-d"}if(dir=="desc"||dir=="descending"){dir="d"}if(dir=="asc"||dir=="ascending"){dir="a"}_sorting.push({by:by,dir:dir,type:stype,datefmt:dfmt});return self};return self};return new QueryObject(source,null)},getMethod:function(name){return this.getAccessor($.fn.grid,name)},extend:function(methods){$.extend($.fn.grid,methods);if(!this.no_legacy_api){$.fn.extend(methods)}}});$.component("coral.grid",$.coral.grid,{setTreeNode:function(i,len){var that=this;if(!that.grid||!that.options.treeGrid){return}var expCol=that.options.expColInd,expanded=that.options.treeReader.expanded_field,isLeaf=that.options.treeReader.leaf_field,level=that.options.treeReader.level_field,icon=that.options.treeReader.icon_field,loaded=that.options.treeReader.loaded,lft,rgt,curLevel,ident,lftpos,twrap,ldat,lf;while(i<len){var ind=that.rows[i].id,dind=that.options._index[ind],expan;ldat=that.options.data[dind];if(that.options.treeGridModel=="nested"){if(!ldat[isLeaf]){lft=parseInt(ldat[that.options.treeReader.left_field],10);rgt=parseInt(ldat[that.options.treeReader.right_field],10);ldat[isLeaf]=(rgt===lft+1)?"true":"false";that.rows[i].cells[that.options._treeleafpos].innerHTML=ldat[isLeaf]}}curLevel=parseInt(ldat[level],10);if(that.options.tree_root_level===0){ident=curLevel+1;lftpos=curLevel}else{ident=curLevel;lftpos=curLevel-1}twrap="<div class='tree-wrap tree-wrap-"+that.options.direction+"' style='width:"+(ident*18)+"px;'>";twrap+="<div style='"+(that.options.direction=="rtl"?"right:":"left:")+(lftpos*18)+"px;' class=' ";if(ldat[loaded]!==undefined){if(ldat[loaded]=="true"||ldat[loaded]===true){ldat[loaded]=true}else{ldat[loaded]=false}}if(ldat[isLeaf]=="true"||ldat[isLeaf]===true){twrap+=((ldat[icon]!==undefined&&ldat[icon]!=="")?ldat[icon]:that.options.treeIcons.leaf)+" tree-leaf treeclick";
ldat[isLeaf]=true;lf="leaf"}else{ldat[isLeaf]=false;lf=""}ldat[expanded]=((ldat[expanded]=="true"||ldat[expanded]===true)?true:false)&&ldat[loaded];if(ldat[expanded]===false){twrap+=((ldat[isLeaf]===true)?"'":that.options.treeIcons.plus+" tree-plus treeclick'")}else{twrap+=((ldat[isLeaf]===true)?"'":that.options.treeIcons.minus+" tree-minus treeclick'")}twrap+="></div></div>";$(that.rows[i].cells[expCol]).wrapInner("<span class='cell-wrapper"+lf+"'></span>").prepend(twrap);if(curLevel!==parseInt(that.options.tree_root_level,10)){var pn=$(that.element).grid("getNodeParent",ldat);expan=pn&&pn.hasOwnProperty(expanded)?pn[expanded]:true;if(!expan){$(that.rows[i]).css("display","none")}}$(that.rows[i].cells[expCol]).find("div.treeclick").bind("click",function(e){var target=e.target||e.srcElement,ind2=$(target,that.rows).closest("tr.jqgrow")[0].id,pos=that.options._index[ind2];if(!that.options.data[pos][isLeaf]){if(that.options.data[pos][expanded]){$(that.element).grid("collapseRow",that.options.data[pos]);$(that.element).grid("collapseNode",that.options.data[pos])}else{$(that.element).grid("expandRow",that.options.data[pos]);$(that.element).grid("expandNode",that.options.data[pos])}}return false});if(that.options.ExpandColClick===true){$(that.rows[i].cells[expCol]).find("span.cell-wrapper").css("cursor","pointer").bind("click",function(e){var target=e.target||e.srcElement,ind2=$(target,that.rows).closest("tr.jqgrow")[0].id,pos=that.options._index[ind2];if(!that.options.data[pos][isLeaf]){if(that.options.data[pos][expanded]){$(that.element).grid("collapseRow",that.options.data[pos]);$(that.element).grid("collapseNode",that.options.data[pos])}else{$(that.element).grid("expandRow",that.options.data[pos]);$(that.element).grid("expandNode",that.options.data[pos])}}$(that.element).grid("setSelection",ind2);return false})}i++}},setTreeGrid:function(){var that=this,i=0,pico,ecol=false,nm,key,dupcols=[];if(!that.options.treeGrid){return}if(!that.options.treedatatype){$.extend(that.options,{treedatatype:that.options.datatype})
}that.options.subGrid=false;that.options.altRows=false;that.options.gridview=true;if(that.options.rowTotal===null){that.options.rowNum=10000}that.options.multiselect=false;that.options.rowList=[];that.options.expColInd=0;pico="coral-icon-triangle-1-"+(that.options.direction=="rtl"?"w":"e");that.options.treeIcons=$.extend({plus:"cui-icon-arrow-right3",minus:"cui-icon-arrow-down3",leaf:"cui-icon-file-empty2"},that.options.treeIcons||{});if(that.options.treeGridModel=="nested"){that.options.treeReader=$.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},that.options.treeReader)}else{if(that.options.treeGridModel=="adjacency"){that.options.treeReader=$.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},that.options.treeReader)}}for(key in that.options.colModel){if(that.options.colModel.hasOwnProperty(key)){nm=that.options.colModel[key].name;if(nm==that.options.ExpandColumn&&!ecol){ecol=true;that.options.expColInd=i}i++;for(var tkey in that.options.treeReader){if(that.options.treeReader[tkey]==nm){dupcols.push(nm)}}}}$.each(that.options.treeReader,function(j,n){if(n&&$.inArray(n,dupcols)===-1){if(j==="leaf_field"){that.options._treeleafpos=i}i++;that.options.colNames.push(n);that.options.colModel.push({name:n,width:1,hidden:true,sortable:false,resizable:false,hidedlg:true,editable:true,search:false})}})},expandRow:function(record){var that=this;if(!that.grid||!that.options.treeGrid){return}var childern=$(that.element).grid("getNodeChildren",record),expanded=that.options.treeReader.expanded_field,rows=that.rows;$(childern).each(function(){var id=$.grid.getAccessor(this,that.options.localReader.id);$(rows.namedItem(id)).css("display","");if(this[expanded]){$(that.element).grid("expandRow",this)}})},collapseRow:function(record){var that=this;if(!that.grid||!that.options.treeGrid){return}var childern=$(that.element).grid("getNodeChildren",record),expanded=that.options.treeReader.expanded_field,rows=that.rows;
$(childern).each(function(){var id=$.grid.getAccessor(this,that.options.localReader.id);$(rows.namedItem(id)).css("display","none");if(this[expanded]){$(that.element).grid("collapseRow",this)}})},getRootNodes:function(){var result=[];var that=this;if(!that.grid||!that.options.treeGrid){return}switch(that.options.treeGridModel){case"nested":var level=that.options.treeReader.level_field;$(that.options.data).each(function(){if(parseInt(this[level],10)===parseInt(that.options.tree_root_level,10)){result.push(this)}});break;case"adjacency":var parent_id=that.options.treeReader.parent_id_field;$(that.options.data).each(function(){if(this[parent_id]===null||String(this[parent_id]).toLowerCase()=="null"){result.push(this)}});break}return result},getNodeDepth:function(rc){var ret=null;this.each(function(){if(!this.grid||!this.options.treeGrid){return}var $t=this;switch(that.options.treeGridModel){case"nested":var level=that.options.treeReader.level_field;ret=parseInt(rc[level],10)-parseInt(that.options.tree_root_level,10);break;case"adjacency":ret=$($t).grid("getNodeAncestors",rc).length;break}});return ret},getNodeParent:function(rc){var result=null;var that=this;if(!that.grid||!that.options.treeGrid){return}switch(that.options.treeGridModel){case"nested":var lftc=that.options.treeReader.left_field,rgtc=that.options.treeReader.right_field,levelc=that.options.treeReader.level_field,lft=parseInt(rc[lftc],10),rgt=parseInt(rc[rgtc],10),level=parseInt(rc[levelc],10);$(that.options.data).each(function(){if(parseInt(this[levelc],10)===level-1&&parseInt(this[lftc],10)<lft&&parseInt(this[rgtc],10)>rgt){result=this;return false}});break;case"adjacency":var parent_id=that.options.treeReader.parent_id_field,dtid=that.options.localReader.id;$(that.options.data).each(function(){if(this[dtid]==rc[parent_id]){result=this;return false}});break}return result},getNodeChildren:function(rc){var result=[];var that=this;if(!that.grid||!that.options.treeGrid){return}switch(that.options.treeGridModel){case"nested":var lftc=that.options.treeReader.left_field,rgtc=that.options.treeReader.right_field,levelc=that.options.treeReader.level_field,lft=parseInt(rc[lftc],10),rgt=parseInt(rc[rgtc],10),level=parseInt(rc[levelc],10);
$(this.options.data).each(function(){if(parseInt(this[levelc],10)===level+1&&parseInt(this[lftc],10)>lft&&parseInt(this[rgtc],10)<rgt){result.push(this)}});break;case"adjacency":var parent_id=that.options.treeReader.parent_id_field,dtid=that.options.localReader.id;$(this.options.data).each(function(){if(this[parent_id]==rc[dtid]){result.push(this)}});break}return result},getFullTreeNode:function(rc){var result=[];this.each(function(){var $t=this,len;if(!$t.grid||!that.options.treeGrid){return}switch(that.options.treeGridModel){case"nested":var lftc=that.options.treeReader.left_field,rgtc=that.options.treeReader.right_field,levelc=that.options.treeReader.level_field,lft=parseInt(rc[lftc],10),rgt=parseInt(rc[rgtc],10),level=parseInt(rc[levelc],10);$(this.options.data).each(function(){if(parseInt(this[levelc],10)>=level&&parseInt(this[lftc],10)>=lft&&parseInt(this[lftc],10)<=rgt){result.push(this)}});break;case"adjacency":if(rc){result.push(rc);var parent_id=that.options.treeReader.parent_id_field,dtid=that.options.localReader.id;$(this.options.data).each(function(i){len=result.length;for(i=0;i<len;i++){if(result[i][dtid]==this[parent_id]){result.push(this);break}}})}break}});return result},getNodeAncestors:function(rc){var ancestors=[];this.each(function(){if(!this.grid||!this.options.treeGrid){return}var parent=$(this).grid("getNodeParent",rc);while(parent){ancestors.push(parent);parent=$(this).grid("getNodeParent",parent)}});return ancestors},isVisibleNode:function(rc){var result=true;this.each(function(){var $t=this;if(!$t.grid||!that.options.treeGrid){return}var ancestors=$($t).grid("getNodeAncestors",rc),expanded=that.options.treeReader.expanded_field;$(ancestors).each(function(){result=result&&this[expanded];if(!result){return false}})});return result},isNodeLoaded:function(rc){var result;var that=this;if(!that.grid||!that.options.treeGrid){return}var isLeaf=that.options.treeReader.leaf_field;if(rc!==undefined){if(rc.loaded!==undefined){result=rc.loaded}else{if(rc[isLeaf]||$(that.element).grid("getNodeChildren",rc).length>0){result=true
}else{result=false}}}else{result=false}return result},expandNode:function(rc){if(!this.grid||!this.options.treeGrid){return}var expanded=this.options.treeReader.expanded_field,parent=this.options.treeReader.parent_id_field,loaded=this.options.treeReader.loaded,level=this.options.treeReader.level_field,lft=this.options.treeReader.left_field,rgt=this.options.treeReader.right_field;if(!rc[expanded]){var id=$.grid.getAccessor(rc,this.options.localReader.id);var rc1=$("#"+$.grid.coralID(id),this.grid.rowsView)[0];var position=this.options._index[id];if($(this.element).grid("isNodeLoaded",this.options.data[position])){rc[expanded]=true;$("div.treeclick",rc1).removeClass(this.options.treeIcons.plus+" tree-plus").addClass(this.options.treeIcons.minus+" tree-minus")}else{if(!this.grid.columnsView.loading){rc[expanded]=true;$("div.treeclick",rc1).removeClass(this.options.treeIcons.plus+" tree-plus").addClass(this.options.treeIcons.minus+" tree-minus");this.options.treeANode=rc1.rowIndex;this.options.datatype=this.options.treedatatype;if(this.options.treeGridModel=="nested"){$(this.element).grid("option",{postData:{nodeid:id,n_left:rc[lft],n_right:rc[rgt],n_level:rc[level]}})}else{$(this.element).grid("option",{postData:{nodeid:id,parentid:rc[parent],n_level:rc[level]}})}$(this.element).grid("reload");rc[loaded]=true;if(this.options.treeGridModel=="nested"){$(this.element).grid("option",{postData:{nodeid:"",n_left:"",n_right:"",n_level:""}})}else{$(this.element).grid("option",{postData:{nodeid:"",parentid:"",n_level:""}})}}}}},collapseNode:function(rc){if(!this.grid||!this.options.treeGrid){return}var expanded=this.options.treeReader.expanded_field;if(rc[expanded]){rc[expanded]=false;var id=$.grid.getAccessor(rc,this.options.localReader.id);var rc1=$("#"+$.grid.coralID(id),this.grid.rowsView)[0];$("div.treeclick",rc1).removeClass(this.options.treeIcons.minus+" tree-minus").addClass(this.options.treeIcons.plus+" tree-plus")}},sortTree:function(sortname,newDir,st,datefmt){if(!this.grid||!this.options.treeGrid){return
}var i,len,rec,records=[],that=this,query,roots,rt=$(that.element).grid("getRootNodes");query=$.grid.from(rt);query.orderBy(sortname,newDir,st,datefmt);roots=query.select();for(i=0,len=roots.length;i<len;i++){rec=roots[i];records.push(rec);$(that.element).grid("collectChildrenSortTree",records,rec,sortname,newDir,st,datefmt)}$.each(records,function(index){var id=$.grid.getAccessor(this,that.options.localReader.id);$("#"+$.grid.coralID(that.options.id)+" tbody tr:eq("+index+")").after($("tr#"+$.grid.coralID(id),that.grid.rowsView))});query=null;roots=null;records=null},collectChildrenSortTree:function(records,rec,sortname,newDir,st,datefmt){if(!this.grid||!this.options.treeGrid){return}var i,len,child,ch,query,children;ch=$(this.element).grid("getNodeChildren",rec);query=$.grid.from(ch);query.orderBy(sortname,newDir,st,datefmt);children=query.select();for(i=0,len=children.length;i<len;i++){child=children[i];records.push(child);$(this.element).grid("collectChildrenSortTree",records,child,sortname,newDir,st,datefmt)}},setTreeRow:function(rowid,data){var success=false;this.each(function(){var t=this;if(!t.grid||!t.options.treeGrid){return}success=$(t).grid("setRowData",rowid,data)});return success},delTreeNode:function(rowid){return this.each(function(){var $t=this,rid=that.options.localReader.id,left=that.options.treeReader.left_field,right=that.options.treeReader.right_field,myright,width,res,key;if(!$t.grid||!that.options.treeGrid){return}var rc=that.options._index[rowid];if(rc!==undefined){myright=parseInt(that.options.data[rc][right],10);width=myright-parseInt(that.options.data[rc][left],10)+1;var dr=$($t).grid("getFullTreeNode",that.options.data[rc]);if(dr.length>0){for(var i=0;i<dr.length;i++){$($t).grid("delRowData",dr[i][rid])}}if(that.options.treeGridModel==="nested"){res=$.grid.from(that.options.data).greater(left,myright,{stype:"integer"}).select();if(res.length){for(key in res){if(res.hasOwnProperty(key)){res[key][left]=parseInt(res[key][left],10)-width}}}res=$.grid.from(that.options.data).greater(right,myright,{stype:"integer"}).select();
if(res.length){for(key in res){if(res.hasOwnProperty(key)){res[key][right]=parseInt(res[key][right],10)-width}}}}}})},addChildNode:function(nodeid,parentid,data){var $t=this[0];if(data){var expanded=that.options.treeReader.expanded_field,isLeaf=that.options.treeReader.leaf_field,level=that.options.treeReader.level_field,parent=that.options.treeReader.parent_id_field,left=that.options.treeReader.left_field,right=that.options.treeReader.right_field,loaded=that.options.treeReader.loaded,method,parentindex,parentdata,parentlevel,i,len,max=0,rowind=parentid,leaf,maxright;if(typeof nodeid==="undefined"||nodeid===null){i=that.options.data.length-1;if(i>=0){while(i>=0){max=Math.max(max,parseInt(that.options.data[i][that.options.localReader.id],10));i--}}nodeid=max+1}var prow=$($t).grid("getInd",parentid);leaf=false;if(parentid===undefined||parentid===null||parentid===""){parentid=null;rowind=null;method="last";parentlevel=that.options.tree_root_level;i=that.options.data.length+1}else{method="after";parentindex=that.options._index[parentid];parentdata=that.options.data[parentindex];parentid=parentdata[that.options.localReader.id];parentlevel=parseInt(parentdata[level],10)+1;var childs=$($t).grid("getFullTreeNode",parentdata);if(childs.length){i=childs[childs.length-1][that.options.localReader.id];rowind=i;i=$($t).grid("getInd",rowind)+1}else{i=$($t).grid("getInd",parentid)+1}if(parentdata[isLeaf]){leaf=true;parentdata[expanded]=true;$($t.rows[prow]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(that.options.treeIcons.leaf+" tree-leaf").addClass(that.options.treeIcons.minus+" tree-minus");that.options.data[parentindex][isLeaf]=false;parentdata[loaded]=true}}len=i+1;data[expanded]=false;data[loaded]=true;data[level]=parentlevel;data[isLeaf]=true;if(that.options.treeGridModel==="adjacency"){data[parent]=parentid}if(that.options.treeGridModel==="nested"){var query,res,key;if(parentid!==null){maxright=parseInt(parentdata[right],10);
query=$.grid.from(that.options.data);query=query.greaterOrEquals(right,maxright,{stype:"integer"});res=query.select();if(res.length){for(key in res){if(res.hasOwnProperty(key)){res[key][left]=res[key][left]>maxright?parseInt(res[key][left],10)+2:res[key][left];res[key][right]=res[key][right]>=maxright?parseInt(res[key][right],10)+2:res[key][right]}}}data[left]=maxright;data[right]=maxright+1}else{maxright=parseInt($($t).grid("getCol",right,false,"max"),10);res=$.grid.from(that.options.data).greater(left,maxright,{stype:"integer"}).select();if(res.length){for(key in res){if(res.hasOwnProperty(key)){res[key][left]=parseInt(res[key][left],10)+2}}}res=$.grid.from(that.options.data).greater(right,maxright,{stype:"integer"}).select();if(res.length){for(key in res){if(res.hasOwnProperty(key)){res[key][right]=parseInt(res[key][right],10)+2}}}data[left]=maxright+1;data[right]=maxright+2}}if(parentid===null||$($t).grid("isNodeLoaded",parentdata)||leaf){$($t).grid("addRowData",nodeid,data,method,rowind);$($t).grid("setTreeNode",i,len)}if(parentdata&&!parentdata[expanded]){$($t.rows[prow]).find("div.treeclick").click()}}},refreshDescription:function(html){if(this.options.toolbarOptions){if(this.options.description){$(".pager-description",this.element).html(html)}}},hideGridHeader:function(){this.element.find(".coral-grid-columns").hide()},showGridHeader:function(){this.element.find(".coral-grid-columns").show()},valid:function(rowid,colname){var res={},resall,getall=false,len,j=0;var that=this,nm,editable,ind;that.errorResults=[];var state;if(typeof(rowid)=="undefined"||!rowid){getall=true;resall=[];len=that.rows.length}else{ind=that.rows.namedItem(rowid);if(!ind){return res}len=2}while(j<len){if(getall){ind=that.rows[j]}if($(ind).hasClass("jqgrow")){$('td[role="gridcell"]',ind).each(function(i){nm=that.options.colModel[i].name;editable=that.options.colModel[i].editable;if(!colname||(colname&&nm==colname)){if(nm!=="cb"&&nm!=="subgrid"&&nm!=="rn"){if(that.options.treeGrid===true&&nm==that.options.ExpandColumn){res[nm]=$.grid.htmlDecode($("span:first",this).html())
}else{try{var sRowArr=$.grep(that.options.savedRow,function(sRow){return sRow.id==ind.id||that.rows[sRow.id].id==ind.id});if(that.options.savedRow.length&&sRowArr.length&&editable){state="edittype"}else{state=null}res[nm]=$.unformat.call(that,this,{rowId:ind.id,colModel:that.options.colModel[i]},i,"get",state)}catch(e){res[nm]=$.grid.htmlDecode($(this).html())}}var validateopitons=$.extend(that.options.colModel[i].formatoptions||{},that.options.colModel[i].editoptions||{});var event=$.Event();event.target=this;var data={validoptions:validateopitons,notComponent:!(state=="edittype"),showRequiredMark:$.noop,hasTips:false,component:(state=="edittype")?that.getCellComponent(ind.id,nm):$(this),element:$(this).find(".ctrl-init").length>0?$(this).find(".ctrl-init"):$(this),value:res[nm]};var error=$.validate.validateField(event,data);if(error.length){if(that.options.allowSaveOnError){$(this).addClass("coral-gridcell-error").attr("data-errors",error)}else{$(this).addClass("coral-gridcell-error")}that.errorResults.push({rowId:ind.id,rowIndex:j,cellIndex:i,errors:error})}else{$(this).removeClass("coral-gridcell-error").removeAttr("data-errors")}}}});if(getall){resall.push(res);res={}}}j++}this.options.isValid=!(this.errorResults.length>0);return this.options.isValid},clearErrors:function(rowid,colname){var res={},resall,getall=false,len,j=0;var that=this,nm,editable,ind;this.errorResults=this.errorResults||[];if(typeof(rowid)=="undefined"||!rowid){getall=true;resall=[];len=that.rows.length;that.errorResults=[]}else{ind=that.rows.namedItem(rowid);if(!ind){return res}len=2;var k=that.errorResults.length;for(k;k>0;k--){if(that.errorResults[k-1].rowId==ind.id){that.errorResults.splice(k-1,1)}}}while(j<len){if(getall){ind=that.rows[j]}if($(ind).hasClass("jqgrow")){$('td[role="gridcell"]',ind).each(function(i){$(this).removeClass("coral-gridcell-error coral-validate-error").removeAttr("data-errors")})}j++}this.options.isValid=!(this.errorResults.length>0)},getCellErrors:function(){return that.errorResults
},resizeFrozen:function(){var top=this.options.caption?$(this.grid.cDiv).outerHeight():0,hth=$(".coral-grid-htable","#"+$.grid.coralID(this.options.id)).outerHeight();if(this.options.toppager){top=top+$($t.grid.topDiv).outerHeight()}if(this.options.toolbar[0]===true){if(this.options.toolbar[1]!="bottom"){top=top+$(this.grid.uDiv).outerHeight()}}if(this.grid.fhDiv){var columsHeight=$("th",this.grid.columnsView).height();$(this.grid.fhDiv).css({top:top});$("th",this.grid.fhDiv).each(function(){$(this).height(columsHeight)});$(this.grid.fbDiv).css({top:(parseInt(top,10)+parseInt(hth,10))});$(this.grid.fbDiv).height($(this.grid.rowsView).height()-this.getScrollBarWidth()+2)}if(this.grid.rightfhDiv){var columsHeight=$("th",this.grid.columnsView).height();$("th",this.grid.rightfhDiv).each(function(){$(this).height(columsHeight)});$(this.grid.rightfhDiv).css({top:top});$(this.grid.rightfbDiv).css({top:(parseInt(top,10)+parseInt(hth,10))});$(this.grid.rightfbDiv).height($(this.grid.rowsView).height()-this.getScrollBarWidth()+2)}},setFrozenColumns:function(){if(!this.grid){return}var $t=this,cm=$t.options.colModel,i=0,len=cm.length,j=len-1,rightmaxfrozen=-1,maxfrozen=-1,frozen=false;if($t.options.subGrid===true||$t.options.treeGrid===true||$t.options.cellEdit===true||$t.options.sortable||$t.options.scroll||$t.options.grouping){return}if($t.options.rownumbers){i++}if($t.options.multiselect||$t.options.singleselect){i++}while(i<len){if(cm[i].frozen===true){frozen=true;maxfrozen=i}else{break}i++}while(j>0){if(cm[j].frozen===true){frozen=true;rightmaxfrozen=j}else{break}j--}if(rightmaxfrozen>0){maxfrozen=-1}if(frozen){var top=$t.options.caption?$($t.grid.cDiv).outerHeight():0,hth=$(".coral-grid-htable","#"+$.grid.coralID($t.options.id)).outerHeight();if($t.options.toppager){top=top+$($t.grid.topDiv).outerHeight()}if($t.options.toolbar[0]===true){if($t.options.toolbar[1]!="bottom"){top=top+$($t.grid.uDiv).outerHeight()}}if(maxfrozen>=0){$t.grid.fhDiv=$('<div style="position:absolute;left:0px;top:'+top+'px;" class="frozen-div coral-state-default coral-grid-columns coral-grid-columns-view"></div>');
$t.grid.fbDiv=$('<div style="position:absolute;left:0px;top:'+(parseInt(top,10)+parseInt(hth,10))+'px;overflow-y:hidden" class="frozen-bdiv coral-grid-rows coral-grid-rows-view"></div>');$("#"+$.grid.coralID($t.options.id)).append($t.grid.fhDiv)}if(rightmaxfrozen>=0){$t.grid.rightfhDiv=$('<div style="position:absolute;right:0;top:'+top+'px;" class="frozen-div coral-state-default coral-grid-columns coral-grid-columns-view"></div>');$t.grid.rightfbDiv=$('<div style="position:absolute;right:0;top:'+(parseInt(top,10)+parseInt(hth,10))+'px;overflow-y:hidden" class="frozen-bdiv coral-grid-rows coral-grid-rows-view"></div>');$("#"+$.grid.coralID($t.options.id)).append($t.grid.rightfhDiv)}var htbl=$(".coral-grid-htable","#"+$.grid.coralID($t.options.id)).clone(true);var righthtbl=$(".coral-grid-htable","#"+$.grid.coralID($t.options.id)).clone(true);$t.rightFrozenWidth=0;if($t.options.groupHeader){if(maxfrozen>=0){$("tr.jqg-first-row-header, tr.jqg-third-row-header",htbl).each(function(){$("th:gt("+maxfrozen+")",this).remove()})}if(rightmaxfrozen>=0){$("tr.jqg-first-row-header, tr.jqg-third-row-header",righthtbl).each(function(){$("th:lt("+rightmaxfrozen+")",this).remove()})}var swapfroz=-1,fdel=-1;$("tr.jqg-second-row-header th",htbl).each(function(){var cs=parseInt($(this).attr("colspan"),10);if(cs){swapfroz=swapfroz+cs;fdel++}if(swapfroz===maxfrozen){return false}});if(swapfroz!==maxfrozen){fdel=maxfrozen}$("tr.jqg-second-row-header",htbl).each(function(){$("th:gt("+fdel+")",this).remove()})}else{if(maxfrozen>=0){$("tr",htbl).each(function(){$("th:gt("+maxfrozen+")",this).remove()})}if(rightmaxfrozen>=0){$("tr",righthtbl).each(function(){$("th:lt("+rightmaxfrozen+")",this).remove()})}}$(htbl).width(1);$(righthtbl).width(1);if(maxfrozen>=0){$($t.grid.fhDiv).append(htbl).mousemove(function(e){if($t.grid.resizing){$t.grid.dragMove(e);return false}})}if(rightmaxfrozen>=0){$($t.grid.rightfhDiv).append(righthtbl).mousemove(function(e){if($t.grid.resizing){$t.grid.dragMove(e);return false
}})}$($t.element).bind("gridonresizestop.setFrozenColumns",function(e,ui){var index=ui.index,w=ui.newWidth;if(maxfrozen>=0){var rhth=$(".coral-grid-htable",$t.grid.fhDiv);$("th:eq("+index+")",rhth).width(w);var btd=$(".coral-grid-btable",$t.grid.fbDiv);$("tr:first td:eq("+index+")",btd).width(w)}if(rightmaxfrozen>=0){var rhth=$(".coral-grid-htable",$t.grid.rightfhDiv);$("th:eq("+(len-index-1)+")",rhth).width(w);var btd=$(".coral-grid-btable",$t.grid.rightfbDiv);$("tr:first td:eq("+(len-index-1)+")",btd).width(w);$t.resetFrozen()}});$($t.element).bind("gridonsortcol.setFrozenColumns",function(event,ui){var index=ui.id,idxcol=ui.colIndex;if(maxfrozen>=0){var previousSelectedTh=$("tr.coral-grid-labels:last th:eq("+$t.options.lastsort+")",$t.grid.fhDiv),newSelectedTh=$("tr.coral-grid-labels:last th:eq("+idxcol+")",$t.grid.fhDiv);$("span.coral-grid-ico-sort",previousSelectedTh).addClass("coral-state-disabled");$(previousSelectedTh).attr("aria-selected","false");$("span.coral-icon-"+$t.options.sortorder,newSelectedTh).removeClass("coral-state-disabled");$(newSelectedTh).attr("aria-selected","true");if(!$t.options.viewsortcols[0]){if($t.options.lastsort!=idxcol){$("span.s-ico",previousSelectedTh).hide();$("span.s-ico",newSelectedTh).show()}}}if(rightmaxfrozen>=0){idxcol=$t.grid.headers.length-idxcol-1;var previousSelectedTh=$("tr.coral-grid-labels:last th:eq("+$t.options.lastsort+")",$t.grid.rightfhDiv),newSelectedTh=$("tr.coral-grid-labels:last th:eq("+idxcol+")",$t.grid.rightfhDiv);$("span.coral-grid-ico-sort",previousSelectedTh).addClass("coral-state-disabled");$(previousSelectedTh).attr("aria-selected","false");$("span.coral-icon-"+$t.options.sortorder,newSelectedTh).removeClass("coral-state-disabled");$(newSelectedTh).attr("aria-selected","true");if(!$t.options.viewsortcols[0]){if($t.options.lastsort!=idxcol){$("span.s-ico",previousSelectedTh).hide();$("span.s-ico",newSelectedTh).show()}}}});if(maxfrozen>=0){$("#"+$.grid.coralID($t.options.id)).append($t.grid.fbDiv)}if(rightmaxfrozen>=0){$("#"+$.grid.coralID($t.options.id)).append($t.grid.rightfbDiv)
}jQuery($t.grid.rowsView).scroll(function(){if(maxfrozen>=0){jQuery($t.grid.fbDiv).scrollTop(jQuery(this).scrollTop())}if(rightmaxfrozen>=0){jQuery($t.grid.rightfbDiv).scrollTop(jQuery(this).scrollTop())}});if($t.options.hoverrows===true){$("#"+$.grid.coralID($t.options.id)).unbind("mouseover").unbind("mouseout")}$($t.element).bind("gridaftercomplete.setFrozenColumns",function(){$("#"+$.grid.coralID($t.options.id)+"_frozen").remove();var btbl,rightbtbl;if(maxfrozen>=0){btbl=$("#"+$.grid.coralID($t.options.id)+"_table").clone(true);jQuery($t.grid.fbDiv).height(jQuery($t.grid.rowsView).height()-$t.getScrollBarWidth()+2);$("tr",btbl).each(function(){$("td:gt("+maxfrozen+")",this).remove();!$t.options.singleselect||$("td:eq(0)>input",this).attr("name",$("td:eq(0)>input",this).attr("name")+"_forzen")});$(btbl).width(1).attr("id",$t.options.id+"_frozen");$($t.grid.fbDiv).append(btbl);if($t.options.hoverrows===true){$("tr.jqgrow",btbl).hover(function(){$(this).addClass("coral-state-hover");$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID($t.options.id)).addClass("coral-state-hover")},function(){$(this).removeClass("coral-state-hover");$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID($t.options.id)).removeClass("coral-state-hover")});$("tr.jqgrow","#"+$.grid.coralID($t.options.id)).hover(function(){$(this).addClass("coral-state-hover");$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID($t.options.id)+"_frozen").addClass("coral-state-hover")},function(){$(this).removeClass("coral-state-hover");$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID($t.options.id)+"_frozen").removeClass("coral-state-hover")})}btbl=null}if(rightmaxfrozen>=0){if(($($t.grid.rowsView)[0].scrollHeight-$($t.grid.rowsView)[0].clientHeight)>0){$t.grid.rightfhDiv.css({right:($t.getScrollBarWidth()-2)+"px"});$t.grid.rightfbDiv.css({right:($t.getScrollBarWidth()-2)+"px"})}rightbtbl=$("#"+$.grid.coralID($t.options.id)+"_table").clone(true);jQuery($t.grid.rightfbDiv).height(jQuery($t.grid.rowsView).height()-$t.getScrollBarWidth()+2);
$("tr",rightbtbl).each(function(){$("td:lt("+rightmaxfrozen+")",this).remove();!$t.options.singleselect||$("td:eq(0)>input",this).attr("name",$("td:eq(0)>input",this).attr("name")+"_forzen")});$(rightbtbl).width(1).attr("id",$t.options.id+"_frozen");$($t.grid.rightfbDiv).append(rightbtbl);if($t.options.hoverrows===true){$("tr.jqgrow",rightbtbl).hover(function(){$(this).addClass("coral-state-hover");$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID($t.options.id)).addClass("coral-state-hover")},function(){$(this).removeClass("coral-state-hover");$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID($t.options.id)).removeClass("coral-state-hover")});$("tr.jqgrow","#"+$.grid.coralID($t.options.id)).hover(function(){$(this).addClass("coral-state-hover");$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID($t.options.id)+"_frozen").addClass("coral-state-hover")},function(){$(this).removeClass("coral-state-hover");$("#"+$.grid.coralID(this.id),"#"+$.grid.coralID($t.options.id)+"_frozen").removeClass("coral-state-hover")})}rightbtbl=null}});$t.options.frozenColumns=true}},destroyFrozenColumns:function(){if(!this.grid){return}if(this.options.frozenColumns===true){var $t=this;$($t.grid.fhDiv).remove();$($t.grid.fbDiv).remove();$($t.grid.rightfhDiv).remove();$($t.grid.rightfbDiv).remove();$t.grid.fhDiv=null;$t.grid.fbDiv=null;$t.grid.rightfhDiv=null;$t.grid.rightfbDiv=null;$(this.element).unbind(".setFrozenColumns");if($t.options.hoverrows===true){var ptr;$("#"+$.grid.coralID($t.options.id)).bind("mouseover",function(e){ptr=$(e.target).closest("tr.jqgrow");if($(ptr).attr("class")!=="coral-subgrid"){$(ptr).addClass("coral-state-hover")}}).bind("mouseout",function(e){ptr=$(e.target).closest("tr.jqgrow");$(ptr).removeClass("coral-state-hover")})}this.options.frozenColumns=false}}})})(jQuery);$.extend($.grid,{template:function(d){var b=$.makeArray(arguments).slice(1),a,c=b.length;if(d==null){d=""}return d.replace(/\{([\w\-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,function(e,h){if(!isNaN(parseInt(h,10))){return b[parseInt(h,10)]
}for(a=0;a<c;a++){if($.isArray(b[a])){var g=b[a],f=g.length;while(f--){if(h===g[f].nm){return g[f].v}}}}})}});(function(a){a.component("coral.grid",a.coral.grid,{groupingSetup:function(){var f=this,e,d,g,c=f.options.colModel,b=f.options.groupingView;if(b!==null&&((typeof b==="object")||a.isFunction(b))){if(!b.groupField.length){f.options.grouping=false}else{if(b.visibiltyOnNextGrouping===undefined){b.visibiltyOnNextGrouping=[]}b.lastvalues=[];if(!b._locgr){b.groups=[]}b.counters=[];for(e=0;e<b.groupField.length;e++){if(!b.groupOrder[e]){b.groupOrder[e]="asc"}if(!b.groupText[e]){b.groupText[e]="{0}"}if(typeof b.groupColumnShow[e]!=="boolean"){b.groupColumnShow[e]=true}if(typeof b.groupSummary[e]!=="boolean"){b.groupSummary[e]=false}if(!b.groupSummaryPos[e]){b.groupSummaryPos[e]="footer"}if(b.groupColumnShow[e]===true){b.visibiltyOnNextGrouping[e]=true;a(this.element).grid("showCol",b.groupField[e])}else{b.visibiltyOnNextGrouping[e]=a("#"+a.grid.coralID(f.options.id+"_"+b.groupField[e])).is(":visible");a(this.element).grid("hideCol",b.groupField[e])}}b.summary=[];if(b.hideFirstGroupCol){b.formatDisplayField[0]=function(h){return h}}for(d=0,g=c.length;d<g;d++){if(b.hideFirstGroupCol){if(!c[d].hidden&&b.groupField[0]===c[d].name){c[d].formatter=function(){return""}}}if(c[d].summaryType){if(c[d].summaryDivider){b.summary.push({nm:c[d].name,st:c[d].summaryType,v:"",sd:c[d].summaryDivider,vd:"",sr:c[d].summaryRound,srt:c[d].summaryRoundType||"round"})}else{b.summary.push({nm:c[d].name,st:c[d].summaryType,v:"",sr:c[d].summaryRound,srt:c[d].summaryRoundType||"round"})}}}}}else{this.options.grouping=false}},groupingPrepare:function(d,e){var k=this.options.groupingView,c,j=k.groupField.length,l,h,g,f,b=0;for(c=0;c<j;c++){l=k.groupField[c];g=k.displayField[c];h=d[l];f=g==null?null:d[g];if(f==null){f=h}if(h!==undefined){if(e===0){k.groups.push({idx:c,dataIndex:l,value:h,displayValue:f,startRow:e,cnt:1,summary:[]});k.lastvalues[c]=h;k.counters[c]={cnt:1,pos:k.groups.length-1,summary:a.extend(true,[],k.summary)};
a.each(k.counters[c].summary,function(){if(a.isFunction(this.st)){this.v=this.st.call(this,this.v,this.nm,d)}else{this.v=a(this.element).grid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,d);if(this.st.toLowerCase()==="avg"&&this.sd){this.vd=a(this.element).grid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,d)}}});k.groups[k.counters[c].pos].summary=k.counters[c].summary}else{if(typeof h!=="object"&&(a.isArray(k.isInTheSameGroup)&&a.isFunction(k.isInTheSameGroup[c])?!k.isInTheSameGroup[c].call(this,k.lastvalues[c],h,c,k):k.lastvalues[c]!==h)){k.groups.push({idx:c,dataIndex:l,value:h,displayValue:f,startRow:e,cnt:1,summary:[]});k.lastvalues[c]=h;b=1;k.counters[c]={cnt:1,pos:k.groups.length-1,summary:a.extend(true,[],k.summary)};a.each(k.counters[c].summary,function(){if(a.isFunction(this.st)){this.v=this.st.call(this,this.v,this.nm,d)}else{this.v=a(this.element).grid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,d);if(this.st.toLowerCase()==="avg"&&this.sd){this.vd=a(this.element).grid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,d)}}});k.groups[k.counters[c].pos].summary=k.counters[c].summary}else{if(b===1){k.groups.push({idx:c,dataIndex:l,value:h,displayValue:f,startRow:e,cnt:1,summary:[]});k.lastvalues[c]=h;k.counters[c]={cnt:1,pos:k.groups.length-1,summary:a.extend(true,[],k.summary)};a.each(k.counters[c].summary,function(){if(a.isFunction(this.st)){this.v=this.st.call(this,this.v,this.nm,d)}else{this.v=a(this.element).grid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,d);if(this.st.toLowerCase()==="avg"&&this.sd){this.vd=a(this.element).grid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,d)}}});k.groups[k.counters[c].pos].summary=k.counters[c].summary}else{k.counters[c].cnt+=1;k.groups[k.counters[c].pos].cnt=k.counters[c].cnt;a.each(k.counters[c].summary,function(){if(a.isFunction(this.st)){this.v=this.st.call(this,this.v,this.nm,d)
}else{this.v=a(this.element).grid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,d);if(this.st.toLowerCase()==="avg"&&this.sd){this.vd=a(this.element).grid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,d)}}});k.groups[k.counters[c].pos].summary=k.counters[c].summary}}}}}return this},groupingToggle:function(c){var f=this,h=f.options.groupingView,t=c.split("_"),g=parseInt(t[t.length-2],10);t.splice(t.length-2,2);var e=t.join("_"),b=h.minusicon,s=h.plusicon,q=a("#"+a.grid.coralID(c)),k=q.length?q[0].nextSibling:null,i=a("#"+a.grid.coralID(c)+" span.tree-wrap-"+f.options.direction),p=function(r){var u=a.map(r.split(" "),function(v){if(v.substring(0,e.length+1)===e+"_"){return parseInt(v.substring(e.length+1),10)}});return u.length>0?u[0]:undefined},o,j,d=false,l=f.options.frozenColumns?f.options.id+"_frozen":false,m=l?a("#"+a.grid.coralID(c),"#"+a.grid.coralID(l)):false,n=(m&&m.length)?m[0].nextSibling:null;if(i.hasClass(b)){if(h.showSummaryOnHide){if(k){while(k){o=p(k.className);if(o!==undefined&&o<=g){break}a(k).hide();k=k.nextSibling;if(l){a(n).hide();n=n.nextSibling}}}}else{if(k){while(k){o=p(k.className);if(o!==undefined&&o<=g){break}a(k).hide();k=k.nextSibling;if(l){a(n).hide();n=n.nextSibling}}}}i.removeClass(b).addClass(s);d=true}else{if(k){j=undefined;while(k){o=p(k.className);if(j===undefined){j=o===undefined}if(o!==undefined){if(o<=g){break}if(o===g+1){a(k).show().find(">td>span.tree-wrap-"+f.options.direction).removeClass(b).addClass(s);if(l){a(n).show().find(">td>span.tree-wrap-"+f.options.direction).removeClass(b).addClass(s)}}}else{if(j){a(k).show();if(l){a(n).show()}}}k=k.nextSibling;if(l){n=n.nextSibling}}}i.removeClass(s).addClass(b)}this._trigger("onClickGroup",null,[{headId:c,collapsed:d}]);return false},groupingRender:function(t,h,e,k){var i=this,j=i.options.groupingView,p="",s="",d,c,m=j.groupCollapse?j.plusicon:j.minusicon,l,g=[],q=j.groupField.length;m+=" tree-wrap-"+i.options.direction;a.each(i.options.colModel,function(u,w){var v;
for(v=0;v<q;v++){if(j.groupField[v]===w.name){g[v]=u;break}}});var n=0;function f(x,y,u){var v=false,w;if(y===0){v=u[x]}else{var z=u[x].idx;if(z===0){v=u[x]}else{for(w=x;w>=0;w--){if(u[w].idx===z-y){v=u[w];break}}}}return v}function b(w,B,E,z){var x=f(w,B,E),C=i.options.colModel,A,D=x.cnt,y="",v;for(v=z;v<h;v++){var u="<td "+this.formatCol(v,1,"")+">&#160;</td>",F="{0}";a.each(x.summary,function(){if(this.nm===C[v].name){if(C[v].summaryTpl){F=C[v].summaryTpl}if(typeof this.st==="string"&&this.st.toLowerCase()==="avg"){if(this.sd&&this.vd){this.v=(this.v/this.vd)}else{if(this.v&&D>0){this.v=(this.v/D)}}}try{this.groupCount=x.cnt;this.groupIndex=x.dataIndex;this.groupValue=x.value;A=this.formatter("",this.v,v,this)}catch(G){A=this.v}u="<td "+this.formatCol(v,1,"")+">"+a.grid.format(F,A)+"</td>";return false}});y+=u}return y}var o=a.makeArray(j.groupSummary),r;o.reverse();r=i.options.multiselect?' colspan="2"':"";a.each(j.groups,function(z,w){if(j._locgr){if(!(w.startRow+w.cnt>(e-1)*k&&w.startRow<e*k)){return true}}n++;c=i.options.id+"ghead_"+w.idx;d=c+"_"+z;s="<span style='cursor:pointer;' class='icon "+m+"' onclick=\"jQuery('#"+a.grid.coralID(i.options.id)+"').grid('groupingToggle','"+d+"');return false;\"></span>";try{if(a.isArray(j.formatDisplayField)&&a.isFunction(j.formatDisplayField[w.idx])){w.displayValue=j.formatDisplayField[w.idx].call(this,w.displayValue,w.value,i.options.colModel[g[w.idx]],w.idx,j);l=w.displayValue}else{l=this.formatter(d,w.displayValue,g[w.idx],w.value)}}catch(F){l=w.displayValue}if(j.groupSummaryPos[w.idx]==="header"){p+='<tr id="'+d+'"'+(j.groupCollapse&&w.idx>0?' style="display:none;" ':" ")+'role="row" class= "coral-component-content jqgroup coral-row-'+i.options.direction+" "+c+'"><td style="padding-left:'+(w.idx*12)+'px;"'+r+">"+s+a.grid.template(j.groupText[w.idx],l,w.cnt,w.summary)+"</td>";p+=b(z,0,j.groups,j.groupColumnShow[w.idx]===false?(r===""?2:3):((r==="")?1:2));p+="</tr>"}else{p+='<tr id="'+d+'"'+(j.groupCollapse&&w.idx>0?' style="display:none;" ':" ")+'role="row" class= "coral-component-content jqgroup coral-row-'+i.options.direction+" "+c+'"><td style="padding-left:'+(w.idx*12)+'px;" colspan="'+(j.groupColumnShow[w.idx]===false?h-1:h)+'">'+s+a.grid.template(j.groupText[w.idx],l,w.cnt,w.summary)+"</td></tr>"
}var B=q-1===w.idx;if(B){var C=j.groups[z+1],u,E,y=0,v=w.startRow,x=C!==undefined?C.startRow:j.groups[z].startRow+j.groups[z].cnt;if(j._locgr){y=(e-1)*k;if(y>w.startRow){v=y}}for(u=v;u<x;u++){if(!t[u-y]){break}p+=t[u-y].join("")}if(j.groupSummaryPos[w.idx]!=="header"){var A;if(C!==undefined){for(A=0;A<j.groupField.length;A++){if(C.dataIndex===j.groupField[A]){break}}n=j.groupField.length-A}for(E=0;E<n;E++){if(!o[E]){continue}var D="";if(j.groupCollapse&&!j.showSummaryOnHide){D=' style="display:none;"'}p+="<tr"+D+' jqfootlevel="'+(w.idx-E)+'" role="row" class="coral-component-content jqfoot coral-row-'+i.options.direction+'">';p+=b(z,E,j.groups,0);p+="</tr>"}n=A}}});a("#"+a.grid.coralID(i.options.id)+" tbody:first").append(p);p=null},groupingGroupBy:function(d,c){var f=this;if(typeof d==="string"){d=[d]}var b=f.options.groupingView;f.options.grouping=true;if(b.visibiltyOnNextGrouping===undefined){b.visibiltyOnNextGrouping=[]}var e;for(e=0;e<b.groupField.length;e++){if(!b.groupColumnShow[e]&&b.visibiltyOnNextGrouping[e]){a(this).grid("showCol",b.groupField[e])}}for(e=0;e<d.length;e++){b.visibiltyOnNextGrouping[e]=a("#"+a.grid.coralID(f.options.id)+"_"+a.grid.coralID(d[e])).is(":visible")}f.options.groupingView=a.extend(f.options.groupingView,c||{});b.groupField=d;a(this).trigger("reloadGrid")},groupingRemove:function(e){var d=this;if(e===undefined){e=true}d.options.grouping=false;if(e===true){var b=d.options.groupingView,c;for(c=0;c<b.groupField.length;c++){if(!b.groupColumnShow[c]&&b.visibiltyOnNextGrouping[c]){a(this).grid("showCol",b.groupField)}}a("tr.jqgroup, tr.jqfoot","#"+a.grid.coralID(d.options.id)+" tbody:first").remove();a("tr.jqgrow:hidden","#"+a.grid.coralID(d.options.id)+" tbody:first").show()}else{a(this).trigger("reloadGrid")}},groupingCalculations:{handler:function(f,i,g,j,h,b){var c={sum:function(){return parseFloat(i||0)+parseFloat((b[g]||0))},min:function(){if(i===""){return parseFloat(b[g]||0)}return Math.min(parseFloat(i),parseFloat(b[g]||0))},max:function(){if(i===""){return parseFloat(b[g]||0)
}return Math.max(parseFloat(i),parseFloat(b[g]||0))},count:function(){if(i===""){i=0}if(b.hasOwnProperty(g)){return i+1}return 0},avg:function(){return c.sum()}};if(!c[f]){throw ("jqGrid Grouping No such method: "+f)}var e=c[f]();if(j!=null){if(h==="fixed"){e=e.toFixed(j)}else{var d=Math.pow(10,j);e=Math.round(e*d)/d}}return e}}})})(jQuery);