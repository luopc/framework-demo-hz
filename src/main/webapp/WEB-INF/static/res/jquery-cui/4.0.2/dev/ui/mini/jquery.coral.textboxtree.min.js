(function(b,c){b.component("coral.autocompletetree",b.coral.autocomplete,{requestIndex:0,pending:0,options:{allowPushParent:false},_create:function(){this.options.render="tree";this._super();b(this.element).easyText({minWidth:20,maxWidth:200,maxChars:60});this._on(this.document,{click:function(d){this._moveInput("last",d)}})},_filter:function(f,e,d){b(this.menu.element).tree("reload",null,f);b(this.menu.element).tree("filterNodesByParam",{name:e.term});d(f)},_initData:function(){var e=this;this.menu={};var d=b("<ul>")[0];b(d).uniqueId().addClass("coral-autocomplete-panel coral-front").appendTo(this._appendTo()).tree({showLine:false,showIcon:false,componentCls:"coral-autocomplete-tree",addDiyDom:function(i,h){var k=15;var g=b("#"+h.tId+"_switch"),j=b("#"+h.tId+"_ico");g.remove();j.before(g);if(h.level>0){var f="<span style='display: inline-block;width:"+(k*h.level)+"px'></span>";g.before(f)}g.remove()},beforeClick:function(g,f){if(!e.options.allowPushParent&&f.isParent){return false}},onClick:function(h,j,i){var g=i,f=e.previous;if(e.element[0]!==e.document[0].activeElement){e.element.focus();e.previous=f;e._delay(function(){e.previous=f;e.selectedItem=g})}if(false!==e._trigger("onNodeClick",h,{item:g})){e._value(g[e.options.valueField]);e.selectedItems.push(g);e._change(h)}e.term=e._text();e.close(h);e.selectedItem=g}}).hide();this.menu.element=b(d)},_initAutocomplete:function(){var f=this.element[0].nodeName.toLowerCase(),e=f==="textarea",d=f==="input";this.isMultiLine=e?true:d?false:this.element.prop("isContentEditable");this.autocompleteWrapper=b('<span class="coral-autocomplete coral-textboxlist coral-textbox" style="border-width: 0;"></span>').insertAfter(this.element);this.autocompleteBorder=b("<span class='coral-textbox-border coral-corner-all clearfix'></span>").appendTo(this.autocompleteWrapper);this.valuebox=b("<input type='hidden'>").appendTo(this.autocompleteBorder);this.valueMethod=this.valuebox[e||d?"val":"text"];this.textMethod=this.element[e||d?"val":"text"];
this.element.addClass("ctrl-form-element coral-validation-autocomplete coral-autocomplete-input coral-autocomplete-text coral-textbox-default coral-form-element-autocomplete").attr("autocomplete","off");this.textboxlistUl=b("<ul class='coral-textboxlist-ul'><li class='coral-textboxlist-inputLi'></li></ul>");this.textboxlistUl.appendTo(this.autocompleteBorder);this.element.appendTo(this.textboxlistUl.find(".coral-textboxlist-inputLi"));if(this.options.buttons.length>0){this._createButtonPanel()}if(typeof this.element.attr("id")!="undefined"){this.options.id=this.element.attr("id")}else{if(this.options.id){this.element.attr("id",this.options.id)}}if(typeof this.element.attr("name")!="undefined"){this.options.name=this.element.attr("name");this.valuebox.attr("name",this.options.name);this.element.removeAttr("name")}else{if(this.options.name){this.valuebox.attr("name",this.options.name)}}if(this.options.text){this._text(this.options.text)}if(b.trim(this.valuebox.val())!=""){this.options.value=this.valuebox.val()}},_bindEvent:function(){this._super();this._on({"click .coral-label-close":function(d){this._removeLabel(d)},"click .coral-textboxlist-item":function(d){d.stopPropagation()},"click .coral-textbox-border":function(d){this.element.focus()},"mouseenter .coral-label-close":function(d){b(d.target).addClass("coral-label-close-hover")},"mouseleave .coral-label-close":function(d){b(d.target).removeClass("coral-label-close-hover")},"focus .coral-textboxlist-item":function(d){b(d.target).addClass("coral-state-active")},"blur .coral-textboxlist-item":function(d){b(d.target).removeClass("coral-state-active")},"keydown .coral-state-active":function(f){var d=b.coral.keyCode;switch(f.keyCode){case d.LEFT:this._moveInput("left",f);break;case d.RIGHT:this._moveInput("right",f);break;case d.BACKSPACE:this._removeLabel(f);break;case d.DELETE:this._removeLabel(f);break;default:break}}})},_term:function(){return this.element.val()},_removeLabel:function(k){var g=this.element.closest("li.coral-textboxlist-inputLi"),i=b(k.target).closest("li.coral-textboxlist-item"),j=b(k.target).closest("li.coral-textboxlist-item:last");
g.insertAfter(j);var h=g.index();var l=i.index();var f=l;if(l>h){f=l-1}i.remove();var d=this.valuebox.val()==""?[]:this.valuebox.val().split(",");d.splice(f,1);this.selectedItems.splice(f,1);this.valuebox.val(d.join(","));this._moveInput("last",k);this.element.val("");this.element.focus()},_moveInput:function(i,h){var d=this.element.closest("li.coral-textboxlist-inputLi");var f=b(h.target).closest("li.coral-textboxlist-item");var g=b(d).closest("li.coral-textboxlist-inputLi").nextAll("li.coral-textboxlist-item").last();switch(i){case"left":d.insertBefore(f);this.element.val("");this.element.focus();break;case"right":d.insertAfter(f);this.element.val("");this.element.focus();break;case"last":d.insertAfter(g);this.element.val("");break}},_moveItem:function(g,f){var d=this.element.closest("li.coral-textboxlist-inputLi");if(g=="left"&&d.prev().length&&b(d.find("input")).caret()==0){this.element.val("");d.prev().focus()}if(g=="right"&&d.next().length&&b(d.find("input")).caret()==d.find("input").val().length){this.element.val("");d.next().focus()}},_setValues:function(d){this._value(d)},_value:function(j){var f=this;if(!j){return this.valuebox.val()}var g=this.element.closest("li.coral-textboxlist-inputLi"),l=g.index(),h=l,k=this.valuebox.val()==""?[]:this.valuebox.val().split(",");k.splice(h,0,j);if(b.trim(j)!==""&&b.isArray(this.options.source)){var i=b(this.menu.element).tree("transformToArray",this.options.source),d=[],e=b.grep(j.split(","),function(m){var n=false;b.each(i,function(o){if(m==i[o][f.options.valueField]){d.push(i[o][f.options.textField]);return true}});return n});if(d.length){this.setText(d)}}else{if(b.trim(j)==""){this.setText(j)}}return this.valuebox.val(k.join(","))},_text:function(f){if(!f){var e=[];b.each(this.textboxlistUl.find(".coral-textboxlist-item"),function(){e.push(b(this).text())});return e.join(",")}var d="";if(f instanceof Array){b.each(f,function(g){f.splice(g,1,"<li tabindex='-1' class='coral-textboxlist-item'>"+this+"<span class='coral-label-close icon icon-close2'></span></li>")
});d=f.join("")}else{d="<li tabindex='-1' class='coral-textboxlist-item'>"+f+"<span class='coral-label-close icon icon-close2'></span></li>"}this.textboxlistUl.find(".coral-textboxlist-inputLi").before(d)}});var a=b.coral.autocomplete})(jQuery);(function(f,e,a,g){var b="easyInput",d="easyText",c=b+d.charAt(0).toUpperCase()+d.slice(1);f.component(b+"."+d,{options:{currentValue:"",values:[],maxWidth:200,minWidth:80,maxChars:200,storage:"array",ajaxConfig:{url:"/",id:"",UPDATETemplate:"",UPDATEData:{},GETCallback:null}},_name:d,_input:null,_id:null,_valuesIndex:null,_classUnChanged:null,_classEmpty:null,_classOnEdit:null,_classChanged:null,_classEasyText:d.toLowerCase(),_setListeners:function(){this._input.bind({focus:this._focusBehaviour,input:this._autoGrownBehaviour,blur:this._blurBehaviour,storageChange:this._storageChange})},_getClassName:function(h){return this._name.toLowerCase()+"-"+h},_setClassNames:function(){this._classOnHover=this._getClassName("onHover");this._classUnChanged=this._getClassName("unChanged");this._classOnEdit=this._getClassName("onEdit");this._classChanged=this._getClassName("changed");this._classEmpty=this._getClassName("empty")},_setVars:function(){var h=this.element;this._input=h;h.uniqueId();this._valuesIndex=0;this._id=this._name+"-"+h.attr("id");h.attr("maxLength",this.options.maxChars)},_setRuler:function(){var i="#"+this._name+"-ruler",j=f(i),h=this._input;if(!j.length){String.prototype.visualLength=function(){var k=f(i);k.html(this.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"));return k.width()};j=f('<span id="'+i.substr(1)+'"></span>');j.css({fontSize:h.css("fontSize"),fontFamily:h.css("font-family"),fontWeight:h.css("fontWeight"),position:"absolute",visibility:"hidden",whiteSpace:"nowrap"});f("body").after(j)}},_initializeAjax:function(){var h=this.options.ajaxConfig;if(!f.isFunction(h.GETCallback)){return}if(h.url.charAt(h.url.length-1)!=="/"){h.url+="/"}if(!h.id){h.id=this._id}f.ajax({url:h.url+h.id,succes:h.GETCallback})
},_setState:function(){var h=this._input,m=h.val(),i=m.visualLength(),k=this.options.minWidth,l=this.options.maxWidth,j;if(i<k){j=k}else{if(l<i){j=l}else{j=i}}h.width(j);if(h.val().length===0){h.removeClass(this._classChanged);h.addClass(this._classEmpty)}else{h.addClass(this._classChanged)}},_focusBehaviour:function(){var i=f(this).data(c),h=i._input;h.removeClass(i._classChanged+" "+i._classUnChanged+" "+i._classEmpty).addClass(i._classOnEdit)},_autoGrownBehaviour:function(){var l=f(this).data(c),h=l._input,m=h.val(),j=l.options.minWidth,k=l.options.maxWidth,i=m.visualLength();if(i<j){i=j}else{if(i>k){i=k}}h.width(i)},_blurBehaviour:function(){var j=f(this).data(c),h=j._input,k=h.val(),i=j.options.ajaxConfig,l;h.removeClass(j._classOnEdit);if(k.length===0){h.addClass(j._classEmpty)}else{h.addClass(j._classChanged);j.option("values",k);j._valuesIndex=j.option("values").length-1;if(j.options.storage==="ajax"){i.UPDATEData.value=h.val();f.ajax({url:i.url+i.id,data:j._tmpl(i.UPDATETemplate,i.UPDATEData),type:"UPDATE"})}}j._setState()},_tmpl:function(j,i){var h=typeof(j)!=="string"?(function(){throw {name:"Invalid Parameter",message:"You must insert a string into the function"}}()):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+j.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return i?h(i):h},_setOption:function(i,j){var h=this.options;switch(i){case"values":h.values.push(j);if(h.storage==="localStorage"){localStorage.setItem(this._id,JSON.stringify(h.values))}return;case"currentValue":this.option("values",j);this._input.val(j);break}this._super("_setOption",i,j)},_create:function(){var i,h,j=this.options.storage;this._setClassNames();this._setVars();this._setListeners();h=this._input;h.addClass(this._classEasyText);if(j==="localStorage"){if(localStorage[this._id]){i=JSON.parse(localStorage[this._id]);
this.options.values=i;h.val(i[i.length-1]);this._valuesIndex=i.length-1}}else{if(j==="ajax"){this._initializeAjax()}}this._setRuler();this._setState()},_destroy:function(){this._input.attr("class","")},deleteStorage:function(){var i=this.options.ajaxConfig,h=this.options.storage;if(h==="localStorage"){localStorage.removeItem(this._id)}else{if(h==="ajax"){f.ajax({url:i.url+i.id,type:"DELETE"})}}this.options.values=[];this._input.val("");this._setState()},getNextBackValue:function(j){var h=this.option("values"),i=this._valuesIndex;if(j===g){j=true}if(typeof(j)!=="boolean"){throw new Error("Invalid parameter")}i+=j?1:(-1);if(h[i]===g){return -1}this._valuesIndex=i;this._input.val(h[i]);this._setState();return h[i]}})})(jQuery,window,document);