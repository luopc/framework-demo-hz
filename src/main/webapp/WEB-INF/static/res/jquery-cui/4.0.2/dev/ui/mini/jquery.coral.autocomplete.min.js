(function(b,c){b.component("coral.autocomplete",b.coral.inputbase,{version:"4.0.2",defaultElement:"<input>",castProperties:["source","buttons","rootNode","triggers"],options:{appendTo:"body",autoFocus:false,allowRepeat:false,asyncType:"post",delay:300,maxLabelWidth:"auto",multiLineLabel:false,minLength:0,minHeight:1,height:"auto",multiple:false,position:{my:"left top",at:"left bottom",collision:"none"},value:"",text:"",forceSelection:false,defaultValue:"",postMode:"value",required:false,showStar:true,separator:",",buttons:[],errMsg:null,errMsgPosition:"leftBottom",panelHeight:"auto",maxPanelHeight:200,iframePanel:false,isLabel:false,source:null,valueField:"value",textField:"label",searchField:"valueField",onValidSuccess:null,onValidError:null,onChange:null,onBlur:null,onClose:null,onFocus:null,onOpen:null,oncancel:null,onResponse:null,onSearch:null,onSelect:null,triggers:null,excluded:false},requestIndex:0,pending:0,_create:function(){var d=this;this._prepareInit();this._initAutocomplete();this._initState();this._initSource();this._initData();this._bindEvent();this._setDefaultValue();this._setDefaultText();this.liveRegion=b("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("coral-helper-hidden-accessible").appendTo(this.document[0].body);this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}});if(this.options.multiLineLabel){b(this.element).easyText({minWidth:10,maxWidth:200,maxChars:60});this._on(this.document,{click:function(e){if(this.options.readonly||this.options.isLabel){return}this._moveInput("last",e)}})}},_prepareInit:function(){this.lastSelectedItem={};this.selectedItems=[];this.isNewMenu=true},_initAutocomplete:function(){var f=this.options.render=="tree"?"autocompletetree":"autocomplete";if(this.options.iframePanel){this.iframePanel=b("<iframe class='coral-autocomplete-iframePanel' style='position:absolute;display:none;'></iframe>").appendTo("body")}if(this.options.multiLineLabel){var e=this,h=this.element[0].nodeName.toLowerCase(),g=h==="textarea",d=h==="input";
this.ismultiLineLabel=g?true:d?false:this.element.prop("isContentEditable");this.autocompleteWrapper=b("<span class='coral-"+f+" coral-textboxlist coral-textbox'></span>").insertAfter(this.element);this.elementBorder=b("<span class='coral-textbox-border coral-corner-all'></span>").css({minHeight:this.options.minHeight+"px",height:this.options.height,overflow:"auto"}).appendTo(this.autocompleteWrapper);this.valuebox=b("<input type='hidden'>").appendTo(this.elementBorder);this.valueMethod=this.valuebox[g||d?"val":"text"];this.textMethod=this.element[g||d?"val":"text"];this.element.addClass("coral-validation-"+f+" coral-autocomplete-input coral-autocomplete-text coral-textbox-default").attr("autocomplete","off");this.textboxlistUl=b("<ul class='coral-textboxlist-ul'><li class='coral-textboxlist-inputLi'></li></ul>");this.textboxlistUl.appendTo(this.elementBorder);this.element.appendTo(this.textboxlistUl.find(".coral-textboxlist-inputLi"));if(this.options.buttons.length>0){this._createButtonPanel()}if(typeof this.element.attr("id")!="undefined"){this.options.id=this.element.attr("id")}else{if(this.options.id){this.element.attr("id",this.options.id)}}if(typeof this.element.attr("name")!="undefined"){this.options.name=this.element.attr("name");this.valuebox.attr("name",this.options.name);this.element.removeAttr("name")}else{if(this.options.name){this.valuebox.attr("name",this.options.name)}}if(this.options.text){this.setText(this.options.text)}if(b.trim(this.valuebox.val())!=""){this.options.value=this.valuebox.val()}if(this.options.showPopup){}}else{var h=this.element[0].nodeName.toLowerCase(),g=h==="textarea",d=h==="input";this.ismultiLineLabel=g?true:d?false:this.element.prop("isContentEditable");this.autocompleteWrapper=b('<span class="coral-'+f+' coral-textbox" style="border-width: 0;"></span>').insertAfter(this.element);this.elementBorder=b('<span class="coral-textbox-border coral-corner-all"></span>').css({minHeight:this.options.minHeight+"px"}).appendTo(this.autocompleteWrapper);
this.valuebox=b("<input type='hidden'>").appendTo(this.elementBorder);this.valueMethod=this.valuebox[g||d?"val":"text"];this.textMethod=this.element[g||d?"val":"text"];this.element.addClass("coral-validation-"+f+" coral-autocomplete-input coral-autocomplete-text coral-textbox-default coral-form-element-autocomplete").attr("autocomplete","off");this.element.appendTo(this.elementBorder);if(this.options.buttons.length>0){this._createButtonPanel()}if(typeof this.element.attr("id")!="undefined"){this.options.id=this.element.attr("id")}else{if(this.options.id){this.element.attr("id",this.options.id)}}if(typeof this.element.attr("name")!="undefined"){this.options.name=this.element.attr("name");this.valuebox.attr("name",this.options.name);this.element.removeAttr("name")}else{if(this.options.name){this.valuebox.attr("name",this.options.name)}}if(this.options.text){this.setText(this.options.text)}if(b.trim(this.valuebox.val())!=""){this.options.value=this.valuebox.val()}}},_initState:function(){if(this.element.prop("readonly")||this.options.readonly){this.options.readonly=true;this.valuebox.prop("readonly",true);this.element.prop("readonly",true);this.component().addClass("coral-readonly")}if(this.options.isLabel){this.element.prop("readonly",true);this.valuebox.prop("readonly",true);this.component().addClass("coral-isLabel")}},reset:function(){this.setValue(this.originalValue)},_bindEvent:function(){var f=this,e,d,g;this._on(this.element,{mouseenter:function(h){if(f.options.disabled||f.options.isLabel||f.options.readonly){return}f.autocompleteWrapper.addClass("coral-textbox-hover")},mouseleave:function(h){if(f.options.disabled||f.options.isLabel||f.options.readonly){return}f.autocompleteWrapper.removeClass("coral-textbox-hover")},keyup:function(h){if(this.options.readonly||this.options.isLabel){return}this._trigger("onKeyUp",h,{})},keydown:function(h){if(f.options.disabled||f.options.isLabel||f.options.readonly){return}if(this.element.prop("readOnly")){e=true;g=true;d=true;return
}e=false;g=false;d=false;var i=b.coral.keyCode;switch(h.keyCode){case i.PAGE_UP:if(this.options.render=="tree"){break}e=true;this._move("previousPage",h);break;case i.PAGE_DOWN:if(this.options.render=="tree"){break}e=true;this._move("nextPage",h);break;case i.LEFT:e=true;this._moveItem("left",h);break;case i.RIGHT:e=true;this._moveItem("right",h);break;case i.UP:if(this.options.render=="tree"){break}e=true;this._keyEvent("previous",h);break;case i.DOWN:if(this.options.render=="tree"){break}e=true;this._keyEvent("next",h);break;case i.ENTER:if(this.menu.active){e=true;h.preventDefault();this.menu.select(h)}break;case i.TAB:if(this.menu.active){this.menu.select(h)}break;case i.ESCAPE:if(this.menu.element.is(":visible")){if(!this.ismultiLineLabel){this.setValue(this.term,true)}this.close(h);h.preventDefault()}break;default:d=true;this._searchTimeout(h);break}this._trigger("onKeyDown",h,{})},keypress:function(h){if(f.options.disabled||f.options.isLabel||f.options.readonly){return}if(e){e=false;if(!this.ismultiLineLabel||this.menu.element.is(":visible")){h.preventDefault()}return}if(d){return}if(this.options.render=="tree"){return}var i=b.coral.keyCode;switch(h.keyCode){case i.PAGE_UP:this._move("previousPage",h);break;case i.PAGE_DOWN:this._move("nextPage",h);break;case i.UP:this._keyEvent("previous",h);break;case i.DOWN:this._keyEvent("next",h);break;default:break}},input:function(h){if(f.options.disabled||f.options.isLabel||f.options.readonly){return}if(g){g=false;h.preventDefault();return}this._searchTimeout(h)},focus:function(){if(f.options.disabled||f.options.isLabel||f.options.readonly){return}this.selectedItem=null;this.previous=this.getValue();this.component().addClass("coral-state-focus")},blur:function(i){this.component().removeClass("coral-state-focus");if(f.options.disabled||f.options.isLabel||f.options.readonly){return}if(this.cancelBlur){delete this.cancelBlur;return}clearTimeout(this.searching);this.close(i);if(!this.options.multiLineLabel){if(this.options.multiple){}else{if(!this.options.forceSelection){if(this.lastSelectedItem[this.options.textField]!=this.element.val()){this.setValue(this.element.val(),true)
}}else{if(this.options.render=="tree"){}else{var h=b.grep(this.responseItems,function(j){return j[f.options.textField]==f.element.val()});if(!h.length){this.setValue("",true)}else{this.setValue(h[0][f.options.valueField],true)}}}}}this._trigger("onBlur",i,{item:this.selectedItem})}});this._on(this.menu.element,{mousedown:function(h){if(this.options.readonly||this.options.isLabel){return}h.preventDefault();this.cancelBlur=true;this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];if(!b(h.target).closest(".coral-menu-item").length){this._delay(function(){var j=this;this.document.one("mousedown",function(k){if(k.target!==j.element[0]&&k.target!==i&&!b.contains(i,k.target)){j.close()}})})}},menuonfocus:function(j,k){if(this.options.readonly||this.options.isLabel){return}var h,i;if(this.isNewMenu){this.isNewMenu=false;if(j.originalEvent&&/^mouse/.test(j.originalEvent.type)){this.menu.blur();this.document.one("mousemove",function(){b(j.target).trigger(j.originalEvent)});return}}i=k.item.data("coral-autocomplete-item");if(false!==this._trigger("onFocus",j,{item:i})){if(j.originalEvent&&/^key/.test(j.originalEvent.type)){}}h=k.item.attr("aria-label")||i[this.options.valueField];if(h&&b.trim(h).length){this.liveRegion.children().hide();b("<div>").text(h).appendTo(this.liveRegion)}},menuonselect:function(j,m){if(this.options.readonly||this.options.isLabel){return}var i=m.item.data("coral-autocomplete-item"),h=this.previous;if(this.element[0]!==this.document[0].activeElement){this.element.focus();this.previous=h;this._delay(function(){this.previous=h;this.selectedItem=i;f.lastSelectedItem=i})}f.lastSelectedItem=i;this.selectedItem=i;if(false!==this._trigger("onSelect",j,{item:i})){var i=m.item.data("coral-autocomplete-item");valueField=i[this.options.valueField];textField=i[this.options.textField];var l=f.getValue(),o=f.getText(),k=l==""?[]:l.split(this.options.separator),n=o==""?[]:o.split(this.options.separator);if(f.options.multiple){if(this.options.postMode=="value"){if(!this.options.allowRepeat&&b.inArray(valueField,k)>-1){return
}k.push(valueField);n.push(textField);this.setText(n.join(this.options.separator));this.setValue(k.join(this.options.separator),true)}if(this.options.postMode=="text"){if(!this.options.allowRepeat&&b.inArray(textField,n)>-1){return}n.push(textField);f.setValue(n.join(this.options.separator),true)}if(this.options.postMode=="value-text"){if(!this.options.allowRepeat&&b.inArray(valueField+"-"+textField,k+"-"+n)>-1){return}k.push(valueField);n.push(textField);this.setValue(k.join(this.options.separator)+"-"+n.join(this.options.separator),true)}}else{if(this.options.postMode=="value"){this.setText(i[this.options.textField],true);this.setValue(i[this.options.valueField],true)}if(this.options.postMode=="text"){this.setValue(i[this.options.textField],true)}if(this.options.postMode=="value-text"){this.setValue(i[this.options.valueField]+"-"+i[this.options.textField],true)}}}this.term=this.getText();this.close(j)}});if(this.options.multiLineLabel){this._on({"click .coral-label-close":function(h){if(this.options.readonly||this.options.isLabel){return}this._removeLabel(h)},"click .coral-textboxlist-item":function(h){if(this.options.readonly||this.options.isLabel){return}h.stopPropagation()},"click .coral-textbox-border":function(h){if(this.options.readonly||this.options.isLabel){return}this.element.focus()},"mouseenter .coral-label-close":function(h){b(h.target).addClass("coral-label-close-hover")},"mouseleave .coral-label-close":function(h){b(h.target).removeClass("coral-label-close-hover")},"focus .coral-textboxlist-item":function(h){if(this.options.readonly||this.options.isLabel){return}b(h.target).addClass("coral-state-active")},"blur .coral-textboxlist-item":function(h){b(h.target).removeClass("coral-state-active")},"keydown .coral-state-active":function(i){if(this.options.readonly||this.options.isLabel){return}var h=b.coral.keyCode;switch(i.keyCode){case h.LEFT:this._moveInput("left",i);break;case h.RIGHT:this._moveInput("right",i);break;case h.BACKSPACE:this._removeLabel(i);
break;case h.DELETE:this._removeLabel(i);break;default:break}}})}},_initData:function(){var e=this;var d=this.options;this.menu=b("<ul>").addClass("coral-autocomplete-panel coral-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance");if(isNaN(d.panelHeight)){b(".coral-autocomplete-panel").css({"max-height":d.maxPanelHeight+"px"});b(".coral-autocomplete-iframePanel").css({"max-height":d.maxPanelHeight+"px"})}},_setDefaultValue:function(){if(!this.options.value){this.originalValue="";return}else{this.setValue(this.options.value);this.originalValue=this.getValue()}},_setDefaultText:function(){if(!this.options.text){return}this.setText(this.options.text)},getLastSelectedItem:function(){return this.lastSelectedItem},_destroy:function(){clearTimeout(this.searching);this.element.removeClass("coral-autocomplete-input").removeAttr("autocomplete");this.menu.element.remove();if(this.options.iframePanel){this.iframePanel.remove()}this.liveRegion.remove()},_setOption:function(d,f){var e=this.options.maxLabelWidth;if(e!="auto"){e=e+"px"}this._super(d,f);if(d==="isLabel"&&typeof f==="boolean"){this.element.prop("readonly",f);this.valuebox.prop("readonly",f);this.component().removeClass("coral-readonly");this.component().toggleClass("coral-isLabel",f);if(this.textboxlistUl){if(f){this.textboxlistUl.find(".coral-textboxlist-item").css("max-width","")}else{this.textboxlistUl.find(".coral-textboxlist-item").css("max-width",e)}}}if(d==="readonly"&&typeof f==="boolean"){this.element.prop("readonly",f);this.valuebox.prop("readonly",f);this.component().removeClass("coral-isLabel");this.component().toggleClass("coral-readonly",f);if(this.textboxlistUl){if(f){this.textboxlistUl.find(".coral-textboxlist-item").css("max-width","")}else{this.textboxlistUl.find(".coral-textboxlist-item").css("max-width",e)}}}if(d==="source"){this._initSource()}if(d==="appendTo"){this.menu.element.appendTo(this._appendTo())}if(d==="disabled"&&f&&this.xhr){this.xhr.abort()}if(d==="value"){this.setValue(f)
}},_appendTo:function(){var d=this.options.appendTo;if(d){d=d.jquery||d.nodeType?b(d):this.document.find(d).eq(0)}if(!d||!d[0]){d=this.element.closest(".coral-front")}if(!d.length){d=this.document[0].body}return d},_filter:function(f,e,d){d(b.coral.autocomplete.filter(f,e.term,this.options.valueField,this.options.textField,this.options.searchField))},_initSource:function(){var f,d,e=this;if(b.isArray(this.options.source)){f=this.options.source;this.source=function(h,g){e._filter(f,h,g)}}else{if(typeof this.options.source==="string"){d=this.options.source;this.source=function(h,g){if(e.xhr){e.xhr.abort()}if(this.element.attr("name")){h[this.element.attr("name")]=h.term}e.xhr=b.ajax({url:d,data:h,type:e.options.asyncType,dataType:"json",success:function(i){if(e.options.render!="tree"){g(i)}else{b(e.menu.element).tree("reload",i);g(i)}},error:function(){g([])}})}}else{this.source=this.options.source}}},_searchTimeout:function(d){clearTimeout(this.searching);this.searching=this._delay(function(){var f=this.term===this._term(),e=this.menu.element.is(":visible"),g=d.altKey||d.ctrlKey||d.metaKey||d.shiftKey;if(!f||(f&&!e&&!g)){this.selectedItem=null;this.search(null,d)}},this.options.delay)},_term:function(){if(this.options.multiLineLabel){return this.element.val()}return this.getText()},search:function(e,d){e=e!=null?e:this._term();this.term=this._term();if(e.length<this.options.minLength||(this.options.minLength>0&&b.trim(e)=="")){return this.close(d)}if(this._trigger("onSearch",d)===false){return}return this._search(e)},_search:function(d){this.pending++;this.element.addClass("coral-autocomplete-loading");this.cancelSearch=false;this.source({term:d},this._response())},_response:function(){var d=++this.requestIndex;return b.proxy(function(e){if(d===this.requestIndex){this.__response(e)}this.pending--;if(!this.pending){this.element.removeClass("coral-autocomplete-loading")}},this)},__response:function(d){if(d){d=this._normalize(d)}this._trigger("onResponse",null,{content:d});
if(!this.options.disabled&&d&&d.length&&!this.cancelSearch){this._suggest(d);this._trigger("onOpen")}else{this._close()}},close:function(d){this.cancelSearch=true;this._close(d)},_close:function(d){if(this.menu.element.is(":visible")){this.menu.element.hide();if(this.options.iframePanel){this.iframePanel.hide()}this.options.render!="tree"&&this.menu.blur();this.isNewMenu=true;this._trigger("onClose",d)}},_change:function(d){if(this.previous!==this.getValue()){this._trigger("onChange",d,{item:this.selectedItem,oldValue:this.previous,value:this.getValue(),text:this.getText(),lastSelectedItem:this.lastSelectedItem})}},_normalize:function(d){var e=this;if(d.length&&d[0][this.options.textField]&&d[0][this.options.valueField]){return d}return b.map(d,function(f){if(typeof f==="string"){return{label:f,value:f}}return b.extend({},f,{label:f.label||f.value,value:f.value||f.label})})},_suggest:function(f){var i=this.menu.element,h;var j=this.iframePanel||b();if(this.options.render=="tree"){}else{this.menu.element.empty();this._renderMenu(i,f);this.isNewMenu=true;this.menu.refresh()}this.responseItems=f;var d=i.height();j.css("height",d);i.show();j.show();var e=i.siblings(".coral-front:visible").map(function(){return +b(this).css("z-index")}).get(),g=Math.max.apply(null,e);if(g>=+i.css("z-index")){i.css("z-index",g+1);j.css("z-index",g)}j.outerWidth(Math.max(i.width("").outerWidth()+1,this.elementBorder.outerWidth()));this._resizeMenu();i.position(b.extend({of:this.elementBorder},this.options.position));j.position(b.extend({of:this.elementBorder},this.options.position));if(this.options.autoFocus){this.menu.next()}},_resizeMenu:function(){var d=this.menu.element;var e=this.iframePanel||b();d.outerWidth(Math.max(d.width("").outerWidth()+1,this.elementBorder.outerWidth()))},_renderMenu:function(e,d){var f=this;b.each(d,function(g,h){f._renderItemData(e,h)})},_renderItemData:function(d,e){return this._renderItem(d,e).data("coral-autocomplete-item",e)},_renderItem:function(j,n){var m=n[this.options.textField];
var k,i="",f=!!n.hidden==true?"hidden":"";var h=b.coral.toFunction(this.options.formatter),e;if(b.isFunction(h)){m=h.apply(this.element[0],[{item:n}])}var g=b.coral.toFunction(this.options.itemattr);if(b.isFunction(g)){var l=g.apply(this.element[0],[{item:n}]);if(!b.isEmptyObject(l)){if(l.hasOwnProperty("style")){style+=l.style;delete l.style}if(l.hasOwnProperty("class")){f+=" "+l["class"];delete l["class"]}try{delete l.role}catch(d){}for(k in l){if(l.hasOwnProperty(k)){i+=" "+k+"="+l[k]}}}return b('<li class="'+f+'"'+i+">").text(m).appendTo(j)}else{return b("<li>").addClass(f).text(m).appendTo(j)}},_move:function(e,d){if(!this.menu.element.is(":visible")){this.search(null,d);return}if(this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)){if(!this.options.multiLineLabel){this.setValue("",true);this.setText(this.term)}this.menu.blur();return}this.menu[e](d)},component:function(){return this.autocompleteWrapper},_setLastSelectedItem:function(){var d=this.options;var e=this.getValue(),f=this.getText();this.lastSelectedItem={};this.lastSelectedItem[d.valueField]=e;this.lastSelectedItem[d.textField]=f},_text:function(i){var h=this.options.maxLabelWidth,d=this.options.readonly,e=this.options.isLabel;if(this.options.multiLineLabel){if(i!=""&&!i){var g=[];b.each(this.textboxlistUl.find(".coral-textboxlist-item"),function(){g.push(b(this).text())});return g.join(",")}var f="";if(i!=""&&!(i instanceof Array)){i=i.split(this.options.separator)}if(i instanceof Array){if(h=="auto"||e||d){b.each(i,function(j){i.splice(j,1,"<li tabindex='-1' class='coral-textboxlist-item'  title='"+this+"'>"+this+"<span class='coral-label-close cui-icon-cross2'></span></li>")})}else{b.each(i,function(j){i.splice(j,1,"<li tabindex='-1' class='coral-textboxlist-item'  style='  max-width:"+h+"px;' title='"+this+"'>"+this+"<span class='coral-label-close cui-icon-cross2'></span></li>")})}f=i.join("")}else{if(h=="auto"||e||d){f="<li tabindex='-1' class='coral-textboxlist-item'   title='"+this+"' >"+i+"<span class='coral-label-close  cui-icon-cross2'></span></li>"
}else{f="<li tabindex='-1' class='coral-textboxlist-item'  style='  max-width:"+h+"px;' title='"+this+"' >"+i+"<span class='coral-label-close cui-icon-cross2'></span></li>"}}if(i!=""){if(this.options.multiple){this.textboxlistUl.find(".coral-textboxlist-item").remove(".coral-textboxlist-item");this.textboxlistUl.find(".coral-textboxlist-inputLi").before(f)}else{this.textboxlistUl.find(".coral-textboxlist-item").remove(".coral-textboxlist-item");this.textboxlistUl.find(".coral-textboxlist-inputLi").before(f)}}else{this.textboxlistUl.find(".coral-textboxlist-item").remove(".coral-textboxlist-item")}}else{return this.textMethod.apply(this.element,arguments)}},getOldValue:function(){var f=this.options,e=[],h=[],d=0;if(!this.currentValues){return e}var h=this.currentValues.split(",");for(;d<h.length;d++){var g=h[d];e.push(g)}return e},setValue:function(d,f){var j=this,m,o,f,i;if(typeof d!=="string"){m=d.value;f=d.changed;i=d.removed}else{m=d}if(this.options.multiLineLabel){this.element.val("");this.element.css({width:"10px"})}this.previous=this.getValue();if(this.options.multiLineLabel){var j=this;var k=this.element.closest("li.coral-textboxlist-inputLi"),p=k.index(),h=p,n=this.valuebox.val(m)==""?[]:this.valuebox.val(m);if(b.trim(m)==""){this.setText(m)}else{if("text"===this.options.postMode){this.setText(m)}else{if(b.trim(m)!==""&&b.isArray(this.options.source)){var l=(this.options.render=="tree")?b(this.menu.element).tree("transformToArray",this.options.source.concat()):this.options.source,e=[],g=b.grep(m.split(","),function(r){var q=false;b.each(l,function(s){if(r==l[s][j.options.valueField]){e.push(l[s][j.options.textField]);return true}});return q});if(e.length){this.setText(e)}}}}if(m==""){n=[]}this.valuebox.val(m);this.currentValues=m}else{if(b.trim(m)==""){this.setText(m)}else{if("text"===this.options.postMode){this.setText(m)}else{if(b.trim(m)!==""&&b.isArray(this.options.source)){var l=(this.options.render=="tree")?b(this.menu.element).tree("transformToArray",this.options.source.concat()):this.options.source,e=[],g=b.grep(m.split(","),function(r){var q=false;
b.each(l,function(s){if(r==l[s][j.options.valueField]){e.push(l[s][j.options.textField]);return true}});return q});if(e.length){this.setText(e[0])}}}}this.valuebox.val(m)}f&&this._change(null)},setText:function(d){this._text(d);this._setLastSelectedItem()},getValue:function(){if(this.options.multiLineLabel){return this.valuebox.val()}else{return this.valueMethod.apply(this.valuebox)}},getText:function(){return this._text()},focus:function(){if(this.options.disabled||this.options.readonly||this.options.isLabel){return false}this.element.focus()},_keyEvent:function(e,d){if(!this.ismultiLineLabel||this.menu.element.is(":visible")){this._move(e,d);d.preventDefault()}},_removeLabel:function(i){var g=this.element.closest("li.coral-textboxlist-inputLi"),m=b(i.target).closest("li.coral-textboxlist-item"),j=b(i.target).closest("li.coral-textboxlist-item:last");g.insertAfter(j);var l=g.index();var f=m.index();var h=f;if(f>l){h=f-1}var d=this.getText().split(",");d.splice(h,1);m.remove();var k=this.getValue().split(",");k.splice(h,1);this.selectedItems.splice(h,1);this.selectedItem=null;this.setValue(k.join(","),true);if(typeof this.options.source=="string"){this.setText(d.join(","))}this._moveInput("last",i);this.element.val("");this.element.focus()},_moveInput:function(i,h){var d=this.element.closest("li.coral-textboxlist-inputLi");var f=b(h.target).closest("li.coral-textboxlist-item");var g=b(d).closest("li.coral-textboxlist-inputLi").nextAll("li.coral-textboxlist-item").last();switch(i){case"left":d.insertBefore(f);this.element.val("");this.element.focus();break;case"right":d.insertAfter(f);this.element.val("");this.element.focus();break;case"last":d.insertAfter(g);this.element.val("");break}},_moveItem:function(g,f){var d=this.element.closest("li.coral-textboxlist-inputLi");if(g=="left"&&d.prev().length&&b(d.find("input")).caret()==0){this.element.val("");d.prev().focus()}if(g=="right"&&d.next().length&&b(d.find("input")).caret()==d.find("input").val().length){this.element.val("");
d.next().focus()}}});b.extend(b.coral.autocomplete,{escapeRegex:function(d){return d.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(j,f,e,d,i){var g=this;var h=new RegExp(b.coral.autocomplete.escapeRegex(f),"i");if(i){return b.grep(j,function(n){var l=h.test(n[d]||n[e]||n);var m=i.split(",");for(var k=0;k<m.length;k++){if(!l&&n[m[k]]){l=h.test(n[m[k]]);if(l){break}}}return l})}return b.grep(j,function(k){return h.test(k[d]||k[e]||k[i]||k)})}});b.component("coral.autocomplete",b.coral.autocomplete,{options:{messages:{noResults:"No search results.",results:function(d){return d+(d>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var d;this._superApply(arguments);if(this.options.disabled||this.cancelSearch){return}if(e&&e.length){d=this.options.messages.results(e.length)}else{d=this.options.messages.noResults}this.liveRegion.children().hide();b("<div>").text(d).appendTo(this.liveRegion)}});var a=b.coral.autocomplete})(jQuery);