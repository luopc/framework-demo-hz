(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./core","./component"],a)}else{a(jQuery)}}(function(a){return a.component("coral.accordion",{version:"4.0.1",options:{active:0,animate:{params:{},duration:300,easing:"swing"},collapsible:false,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"cui-icon-arrow-down3",header:"cui-icon-arrow-up3"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var b=this.options;b.icons=a.coral.toFunction(b.icons);this.prevShow=this.prevHide=a();this.element.addClass("coral-accordion ctrl-init ctrl-init-accordion coral-component coral-helper-reset").attr("role","tablist");if(!b.collapsible&&(b.active===false||b.active==null)){b.active=0}this._processPanels();if(b.active<0){b.active+=this.headers.length}this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:!this.active.length?a():this.active.next()}},_createIcons:function(){var c=this,b=this.options.icons;if(b){a("<span>").addClass("coral-accordion-header-icon icon "+b.header).prependTo(this.headers);this.active.children(".coral-accordion-header-icon").removeClass(b.header).addClass(b.activeHeader);this.headers.each(function(){var d=a.parser.parseOptions(this);if(d.collapsible==false){a(this).children(".coral-accordion-header-icon").remove()}else{a(this).addClass("coral-accordion-icons")}})}},_destroyIcons:function(){this.headers.removeClass("coral-accordion-icons").children(".coral-accordion-header-icon").remove()},_destroy:function(){var b;this.element.removeClass("coral-accordion coral-component coral-helper-reset").removeAttr("role");this.headers.removeClass("coral-accordion-header coral-accordion-header-active coral-state-default coral-corner-all coral-state-active coral-state-disabled coral-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId();
this._destroyIcons();b=this.headers.next().removeClass("coral-helper-reset coral-widget-content coral-corner-bottom coral-accordion-content coral-accordion-content-active coral-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId();if(this.options.heightStyle!=="content"){b.css("height","")}},_setOption:function(b,c){if(b==="active"){this._activate(c);return}if(b==="event"){if(this.options.event){this._off(this.headers,this.options.event)}this._setupEvents(c)}this._super(b,c);if(b==="collapsible"&&!c&&this.options.active===false){this._activate(0)}if(b==="icons"){this._destroyIcons();if(c){this._createIcons()}}if(b==="disabled"){this.element.toggleClass("coral-state-disabled",!!c).attr("aria-disabled",c);this.headers.add(this.headers.next()).toggleClass("coral-state-disabled",!!c)}},_keydown:function(e){if(e.altKey||e.ctrlKey){return}var f=a.coral.keyCode,d=this.headers.length,b=this.headers.index(e.target),c=false;switch(e.keyCode){case f.RIGHT:case f.DOWN:c=this.headers[(b+1)%d];break;case f.LEFT:case f.UP:c=this.headers[(b-1+d)%d];break;case f.SPACE:case f.ENTER:this._eventHandler(e);break;case f.HOME:c=this.headers[0];break;case f.END:c=this.headers[d-1];break}if(c){a(e.target).attr("tabIndex",-1);a(c).attr("tabIndex",0);c.focus();e.preventDefault()}},_panelKeyDown:function(b){if(b.keyCode===a.coral.keyCode.UP&&b.ctrlKey){a(b.currentTarget).prev().focus()}},refresh:function(){var b=this.options;this._processPanels();if((b.active===false&&b.collapsible===true)||!this.headers.length){b.active=false;this.active=a()}else{if(b.active===false){this._activate(0)}else{if(this.active.length&&!a.contains(this.element[0],this.active[0])){if(this.headers.length===this.headers.find(".coral-state-disabled").length){b.active=false;this.active=a()}else{this._activate(Math.max(0,b.active-1))}}else{b.active=this.headers.index(this.active)}}}this._destroyIcons();this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("coral-accordion-header coral-state-default coral-corner-all");
this.headers.next().addClass("coral-accordion-content coral-helper-reset coral-component-content coral-corner-bottom").filter(":not(.coral-accordion-content-active)").hide()},_refresh:function(){var e,c=this.options,b=c.heightStyle,d=this.element.parent();this.active=this._findActive(c.active).addClass("coral-accordion-header-active coral-state-active coral-corner-top").removeClass("coral-corner-all");this.active.next().addClass("coral-accordion-content-active").show();this.headers.attr("role","tab").each(function(){var i=a(this),h=i.uniqueId().attr("id"),f=i.next(),g=f.uniqueId().attr("id");i.attr("aria-controls",g);f.attr("aria-labelledby",h)}).next().attr("role","tabpanel");this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide();if(!this.active.length){this.headers.eq(0).attr("tabIndex",0)}else{this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"})}this._createIcons();this._setupEvents(c.event);if(b==="fill"){a.coral.fitParent(this.component(),true);e=d.height();this.element.siblings(":visible").each(function(){var g=a(this),f=g.css("position");if(f==="absolute"||f==="fixed"){return}e-=g.outerHeight(true)});this.headers.each(function(){e-=a(this).outerHeight(true)});this.headers.next().each(function(){a(this).height(Math.max(0,e-a(this).innerHeight()+a(this).height()))}).addClass("coral-scroll")}else{if(b==="auto"){e=0;this.headers.next().each(function(){e=Math.max(e,a(this).css("height","").height())}).height(e)}}this.headers.each(function(){var f=a.parser.parseOptions(this);if(f.collapsible==false){a(this).next().addClass("hidden")}})},_activate:function(b){var c=this._findActive(b)[0];if(c===this.active[0]){return}c=c||this.active[0];this._eventHandler({target:c,currentTarget:c,preventDefault:a.noop})},_findActive:function(b){return typeof b==="number"?this.headers.eq(b):a()},_setupEvents:function(c){var b={keydown:"_keydown"};
if(c){a.each(c.split(" "),function(e,d){b[d]="_eventHandler"})}this._off(this.headers.add(this.headers.next()));this._on(this.headers,b);this._on(this.headers.next(),{keydown:"_panelKeyDown"});this._hoverable(this.headers);this._focusable(this.headers)},_eventHandler:function(b){var j=this.options,e=this.active,f=a(b.currentTarget),h=f[0]===e[0],c=h&&j.collapsible,d=c?a():f.next(),g=e.next(),i={oldHeader:e,oldPanel:g,newHeader:c?a():f,newPanel:d,headerOptions:a.parser.parseOptions((c?a():f))};b.preventDefault();if((h&&!j.collapsible)||(this._trigger("beforeActivate",b,i)===false)){return}j.active=c?false:this.headers.index(f);this.active=h?a():f;this._toggle(i);e.removeClass("coral-accordion-header-active coral-state-active");if(j.icons){e.children(".coral-accordion-header-icon").removeClass(j.icons.activeHeader).addClass(j.icons.header)}if(!h){f.removeClass("coral-corner-all").addClass("coral-accordion-header-active coral-state-active coral-corner-top");if(j.icons){f.children(".coral-accordion-header-icon").removeClass(j.icons.header).addClass(j.icons.activeHeader)}f.next().addClass("coral-accordion-content-active")}},_toggle:function(d){var b=d.newPanel,c=this.prevShow.length?this.prevShow:d.oldPanel;this.prevShow.add(this.prevHide).stop(true,true);this.prevShow=b;this.prevHide=c;if(this.options.animate){this._animate(b,c,d)}else{c.hide();b.show();this._toggleComplete(d)}c.attr({"aria-hidden":"true"});c.prev().attr("aria-selected","false");if(b.length&&c.length){c.prev().attr({tabIndex:-1,"aria-expanded":"false"})}else{if(b.length){this.headers.filter(function(){return a(this).attr("tabIndex")===0}).attr("tabIndex",-1)}}b.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(b,j,f){var i,h,e,g=this,k=0,l=b.length&&(!j.length||(b.index()<j.index())),d=this.options.animate||{},m=l&&d.down||d,c=function(){g._toggleComplete(f)};if(typeof m==="number"){e=m}if(typeof m==="string"){h=m}h=h||m.easing||d.easing;
e=e||m.duration||d.duration;if(!j.length){return b.animate(this.showProps,e,h,c)}if(!b.length){return j.animate(this.hideProps,e,h,c)}i=b.show().outerHeight();j.animate(this.hideProps,{duration:e,easing:h,step:function(n,o){o.now=Math.round(n)}});b.hide().animate(this.showProps,{duration:e,easing:h,complete:c,step:function(n,o){o.now=Math.round(n);if(o.prop!=="height"){k+=o.now}else{if(g.options.heightStyle!=="content"){k=0}}}})},_toggleComplete:function(c){var b=c.oldPanel;b.removeClass("coral-accordion-content-active").prev().removeClass("coral-corner-top").addClass("coral-corner-all");if(b.length){b.parent()[0].className=b.parent()[0].className}this._trigger("onActivate",null,c)}})}));