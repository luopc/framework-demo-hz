/*!
 * 组件库4.0.1：按钮
 *
 * 依赖JS文件:
 *	   jquery.coral.core.js
 *	   jquery.coral.component.js
 */
(function(f,h){var d,c="coral-button coral-component coral-state-default coral-corner-all",g="coral-button-text-icons coral-button-text-icon-primary coral-button-text-icon-secondary",b="coral-state-focus",e=function(){var i=f(this);setTimeout(function(){i.find(":coral-button").button("refresh")},1)},a=function(j){var i=j.name,k=j.form,l=f([]);if(i){i=i.replace(/'/g,"\\'");if(k){l=f(k).find("[name='"+i+"'][type=radio]")}else{l=f("[name='"+i+"'][type=radio]",j.ownerDocument).filter(function(){return !this.form})}}return l};f.component("coral.button",{version:"4.0.1",defaultElement:"<button>",options:{id:null,name:null,cls:null,title:false,disabled:null,text:true,label:null,icons:{primary:null,secondary:null},width:null,countdown:false,countdownTime:3000,showCountdown:true,onCreate:null,onClick:null,onDblClick:null,onMouseEnter:null,onMouseLeave:null},_create:function(){this.options.icons=this._icons();this.element.addClass("ctrl-init ctrl-init-button");this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,e);if(typeof this.options.disabled!=="boolean"){this.options.disabled=!!this.element.prop("disabled")}else{this.element.prop("disabled",this.options.disabled)}this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title")||this.options.title;var k=this,i=this.options,l=this.type==="checkbox"||this.type==="radio",j=!l?"coral-state-active":"";if(i.id){this.element.attr("id",i.id)}if(i.name){this.element.attr("name",i.name)}if(i.label===null){i.label=(this.type==="input"?this.buttonElement.val():this.buttonElement.html())}this._hoverable(this.buttonElement);this.buttonElement.addClass(c).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){if(i.disabled){return}if(this===d){f(this).addClass("coral-state-active")}k._trigger("onMouseEnter",null,{id:this.id,label:k.options.label})}).bind("mouseleave"+this.eventNamespace,function(){if(i.disabled){return
}f(this).removeClass(j);k._trigger("onMouseLeave",null,{id:this.id,label:k.options.label})}).bind("click"+this.eventNamespace,function(n){if(i.disabled){n.preventDefault();n.stopImmediatePropagation()}else{if(i.once){k.element.button("disable")}if(i.countdown){var p=i.countdownTime/1000;var m=k.element.button("option","label");function o(){if(p<=0){k.element.button("enable");k.element.button("option","label",m)}else{k.element.button("option","label",m+"("+p+")");p--;setTimeout(function(){o()},1000)}}if(f(document).find(k.element).length){k.element.button("disable");if(i.showCountdown){o()}else{k._delay(function(){k.element.button("enable");k.element.button("option","label",m)},i.countdownTime)}}}k._trigger("onClick",null,{id:this.id,label:k.options.label})}}).bind("dblclick"+this.eventNamespace,function(m){if(i.disabled){m.preventDefault();m.stopImmediatePropagation()}else{k._trigger("onDblClick",null,{id:this.id,label:k.options.label})}});this._on({focus:function(){this.buttonElement.addClass("coral-state-focus")},blur:function(){this.buttonElement.removeClass("coral-state-focus")}});if(l){this.element.bind("change"+this.eventNamespace,function(){k.refresh()})}if(this.type==="checkbox"){this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled){return false}})}else{if(this.type==="radio"){this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled){return false}f(this).addClass("coral-state-active");k.buttonElement.attr("aria-pressed","true");var m=k.element[0];a(m).not(m).map(function(){return f(this).button("component")[0]}).removeClass("coral-state-active").attr("aria-pressed","false")})}else{this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(i.disabled){return false}f(this).addClass("coral-state-active");d=this;k.document.one("mouseup",function(){d=null})}).bind("mouseup"+this.eventNamespace,function(){if(i.disabled){return false}f(this).removeClass("coral-state-active")}).bind("keydown"+this.eventNamespace,function(m){if(i.disabled){return false
}if(m.keyCode===f.coral.keyCode.SPACE||m.keyCode===f.coral.keyCode.ENTER){f(this).addClass("coral-state-active")}}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){f(this).removeClass("coral-state-active")});if(this.buttonElement.is("a")){this.buttonElement.keyup(function(m){if(m.keyCode===f.coral.keyCode.SPACE){f(this).click()}})}}}if(i.width){this.buttonElement.outerWidth(i.width)}this._setOption("disabled",i.disabled);this._resetButton()},_icons:function(){var l=this.options.icons,k=null,n=null,m=null,i=null;if(l&&typeof l==="string"){k=l.split(",");if(k.length>0){n=f.trim(k[0]);i=j("right",n);if(null===i){m=j("left",n,true)}}if(k.length>1){n=f.trim(k[1]);m=((m===null)?j("left",n):m);if(null===i){i=j("right",n,true)}}}else{return l}function j(p,q,r){var o=q.split(" ");if(f.inArray(p,o)>-1){o=f.grep(o,function(s,t){return s!==p});return o.join(" ")}if(r){return q}return null}return{primary:m,secondary:i}},_determineButtonType:function(){var i,k,j;if(this.element.is("[type=checkbox]")){this.type="checkbox"}else{if(this.element.is("[type=radio]")){this.type="radio"}else{if(this.element.is("input")){this.type="input"}else{this.type="button"}}}if(this.type==="checkbox"||this.type==="radio"){i=this.element.parents().last();k="label[for='"+this.element.attr("id")+"']";this.buttonElement=i.find(k);if(!this.buttonElement.length){i=i.length?i.siblings():this.element.siblings();this.buttonElement=i.filter(k);if(!this.buttonElement.length){this.buttonElement=i.find(k)}}this.element.addClass("coral-helper-hidden-accessible");j=this.element.is(":checked");if(j){this.buttonElement.addClass("coral-state-active")}this.buttonElement.prop("aria-pressed",j)}else{this.buttonElement=this.element}},component:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("coral-helper-hidden-accessible");this.buttonElement.removeClass(c+" ui-state-active "+g).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".coral-button-text").html());
if(!this.hasTitle){this.buttonElement.removeAttr("title")}},_setOption:function(i,j){this._super(i,j);if(i==="disabled"){this.component().toggleClass("coral-state-disabled",!!j);this.element.prop("disabled",!!j);if(j){if(this.type==="checkbox"||this.type==="radio"){this.buttonElement.removeClass("coral-state-focus")}else{this.buttonElement.removeClass("coral-state-focus coral-state-active")}}return}this._resetButton()},update:function(i){if(typeof i==="string"){this.element.find(".coral-button-text").html(i)}},refresh:function(){var i=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("coral-button-disabled");if(i!==this.options.disabled){this._setOption("disabled",i)}if(this.type==="radio"){a(this.element[0]).each(function(){if(f(this).is(":checked")){f(this).button("component").addClass("coral-state-active").attr("aria-pressed","true")}else{f(this).button("component").removeClass("coral-state-active").attr("aria-pressed","false")}})}else{if(this.type==="checkbox"){if(this.element.is(":checked")){this.buttonElement.addClass("coral-state-active").attr("aria-pressed","true")}else{this.buttonElement.removeClass("coral-state-active").attr("aria-pressed","false")}}}},_resetButton:function(){if(this.type==="input"){if(this.options.label){this.element.val(this.options.label)}return}var m=this.buttonElement.removeClass(g),k=f("<span></span>",this.document[0]).addClass("coral-button-text").html(this.options.label).appendTo(m.empty()).text(),j=this.options.icons,i=j.primary&&j.secondary,l=[];if(j.primary||j.secondary){if(this.options.text){l.push("coral-button-text-icon"+(i?"s":(j.primary?"-primary":"-secondary")))}if(j.primary){m.prepend("<span class='coral-button-icon-primary icon "+j.primary+"'></span>")}if(j.secondary){m.append("<span class='coral-button-icon-secondary icon "+j.secondary+"'></span>")}if(!this.options.text){l.push(i?"coral-button-icons-only":"coral-button-icon-only");if(!this.hasTitle){m.attr("title",f.trim(k))}}}else{l.push("coral-button-text-only")
}if(this.hasTitle){m.attr("title",f.trim(k))}m.addClass(l.join(" "))}});f.component("coral.buttonset",{version:"4.0.1",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(coral-button)"},_create:function(){this.element.addClass("coral-buttonset")},_init:function(){this.refresh()},_setOption:function(i,j){if(i==="disabled"){this.buttons.button("option",i,j)}this._super(i,j)},refresh:function(){var j=this.element.css("direction")==="rtl",i=this.element.find(this.options.items),k=i.filter(":coral-button");i.not(":coral-button").button();k.button("refresh");this.buttons=i.map(function(){return f(this).button("component")[0]}).removeClass("coral-corner-all coral-corner-left coral-corner-right").filter(":first").addClass(j?"coral-corner-right":"coral-corner-left").end().filter(":last").addClass(j?"coral-corner-left":"coral-corner-right").end().end()},_destroy:function(){this.element.removeClass("coral-buttonset");this.buttons.map(function(){return f(this).button("component")[0]}).removeClass("coral-corner-left coral-corner-right").end().button("destroy")}})}(jQuery));