/*!
 * 组件库4.0：下拉按钮
 * 
 * 依赖JS文件：
 *    jquery.coral.core.js
 *    jquery.coral.component.js
 */
(function(a,b){a.component("coral.splitbutton",a.coral.button,{version:"4.0.2",componentName:"splitbutton",castProperties:["menuOptions","dataCustom"],options:{id:null,name:null,label:null,cls:null,icons:{primary:null,secondary:null},width:null,text:true,disabled:false,menuOptions:{autoDisplay:false,popup:true},data:null,url:null,onCreate:null,onClick:null,onDblClick:null},component:function(){var c=this;return this.uiBox},uiBorder:function(){return this.uiBorder},uiDropdownButton:function(){return this.dropdownButton},menu:function(){return this.uiMenu},_create:function(){var c=this;this._initElements();this._super()},_initElements:function(){var g=this,f=this.options,e=this.options.menuOptions,h=this.options.data,c=this.options.url;this.element.addClass("ctrl-init ctrl-init-splitbutton coral-splitbutton-element");this.dropdownButton=a("<button class='coral-splitbutton-dropdownbutton' type='button'></button>").uniqueId();this.uiBorder=a('<span class="coral-splitbutton-border"></span>');this.uiBox=a('<span class="coral-splitbutton"></span>');this.uiBox.append(this.uiBorder);this.uiMenu=a('<ul class="coral-splitbutton-menu"></ul>');this.uiBox.insertAfter(this.element);this.uiBorder.append(this.element).append(this.dropdownButton);this.uiMenu.appendTo(a(document.body));if(f.width){this.uiBox.css({width:f.width})}if(typeof this.element.attr("id")!="undefined"){this.options.id=this.element.attr("id")}else{if(this.options.id){this.element.attr("id",this.options.id)}else{this.options.id=this.element.uniqueId()}}if(typeof this.element.attr("name")!="undefined"){this.options.name=this.element.attr("name")}else{if(this.options.name){this.element.attr("name",this.options.name)}}this.triggerId=this.dropdownButton.attr("id");this._on(this.element,{buttononclick:function(j,i){g._trigger("onClick",j,i)}});this.dropdownButton.button({label:"下拉按钮",text:false,icons:"cui-icon-arrow-down3",onClick:function(k,j){if(!g._getToolbar().length||g._getToolbar().toolbar("option","clickToDisplay")==0){return
}if(!g._getToolbar().length||!g._getToolbar().toolbar("option","autoDisplay")){return}var i=g._getToolbar(true);if(i.length){i.toggleClass("coral-toolbar-click-active")}},onMouseEnter:function(k,j){if(!g._getToolbar().length||!g._getToolbar().toolbar("option","autoDisplay")){return}var i=g._getToolbar(true);if(i.hasClass("coral-toolbar-click-active")){if(a(".coral-tieredmenu:visible").length){g._hideMenus()}g.uiMenu.tieredmenu("show")}}});var d={};if(null!=h){d.data=h}if(null!=c){d.url=c}e=a.extend({},d,f.menuOptions,{id:this.element.attr("id")+"_tieredmenu",trigger:this.dropdownButton,of:this.element});this.uiMenu.tieredmenu(e);if(g._getToolbar().length&&g._getToolbar().toolbar("option","autoDisplay")){this.uiMenu.tieredmenu("component").bind("mouseleave",function(){g._hideMenus()})}this._on(this.uiMenu,{tieredmenuonclick:function(j,i){g._trigger("onClick",j,i)}})},_getToolbar:function(d){var f=this,e=this.options,c=a();if(this.element.hasClass("ctrl-toolbar-element")){c=d?this.element.parents(".coral-toolbar:eq(0)"):this.element.parents(".ctrl-init-toolbar:eq(0)")}return c},_hideMenus:function(){a(".coral-tieredmenu").hide()},hideAllMenus:function(){a(".coral-tieredmenu").hide()},showMenu:function(){this.uiMenu.tieredmenu("show")},_setOption:function(c,e){if(c==="id"||c==="name"){return}var d=this;if(c==="disabled"){this.element.toggleClass("coral-state-disabled",e);this.dropdownButton.button("option","disabled",e)}this._super(c,e)},_destroy:function(){this.uiBox.replaceWith(this.element);this.uiMenu.parent().remove();this.element.removeClass("ctrl-init ctrl-init-splitbutton coral-splitbutton-element")}})})(jQuery);