(function(a,b){a.component("coral.uploader",{version:a.coral.version,castProperties:["dataCustom","formData","overrideEvents","buttons","itemTemplate"],options:{id:"",swf:a.coral.contextPath+"/jquery-cui/resource/swfupload.swf",uploader:"",auto:true,buttonClass:"",buttonCursor:"hand",buttonImage:null,buttonText:"SELECT FILES",checkExisting:false,debug:false,fileObjName:"Filedata",fileSizeLimit:0,fileTypeDesc:"All Files",fileTypeExts:"*.*",heigh:30,itemTemplate:false,method:"post",multi:true,formData:{},preventCaching:true,progressData:"percentage",queueID:false,queueSizeLimit:999,removeCompleted:true,removeTimeout:3,requeueError:false,successTimeout:30,uploadLimit:0,width:120,cls:"",displayStyle:"original",emptyText:"请选择...",delay:1000,buttons:null,overrideEvents:[],onCancel:null,onClearQueue:null,onDestroy:null,onDialogClose:null,onDialogOpen:null,onDisable:null,onEnable:null,onFallback:null,onNoflash:null,onInit:null,onQueueComplete:null,onSelectError:null,onSelect:null,onNoFlash:null,onSWFReady:null,onUploadComplete:null,onUploadError:null,onUploadSuccess:null,onUploadProgress:null,onUploadStart:null},_create:function(){var d=this;d._initElement();var c=d._flashCheck();if(c==false){d._trigger("onNoFlash",null,[])}},_initElement:function(){var e=this,d=e.options,c={};if(typeof e.element.attr("id")!="undefined"){d.id=e.element.attr("id")}else{if(d.id){e.element.attr("id",d.id)}}if(typeof e.element.attr("name")!="undefined"){d.name=e.element.attr("name")}else{if(d.name){e.element.attr("name",d.name)}}delete d.id;c=e.getEventsObj();d=a.extend({},d,c);this._initUploder(d);d.id=e.element.attr("id")},_flashCheck:function(){var g=!-[1,];var c=true;if(g){try{var f=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");c=true}catch(h){c=false}}else{try{if(navigator.plugins&&navigator.plugins.length>0){var d=navigator.plugins["Shockwave Flash"];if(d==b){c=false}}else{c=true}}catch(h){c=false}}return c},component:function(){return this.uiUploader},destroy:function(){this.uploader.uploadify("destroy")
},disable:function(c){this.uploader.uploadify("disable",c)},settings:function(c,d,e){this.uploader.uploadify("settings",c,d,e)},stop:function(){this.uploader.uploadify("stop")},upload:function(c){if("original"==this.options.displayStyle||!this._isQueueDialog()){this.uploader.uploadify("upload",c);return}if(this.select.length==0){return}var d=this,e=this.element.attr("id");a("#"+e+"_queue").dialog("open")},getvalue:function(){if(this.select.length==0){alert("none file")}return this.select.join(",")},cancel:function(){this.uploader.uploadify("cancel")},clear:function(c){if("custom"==this.options.displayStyle){this.select=[];this.uiUploader.find(".coral-file").html("请选择...");this.uiUploader.find("object").attr("title","请选择...")}this.uploader.uploadify("cancel");this.clearQueue()},clearQueue:function(){this.uploader.clearQueue()},uploadify:function(){return this.uploader},queueData:function(){return this.uploader.data("uploadify").queueData},_getButtons:function(){if(typeof this.options.buttons==="object"){return this.options.buttons}if(typeof this.options.buttons!=="string"){return[]}var k=this,j=this.options,h=this.options.buttons,d=[];var f=a.trim(h).split(",");for(var e in f){var c={},g=f[e].split(" ");c.label=g[0];c.click=g[1];d.push(c)}return d},_triggerClick:function(c,e,f){var d=this;var g=a.coral.toFunction(c);e=a.Event(e);return g.apply(d.element[0],[e].concat(f))},_createButtons:function(){var f=this,e=this.options,d=this._getButtons();var c=a('<span class="coral-uploader-btn-icons coral-corner-right"></span>');f.uiBorder.append(c);a.each(d,function(j,l){var i=l.label,m=l.id,k=l.click,h={},g=a('<span class="coral-uploader-btn-ico icon coral-uploader-btn-textico"></span>');if(i){g.html(i);h.label=i}if(m){g.attr("data-id",m);h.id=m}g.bind("click"+f.eventNamespace,function(n){if(f.options.disabled){return}f._triggerClick(k,n,h)});c.append(g)})},_initUploder:function(c){var e=this,f=e.element.attr("id");e.uiUploader=a('<span class="coral-uploader"></span>');e.uiBorder=a('<span class="coral-uploader-border coral-corner-all"></span>');
e.uploader=a('<div id="'+f+'_uploader"></div>');e.element.after(e.uiUploader);e.uiUploader.append(e.uiBorder);e.uiBorder.append(e.element);e.element.hide();if(c.displayStyle=="original"){e.element.before(e.uploader);this.uploader.uploadify(c);return}this.uiUploader.addClass("coral-uploader-custom coral-textbox");this.uiBorder.addClass("coral-textbox-border");if(c.buttons){this._createButtons()}e.select=[];a(this.element).wrap('<span class="coral-file-default"></span>').before("<span class='coral-file'>"+c.emptyText+"</span>").before(e.uploader);var d=a.extend(c,{height:28,width:800});if(!d.queueID){a(this.element).before("<div id='"+f+"_queue'></div>");a("#"+f+"_queue").dialog({autoOpen:false,title:"上传",modal:false,resizable:false,onOpen:function(){e.uploader.uploadify("upload","*")}});c.queueID=f+"_queue";this.hasDialog=true}e.uploader.uploadify(d)},_isQueueDialog:function(){return this.hasDialog},_reloadUploader:function(){var d=this,c=this.options;delete c.id;d.uploader.uploadify(c);c.id=d.element.attr("id")},getEventsObj:function(){var d=this,c=this.options,e=this.element.attr("id");return{onCancel:function(f){d._trigger("onCancel",null,[{file:f}])},onClearQueue:function(f){d._trigger("onClearQueue",null,[{queueItemCount:f}])},onDestroy:function(){d._trigger("onDestroy",null,[])},onDialogClose:function(f){if("custom"==c.displayStyle&&c.auto&&d._isQueueDialog()){a("#"+e+"_queue").dialog("open")}d._trigger("onDialogClose",null,[{queueData:f}])},onDialogOpen:function(){if("custom"==c.displayStyle){}d._trigger("onDialogOpen",null,[])},onDisable:function(){d._trigger("onDisable",null,[])},onEnable:function(){d._trigger("onEnable",null,[])},onFallback:function(){d._trigger("onFallback ",null,[])},onNoflash:function(){return d.uiBorder},onInit:function(f){d._trigger("onInit",null,[{swfuploadify:f}])},onQueueComplete:function(f){var g=d.element.attr("id");if("custom"==c.displayStyle&&d._isQueueDialog()){setTimeout(function(){a("#"+g+"_queue").dialog("close");d.select=[]},c.delay)
}d._trigger("onQueueComplete",null,[{queueData:f}])},onSelectError:function(f,h,g){d._trigger("onSelectError",null,[{arguments:arguments}])},onSelect:function(f){if("custom"==c.displayStyle){d.select.push(f.name);d.uiUploader.find(".coral-file").html(d.select.join(","));d.uiUploader.find("object").attr("title",d.select.join(","))}d._trigger("onSelect",null,[{file:f}])},onSWFReady:function(){d._trigger("onSWFReady",null,[])},onUploadComplete:function(f){d._trigger("onUploadComplete",null,[{file:f}])},onUploadError:function(f,i,h,g){d._trigger("onUploadError",null,[{file:f,errorCode:i,errorMsg:h,errorString:g}])},onUploadSuccess:function(g,h,f){d._trigger("onUploadSuccess",null,[{file:g,data:h,response:f}])},onUploadProgress:function(g,j,f,i,h){d._trigger("onUploadProgress",null,[{file:g,fileBytesLoaded:j,fileTotalBytes:f,queueBytesLoaded:i,uploadSize:h}])},onUploadStart:function(f){d._trigger("onUploadStart",null,[{file:f}])}}},_setOption:function(c,e){var d=this;if(c==="id"||c==="name"){return}this._super(c,e);if(c==="emptyText"){this.uiUploader.find(".coral-file").html(e);return}d.settings(c,e)},_destroy:function(){var c=this;c.uiUploader.replaceWith(c.element)}})})(jQuery);