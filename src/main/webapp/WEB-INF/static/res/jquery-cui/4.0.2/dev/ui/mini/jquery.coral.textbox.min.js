(function(a,b){a.component("coral.textbox",a.coral.inputbase,{version:a.coral.version,castProperties:["dataCustom","title","buttons","buttonOptions","triggers"],options:{swfPath:a.coral.contextPath+"/jquery-cui/resource/swfupload.swf",hasTips:false,showStar:true,showClose:false,dataCustom:null,value:"",readonly:false,readonlyInput:false,disabled:false,required:false,isLabel:false,title:null,buttons:[],errMsg:null,errMsgPosition:"leftBottom",placeholder:"",type:"text",labelField:null,starBefore:false,valueChangedOnKeyUp:false,onClick:null,onChange:null,onBlur:null,onFocus:null,onKeyDown:null,onKeyUp:null,onKeyPress:null,onEnter:null,onMouseEnter:null,onMouseLeave:null,onCreate:null,onValidSuccess:null,onValidError:null,onValidWarn:null,onUploadSuccess:null,buttonOptions:null,triggers:null,excluded:false},button:function(){if(null!==this.options.buttonOptions){return this.$button}},component:function(){return this.uiTextbox},focus:function(){if(this.options.disabled||this.options.isLabel||this.options.readonly||this.options.readonlyInput){return false}if("hidden"==this.element.attr("type")){return}var c=this;this.element.focus();return true},_create:function(){var c=this;if(c.options.hasTips){c.options.title=true}if("hidden"!==this.element.attr("type")&&"file"!==this.element.attr("type")&&"password"!==this.element.attr("type")&&"text"!==this.element.attr("type")&&"INPUT"==this.element[0].tagName.toUpperCase()){this.element.attr("type","text")}this.element.addClass("ctrl-form-element");if(this.options.dataCustom){this.element.attr("data-custom",this.options.dataCustom)}this._initElement();this.setValue(this.element.val(),false);this.originalValue=this.getValue();this._bindEvents();if(null!==this.options.buttonOptions){this._outerButtons()}c._trigger("onCreate",null,[])},_outerButtons:function(){this.uiDialogOuterButtonPanel=a('<span class="coral-outerbuttonset coral-corner-all "></span>');this.component().append(this.uiDialogOuterButtonPanel);this._createButtons(this.options.buttonOptions,null,this.uiDialogOuterButtonPanel);
this.component().css("padding-right",this.uiDialogOuterButtonPanel.outerWidth()+8)},_getButtonEl:function(){return a("<button type='button'></button>").addClass("coral-textbox-button")},reset:function(){this.setValue(this.originalValue)},_initSimple:function(){var c=this,d=c.element.uniqueId().attr("id")},_initUpload:function(){var c=this,d=c.element.uniqueId().attr("id");c.select=[];a(this.element).wrap('<span class="coral-file-default"></span>').before("<span class='coral-file'>请选择...</span>").before("<div id='"+d+"_upload'></div>").before("<div id='"+d+"_queue'></div>").hide();c.uploader=a("#"+d+"_upload");c.uploader.uploadify({swf:this.options.swfPath,uploader:c.options.uploadUrl,queueID:d+"_queue",height:"28",width:"800",buttonText:"浏览",onDialogOpen:function(){c.select=[]},onDialogClose:function(){},onSelect:function(e){c.select.push(e.name);c.uiTextbox.find(".coral-file").html(c.select.join(","));c.uiTextbox.find("object").attr("title",c.select.join(","))},onCancel:function(e){},onQueueComplete:function(e){setTimeout(function(){a("#"+d+"_queue").dialog("close");c.select=[]},3500)},onUploadSuccess:function(f,g,e){c._trigger("onUploadSuccess",null,[{file:f,data:g,response:e}])},auto:false});a("#"+d+"_queue").dialog({autoOpen:false,modal:false,resizable:false,onOpen:function(){c.uploader.uploadify("upload","*")}})},upload:function(c){var d=this;var e=d.element[0].id;if(this.select.length===0){return}a("#"+e+"_queue").dialog("open")},cancel:function(c){this.uploader.uploadify("cancel")},clear:function(c){this.select=[];this.uiTextbox.find(".coral-file").html("请选择...");this.uiTextbox.find("object").attr("title","请选择...");this.uploader.uploadify("cancel")},_getIcon:function(g){var c=[];if(typeof g==="undefined"||g==null||g==""){return[]}if(typeof g=="object"){for(var f in g){var h={};h[g[f].icon]=g[f].click;c.push(h)}}else{var e=a.trim(g).split(",");for(var f in e){var d=e[f].split(" ");var h={};h[d[0]]=d[1];c.push(h)}}return c},_triggerClick:function(c,e,f){var d=this;
var g=a.coral.toFunction(c);e=a.Event(e);return g.apply(d.element[0],[e].concat(f))},_updateLabel:function(c){this.uiLabel.html(c)},_initElement:function(){var h=this,d=null,e=h.options;this.uiTextbox=a('<span class="coral-textbox"><span class="coral-textbox-border coral-corner-all"></span></span>').insertAfter(h.element);h.elementBorder=h.uiTextbox.find(".coral-textbox-border");h.element.appendTo(h.elementBorder);h.element.addClass("coral-textbox-default coral-validation-textbox");if(this.options.buttons.length>0){this._createButtonPanel()}if(e.labelField){this.uiLabel=a('<label class="coral-label">'+e.labelField+"</label>");this.elementBorder.before(this.uiLabel);this.uiTextbox.addClass("coral-hasLabel")}this.valuebox=a("<input type='hidden' class='coral-value-textbox'>").appendTo(this.uiTextbox);if("hidden"==this.element.attr("type")){h.uiTextbox.hide()}if("TEXTAREA"==this.element[0].tagName){h.component().addClass("coral-textbox-textarea")}if("file"==h.element.attr("type")){if("uploadify"==h.options.formatter){h._initUpload()}if("simple"==h.options.formatter||typeof h.options.formatter=="undefined"){h._initSimple()}}var c=[],g=null;if((c=h._getIcon(h.options.icons)).length!=0){g=true}else{if((c=h._getIcon(h.options.texticons)).length!=0){g=false}}if(g!=null){this.uiDialogButtonPanel=a('<span class="coral-textbox-btn-icons coral-corner-right"></span>');h.elementBorder.append(this.uiDialogButtonPanel);for(var f in c){a.each(c[f],function(i,k){var j=a('<span class="coral-textbox-btn-ico icon"></span>');if(g){j.addClass(i)}else{j.addClass("coral-textbox-btn-textico").html(i)}j.bind("click"+h.eventNamespace,function(l){if(h.options.disabled){return}h._triggerClick(k,l,[{value:h.element.val()}])});h.uiDialogButtonPanel.append(j)})}this.rightPos=this.uiDialogButtonPanel.outerWidth()}if(typeof this.element.attr("id")!="undefined"){this.options.id=this.element.attr("id")}else{if(this.options.id){this.element.attr("id",this.options.id)}}if(typeof this.element.attr("name")!="undefined"){this.options.name=this.element.attr("name")
}else{if(this.options.name){this.element.attr("name",this.options.name)}}if("TEXTAREA"===this.element[0].tagName){if(a.trim(this.element.text())!==""){this.options.value=this.element.text()}else{if(this.options.value){this.element.text(this.options.value)}}}else{if(a.trim(this.element.val())!==""){this.options.value=this.element.val()}else{if(this.options.value){this.element.val(this.options.value)}}}if(e.width!==""&&e.width!==b){this.uiTextbox.css("width",e.width)}if(e.height!==""&&e.height!==b){this._setOption("height",e.height)}if(e.readonlyInput){this._setReadonlyInput()}if(e.readonly){this._setReadonly()}if(typeof e.isLabel=="boolean"&&e.isLabel){this._setReadonly();this.options.readonly=true;this.component().addClass("coral-isLabel");return}if(typeof e.disabled==="boolean"&&e.disabled){this._setOption("disabled",e.disabled)}if(this.options.showClose){this.uiClose=a("<span class='coral-textbox-close cui-icon-cross2'></span>");this.elementBorder.append(this.uiClose);this.uiClose.css("right",this.rightPos?this.rightPos:0)}this.element.attr("placeholder",e.placeholder);if(e.placeholder&&""===this.element.val()){this._showPlaceholder()}this._updateTitle();this._refresh()},_setReadonlyInput:function(){if(typeof this.element.attr("readonly")!="undefined"){this.options.readonlyInput=this.element.prop("readonly")}else{if(this.options.readonlyInput){this.element.prop("readonly",this.options.readonlyInput)}}if(this.element.prop("readonly")){this.component().addClass("coral-readonlyInput")}},_setReadonly:function(){this.options.readonlyInput=true;this._setReadonlyInput();this.component().removeClass("coral-readonlyInput").addClass("coral-readonly");var c=this.component().find(".ctrl-init-button");c.button("disable")},_updateTitle:function(){var d=this,c=this.options;if(c.title==true){d.element.attr("title",d.element.val())}else{if(c.title==false){d.element.attr("title","")}else{d.element.attr("title",c.title)}}},_showPlaceholder:function(){if(a.support.placeholder){return}var d=this,c=a("<span class='coral-textbox-placeholder-label'>"+d.options.placeholder+"</span>");
a(d.element).after(c)},_hidePlaceholder:function(){if(a.support.placeholder){return}var c=this;c.uiTextbox.find(".coral-textbox-placeholder-label").remove()},_bindEvents:function(){var e=this,d=this.options;var c;this._on({"mouseenter.coral-textbox-border":function(f){if(typeof d.isLabel=="boolean"&&d.isLabel){return}if(typeof d.readonly=="boolean"&&d.readonly){return}e.component().addClass("coral-textbox-hover");this._trigger("onMouseEnter",f,[])},"mouseleave.coral-textbox-border":function(f){if(typeof d.isLabel=="boolean"&&d.isLabel){return}if(typeof d.readonly=="boolean"&&d.readonly){return}e.component().removeClass("coral-textbox-hover");this._trigger("onMouseLeave",f,[])},click:function(f){e._hidePlaceholder();this._trigger("onClick",f,[])},"click.coral-textbox-placeholder-label":function(f){e._hidePlaceholder();e.element.focus()},dblclick:function(f){this._trigger("onDblClick",f,[])},blur:function(f){this.component().removeClass("coral-state-focus");if(""===this.element.val()){this._showPlaceholder()}if(c){c=false;return}this.setValue(this.element.val(),true);this._trigger("onBlur",f,[])},focusin:function(f){if(d.isLabel||d.readonly||d.readonlyInput){this._trigger("onFocus",f,[{value:this.valuebox.val(),text:this.element.val()}]);return}this.component().addClass("coral-state-focus");this._trigger("onFocus",f,[{value:this.valuebox.val(),text:this.element.val()}])},keydown:function(f){if(d.isLabel||d.readonly||d.readonlyInput){return}this._trigger("onKeyDown",f,[{value:this.valuebox.val(),text:this.element.val(),id:this.options.id}]);if(f.keyCode==13){this.setValue(this.element.val(),true);this._trigger("onEnter",f,[{value:this.valuebox.val(),text:this.element.val()}])}this._hidePlaceholder()},keypress:function(f){if(d.isLabel||d.readonly||d.readonlyInput){return}this._trigger("onKeyPress",f,[{value:this.valuebox.val(),text:this.element.val()}])},keyup:function(f){if(d.isLabel||d.readonly||d.readonlyInput){return}if(this.options.valueChangedOnKeyUp){this.setValue(this.element.val(),true,false)
}this._trigger("onKeyUp",f,[{value:this.valuebox.val(),text:this.element.val(),id:this.options.id}])},"click.coral-textbox-close":function(f){f.preventDefault();this.setValue("",true);if(this.options.placeholder){this._showPlaceholder()}this._trigger("onCloseClick",event,[])},"mousedown.coral-textbox-close":function(f){f.stopPropagation();c=true}})},_refresh:function(){var d=this,c=this.options},_setOption:function(f,h){var g=this;if(f==="id"||f==="name"||f==="type"){return}if(f==="height"){if(typeof this.options.isLabel==="boolean"&&this.options.isLabel){return}if(h){this.component().outerHeight(h);this.uiTextbox.find(".coral-textbox-btn-textico").css({"line-height":(h-6)+"px",height:h+"px"})}}if(f==="width"){if(typeof this.options.isLabel==="boolean"&&this.options.isLabel){return}if(h){this.uiTextbox.css("width",this.options.width)}}this._super(f,h);if(f==="placeholder"){this.element.attr("placeholder",this.options.placeholder);if(this.getValue()===""){this._showPlaceholder()}}if(f=="texticons"){var d=g._getIcon(g.options.texticons);var c=a('<span class="coral-textbox-btn-icons coral-corner-right"></span>');g.elementBorder.find(".coral-textbox-btn-icons").replaceWith(c);for(var e in d){a.each(d[e],function(i,k){var j=a('<span class="coral-textbox-btn-ico icon"></span>').addClass("coral-textbox-btn-textico").html(i);j.bind("click"+g.eventNamespace,function(l){if(g.options.disabled){return}g._triggerClick(k,l,[{value:g.element.val()}])});c.append(j)})}}if(f==="value"){g._updateTitle();g.setValue(h,false)}if(f==="isLabel"){if(typeof h=="boolean"&&h){this._setReadonly();this.component().removeClass("coral-readonly").addClass("coral-isLabel")}else{if(typeof h=="boolean"&&!h){this.element.prop("readonly",false);this.options.readonly=false;this.component().find(".ctrl-init-button").button("enable");this.component().removeClass("coral-isLabel coral-readonly")}}}if(f==="readonly"){if(typeof h=="boolean"&&h){this._setReadonly();this.component().removeClass("coral-isLabel").addClass("coral-readonly")
}else{if(typeof h=="boolean"&&!h){this.element.prop("readonly",false);this.options.readonly=false;this.options.readonlyInput=false;this.component().find(".ctrl-init-button").button("enable");this.element.prop("readonly",false);this.component().removeClass("coral-isLabel coral-readonly")}}}if(f==="readonlyInput"){if(typeof h=="boolean"&&h){this._setReadonlyInput();this.component().removeClass("coral-isLabel").addClass("coral-readonlyInput")}else{if(typeof h=="boolean"&&!h){this.element.prop("readonly",false);this.options.readonlyInput=false;this.component().removeClass("coral-isLabel coral-readonlyInput")}}}if(f==="disabled"){if(h){this.element.prop("disabled",true);this.component().find(".ctrl-init-button").button("disable")}else{this.element.prop("disabled",false);this.component().find(".ctrl-init-button").button("enable")}}if(f==="labelField"){g._updateLabel(h)}if(f==="title"){g._updateTitle()}if(f==="hasTips"){g._updateTitle()}},_destroy:function(){this.uiTextbox.replaceWith(this.element);this.element.val("");this.element.removeAttr("value");this.element.removeClass("coral-textbox-default").removeClass("coral-validation-textbox").removeClass("coral-textbox-hover").removeClass("coral-textbox-textarea").removeClass("coral-textbox-input").removeAttr("placeholder").removeAttr("title").removeAttr("readonly").removeAttr("disabled")},disable:function(){this._setOption("disabled",true)},enable:function(){this._setOption("disabled",false)},getHtml:function(){return this.element.text()},setHtml:function(){this.element.text(value);this._updateTitle()},getValue:function(){return this.valuebox.val()},getValidateValue:function(){return this.getText()},getText:function(){if(this.component().hasClass("coral-state-focus")){if(this.element.is("textarea")){return this.element.text()}else{return this.element.val()}}else{return this.valuebox.val()}},setValue:function(g,d,f){var h=g,e;f=f!==false?true:false;var c=a.coral.toFunction(this.options.formatterText);if(a.isFunction(c)){h=c.apply(this.options.element,[{value:g}])
}if(f){this.setText(h)}this.valuebox.val(g);this.options.value=g;if(d&&this.previous!=g){this._trigger("onChange",null,[{value:g,text:h}])}this.previous=g;if(g!==""){this._hidePlaceholder()}},setText:function(c){if(this.element.is("textarea")){this.element.val(c);this.element.text(c)}else{this.element.val(c)}this._updateTitle()},formValue:function(){var d={},c=this.element.attr("name");if(!c){return null}d[c]=this.getValue();return d}})})(jQuery);